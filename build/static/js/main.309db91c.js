/*! For license information please see main.309db91c.js.LICENSE.txt */
(()=>{"use strict";var e={43:(e,t,n)=>{e.exports=n(202)},153:(e,t,n)=>{var i=n(43),s=Symbol.for("react.element"),r=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var i,r={},c=null,d=null;for(i in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,i)&&!l.hasOwnProperty(i)&&(r[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===r[i]&&(r[i]=t[i]);return{$$typeof:s,type:e,key:c,ref:d,props:r,_owner:o.current}}t.Fragment=r,t.jsx=c,t.jsxs=c},202:(e,t)=>{var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,f={};function y(e,t,n){this.props=e,this.context=t,this.refs=f,this.updater=n||m}function v(){}function b(e,t,n){this.props=e,this.context=t,this.refs=f,this.updater=n||m}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=y.prototype;var x=b.prototype=new v;x.constructor=b,g(x,y.prototype),x.isPureReactComponent=!0;var w=Array.isArray,_=Object.prototype.hasOwnProperty,S={current:null},C={key:!0,ref:!0,__self:!0,__source:!0};function A(e,t,i){var s,r={},a=null,o=null;if(null!=t)for(s in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)_.call(t,s)&&!C.hasOwnProperty(s)&&(r[s]=t[s]);var l=arguments.length-2;if(1===l)r.children=i;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];r.children=c}if(e&&e.defaultProps)for(s in l=e.defaultProps)void 0===r[s]&&(r[s]=l[s]);return{$$typeof:n,type:e,key:a,ref:o,props:r,_owner:S.current}}function E(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var T=/\/+/g;function k(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function N(e,t,s,r,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case i:l=!0}}if(l)return a=a(l=e),e=""===r?"."+k(l,0):r,w(a)?(s="",null!=e&&(s=e.replace(T,"$&/")+"/"),N(a,t,s,"",function(e){return e})):null!=a&&(E(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,s+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(T,"$&/")+"/")+e)),t.push(a)),1;if(l=0,r=""===r?".":r+":",w(e))for(var c=0;c<e.length;c++){var d=r+k(o=e[c],c);l+=N(o,t,s,d,a)}else if(d=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof d)for(e=d.call(e),c=0;!(o=e.next()).done;)l+=N(o=o.value,t,s,d=r+k(o,c++),a);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function I(e,t,n){if(null==e)return e;var i=[],s=0;return N(e,i,"","",function(e){return t.call(n,e,s++)}),i}function D(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P={current:null},M={transition:null},R={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:M,ReactCurrentOwner:S};function L(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:I,forEach:function(e,t,n){I(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return I(e,function(){t++}),t},toArray:function(e){return I(e,function(e){return e})||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=s,t.Profiler=a,t.PureComponent=b,t.StrictMode=r,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=R,t.act=L,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=g({},e.props),r=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=S.current),void 0!==t.key&&(r=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)_.call(t,c)&&!C.hasOwnProperty(c)&&(s[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)s.children=i;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];s.children=l}return{$$typeof:n,type:e.type,key:r,ref:a,props:s,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=A,t.createFactory=function(e){var t=A.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:D}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=M.transition;M.transition={};try{e()}finally{M.transition=t}},t.unstable_act=L,t.useCallback=function(e,t){return P.current.useCallback(e,t)},t.useContext=function(e){return P.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return P.current.useDeferredValue(e)},t.useEffect=function(e,t){return P.current.useEffect(e,t)},t.useId=function(){return P.current.useId()},t.useImperativeHandle=function(e,t,n){return P.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return P.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return P.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return P.current.useMemo(e,t)},t.useReducer=function(e,t,n){return P.current.useReducer(e,t,n)},t.useRef=function(e){return P.current.useRef(e)},t.useState=function(e){return P.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return P.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return P.current.useTransition()},t.version="18.3.1"},234:(e,t)=>{function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,s=e[i];if(!(0<r(s,t)))break e;e[i]=t,e[n]=s,n=i}}function i(e){return 0===e.length?null:e[0]}function s(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,s=e.length,a=s>>>1;i<a;){var o=2*(i+1)-1,l=e[o],c=o+1,d=e[c];if(0>r(l,n))c<s&&0>r(d,l)?(e[i]=d,e[c]=n,i=c):(e[i]=l,e[o]=n,i=o);else{if(!(c<s&&0>r(d,n)))break e;e[i]=d,e[c]=n,i=c}}}return t}function r(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],d=[],u=1,h=null,p=3,m=!1,g=!1,f=!1,y="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=i(d);null!==t;){if(null===t.callback)s(d);else{if(!(t.startTime<=e))break;s(d),t.sortIndex=t.expirationTime,n(c,t)}t=i(d)}}function w(e){if(f=!1,x(e),!g)if(null!==i(c))g=!0,M(_);else{var t=i(d);null!==t&&R(w,t.startTime-e)}}function _(e,n){g=!1,f&&(f=!1,v(E),E=-1),m=!0;var r=p;try{for(x(n),h=i(c);null!==h&&(!(h.expirationTime>n)||e&&!N());){var a=h.callback;if("function"===typeof a){h.callback=null,p=h.priorityLevel;var o=a(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?h.callback=o:h===i(c)&&s(c),x(n)}else s(c);h=i(c)}if(null!==h)var l=!0;else{var u=i(d);null!==u&&R(w,u.startTime-n),l=!1}return l}finally{h=null,p=r,m=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,C=!1,A=null,E=-1,T=5,k=-1;function N(){return!(t.unstable_now()-k<T)}function I(){if(null!==A){var e=t.unstable_now();k=e;var n=!0;try{n=A(!0,e)}finally{n?S():(C=!1,A=null)}}else C=!1}if("function"===typeof b)S=function(){b(I)};else if("undefined"!==typeof MessageChannel){var D=new MessageChannel,P=D.port2;D.port1.onmessage=I,S=function(){P.postMessage(null)}}else S=function(){y(I,0)};function M(e){A=e,C||(C=!0,S())}function R(e,n){E=y(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){g||m||(g=!0,M(_))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,s,r){var a=t.unstable_now();switch("object"===typeof r&&null!==r?r="number"===typeof(r=r.delay)&&0<r?a+r:a:r=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:u++,callback:s,priorityLevel:e,startTime:r,expirationTime:o=r+o,sortIndex:-1},r>a?(e.sortIndex=r,n(d,e),null===i(c)&&e===i(d)&&(f?(v(E),E=-1):f=!0,R(w,r-a))):(e.sortIndex=o,n(c,e),g||m||(g=!0,M(_))),e},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},391:(e,t,n)=>{var i=n(950);t.createRoot=i.createRoot,t.hydrateRoot=i.hydrateRoot},579:(e,t,n)=>{e.exports=n(153)},730:(e,t,n)=>{var i=n(43),s=n(853);function r(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)a.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},m={};function g(e,t,n,i,s,r,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=r,this.removeEmptyString=a}var f={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){f[e]=new g(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];f[t]=new g(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){f[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){f[e]=new g(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){f[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){f[e]=new g(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){f[e]=new g(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){f[e]=new g(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){f[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)});var y=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function b(e,t,n,i){var s=f.hasOwnProperty(t)?f[t]:null;(null!==s?0!==s.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,s,i)&&(n=null),i||null===s?function(e){return!!u.call(m,e)||!u.call(p,e)&&(h.test(e)?m[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):s.mustUseProperty?e[s.propertyName]=null===n?3!==s.type&&"":n:(t=s.attributeName,i=s.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(s=s.type)||4===s&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(y,v);f[t]=new g(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(y,v);f[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(y,v);f[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){f[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)}),f.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){f[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)});var x=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),_=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),A=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),T=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),P=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var M=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var R=Symbol.iterator;function L(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=R&&e[R]||e["@@iterator"])?e:null}var j,O=Object.assign;function F(e){if(void 0===j)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);j=t&&t[1]||""}return"\n"+j+e}var B=!1;function U(e,t){if(!e||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var i=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){i=c}e.call(t.prototype)}else{try{throw Error()}catch(c){i=c}e()}}catch(c){if(c&&i&&"string"===typeof c.stack){for(var s=c.stack.split("\n"),r=i.stack.split("\n"),a=s.length-1,o=r.length-1;1<=a&&0<=o&&s[a]!==r[o];)o--;for(;1<=a&&0<=o;a--,o--)if(s[a]!==r[o]){if(1!==a||1!==o)do{if(a--,0>--o||s[a]!==r[o]){var l="\n"+s[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=o);break}}}finally{B=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?F(e):""}function z(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=U(e.type,!1);case 11:return e=U(e.type.render,!1);case 1:return e=U(e.type,!0);default:return""}}function V(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case _:return"Portal";case A:return"Profiler";case C:return"StrictMode";case N:return"Suspense";case I:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case T:return(e.displayName||"Context")+".Consumer";case E:return(e._context.displayName||"Context")+".Provider";case k:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case D:return null!==(t=e.displayName||null)?t:V(e.type)||"Memo";case P:t=e._payload,e=e._init;try{return V(e(t))}catch(n){}}return null}function H(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(t);case 8:return t===C?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function $(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function q(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function G(e){e._valueTracker||(e._valueTracker=function(e){var t=q(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var s=n.get,r=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(e){i=""+e,r.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function W(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=q(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function K(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var n=t.checked;return O({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function X(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=$(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Y(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function J(e,t){Y(e,t);var n=$(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,$(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&K(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var s=0;s<n.length;s++)t["$"+n[s]]=!0;for(n=0;n<e.length;n++)s=t.hasOwnProperty("$"+e[n].value),e[n].selected!==s&&(e[n].selected=s),s&&i&&(e[n].defaultSelected=!0)}else{for(n=""+$(n),t=null,s=0;s<e.length;s++){if(e[s].value===n)return e[s].selected=!0,void(i&&(e[s].defaultSelected=!0));null!==t||e[s].disabled||(t=e[s])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(r(91));return O({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function se(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(r(92));if(te(n)){if(1<n.length)throw Error(r(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:$(n)}}function re(e,t){var n=$(t.value),i=$(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,de,ue=(de=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction(function(){return de(e,t)})}:de);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},me=["Webkit","ms","Moz","O"];function ge(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function fe(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),s=ge(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,s):e[n]=s}}Object.keys(pe).forEach(function(e){me.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]})});var ye=O({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(r(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(r(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(r(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(r(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var _e=null,Se=null,Ce=null;function Ae(e){if(e=bs(e)){if("function"!==typeof _e)throw Error(r(280));var t=e.stateNode;t&&(t=ws(t),_e(e.stateNode,e.type,t))}}function Ee(e){Se?Ce?Ce.push(e):Ce=[e]:Se=e}function Te(){if(Se){var e=Se,t=Ce;if(Ce=Se=null,Ae(e),t)for(e=0;e<t.length;e++)Ae(t[e])}}function ke(e,t){return e(t)}function Ne(){}var Ie=!1;function De(e,t,n){if(Ie)return e(t,n);Ie=!0;try{return ke(e,t,n)}finally{Ie=!1,(null!==Se||null!==Ce)&&(Ne(),Te())}}function Pe(e,t){var n=e.stateNode;if(null===n)return null;var i=ws(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(r(231,t,typeof n));return n}var Me=!1;if(d)try{var Re={};Object.defineProperty(Re,"passive",{get:function(){Me=!0}}),window.addEventListener("test",Re,Re),window.removeEventListener("test",Re,Re)}catch(de){Me=!1}function Le(e,t,n,i,s,r,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(d){this.onError(d)}}var je=!1,Oe=null,Fe=!1,Be=null,Ue={onError:function(e){je=!0,Oe=e}};function ze(e,t,n,i,s,r,a,o,l){je=!1,Oe=null,Le.apply(Ue,arguments)}function Ve(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function He(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function $e(e){if(Ve(e)!==e)throw Error(r(188))}function qe(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ve(e)))throw Error(r(188));return t!==e?null:e}for(var n=e,i=t;;){var s=n.return;if(null===s)break;var a=s.alternate;if(null===a){if(null!==(i=s.return)){n=i;continue}break}if(s.child===a.child){for(a=s.child;a;){if(a===n)return $e(s),e;if(a===i)return $e(s),t;a=a.sibling}throw Error(r(188))}if(n.return!==i.return)n=s,i=a;else{for(var o=!1,l=s.child;l;){if(l===n){o=!0,n=s,i=a;break}if(l===i){o=!0,i=s,n=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===n){o=!0,n=a,i=s;break}if(l===i){o=!0,i=a,n=s;break}l=l.sibling}if(!o)throw Error(r(189))}}if(n.alternate!==i)throw Error(r(190))}if(3!==n.tag)throw Error(r(188));return n.stateNode.current===n?e:t}(e))?Ge(e):null}function Ge(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ge(e);if(null!==t)return t;e=e.sibling}return null}var We=s.unstable_scheduleCallback,Ke=s.unstable_cancelCallback,Qe=s.unstable_shouldYield,Xe=s.unstable_requestPaint,Ye=s.unstable_now,Je=s.unstable_getCurrentPriorityLevel,Ze=s.unstable_ImmediatePriority,et=s.unstable_UserBlockingPriority,tt=s.unstable_NormalPriority,nt=s.unstable_LowPriority,it=s.unstable_IdlePriority,st=null,rt=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2;var ct=64,dt=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,s=e.suspendedLanes,r=e.pingedLanes,a=268435455&n;if(0!==a){var o=a&~s;0!==o?i=ut(o):0!==(r&=a)&&(i=ut(r))}else 0!==(a=n&~s)?i=ut(a):0!==r&&(i=ut(r));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&s)&&((s=i&-i)>=(r=t&-t)||16===s&&0!==(4194240&r)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)s=1<<(n=31-at(t)),i|=e[n],t&=~s;return i}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function mt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function gt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function ft(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function vt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-at(n),s=1<<i;s&t|e[i]&t&&(e[i]|=t),n&=~s}}var bt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var wt,_t,St,Ct,At,Et=!1,Tt=[],kt=null,Nt=null,It=null,Dt=new Map,Pt=new Map,Mt=[],Rt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":kt=null;break;case"dragenter":case"dragleave":Nt=null;break;case"mouseover":case"mouseout":It=null;break;case"pointerover":case"pointerout":Dt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pt.delete(t.pointerId)}}function jt(e,t,n,i,s,r){return null===e||e.nativeEvent!==r?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:r,targetContainers:[s]},null!==t&&(null!==(t=bs(t))&&_t(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==s&&-1===t.indexOf(s)&&t.push(s),e)}function Ot(e){var t=vs(e.target);if(null!==t){var n=Ve(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=He(n)))return e.blockedOn=t,void At(e.priority,function(){St(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=bs(n))&&_t(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);xe=i,n.target.dispatchEvent(i),xe=null,t.shift()}return!0}function Bt(e,t,n){Ft(e)&&n.delete(t)}function Ut(){Et=!1,null!==kt&&Ft(kt)&&(kt=null),null!==Nt&&Ft(Nt)&&(Nt=null),null!==It&&Ft(It)&&(It=null),Dt.forEach(Bt),Pt.forEach(Bt)}function zt(e,t){e.blockedOn===t&&(e.blockedOn=null,Et||(Et=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,Ut)))}function Vt(e){function t(t){return zt(t,e)}if(0<Tt.length){zt(Tt[0],e);for(var n=1;n<Tt.length;n++){var i=Tt[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==kt&&zt(kt,e),null!==Nt&&zt(Nt,e),null!==It&&zt(It,e),Dt.forEach(t),Pt.forEach(t),n=0;n<Mt.length;n++)(i=Mt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Mt.length&&null===(n=Mt[0]).blockedOn;)Ot(n),null===n.blockedOn&&Mt.shift()}var Ht=x.ReactCurrentBatchConfig,$t=!0;function qt(e,t,n,i){var s=bt,r=Ht.transition;Ht.transition=null;try{bt=1,Wt(e,t,n,i)}finally{bt=s,Ht.transition=r}}function Gt(e,t,n,i){var s=bt,r=Ht.transition;Ht.transition=null;try{bt=4,Wt(e,t,n,i)}finally{bt=s,Ht.transition=r}}function Wt(e,t,n,i){if($t){var s=Qt(e,t,n,i);if(null===s)$i(e,t,i,Kt,n),Lt(e,i);else if(function(e,t,n,i,s){switch(t){case"focusin":return kt=jt(kt,e,t,n,i,s),!0;case"dragenter":return Nt=jt(Nt,e,t,n,i,s),!0;case"mouseover":return It=jt(It,e,t,n,i,s),!0;case"pointerover":var r=s.pointerId;return Dt.set(r,jt(Dt.get(r)||null,e,t,n,i,s)),!0;case"gotpointercapture":return r=s.pointerId,Pt.set(r,jt(Pt.get(r)||null,e,t,n,i,s)),!0}return!1}(s,e,t,n,i))i.stopPropagation();else if(Lt(e,i),4&t&&-1<Rt.indexOf(e)){for(;null!==s;){var r=bs(s);if(null!==r&&wt(r),null===(r=Qt(e,t,n,i))&&$i(e,t,i,Kt,n),r===s)break;s=r}null!==s&&i.stopPropagation()}else $i(e,t,i,null,n)}}var Kt=null;function Qt(e,t,n,i){if(Kt=null,null!==(e=vs(e=we(i))))if(null===(t=Ve(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=He(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function Xt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var Yt=null,Jt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Jt,i=n.length,s="value"in Yt?Yt.value:Yt.textContent,r=s.length;for(e=0;e<i&&n[e]===s[e];e++);var a=i-e;for(t=1;t<=a&&n[i-t]===s[r-t];t++);return Zt=s.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function sn(){return!1}function rn(e){function t(t,n,i,s,r){for(var a in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=s,this.target=r,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(null!=s.defaultPrevented?s.defaultPrevented:!1===s.returnValue)?nn:sn,this.isPropagationStopped=sn,this}return O(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,on,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dn=rn(cn),un=O({},cn,{view:0,detail:0}),hn=rn(un),pn=O({},un,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:An,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(an=e.screenX-ln.screenX,on=e.screenY-ln.screenY):on=an=0,ln=e),an)},movementY:function(e){return"movementY"in e?e.movementY:on}}),mn=rn(pn),gn=rn(O({},pn,{dataTransfer:0})),fn=rn(O({},un,{relatedTarget:0})),yn=rn(O({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=O({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=rn(vn),xn=rn(O({},cn,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_n={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Cn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function An(){return Cn}var En=O({},un,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?_n[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:An,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Tn=rn(En),kn=rn(O({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Nn=rn(O({},un,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:An})),In=rn(O({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Dn=O({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Pn=rn(Dn),Mn=[9,13,27,32],Rn=d&&"CompositionEvent"in window,Ln=null;d&&"documentMode"in document&&(Ln=document.documentMode);var jn=d&&"TextEvent"in window&&!Ln,On=d&&(!Rn||Ln&&8<Ln&&11>=Ln),Fn=String.fromCharCode(32),Bn=!1;function Un(e,t){switch(e){case"keyup":return-1!==Mn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Vn=!1;var Hn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $n(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Hn[e.type]:"textarea"===t}function qn(e,t,n,i){Ee(i),0<(t=Gi(t,"onChange")).length&&(n=new dn("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Gn=null,Wn=null;function Kn(e){Fi(e,0)}function Qn(e){if(W(xs(e)))return e}function Xn(e,t){if("change"===e)return t}var Yn=!1;if(d){var Jn;if(d){var Zn="oninput"in document;if(!Zn){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),Zn="function"===typeof ei.oninput}Jn=Zn}else Jn=!1;Yn=Jn&&(!document.documentMode||9<document.documentMode)}function ti(){Gn&&(Gn.detachEvent("onpropertychange",ni),Wn=Gn=null)}function ni(e){if("value"===e.propertyName&&Qn(Wn)){var t=[];qn(t,Wn,e,we(e)),De(Kn,t)}}function ii(e,t,n){"focusin"===e?(ti(),Wn=n,(Gn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function si(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Qn(Wn)}function ri(e,t){if("click"===e)return Qn(t)}function ai(e,t){if("input"===e||"change"===e)return Qn(t)}var oi="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function li(e,t){if(oi(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var s=n[i];if(!u.call(t,s)||!oi(e[s],t[s]))return!1}return!0}function ci(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function di(e,t){var n,i=ci(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ci(i)}}function ui(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?ui(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hi(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=K((e=t.contentWindow).document)}return t}function pi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function mi(e){var t=hi(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&ui(n.ownerDocument.documentElement,n)){if(null!==i&&pi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var s=n.textContent.length,r=Math.min(i.start,s);i=void 0===i.end?r:Math.min(i.end,s),!e.extend&&r>i&&(s=i,i=r,r=s),s=di(n,r);var a=di(n,i);s&&a&&(1!==e.rangeCount||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(s.node,s.offset),e.removeAllRanges(),r>i?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var gi=d&&"documentMode"in document&&11>=document.documentMode,fi=null,yi=null,vi=null,bi=!1;function xi(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;bi||null==fi||fi!==K(i)||("selectionStart"in(i=fi)&&pi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},vi&&li(vi,i)||(vi=i,0<(i=Gi(yi,"onSelect")).length&&(t=new dn("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=fi)))}function wi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var _i={animationend:wi("Animation","AnimationEnd"),animationiteration:wi("Animation","AnimationIteration"),animationstart:wi("Animation","AnimationStart"),transitionend:wi("Transition","TransitionEnd")},Si={},Ci={};function Ai(e){if(Si[e])return Si[e];if(!_i[e])return e;var t,n=_i[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ci)return Si[e]=n[t];return e}d&&(Ci=document.createElement("div").style,"AnimationEvent"in window||(delete _i.animationend.animation,delete _i.animationiteration.animation,delete _i.animationstart.animation),"TransitionEvent"in window||delete _i.transitionend.transition);var Ei=Ai("animationend"),Ti=Ai("animationiteration"),ki=Ai("animationstart"),Ni=Ai("transitionend"),Ii=new Map,Di="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pi(e,t){Ii.set(e,t),l(t,[e])}for(var Mi=0;Mi<Di.length;Mi++){var Ri=Di[Mi];Pi(Ri.toLowerCase(),"on"+(Ri[0].toUpperCase()+Ri.slice(1)))}Pi(Ei,"onAnimationEnd"),Pi(Ti,"onAnimationIteration"),Pi(ki,"onAnimationStart"),Pi("dblclick","onDoubleClick"),Pi("focusin","onFocus"),Pi("focusout","onBlur"),Pi(Ni,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Li="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ji=new Set("cancel close invalid load scroll toggle".split(" ").concat(Li));function Oi(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,s,a,o,l,c){if(ze.apply(this,arguments),je){if(!je)throw Error(r(198));var d=Oe;je=!1,Oe=null,Fe||(Fe=!0,Be=d)}}(i,t,void 0,e),e.currentTarget=null}function Fi(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],s=i.event;i=i.listeners;e:{var r=void 0;if(t)for(var a=i.length-1;0<=a;a--){var o=i[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==r&&s.isPropagationStopped())break e;Oi(s,o,c),r=l}else for(a=0;a<i.length;a++){if(l=(o=i[a]).instance,c=o.currentTarget,o=o.listener,l!==r&&s.isPropagationStopped())break e;Oi(s,o,c),r=l}}}if(Fe)throw e=Be,Fe=!1,Be=null,e}function Bi(e,t){var n=t[gs];void 0===n&&(n=t[gs]=new Set);var i=e+"__bubble";n.has(i)||(Hi(t,e,2,!1),n.add(i))}function Ui(e,t,n){var i=0;t&&(i|=4),Hi(n,e,i,t)}var zi="_reactListening"+Math.random().toString(36).slice(2);function Vi(e){if(!e[zi]){e[zi]=!0,a.forEach(function(t){"selectionchange"!==t&&(ji.has(t)||Ui(t,!1,e),Ui(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[zi]||(t[zi]=!0,Ui("selectionchange",!1,t))}}function Hi(e,t,n,i){switch(Xt(t)){case 1:var s=qt;break;case 4:s=Gt;break;default:s=Wt}n=s.bind(null,t,n,e),s=void 0,!Me||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(s=!0),i?void 0!==s?e.addEventListener(t,n,{capture:!0,passive:s}):e.addEventListener(t,n,!0):void 0!==s?e.addEventListener(t,n,{passive:s}):e.addEventListener(t,n,!1)}function $i(e,t,n,i,s){var r=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var a=i.tag;if(3===a||4===a){var o=i.stateNode.containerInfo;if(o===s||8===o.nodeType&&o.parentNode===s)break;if(4===a)for(a=i.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===s||8===l.nodeType&&l.parentNode===s))return;a=a.return}for(;null!==o;){if(null===(a=vs(o)))return;if(5===(l=a.tag)||6===l){i=r=a;continue e}o=o.parentNode}}i=i.return}De(function(){var i=r,s=we(n),a=[];e:{var o=Ii.get(e);if(void 0!==o){var l=dn,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=Tn;break;case"focusin":c="focus",l=fn;break;case"focusout":c="blur",l=fn;break;case"beforeblur":case"afterblur":l=fn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=mn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=gn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Nn;break;case Ei:case Ti:case ki:l=yn;break;case Ni:l=In;break;case"scroll":l=hn;break;case"wheel":l=Pn;break;case"copy":case"cut":case"paste":l=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=kn}var d=0!==(4&t),u=!d&&"scroll"===e,h=d?null!==o?o+"Capture":null:o;d=[];for(var p,m=i;null!==m;){var g=(p=m).stateNode;if(5===p.tag&&null!==g&&(p=g,null!==h&&(null!=(g=Pe(m,h))&&d.push(qi(m,g,p)))),u)break;m=m.return}0<d.length&&(o=new l(o,c,null,n,s),a.push({event:o,listeners:d}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===xe||!(c=n.relatedTarget||n.fromElement)||!vs(c)&&!c[ms])&&(l||o)&&(o=s.window===s?s:(o=s.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?vs(c):null)&&(c!==(u=Ve(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(d=mn,g="onMouseLeave",h="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(d=kn,g="onPointerLeave",h="onPointerEnter",m="pointer"),u=null==l?o:xs(l),p=null==c?o:xs(c),(o=new d(g,m+"leave",l,n,s)).target=u,o.relatedTarget=p,g=null,vs(s)===i&&((d=new d(h,m+"enter",c,n,s)).target=p,d.relatedTarget=u,g=d),u=g,l&&c)e:{for(h=c,m=0,p=d=l;p;p=Wi(p))m++;for(p=0,g=h;g;g=Wi(g))p++;for(;0<m-p;)d=Wi(d),m--;for(;0<p-m;)h=Wi(h),p--;for(;m--;){if(d===h||null!==h&&d===h.alternate)break e;d=Wi(d),h=Wi(h)}d=null}else d=null;null!==l&&Ki(a,o,l,d,!1),null!==c&&null!==u&&Ki(a,u,c,d,!0)}if("select"===(l=(o=i?xs(i):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var f=Xn;else if($n(o))if(Yn)f=ai;else{f=si;var y=ii}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(f=ri);switch(f&&(f=f(e,i))?qn(a,f,n,s):(y&&y(e,o,i),"focusout"===e&&(y=o._wrapperState)&&y.controlled&&"number"===o.type&&ee(o,"number",o.value)),y=i?xs(i):window,e){case"focusin":($n(y)||"true"===y.contentEditable)&&(fi=y,yi=i,vi=null);break;case"focusout":vi=yi=fi=null;break;case"mousedown":bi=!0;break;case"contextmenu":case"mouseup":case"dragend":bi=!1,xi(a,n,s);break;case"selectionchange":if(gi)break;case"keydown":case"keyup":xi(a,n,s)}var v;if(Rn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Vn?Un(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(On&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Vn&&(v=en()):(Jt="value"in(Yt=s)?Yt.value:Yt.textContent,Vn=!0)),0<(y=Gi(i,b)).length&&(b=new xn(b,e,null,n,s),a.push({event:b,listeners:y}),v?b.data=v:null!==(v=zn(n))&&(b.data=v))),(v=jn?function(e,t){switch(e){case"compositionend":return zn(t);case"keypress":return 32!==t.which?null:(Bn=!0,Fn);case"textInput":return(e=t.data)===Fn&&Bn?null:e;default:return null}}(e,n):function(e,t){if(Vn)return"compositionend"===e||!Rn&&Un(e,t)?(e=en(),Zt=Jt=Yt=null,Vn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return On&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Gi(i,"onBeforeInput")).length&&(s=new xn("onBeforeInput","beforeinput",null,n,s),a.push({event:s,listeners:i}),s.data=v))}Fi(a,t)})}function qi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Gi(e,t){for(var n=t+"Capture",i=[];null!==e;){var s=e,r=s.stateNode;5===s.tag&&null!==r&&(s=r,null!=(r=Pe(e,n))&&i.unshift(qi(e,r,s)),null!=(r=Pe(e,t))&&i.push(qi(e,r,s))),e=e.return}return i}function Wi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Ki(e,t,n,i,s){for(var r=t._reactName,a=[];null!==n&&n!==i;){var o=n,l=o.alternate,c=o.stateNode;if(null!==l&&l===i)break;5===o.tag&&null!==c&&(o=c,s?null!=(l=Pe(n,r))&&a.unshift(qi(n,l,o)):s||null!=(l=Pe(n,r))&&a.push(qi(n,l,o))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Qi=/\r\n?/g,Xi=/\u0000|\uFFFD/g;function Yi(e){return("string"===typeof e?e:""+e).replace(Qi,"\n").replace(Xi,"")}function Ji(e,t,n){if(t=Yi(t),Yi(e)!==t&&n)throw Error(r(425))}function Zi(){}var es=null,ts=null;function ns(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var is="function"===typeof setTimeout?setTimeout:void 0,ss="function"===typeof clearTimeout?clearTimeout:void 0,rs="function"===typeof Promise?Promise:void 0,as="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof rs?function(e){return rs.resolve(null).then(e).catch(os)}:is;function os(e){setTimeout(function(){throw e})}function ls(e,t){var n=t,i=0;do{var s=n.nextSibling;if(e.removeChild(n),s&&8===s.nodeType)if("/$"===(n=s.data)){if(0===i)return e.removeChild(s),void Vt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=s}while(n);Vt(t)}function cs(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ds(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var us=Math.random().toString(36).slice(2),hs="__reactFiber$"+us,ps="__reactProps$"+us,ms="__reactContainer$"+us,gs="__reactEvents$"+us,fs="__reactListeners$"+us,ys="__reactHandles$"+us;function vs(e){var t=e[hs];if(t)return t;for(var n=e.parentNode;n;){if(t=n[ms]||n[hs]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ds(e);null!==e;){if(n=e[hs])return n;e=ds(e)}return t}n=(e=n).parentNode}return null}function bs(e){return!(e=e[hs]||e[ms])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xs(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(r(33))}function ws(e){return e[ps]||null}var _s=[],Ss=-1;function Cs(e){return{current:e}}function As(e){0>Ss||(e.current=_s[Ss],_s[Ss]=null,Ss--)}function Es(e,t){Ss++,_s[Ss]=e.current,e.current=t}var Ts={},ks=Cs(Ts),Ns=Cs(!1),Is=Ts;function Ds(e,t){var n=e.type.contextTypes;if(!n)return Ts;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var s,r={};for(s in n)r[s]=t[s];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function Ps(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Ms(){As(Ns),As(ks)}function Rs(e,t,n){if(ks.current!==Ts)throw Error(r(168));Es(ks,t),Es(Ns,n)}function Ls(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var s in i=i.getChildContext())if(!(s in t))throw Error(r(108,H(e)||"Unknown",s));return O({},n,i)}function js(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ts,Is=ks.current,Es(ks,e),Es(Ns,Ns.current),!0}function Os(e,t,n){var i=e.stateNode;if(!i)throw Error(r(169));n?(e=Ls(e,t,Is),i.__reactInternalMemoizedMergedChildContext=e,As(Ns),As(ks),Es(ks,e)):As(Ns),Es(Ns,n)}var Fs=null,Bs=!1,Us=!1;function zs(e){null===Fs?Fs=[e]:Fs.push(e)}function Vs(){if(!Us&&null!==Fs){Us=!0;var e=0,t=bt;try{var n=Fs;for(bt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Fs=null,Bs=!1}catch(s){throw null!==Fs&&(Fs=Fs.slice(e+1)),We(Ze,Vs),s}finally{bt=t,Us=!1}}return null}var Hs=[],$s=0,qs=null,Gs=0,Ws=[],Ks=0,Qs=null,Xs=1,Ys="";function Js(e,t){Hs[$s++]=Gs,Hs[$s++]=qs,qs=e,Gs=t}function Zs(e,t,n){Ws[Ks++]=Xs,Ws[Ks++]=Ys,Ws[Ks++]=Qs,Qs=e;var i=Xs;e=Ys;var s=32-at(i)-1;i&=~(1<<s),n+=1;var r=32-at(t)+s;if(30<r){var a=s-s%5;r=(i&(1<<a)-1).toString(32),i>>=a,s-=a,Xs=1<<32-at(t)+s|n<<s|i,Ys=r+e}else Xs=1<<r|n<<s|i,Ys=e}function er(e){null!==e.return&&(Js(e,1),Zs(e,1,0))}function tr(e){for(;e===qs;)qs=Hs[--$s],Hs[$s]=null,Gs=Hs[--$s],Hs[$s]=null;for(;e===Qs;)Qs=Ws[--Ks],Ws[Ks]=null,Ys=Ws[--Ks],Ws[Ks]=null,Xs=Ws[--Ks],Ws[Ks]=null}var nr=null,ir=null,sr=!1,rr=null;function ar(e,t){var n=Pc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function or(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,nr=e,ir=cs(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,nr=e,ir=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Qs?{id:Xs,overflow:Ys}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Pc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,nr=e,ir=null,!0);default:return!1}}function lr(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function cr(e){if(sr){var t=ir;if(t){var n=t;if(!or(e,t)){if(lr(e))throw Error(r(418));t=cs(n.nextSibling);var i=nr;t&&or(e,t)?ar(i,n):(e.flags=-4097&e.flags|2,sr=!1,nr=e)}}else{if(lr(e))throw Error(r(418));e.flags=-4097&e.flags|2,sr=!1,nr=e}}}function dr(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;nr=e}function ur(e){if(e!==nr)return!1;if(!sr)return dr(e),sr=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ns(e.type,e.memoizedProps)),t&&(t=ir)){if(lr(e))throw hr(),Error(r(418));for(;t;)ar(e,t),t=cs(t.nextSibling)}if(dr(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(r(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ir=cs(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ir=null}}else ir=nr?cs(e.stateNode.nextSibling):null;return!0}function hr(){for(var e=ir;e;)e=cs(e.nextSibling)}function pr(){ir=nr=null,sr=!1}function mr(e){null===rr?rr=[e]:rr.push(e)}var gr=x.ReactCurrentBatchConfig;function fr(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(r(309));var i=n.stateNode}if(!i)throw Error(r(147,e));var s=i,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=s.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(r(284));if(!n._owner)throw Error(r(290,e))}return e}function yr(e,t){throw e=Object.prototype.toString.call(t),Error(r(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function vr(e){return(0,e._init)(e._payload)}function br(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function s(e,t){return(e=Rc(e,t)).index=0,e.sibling=null,e}function a(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=Fc(n,e.mode,i)).return=e,t):((t=s(t,n)).return=e,t)}function c(e,t,n,i){var r=n.type;return r===S?u(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===r||"object"===typeof r&&null!==r&&r.$$typeof===P&&vr(r)===t.type)?((i=s(t,n.props)).ref=fr(e,t,n),i.return=e,i):((i=Lc(n.type,n.key,n.props,null,e.mode,i)).ref=fr(e,t,n),i.return=e,i)}function d(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Bc(n,e.mode,i)).return=e,t):((t=s(t,n.children||[])).return=e,t)}function u(e,t,n,i,r){return null===t||7!==t.tag?((t=jc(n,e.mode,i,r)).return=e,t):((t=s(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Fc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Lc(t.type,t.key,t.props,null,e.mode,n)).ref=fr(e,null,t),n.return=e,n;case _:return(t=Bc(t,e.mode,n)).return=e,t;case P:return h(e,(0,t._init)(t._payload),n)}if(te(t)||L(t))return(t=jc(t,e.mode,n,null)).return=e,t;yr(e,t)}return null}function p(e,t,n,i){var s=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==s?null:l(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===s?c(e,t,n,i):null;case _:return n.key===s?d(e,t,n,i):null;case P:return p(e,t,(s=n._init)(n._payload),i)}if(te(n)||L(n))return null!==s?null:u(e,t,n,i,null);yr(e,n)}return null}function m(e,t,n,i,s){if("string"===typeof i&&""!==i||"number"===typeof i)return l(t,e=e.get(n)||null,""+i,s);if("object"===typeof i&&null!==i){switch(i.$$typeof){case w:return c(t,e=e.get(null===i.key?n:i.key)||null,i,s);case _:return d(t,e=e.get(null===i.key?n:i.key)||null,i,s);case P:return m(e,t,n,(0,i._init)(i._payload),s)}if(te(i)||L(i))return u(t,e=e.get(n)||null,i,s,null);yr(t,i)}return null}function g(s,r,o,l){for(var c=null,d=null,u=r,g=r=0,f=null;null!==u&&g<o.length;g++){u.index>g?(f=u,u=null):f=u.sibling;var y=p(s,u,o[g],l);if(null===y){null===u&&(u=f);break}e&&u&&null===y.alternate&&t(s,u),r=a(y,r,g),null===d?c=y:d.sibling=y,d=y,u=f}if(g===o.length)return n(s,u),sr&&Js(s,g),c;if(null===u){for(;g<o.length;g++)null!==(u=h(s,o[g],l))&&(r=a(u,r,g),null===d?c=u:d.sibling=u,d=u);return sr&&Js(s,g),c}for(u=i(s,u);g<o.length;g++)null!==(f=m(u,s,g,o[g],l))&&(e&&null!==f.alternate&&u.delete(null===f.key?g:f.key),r=a(f,r,g),null===d?c=f:d.sibling=f,d=f);return e&&u.forEach(function(e){return t(s,e)}),sr&&Js(s,g),c}function f(s,o,l,c){var d=L(l);if("function"!==typeof d)throw Error(r(150));if(null==(l=d.call(l)))throw Error(r(151));for(var u=d=null,g=o,f=o=0,y=null,v=l.next();null!==g&&!v.done;f++,v=l.next()){g.index>f?(y=g,g=null):y=g.sibling;var b=p(s,g,v.value,c);if(null===b){null===g&&(g=y);break}e&&g&&null===b.alternate&&t(s,g),o=a(b,o,f),null===u?d=b:u.sibling=b,u=b,g=y}if(v.done)return n(s,g),sr&&Js(s,f),d;if(null===g){for(;!v.done;f++,v=l.next())null!==(v=h(s,v.value,c))&&(o=a(v,o,f),null===u?d=v:u.sibling=v,u=v);return sr&&Js(s,f),d}for(g=i(s,g);!v.done;f++,v=l.next())null!==(v=m(g,s,f,v.value,c))&&(e&&null!==v.alternate&&g.delete(null===v.key?f:v.key),o=a(v,o,f),null===u?d=v:u.sibling=v,u=v);return e&&g.forEach(function(e){return t(s,e)}),sr&&Js(s,f),d}return function e(i,r,a,l){if("object"===typeof a&&null!==a&&a.type===S&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case w:e:{for(var c=a.key,d=r;null!==d;){if(d.key===c){if((c=a.type)===S){if(7===d.tag){n(i,d.sibling),(r=s(d,a.props.children)).return=i,i=r;break e}}else if(d.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===P&&vr(c)===d.type){n(i,d.sibling),(r=s(d,a.props)).ref=fr(i,d,a),r.return=i,i=r;break e}n(i,d);break}t(i,d),d=d.sibling}a.type===S?((r=jc(a.props.children,i.mode,l,a.key)).return=i,i=r):((l=Lc(a.type,a.key,a.props,null,i.mode,l)).ref=fr(i,r,a),l.return=i,i=l)}return o(i);case _:e:{for(d=a.key;null!==r;){if(r.key===d){if(4===r.tag&&r.stateNode.containerInfo===a.containerInfo&&r.stateNode.implementation===a.implementation){n(i,r.sibling),(r=s(r,a.children||[])).return=i,i=r;break e}n(i,r);break}t(i,r),r=r.sibling}(r=Bc(a,i.mode,l)).return=i,i=r}return o(i);case P:return e(i,r,(d=a._init)(a._payload),l)}if(te(a))return g(i,r,a,l);if(L(a))return f(i,r,a,l);yr(i,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==r&&6===r.tag?(n(i,r.sibling),(r=s(r,a)).return=i,i=r):(n(i,r),(r=Fc(a,i.mode,l)).return=i,i=r),o(i)):n(i,r)}}var xr=br(!0),wr=br(!1),_r=Cs(null),Sr=null,Cr=null,Ar=null;function Er(){Ar=Cr=Sr=null}function Tr(e){var t=_r.current;As(_r),e._currentValue=t}function kr(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Ir(e,t){Sr=e,Ar=Cr=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(xo=!0),e.firstContext=null)}function Dr(e){var t=e._currentValue;if(Ar!==e)if(e={context:e,memoizedValue:t,next:null},null===Cr){if(null===Sr)throw Error(r(308));Cr=e,Sr.dependencies={lanes:0,firstContext:e}}else Cr=Cr.next=e;return t}var Pr=null;function Mr(e){null===Pr?Pr=[e]:Pr.push(e)}function Rr(e,t,n,i){var s=t.interleaved;return null===s?(n.next=n,Mr(t)):(n.next=s.next,s.next=n),t.interleaved=n,Lr(e,i)}function Lr(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var jr=!1;function Or(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fr(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Br(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ur(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Nl)){var s=i.pending;return null===s?t.next=t:(t.next=s.next,s.next=t),i.pending=t,Lr(e,n)}return null===(s=i.interleaved)?(t.next=t,Mr(i)):(t.next=s.next,s.next=t),i.interleaved=t,Lr(e,n)}function zr(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,vt(e,n)}}function Vr(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var s=null,r=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===r?s=r=a:r=r.next=a,n=n.next}while(null!==n);null===r?s=r=t:r=r.next=t}else s=r=t;return n={baseState:i.baseState,firstBaseUpdate:s,lastBaseUpdate:r,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Hr(e,t,n,i){var s=e.updateQueue;jr=!1;var r=s.firstBaseUpdate,a=s.lastBaseUpdate,o=s.shared.pending;if(null!==o){s.shared.pending=null;var l=o,c=l.next;l.next=null,null===a?r=c:a.next=c,a=l;var d=e.alternate;null!==d&&((o=(d=d.updateQueue).lastBaseUpdate)!==a&&(null===o?d.firstBaseUpdate=c:o.next=c,d.lastBaseUpdate=l))}if(null!==r){var u=s.baseState;for(a=0,d=c=l=null,o=r;;){var h=o.lane,p=o.eventTime;if((i&h)===h){null!==d&&(d=d.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var m=e,g=o;switch(h=t,p=n,g.tag){case 1:if("function"===typeof(m=g.payload)){u=m.call(p,u,h);break e}u=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(h="function"===typeof(m=g.payload)?m.call(p,u,h):m)||void 0===h)break e;u=O({},u,h);break e;case 2:jr=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(h=s.effects)?s.effects=[o]:h.push(o))}else p={eventTime:p,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===d?(c=d=p,l=u):d=d.next=p,a|=h;if(null===(o=o.next)){if(null===(o=s.shared.pending))break;o=(h=o).next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}if(null===d&&(l=u),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=d,null!==(t=s.shared.interleaved)){s=t;do{a|=s.lane,s=s.next}while(s!==t)}else null===r&&(s.shared.lanes=0);Ol|=a,e.lanes=a,e.memoizedState=u}}function $r(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],s=i.callback;if(null!==s){if(i.callback=null,i=n,"function"!==typeof s)throw Error(r(191,s));s.call(i)}}}var qr={},Gr=Cs(qr),Wr=Cs(qr),Kr=Cs(qr);function Qr(e){if(e===qr)throw Error(r(174));return e}function Xr(e,t){switch(Es(Kr,t),Es(Wr,e),Es(Gr,qr),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}As(Gr),Es(Gr,t)}function Yr(){As(Gr),As(Wr),As(Kr)}function Jr(e){Qr(Kr.current);var t=Qr(Gr.current),n=le(t,e.type);t!==n&&(Es(Wr,e),Es(Gr,n))}function Zr(e){Wr.current===e&&(As(Gr),As(Wr))}var ea=Cs(0);function ta(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var na=[];function ia(){for(var e=0;e<na.length;e++)na[e]._workInProgressVersionPrimary=null;na.length=0}var sa=x.ReactCurrentDispatcher,ra=x.ReactCurrentBatchConfig,aa=0,oa=null,la=null,ca=null,da=!1,ua=!1,ha=0,pa=0;function ma(){throw Error(r(321))}function ga(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!oi(e[n],t[n]))return!1;return!0}function fa(e,t,n,i,s,a){if(aa=a,oa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,sa.current=null===e||null===e.memoizedState?Za:eo,e=n(i,s),ua){a=0;do{if(ua=!1,ha=0,25<=a)throw Error(r(301));a+=1,ca=la=null,t.updateQueue=null,sa.current=to,e=n(i,s)}while(ua)}if(sa.current=Ja,t=null!==la&&null!==la.next,aa=0,ca=la=oa=null,da=!1,t)throw Error(r(300));return e}function ya(){var e=0!==ha;return ha=0,e}function va(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ca?oa.memoizedState=ca=e:ca=ca.next=e,ca}function ba(){if(null===la){var e=oa.alternate;e=null!==e?e.memoizedState:null}else e=la.next;var t=null===ca?oa.memoizedState:ca.next;if(null!==t)ca=t,la=e;else{if(null===e)throw Error(r(310));e={memoizedState:(la=e).memoizedState,baseState:la.baseState,baseQueue:la.baseQueue,queue:la.queue,next:null},null===ca?oa.memoizedState=ca=e:ca=ca.next=e}return ca}function xa(e,t){return"function"===typeof t?t(e):t}function wa(e){var t=ba(),n=t.queue;if(null===n)throw Error(r(311));n.lastRenderedReducer=e;var i=la,s=i.baseQueue,a=n.pending;if(null!==a){if(null!==s){var o=s.next;s.next=a.next,a.next=o}i.baseQueue=s=a,n.pending=null}if(null!==s){a=s.next,i=i.baseState;var l=o=null,c=null,d=a;do{var u=d.lane;if((aa&u)===u)null!==c&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),i=d.hasEagerState?d.eagerState:e(i,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};null===c?(l=c=h,o=i):c=c.next=h,oa.lanes|=u,Ol|=u}d=d.next}while(null!==d&&d!==a);null===c?o=i:c.next=l,oi(i,t.memoizedState)||(xo=!0),t.memoizedState=i,t.baseState=o,t.baseQueue=c,n.lastRenderedState=i}if(null!==(e=n.interleaved)){s=e;do{a=s.lane,oa.lanes|=a,Ol|=a,s=s.next}while(s!==e)}else null===s&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function _a(e){var t=ba(),n=t.queue;if(null===n)throw Error(r(311));n.lastRenderedReducer=e;var i=n.dispatch,s=n.pending,a=t.memoizedState;if(null!==s){n.pending=null;var o=s=s.next;do{a=e(a,o.action),o=o.next}while(o!==s);oi(a,t.memoizedState)||(xo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,i]}function Sa(){}function Ca(e,t){var n=oa,i=ba(),s=t(),a=!oi(i.memoizedState,s);if(a&&(i.memoizedState=s,xo=!0),i=i.queue,ja(Ta.bind(null,n,i,e),[e]),i.getSnapshot!==t||a||null!==ca&&1&ca.memoizedState.tag){if(n.flags|=2048,Da(9,Ea.bind(null,n,i,s,t),void 0,null),null===Il)throw Error(r(349));0!==(30&aa)||Aa(n,t,s)}return s}function Aa(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=oa.updateQueue)?(t={lastEffect:null,stores:null},oa.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ea(e,t,n,i){t.value=n,t.getSnapshot=i,ka(t)&&Na(e)}function Ta(e,t,n){return n(function(){ka(t)&&Na(e)})}function ka(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!oi(e,n)}catch(i){return!0}}function Na(e){var t=Lr(e,1);null!==t&&ic(t,e,1,-1)}function Ia(e){var t=va();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xa,lastRenderedState:e},t.queue=e,e=e.dispatch=Ka.bind(null,oa,e),[t.memoizedState,e]}function Da(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=oa.updateQueue)?(t={lastEffect:null,stores:null},oa.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Pa(){return ba().memoizedState}function Ma(e,t,n,i){var s=va();oa.flags|=e,s.memoizedState=Da(1|t,n,void 0,void 0===i?null:i)}function Ra(e,t,n,i){var s=ba();i=void 0===i?null:i;var r=void 0;if(null!==la){var a=la.memoizedState;if(r=a.destroy,null!==i&&ga(i,a.deps))return void(s.memoizedState=Da(t,n,r,i))}oa.flags|=e,s.memoizedState=Da(1|t,n,r,i)}function La(e,t){return Ma(8390656,8,e,t)}function ja(e,t){return Ra(2048,8,e,t)}function Oa(e,t){return Ra(4,2,e,t)}function Fa(e,t){return Ra(4,4,e,t)}function Ba(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ua(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ra(4,4,Ba.bind(null,t,e),n)}function za(){}function Va(e,t){var n=ba();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&ga(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Ha(e,t){var n=ba();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&ga(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function $a(e,t,n){return 0===(21&aa)?(e.baseState&&(e.baseState=!1,xo=!0),e.memoizedState=n):(oi(n,t)||(n=gt(),oa.lanes|=n,Ol|=n,e.baseState=!0),t)}function qa(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var i=ra.transition;ra.transition={};try{e(!1),t()}finally{bt=n,ra.transition=i}}function Ga(){return ba().memoizedState}function Wa(e,t,n){var i=nc(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Qa(e))Xa(t,n);else if(null!==(n=Rr(e,t,n,i))){ic(n,e,i,tc()),Ya(n,t,i)}}function Ka(e,t,n){var i=nc(e),s={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Qa(e))Xa(t,s);else{var r=e.alternate;if(0===e.lanes&&(null===r||0===r.lanes)&&null!==(r=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=r(a,n);if(s.hasEagerState=!0,s.eagerState=o,oi(o,a)){var l=t.interleaved;return null===l?(s.next=s,Mr(t)):(s.next=l.next,l.next=s),void(t.interleaved=s)}}catch(c){}null!==(n=Rr(e,t,s,i))&&(ic(n,e,i,s=tc()),Ya(n,t,i))}}function Qa(e){var t=e.alternate;return e===oa||null!==t&&t===oa}function Xa(e,t){ua=da=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Ya(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,vt(e,n)}}var Ja={readContext:Dr,useCallback:ma,useContext:ma,useEffect:ma,useImperativeHandle:ma,useInsertionEffect:ma,useLayoutEffect:ma,useMemo:ma,useReducer:ma,useRef:ma,useState:ma,useDebugValue:ma,useDeferredValue:ma,useTransition:ma,useMutableSource:ma,useSyncExternalStore:ma,useId:ma,unstable_isNewReconciler:!1},Za={readContext:Dr,useCallback:function(e,t){return va().memoizedState=[e,void 0===t?null:t],e},useContext:Dr,useEffect:La,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ma(4194308,4,Ba.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ma(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ma(4,2,e,t)},useMemo:function(e,t){var n=va();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=va();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=Wa.bind(null,oa,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},va().memoizedState=e},useState:Ia,useDebugValue:za,useDeferredValue:function(e){return va().memoizedState=e},useTransition:function(){var e=Ia(!1),t=e[0];return e=qa.bind(null,e[1]),va().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=oa,s=va();if(sr){if(void 0===n)throw Error(r(407));n=n()}else{if(n=t(),null===Il)throw Error(r(349));0!==(30&aa)||Aa(i,t,n)}s.memoizedState=n;var a={value:n,getSnapshot:t};return s.queue=a,La(Ta.bind(null,i,a,e),[e]),i.flags|=2048,Da(9,Ea.bind(null,i,a,n,t),void 0,null),n},useId:function(){var e=va(),t=Il.identifierPrefix;if(sr){var n=Ys;t=":"+t+"R"+(n=(Xs&~(1<<32-at(Xs)-1)).toString(32)+n),0<(n=ha++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=pa++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},eo={readContext:Dr,useCallback:Va,useContext:Dr,useEffect:ja,useImperativeHandle:Ua,useInsertionEffect:Oa,useLayoutEffect:Fa,useMemo:Ha,useReducer:wa,useRef:Pa,useState:function(){return wa(xa)},useDebugValue:za,useDeferredValue:function(e){return $a(ba(),la.memoizedState,e)},useTransition:function(){return[wa(xa)[0],ba().memoizedState]},useMutableSource:Sa,useSyncExternalStore:Ca,useId:Ga,unstable_isNewReconciler:!1},to={readContext:Dr,useCallback:Va,useContext:Dr,useEffect:ja,useImperativeHandle:Ua,useInsertionEffect:Oa,useLayoutEffect:Fa,useMemo:Ha,useReducer:_a,useRef:Pa,useState:function(){return _a(xa)},useDebugValue:za,useDeferredValue:function(e){var t=ba();return null===la?t.memoizedState=e:$a(t,la.memoizedState,e)},useTransition:function(){return[_a(xa)[0],ba().memoizedState]},useMutableSource:Sa,useSyncExternalStore:Ca,useId:Ga,unstable_isNewReconciler:!1};function no(e,t){if(e&&e.defaultProps){for(var n in t=O({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function io(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:O({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var so={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=tc(),s=nc(e),r=Br(i,s);r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=Ur(e,r,s))&&(ic(t,e,s,i),zr(t,e,s))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=tc(),s=nc(e),r=Br(i,s);r.tag=1,r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=Ur(e,r,s))&&(ic(t,e,s,i),zr(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tc(),i=nc(e),s=Br(n,i);s.tag=2,void 0!==t&&null!==t&&(s.callback=t),null!==(t=Ur(e,s,i))&&(ic(t,e,i,n),zr(t,e,i))}};function ro(e,t,n,i,s,r,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,r,a):!t.prototype||!t.prototype.isPureReactComponent||(!li(n,i)||!li(s,r))}function ao(e,t,n){var i=!1,s=Ts,r=t.contextType;return"object"===typeof r&&null!==r?r=Dr(r):(s=Ps(t)?Is:ks.current,r=(i=null!==(i=t.contextTypes)&&void 0!==i)?Ds(e,s):Ts),t=new t(n,r),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=so,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=r),t}function oo(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&so.enqueueReplaceState(t,t.state,null)}function lo(e,t,n,i){var s=e.stateNode;s.props=n,s.state=e.memoizedState,s.refs={},Or(e);var r=t.contextType;"object"===typeof r&&null!==r?s.context=Dr(r):(r=Ps(t)?Is:ks.current,s.context=Ds(e,r)),s.state=e.memoizedState,"function"===typeof(r=t.getDerivedStateFromProps)&&(io(e,t,r,n),s.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof s.getSnapshotBeforeUpdate||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||(t=s.state,"function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount(),t!==s.state&&so.enqueueReplaceState(s,s.state,null),Hr(e,n,s,i),s.state=e.memoizedState),"function"===typeof s.componentDidMount&&(e.flags|=4194308)}function co(e,t){try{var n="",i=t;do{n+=z(i),i=i.return}while(i);var s=n}catch(r){s="\nError generating stack: "+r.message+"\n"+r.stack}return{value:e,source:t,stack:s,digest:null}}function uo(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ho(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var po="function"===typeof WeakMap?WeakMap:Map;function mo(e,t,n){(n=Br(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){ql||(ql=!0,Gl=i),ho(0,t)},n}function go(e,t,n){(n=Br(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var s=t.value;n.payload=function(){return i(s)},n.callback=function(){ho(0,t)}}var r=e.stateNode;return null!==r&&"function"===typeof r.componentDidCatch&&(n.callback=function(){ho(0,t),"function"!==typeof i&&(null===Wl?Wl=new Set([this]):Wl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function fo(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new po;var s=new Set;i.set(t,s)}else void 0===(s=i.get(t))&&(s=new Set,i.set(t,s));s.has(n)||(s.add(n),e=Ec.bind(null,e,t,n),t.then(e,e))}function yo(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vo(e,t,n,i,s){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Br(-1,1)).tag=2,Ur(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=s,e)}var bo=x.ReactCurrentOwner,xo=!1;function wo(e,t,n,i){t.child=null===e?wr(t,null,n,i):xr(t,e.child,n,i)}function _o(e,t,n,i,s){n=n.render;var r=t.ref;return Ir(t,s),i=fa(e,t,n,i,r,s),n=ya(),null===e||xo?(sr&&n&&er(t),t.flags|=1,wo(e,t,i,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,qo(e,t,s))}function So(e,t,n,i,s){if(null===e){var r=n.type;return"function"!==typeof r||Mc(r)||void 0!==r.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Lc(n.type,null,i,t,t.mode,s)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=r,Co(e,t,r,i,s))}if(r=e.child,0===(e.lanes&s)){var a=r.memoizedProps;if((n=null!==(n=n.compare)?n:li)(a,i)&&e.ref===t.ref)return qo(e,t,s)}return t.flags|=1,(e=Rc(r,i)).ref=t.ref,e.return=t,t.child=e}function Co(e,t,n,i,s){if(null!==e){var r=e.memoizedProps;if(li(r,i)&&e.ref===t.ref){if(xo=!1,t.pendingProps=i=r,0===(e.lanes&s))return t.lanes=e.lanes,qo(e,t,s);0!==(131072&e.flags)&&(xo=!0)}}return To(e,t,n,i,s)}function Ao(e,t,n){var i=t.pendingProps,s=i.children,r=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Es(Rl,Ml),Ml|=n;else{if(0===(1073741824&n))return e=null!==r?r.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Es(Rl,Ml),Ml|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==r?r.baseLanes:n,Es(Rl,Ml),Ml|=i}else null!==r?(i=r.baseLanes|n,t.memoizedState=null):i=n,Es(Rl,Ml),Ml|=i;return wo(e,t,s,n),t.child}function Eo(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function To(e,t,n,i,s){var r=Ps(n)?Is:ks.current;return r=Ds(t,r),Ir(t,s),n=fa(e,t,n,i,r,s),i=ya(),null===e||xo?(sr&&i&&er(t),t.flags|=1,wo(e,t,n,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,qo(e,t,s))}function ko(e,t,n,i,s){if(Ps(n)){var r=!0;js(t)}else r=!1;if(Ir(t,s),null===t.stateNode)$o(e,t),ao(t,n,i),lo(t,n,i,s),i=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=n.contextType;"object"===typeof c&&null!==c?c=Dr(c):c=Ds(t,c=Ps(n)?Is:ks.current);var d=n.getDerivedStateFromProps,u="function"===typeof d||"function"===typeof a.getSnapshotBeforeUpdate;u||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==i||l!==c)&&oo(t,a,i,c),jr=!1;var h=t.memoizedState;a.state=h,Hr(t,i,a,s),l=t.memoizedState,o!==i||h!==l||Ns.current||jr?("function"===typeof d&&(io(t,n,d,i),l=t.memoizedState),(o=jr||ro(t,n,o,i,h,l,c))?(u||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),a.props=i,a.state=l,a.context=c,i=o):("function"===typeof a.componentDidMount&&(t.flags|=4194308),i=!1)}else{a=t.stateNode,Fr(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:no(t.type,o),a.props=c,u=t.pendingProps,h=a.context,"object"===typeof(l=n.contextType)&&null!==l?l=Dr(l):l=Ds(t,l=Ps(n)?Is:ks.current);var p=n.getDerivedStateFromProps;(d="function"===typeof p||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==u||h!==l)&&oo(t,a,i,l),jr=!1,h=t.memoizedState,a.state=h,Hr(t,i,a,s);var m=t.memoizedState;o!==u||h!==m||Ns.current||jr?("function"===typeof p&&(io(t,n,p,i),m=t.memoizedState),(c=jr||ro(t,n,c,i,h,m,l)||!1)?(d||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(i,m,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(i,m,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=m),a.props=i,a.state=m,a.context=l,i=c):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),i=!1)}return No(e,t,n,i,r,s)}function No(e,t,n,i,s,r){Eo(e,t);var a=0!==(128&t.flags);if(!i&&!a)return s&&Os(t,n,!1),qo(e,t,r);i=t.stateNode,bo.current=t;var o=a&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&a?(t.child=xr(t,e.child,null,r),t.child=xr(t,null,o,r)):wo(e,t,o,r),t.memoizedState=i.state,s&&Os(t,n,!0),t.child}function Io(e){var t=e.stateNode;t.pendingContext?Rs(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Rs(0,t.context,!1),Xr(e,t.containerInfo)}function Do(e,t,n,i,s){return pr(),mr(s),t.flags|=256,wo(e,t,n,i),t.child}var Po,Mo,Ro,Lo,jo={dehydrated:null,treeContext:null,retryLane:0};function Oo(e){return{baseLanes:e,cachePool:null,transitions:null}}function Fo(e,t,n){var i,s=t.pendingProps,a=ea.current,o=!1,l=0!==(128&t.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&0!==(2&a)),i?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Es(ea,1&a),null===e)return cr(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=s.children,e=s.fallback,o?(s=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&s)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Oc(l,s,0,null),e=jc(e,s,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Oo(n),t.memoizedState=jo,e):Bo(t,l));if(null!==(a=e.memoizedState)&&null!==(i=a.dehydrated))return function(e,t,n,i,s,a,o){if(n)return 256&t.flags?(t.flags&=-257,Uo(e,t,o,i=uo(Error(r(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=i.fallback,s=t.mode,i=Oc({mode:"visible",children:i.children},s,0,null),(a=jc(a,s,o,null)).flags|=2,i.return=t,a.return=t,i.sibling=a,t.child=i,0!==(1&t.mode)&&xr(t,e.child,null,o),t.child.memoizedState=Oo(o),t.memoizedState=jo,a);if(0===(1&t.mode))return Uo(e,t,o,null);if("$!"===s.data){if(i=s.nextSibling&&s.nextSibling.dataset)var l=i.dgst;return i=l,Uo(e,t,o,i=uo(a=Error(r(419)),i,void 0))}if(l=0!==(o&e.childLanes),xo||l){if(null!==(i=Il)){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}0!==(s=0!==(s&(i.suspendedLanes|o))?0:s)&&s!==a.retryLane&&(a.retryLane=s,Lr(e,s),ic(i,e,s,-1))}return fc(),Uo(e,t,o,i=uo(Error(r(421))))}return"$?"===s.data?(t.flags|=128,t.child=e.child,t=kc.bind(null,e),s._reactRetry=t,null):(e=a.treeContext,ir=cs(s.nextSibling),nr=t,sr=!0,rr=null,null!==e&&(Ws[Ks++]=Xs,Ws[Ks++]=Ys,Ws[Ks++]=Qs,Xs=e.id,Ys=e.overflow,Qs=t),t=Bo(t,i.children),t.flags|=4096,t)}(e,t,l,s,i,a,n);if(o){o=s.fallback,l=t.mode,i=(a=e.child).sibling;var c={mode:"hidden",children:s.children};return 0===(1&l)&&t.child!==a?((s=t.child).childLanes=0,s.pendingProps=c,t.deletions=null):(s=Rc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==i?o=Rc(i,o):(o=jc(o,l,n,null)).flags|=2,o.return=t,s.return=t,s.sibling=o,t.child=s,s=o,o=t.child,l=null===(l=e.child.memoizedState)?Oo(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~n,t.memoizedState=jo,s}return e=(o=e.child).sibling,s=Rc(o,{mode:"visible",children:s.children}),0===(1&t.mode)&&(s.lanes=n),s.return=t,s.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function Bo(e,t){return(t=Oc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Uo(e,t,n,i){return null!==i&&mr(i),xr(t,e.child,null,n),(e=Bo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function zo(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),kr(e.return,t,n)}function Vo(e,t,n,i,s){var r=e.memoizedState;null===r?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:s}:(r.isBackwards=t,r.rendering=null,r.renderingStartTime=0,r.last=i,r.tail=n,r.tailMode=s)}function Ho(e,t,n){var i=t.pendingProps,s=i.revealOrder,r=i.tail;if(wo(e,t,i.children,n),0!==(2&(i=ea.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&zo(e,n,t);else if(19===e.tag)zo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Es(ea,i),0===(1&t.mode))t.memoizedState=null;else switch(s){case"forwards":for(n=t.child,s=null;null!==n;)null!==(e=n.alternate)&&null===ta(e)&&(s=n),n=n.sibling;null===(n=s)?(s=t.child,t.child=null):(s=n.sibling,n.sibling=null),Vo(t,!1,s,n,r);break;case"backwards":for(n=null,s=t.child,t.child=null;null!==s;){if(null!==(e=s.alternate)&&null===ta(e)){t.child=s;break}e=s.sibling,s.sibling=n,n=s,s=e}Vo(t,!0,n,null,r);break;case"together":Vo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function $o(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function qo(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ol|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(r(153));if(null!==t.child){for(n=Rc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Rc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Go(e,t){if(!sr)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Wo(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var s=e.child;null!==s;)n|=s.lanes|s.childLanes,i|=14680064&s.subtreeFlags,i|=14680064&s.flags,s.return=e,s=s.sibling;else for(s=e.child;null!==s;)n|=s.lanes|s.childLanes,i|=s.subtreeFlags,i|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Ko(e,t,n){var i=t.pendingProps;switch(tr(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wo(t),null;case 1:case 17:return Ps(t.type)&&Ms(),Wo(t),null;case 3:return i=t.stateNode,Yr(),As(Ns),As(ks),ia(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(ur(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==rr&&(oc(rr),rr=null))),Mo(e,t),Wo(t),null;case 5:Zr(t);var s=Qr(Kr.current);if(n=t.type,null!==e&&null!=t.stateNode)Ro(e,t,n,i,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(r(166));return Wo(t),null}if(e=Qr(Gr.current),ur(t)){i=t.stateNode,n=t.type;var a=t.memoizedProps;switch(i[hs]=t,i[ps]=a,e=0!==(1&t.mode),n){case"dialog":Bi("cancel",i),Bi("close",i);break;case"iframe":case"object":case"embed":Bi("load",i);break;case"video":case"audio":for(s=0;s<Li.length;s++)Bi(Li[s],i);break;case"source":Bi("error",i);break;case"img":case"image":case"link":Bi("error",i),Bi("load",i);break;case"details":Bi("toggle",i);break;case"input":X(i,a),Bi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!a.multiple},Bi("invalid",i);break;case"textarea":se(i,a),Bi("invalid",i)}for(var l in ve(n,a),s=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"===typeof c?i.textContent!==c&&(!0!==a.suppressHydrationWarning&&Ji(i.textContent,c,e),s=["children",c]):"number"===typeof c&&i.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Ji(i.textContent,c,e),s=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Bi("scroll",i)}switch(n){case"input":G(i),Z(i,a,!0);break;case"textarea":G(i),ae(i);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(i.onclick=Zi)}i=s,t.updateQueue=i,null!==i&&(t.flags|=4)}else{l=9===s.nodeType?s:s.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=l.createElement(n,{is:i.is}):(e=l.createElement(n),"select"===n&&(l=e,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):e=l.createElementNS(e,n),e[hs]=t,e[ps]=i,Po(e,t,!1,!1),t.stateNode=e;e:{switch(l=be(n,i),n){case"dialog":Bi("cancel",e),Bi("close",e),s=i;break;case"iframe":case"object":case"embed":Bi("load",e),s=i;break;case"video":case"audio":for(s=0;s<Li.length;s++)Bi(Li[s],e);s=i;break;case"source":Bi("error",e),s=i;break;case"img":case"image":case"link":Bi("error",e),Bi("load",e),s=i;break;case"details":Bi("toggle",e),s=i;break;case"input":X(e,i),s=Q(e,i),Bi("invalid",e);break;case"option":default:s=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},s=O({},i,{value:void 0}),Bi("invalid",e);break;case"textarea":se(e,i),s=ie(e,i),Bi("invalid",e)}for(a in ve(n,s),c=s)if(c.hasOwnProperty(a)){var d=c[a];"style"===a?fe(e,d):"dangerouslySetInnerHTML"===a?null!=(d=d?d.__html:void 0)&&ue(e,d):"children"===a?"string"===typeof d?("textarea"!==n||""!==d)&&he(e,d):"number"===typeof d&&he(e,""+d):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=d&&"onScroll"===a&&Bi("scroll",e):null!=d&&b(e,a,d,l))}switch(n){case"input":G(e),Z(e,i,!1);break;case"textarea":G(e),ae(e);break;case"option":null!=i.value&&e.setAttribute("value",""+$(i.value));break;case"select":e.multiple=!!i.multiple,null!=(a=i.value)?ne(e,!!i.multiple,a,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof s.onClick&&(e.onclick=Zi)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Wo(t),null;case 6:if(e&&null!=t.stateNode)Lo(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(r(166));if(n=Qr(Kr.current),Qr(Gr.current),ur(t)){if(i=t.stateNode,n=t.memoizedProps,i[hs]=t,(a=i.nodeValue!==n)&&null!==(e=nr))switch(e.tag){case 3:Ji(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Ji(i.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[hs]=t,t.stateNode=i}return Wo(t),null;case 13:if(As(ea),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(sr&&null!==ir&&0!==(1&t.mode)&&0===(128&t.flags))hr(),pr(),t.flags|=98560,a=!1;else if(a=ur(t),null!==i&&null!==i.dehydrated){if(null===e){if(!a)throw Error(r(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(r(317));a[hs]=t}else pr(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Wo(t),a=!1}else null!==rr&&(oc(rr),rr=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&ea.current)?0===Ll&&(Ll=3):fc())),null!==t.updateQueue&&(t.flags|=4),Wo(t),null);case 4:return Yr(),Mo(e,t),null===e&&Vi(t.stateNode.containerInfo),Wo(t),null;case 10:return Tr(t.type._context),Wo(t),null;case 19:if(As(ea),null===(a=t.memoizedState))return Wo(t),null;if(i=0!==(128&t.flags),null===(l=a.rendering))if(i)Go(a,!1);else{if(0!==Ll||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ta(e))){for(t.flags|=128,Go(a,!1),null!==(i=l.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(a=n).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Es(ea,1&ea.current|2),t.child}e=e.sibling}null!==a.tail&&Ye()>Hl&&(t.flags|=128,i=!0,Go(a,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=ta(l))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Go(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!sr)return Wo(t),null}else 2*Ye()-a.renderingStartTime>Hl&&1073741824!==n&&(t.flags|=128,i=!0,Go(a,!1),t.lanes=4194304);a.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=a.last)?n.sibling=l:t.child=l,a.last=l)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Ye(),t.sibling=null,n=ea.current,Es(ea,i?1&n|2:1&n),t):(Wo(t),null);case 22:case 23:return hc(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&Ml)&&(Wo(t),6&t.subtreeFlags&&(t.flags|=8192)):Wo(t),null;case 24:case 25:return null}throw Error(r(156,t.tag))}function Qo(e,t){switch(tr(t),t.tag){case 1:return Ps(t.type)&&Ms(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Yr(),As(Ns),As(ks),ia(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Zr(t),null;case 13:if(As(ea),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(r(340));pr()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return As(ea),null;case 4:return Yr(),null;case 10:return Tr(t.type._context),null;case 22:case 23:return hc(),null;default:return null}}Po=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Mo=function(){},Ro=function(e,t,n,i){var s=e.memoizedProps;if(s!==i){e=t.stateNode,Qr(Gr.current);var r,a=null;switch(n){case"input":s=Q(e,s),i=Q(e,i),a=[];break;case"select":s=O({},s,{value:void 0}),i=O({},i,{value:void 0}),a=[];break;case"textarea":s=ie(e,s),i=ie(e,i),a=[];break;default:"function"!==typeof s.onClick&&"function"===typeof i.onClick&&(e.onclick=Zi)}for(d in ve(n,i),n=null,s)if(!i.hasOwnProperty(d)&&s.hasOwnProperty(d)&&null!=s[d])if("style"===d){var l=s[d];for(r in l)l.hasOwnProperty(r)&&(n||(n={}),n[r]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(o.hasOwnProperty(d)?a||(a=[]):(a=a||[]).push(d,null));for(d in i){var c=i[d];if(l=null!=s?s[d]:void 0,i.hasOwnProperty(d)&&c!==l&&(null!=c||null!=l))if("style"===d)if(l){for(r in l)!l.hasOwnProperty(r)||c&&c.hasOwnProperty(r)||(n||(n={}),n[r]="");for(r in c)c.hasOwnProperty(r)&&l[r]!==c[r]&&(n||(n={}),n[r]=c[r])}else n||(a||(a=[]),a.push(d,n)),n=c;else"dangerouslySetInnerHTML"===d?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(a=a||[]).push(d,c)):"children"===d?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(d,""+c):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(o.hasOwnProperty(d)?(null!=c&&"onScroll"===d&&Bi("scroll",e),a||l===c||(a=[])):(a=a||[]).push(d,c))}n&&(a=a||[]).push("style",n);var d=a;(t.updateQueue=d)&&(t.flags|=4)}},Lo=function(e,t,n,i){n!==i&&(t.flags|=4)};var Xo=!1,Yo=!1,Jo="function"===typeof WeakSet?WeakSet:Set,Zo=null;function el(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Ac(e,t,i)}else n.current=null}function tl(e,t,n){try{n()}catch(i){Ac(e,t,i)}}var nl=!1;function il(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var s=i=i.next;do{if((s.tag&e)===e){var r=s.destroy;s.destroy=void 0,void 0!==r&&tl(t,n,r)}s=s.next}while(s!==i)}}function sl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function rl(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function al(e){var t=e.alternate;null!==t&&(e.alternate=null,al(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hs],delete t[ps],delete t[gs],delete t[fs],delete t[ys])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ol(e){return 5===e.tag||3===e.tag||4===e.tag}function ll(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ol(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zi));else if(4!==i&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}function dl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(dl(e,t,n),e=e.sibling;null!==e;)dl(e,t,n),e=e.sibling}var ul=null,hl=!1;function pl(e,t,n){for(n=n.child;null!==n;)ml(e,t,n),n=n.sibling}function ml(e,t,n){if(rt&&"function"===typeof rt.onCommitFiberUnmount)try{rt.onCommitFiberUnmount(st,n)}catch(o){}switch(n.tag){case 5:Yo||el(n,t);case 6:var i=ul,s=hl;ul=null,pl(e,t,n),hl=s,null!==(ul=i)&&(hl?(e=ul,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):ul.removeChild(n.stateNode));break;case 18:null!==ul&&(hl?(e=ul,n=n.stateNode,8===e.nodeType?ls(e.parentNode,n):1===e.nodeType&&ls(e,n),Vt(e)):ls(ul,n.stateNode));break;case 4:i=ul,s=hl,ul=n.stateNode.containerInfo,hl=!0,pl(e,t,n),ul=i,hl=s;break;case 0:case 11:case 14:case 15:if(!Yo&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){s=i=i.next;do{var r=s,a=r.destroy;r=r.tag,void 0!==a&&(0!==(2&r)||0!==(4&r))&&tl(n,t,a),s=s.next}while(s!==i)}pl(e,t,n);break;case 1:if(!Yo&&(el(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(o){Ac(n,t,o)}pl(e,t,n);break;case 21:pl(e,t,n);break;case 22:1&n.mode?(Yo=(i=Yo)||null!==n.memoizedState,pl(e,t,n),Yo=i):pl(e,t,n);break;default:pl(e,t,n)}}function gl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Jo),t.forEach(function(t){var i=Nc.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))})}}function fl(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var s=n[i];try{var a=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:ul=l.stateNode,hl=!1;break e;case 3:case 4:ul=l.stateNode.containerInfo,hl=!0;break e}l=l.return}if(null===ul)throw Error(r(160));ml(a,o,s),ul=null,hl=!1;var c=s.alternate;null!==c&&(c.return=null),s.return=null}catch(d){Ac(s,t,d)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)yl(t,e),t=t.sibling}function yl(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(fl(t,e),vl(e),4&i){try{il(3,e,e.return),sl(3,e)}catch(f){Ac(e,e.return,f)}try{il(5,e,e.return)}catch(f){Ac(e,e.return,f)}}break;case 1:fl(t,e),vl(e),512&i&&null!==n&&el(n,n.return);break;case 5:if(fl(t,e),vl(e),512&i&&null!==n&&el(n,n.return),32&e.flags){var s=e.stateNode;try{he(s,"")}catch(f){Ac(e,e.return,f)}}if(4&i&&null!=(s=e.stateNode)){var a=e.memoizedProps,o=null!==n?n.memoizedProps:a,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===a.type&&null!=a.name&&Y(s,a),be(l,o);var d=be(l,a);for(o=0;o<c.length;o+=2){var u=c[o],h=c[o+1];"style"===u?fe(s,h):"dangerouslySetInnerHTML"===u?ue(s,h):"children"===u?he(s,h):b(s,u,h,d)}switch(l){case"input":J(s,a);break;case"textarea":re(s,a);break;case"select":var p=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!a.multiple;var m=a.value;null!=m?ne(s,!!a.multiple,m,!1):p!==!!a.multiple&&(null!=a.defaultValue?ne(s,!!a.multiple,a.defaultValue,!0):ne(s,!!a.multiple,a.multiple?[]:"",!1))}s[ps]=a}catch(f){Ac(e,e.return,f)}}break;case 6:if(fl(t,e),vl(e),4&i){if(null===e.stateNode)throw Error(r(162));s=e.stateNode,a=e.memoizedProps;try{s.nodeValue=a}catch(f){Ac(e,e.return,f)}}break;case 3:if(fl(t,e),vl(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(f){Ac(e,e.return,f)}break;case 4:default:fl(t,e),vl(e);break;case 13:fl(t,e),vl(e),8192&(s=e.child).flags&&(a=null!==s.memoizedState,s.stateNode.isHidden=a,!a||null!==s.alternate&&null!==s.alternate.memoizedState||(Vl=Ye())),4&i&&gl(e);break;case 22:if(u=null!==n&&null!==n.memoizedState,1&e.mode?(Yo=(d=Yo)||u,fl(t,e),Yo=d):fl(t,e),vl(e),8192&i){if(d=null!==e.memoizedState,(e.stateNode.isHidden=d)&&!u&&0!==(1&e.mode))for(Zo=e,u=e.child;null!==u;){for(h=Zo=u;null!==Zo;){switch(m=(p=Zo).child,p.tag){case 0:case 11:case 14:case 15:il(4,p,p.return);break;case 1:el(p,p.return);var g=p.stateNode;if("function"===typeof g.componentWillUnmount){i=p,n=p.return;try{t=i,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(f){Ac(i,n,f)}}break;case 5:el(p,p.return);break;case 22:if(null!==p.memoizedState){_l(h);continue}}null!==m?(m.return=p,Zo=m):_l(h)}u=u.sibling}e:for(u=null,h=e;;){if(5===h.tag){if(null===u){u=h;try{s=h.stateNode,d?"function"===typeof(a=s.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=h.stateNode,o=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=ge("display",o))}catch(f){Ac(e,e.return,f)}}}else if(6===h.tag){if(null===u)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(f){Ac(e,e.return,f)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:fl(t,e),vl(e),4&i&&gl(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(ol(n)){var i=n;break e}n=n.return}throw Error(r(160))}switch(i.tag){case 5:var s=i.stateNode;32&i.flags&&(he(s,""),i.flags&=-33),dl(e,ll(e),s);break;case 3:case 4:var a=i.stateNode.containerInfo;cl(e,ll(e),a);break;default:throw Error(r(161))}}catch(o){Ac(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bl(e,t,n){Zo=e,xl(e,t,n)}function xl(e,t,n){for(var i=0!==(1&e.mode);null!==Zo;){var s=Zo,r=s.child;if(22===s.tag&&i){var a=null!==s.memoizedState||Xo;if(!a){var o=s.alternate,l=null!==o&&null!==o.memoizedState||Yo;o=Xo;var c=Yo;if(Xo=a,(Yo=l)&&!c)for(Zo=s;null!==Zo;)l=(a=Zo).child,22===a.tag&&null!==a.memoizedState?Sl(s):null!==l?(l.return=a,Zo=l):Sl(s);for(;null!==r;)Zo=r,xl(r,t,n),r=r.sibling;Zo=s,Xo=o,Yo=c}wl(e)}else 0!==(8772&s.subtreeFlags)&&null!==r?(r.return=s,Zo=r):wl(e)}}function wl(e){for(;null!==Zo;){var t=Zo;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Yo||sl(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Yo)if(null===n)i.componentDidMount();else{var s=t.elementType===t.type?n.memoizedProps:no(t.type,n.memoizedProps);i.componentDidUpdate(s,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&$r(t,a,i);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}$r(t,o,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var d=t.alternate;if(null!==d){var u=d.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&Vt(h)}}}break;default:throw Error(r(163))}Yo||512&t.flags&&rl(t)}catch(p){Ac(t,t.return,p)}}if(t===e){Zo=null;break}if(null!==(n=t.sibling)){n.return=t.return,Zo=n;break}Zo=t.return}}function _l(e){for(;null!==Zo;){var t=Zo;if(t===e){Zo=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Zo=n;break}Zo=t.return}}function Sl(e){for(;null!==Zo;){var t=Zo;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{sl(4,t)}catch(l){Ac(t,n,l)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var s=t.return;try{i.componentDidMount()}catch(l){Ac(t,s,l)}}var r=t.return;try{rl(t)}catch(l){Ac(t,r,l)}break;case 5:var a=t.return;try{rl(t)}catch(l){Ac(t,a,l)}}}catch(l){Ac(t,t.return,l)}if(t===e){Zo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Zo=o;break}Zo=t.return}}var Cl,Al=Math.ceil,El=x.ReactCurrentDispatcher,Tl=x.ReactCurrentOwner,kl=x.ReactCurrentBatchConfig,Nl=0,Il=null,Dl=null,Pl=0,Ml=0,Rl=Cs(0),Ll=0,jl=null,Ol=0,Fl=0,Bl=0,Ul=null,zl=null,Vl=0,Hl=1/0,$l=null,ql=!1,Gl=null,Wl=null,Kl=!1,Ql=null,Xl=0,Yl=0,Jl=null,Zl=-1,ec=0;function tc(){return 0!==(6&Nl)?Ye():-1!==Zl?Zl:Zl=Ye()}function nc(e){return 0===(1&e.mode)?1:0!==(2&Nl)&&0!==Pl?Pl&-Pl:null!==gr.transition?(0===ec&&(ec=gt()),ec):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Xt(e.type)}function ic(e,t,n,i){if(50<Yl)throw Yl=0,Jl=null,Error(r(185));yt(e,n,i),0!==(2&Nl)&&e===Il||(e===Il&&(0===(2&Nl)&&(Fl|=n),4===Ll&&lc(e,Pl)),sc(e,i),1===n&&0===Nl&&0===(1&t.mode)&&(Hl=Ye()+500,Bs&&Vs()))}function sc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,s=e.expirationTimes,r=e.pendingLanes;0<r;){var a=31-at(r),o=1<<a,l=s[a];-1===l?0!==(o&n)&&0===(o&i)||(s[a]=pt(o,t)):l<=t&&(e.expiredLanes|=o),r&=~o}}(e,t);var i=ht(e,e===Il?Pl:0);if(0===i)null!==n&&Ke(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Ke(n),1===t)0===e.tag?function(e){Bs=!0,zs(e)}(cc.bind(null,e)):zs(cc.bind(null,e)),as(function(){0===(6&Nl)&&Vs()}),n=null;else{switch(xt(i)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=Ic(n,rc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function rc(e,t){if(Zl=-1,ec=0,0!==(6&Nl))throw Error(r(327));var n=e.callbackNode;if(Sc()&&e.callbackNode!==n)return null;var i=ht(e,e===Il?Pl:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=yc(e,i);else{t=i;var s=Nl;Nl|=2;var a=gc();for(Il===e&&Pl===t||($l=null,Hl=Ye()+500,pc(e,t));;)try{bc();break}catch(l){mc(e,l)}Er(),El.current=a,Nl=s,null!==Dl?t=0:(Il=null,Pl=0,t=Ll)}if(0!==t){if(2===t&&(0!==(s=mt(e))&&(i=s,t=ac(e,s))),1===t)throw n=jl,pc(e,0),lc(e,i),sc(e,Ye()),n;if(6===t)lc(e,i);else{if(s=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var s=n[i],r=s.getSnapshot;s=s.value;try{if(!oi(r(),s))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(s)&&(2===(t=yc(e,i))&&(0!==(a=mt(e))&&(i=a,t=ac(e,a))),1===t))throw n=jl,pc(e,0),lc(e,i),sc(e,Ye()),n;switch(e.finishedWork=s,e.finishedLanes=i,t){case 0:case 1:throw Error(r(345));case 2:case 5:_c(e,zl,$l);break;case 3:if(lc(e,i),(130023424&i)===i&&10<(t=Vl+500-Ye())){if(0!==ht(e,0))break;if(((s=e.suspendedLanes)&i)!==i){tc(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=is(_c.bind(null,e,zl,$l),t);break}_c(e,zl,$l);break;case 4:if(lc(e,i),(4194240&i)===i)break;for(t=e.eventTimes,s=-1;0<i;){var o=31-at(i);a=1<<o,(o=t[o])>s&&(s=o),i&=~a}if(i=s,10<(i=(120>(i=Ye()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Al(i/1960))-i)){e.timeoutHandle=is(_c.bind(null,e,zl,$l),i);break}_c(e,zl,$l);break;default:throw Error(r(329))}}}return sc(e,Ye()),e.callbackNode===n?rc.bind(null,e):null}function ac(e,t){var n=Ul;return e.current.memoizedState.isDehydrated&&(pc(e,t).flags|=256),2!==(e=yc(e,t))&&(t=zl,zl=n,null!==t&&oc(t)),e}function oc(e){null===zl?zl=e:zl.push.apply(zl,e)}function lc(e,t){for(t&=~Bl,t&=~Fl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),i=1<<n;e[n]=-1,t&=~i}}function cc(e){if(0!==(6&Nl))throw Error(r(327));Sc();var t=ht(e,0);if(0===(1&t))return sc(e,Ye()),null;var n=yc(e,t);if(0!==e.tag&&2===n){var i=mt(e);0!==i&&(t=i,n=ac(e,i))}if(1===n)throw n=jl,pc(e,0),lc(e,t),sc(e,Ye()),n;if(6===n)throw Error(r(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,_c(e,zl,$l),sc(e,Ye()),null}function dc(e,t){var n=Nl;Nl|=1;try{return e(t)}finally{0===(Nl=n)&&(Hl=Ye()+500,Bs&&Vs())}}function uc(e){null!==Ql&&0===Ql.tag&&0===(6&Nl)&&Sc();var t=Nl;Nl|=1;var n=kl.transition,i=bt;try{if(kl.transition=null,bt=1,e)return e()}finally{bt=i,kl.transition=n,0===(6&(Nl=t))&&Vs()}}function hc(){Ml=Rl.current,As(Rl)}function pc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ss(n)),null!==Dl)for(n=Dl.return;null!==n;){var i=n;switch(tr(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&Ms();break;case 3:Yr(),As(Ns),As(ks),ia();break;case 5:Zr(i);break;case 4:Yr();break;case 13:case 19:As(ea);break;case 10:Tr(i.type._context);break;case 22:case 23:hc()}n=n.return}if(Il=e,Dl=e=Rc(e.current,null),Pl=Ml=t,Ll=0,jl=null,Bl=Fl=Ol=0,zl=Ul=null,null!==Pr){for(t=0;t<Pr.length;t++)if(null!==(i=(n=Pr[t]).interleaved)){n.interleaved=null;var s=i.next,r=n.pending;if(null!==r){var a=r.next;r.next=s,i.next=a}n.pending=i}Pr=null}return e}function mc(e,t){for(;;){var n=Dl;try{if(Er(),sa.current=Ja,da){for(var i=oa.memoizedState;null!==i;){var s=i.queue;null!==s&&(s.pending=null),i=i.next}da=!1}if(aa=0,ca=la=oa=null,ua=!1,ha=0,Tl.current=null,null===n||null===n.return){Ll=1,jl=t,Dl=null;break}e:{var a=e,o=n.return,l=n,c=t;if(t=Pl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var d=c,u=l,h=u.tag;if(0===(1&u.mode)&&(0===h||11===h||15===h)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=yo(o);if(null!==m){m.flags&=-257,vo(m,o,l,0,t),1&m.mode&&fo(a,d,t),c=d;var g=(t=m).updateQueue;if(null===g){var f=new Set;f.add(c),t.updateQueue=f}else g.add(c);break e}if(0===(1&t)){fo(a,d,t),fc();break e}c=Error(r(426))}else if(sr&&1&l.mode){var y=yo(o);if(null!==y){0===(65536&y.flags)&&(y.flags|=256),vo(y,o,l,0,t),mr(co(c,l));break e}}a=c=co(c,l),4!==Ll&&(Ll=2),null===Ul?Ul=[a]:Ul.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Vr(a,mo(0,c,t));break e;case 1:l=c;var v=a.type,b=a.stateNode;if(0===(128&a.flags)&&("function"===typeof v.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Wl||!Wl.has(b)))){a.flags|=65536,t&=-t,a.lanes|=t,Vr(a,go(a,l,t));break e}}a=a.return}while(null!==a)}wc(n)}catch(x){t=x,Dl===n&&null!==n&&(Dl=n=n.return);continue}break}}function gc(){var e=El.current;return El.current=Ja,null===e?Ja:e}function fc(){0!==Ll&&3!==Ll&&2!==Ll||(Ll=4),null===Il||0===(268435455&Ol)&&0===(268435455&Fl)||lc(Il,Pl)}function yc(e,t){var n=Nl;Nl|=2;var i=gc();for(Il===e&&Pl===t||($l=null,pc(e,t));;)try{vc();break}catch(s){mc(e,s)}if(Er(),Nl=n,El.current=i,null!==Dl)throw Error(r(261));return Il=null,Pl=0,Ll}function vc(){for(;null!==Dl;)xc(Dl)}function bc(){for(;null!==Dl&&!Qe();)xc(Dl)}function xc(e){var t=Cl(e.alternate,e,Ml);e.memoizedProps=e.pendingProps,null===t?wc(e):Dl=t,Tl.current=null}function wc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ko(n,t,Ml)))return void(Dl=n)}else{if(null!==(n=Qo(n,t)))return n.flags&=32767,void(Dl=n);if(null===e)return Ll=6,void(Dl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Dl=t);Dl=t=e}while(null!==t);0===Ll&&(Ll=5)}function _c(e,t,n){var i=bt,s=kl.transition;try{kl.transition=null,bt=1,function(e,t,n,i){do{Sc()}while(null!==Ql);if(0!==(6&Nl))throw Error(r(327));n=e.finishedWork;var s=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(r(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var s=31-at(n),r=1<<s;t[s]=0,i[s]=-1,e[s]=-1,n&=~r}}(e,a),e===Il&&(Dl=Il=null,Pl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Kl||(Kl=!0,Ic(tt,function(){return Sc(),null})),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=kl.transition,kl.transition=null;var o=bt;bt=1;var l=Nl;Nl|=4,Tl.current=null,function(e,t){if(es=$t,pi(e=hi())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var s=i.anchorOffset,a=i.focusNode;i=i.focusOffset;try{n.nodeType,a.nodeType}catch(Nr){n=null;break e}var o=0,l=-1,c=-1,d=0,u=0,h=e,p=null;t:for(;;){for(var m;h!==n||0!==s&&3!==h.nodeType||(l=o+s),h!==a||0!==i&&3!==h.nodeType||(c=o+i),3===h.nodeType&&(o+=h.nodeValue.length),null!==(m=h.firstChild);)p=h,h=m;for(;;){if(h===e)break t;if(p===n&&++d===s&&(l=o),p===a&&++u===i&&(c=o),null!==(m=h.nextSibling))break;p=(h=p).parentNode}h=m}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ts={focusedElem:e,selectionRange:n},$t=!1,Zo=t;null!==Zo;)if(e=(t=Zo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Zo=e;else for(;null!==Zo;){t=Zo;try{var g=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==g){var f=g.memoizedProps,y=g.memoizedState,v=t.stateNode,b=v.getSnapshotBeforeUpdate(t.elementType===t.type?f:no(t.type,f),y);v.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(r(163))}}catch(Nr){Ac(t,t.return,Nr)}if(null!==(e=t.sibling)){e.return=t.return,Zo=e;break}Zo=t.return}g=nl,nl=!1}(e,n),yl(n,e),mi(ts),$t=!!es,ts=es=null,e.current=n,bl(n,e,s),Xe(),Nl=l,bt=o,kl.transition=a}else e.current=n;if(Kl&&(Kl=!1,Ql=e,Xl=s),a=e.pendingLanes,0===a&&(Wl=null),function(e){if(rt&&"function"===typeof rt.onCommitFiberRoot)try{rt.onCommitFiberRoot(st,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),sc(e,Ye()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)s=t[n],i(s.value,{componentStack:s.stack,digest:s.digest});if(ql)throw ql=!1,e=Gl,Gl=null,e;0!==(1&Xl)&&0!==e.tag&&Sc(),a=e.pendingLanes,0!==(1&a)?e===Jl?Yl++:(Yl=0,Jl=e):Yl=0,Vs()}(e,t,n,i)}finally{kl.transition=s,bt=i}return null}function Sc(){if(null!==Ql){var e=xt(Xl),t=kl.transition,n=bt;try{if(kl.transition=null,bt=16>e?16:e,null===Ql)var i=!1;else{if(e=Ql,Ql=null,Xl=0,0!==(6&Nl))throw Error(r(331));var s=Nl;for(Nl|=4,Zo=e.current;null!==Zo;){var a=Zo,o=a.child;if(0!==(16&Zo.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var d=l[c];for(Zo=d;null!==Zo;){var u=Zo;switch(u.tag){case 0:case 11:case 15:il(8,u,a)}var h=u.child;if(null!==h)h.return=u,Zo=h;else for(;null!==Zo;){var p=(u=Zo).sibling,m=u.return;if(al(u),u===d){Zo=null;break}if(null!==p){p.return=m,Zo=p;break}Zo=m}}}var g=a.alternate;if(null!==g){var f=g.child;if(null!==f){g.child=null;do{var y=f.sibling;f.sibling=null,f=y}while(null!==f)}}Zo=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,Zo=o;else e:for(;null!==Zo;){if(0!==(2048&(a=Zo).flags))switch(a.tag){case 0:case 11:case 15:il(9,a,a.return)}var v=a.sibling;if(null!==v){v.return=a.return,Zo=v;break e}Zo=a.return}}var b=e.current;for(Zo=b;null!==Zo;){var x=(o=Zo).child;if(0!==(2064&o.subtreeFlags)&&null!==x)x.return=o,Zo=x;else e:for(o=b;null!==Zo;){if(0!==(2048&(l=Zo).flags))try{switch(l.tag){case 0:case 11:case 15:sl(9,l)}}catch(_){Ac(l,l.return,_)}if(l===o){Zo=null;break e}var w=l.sibling;if(null!==w){w.return=l.return,Zo=w;break e}Zo=l.return}}if(Nl=s,Vs(),rt&&"function"===typeof rt.onPostCommitFiberRoot)try{rt.onPostCommitFiberRoot(st,e)}catch(_){}i=!0}return i}finally{bt=n,kl.transition=t}}return!1}function Cc(e,t,n){e=Ur(e,t=mo(0,t=co(n,t),1),1),t=tc(),null!==e&&(yt(e,1,t),sc(e,t))}function Ac(e,t,n){if(3===e.tag)Cc(e,e,n);else for(;null!==t;){if(3===t.tag){Cc(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Wl||!Wl.has(i))){t=Ur(t,e=go(t,e=co(n,e),1),1),e=tc(),null!==t&&(yt(t,1,e),sc(t,e));break}}t=t.return}}function Ec(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=tc(),e.pingedLanes|=e.suspendedLanes&n,Il===e&&(Pl&n)===n&&(4===Ll||3===Ll&&(130023424&Pl)===Pl&&500>Ye()-Vl?pc(e,0):Bl|=n),sc(e,t)}function Tc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=dt,0===(130023424&(dt<<=1))&&(dt=4194304)));var n=tc();null!==(e=Lr(e,t))&&(yt(e,t,n),sc(e,n))}function kc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Tc(e,n)}function Nc(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,s=e.memoizedState;null!==s&&(n=s.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(r(314))}null!==i&&i.delete(t),Tc(e,n)}function Ic(e,t){return We(e,t)}function Dc(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Pc(e,t,n,i){return new Dc(e,t,n,i)}function Mc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Rc(e,t){var n=e.alternate;return null===n?((n=Pc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Lc(e,t,n,i,s,a){var o=2;if(i=e,"function"===typeof e)Mc(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case S:return jc(n.children,s,a,t);case C:o=8,s|=8;break;case A:return(e=Pc(12,n,t,2|s)).elementType=A,e.lanes=a,e;case N:return(e=Pc(13,n,t,s)).elementType=N,e.lanes=a,e;case I:return(e=Pc(19,n,t,s)).elementType=I,e.lanes=a,e;case M:return Oc(n,s,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case E:o=10;break e;case T:o=9;break e;case k:o=11;break e;case D:o=14;break e;case P:o=16,i=null;break e}throw Error(r(130,null==e?e:typeof e,""))}return(t=Pc(o,n,t,s)).elementType=e,t.type=i,t.lanes=a,t}function jc(e,t,n,i){return(e=Pc(7,e,i,t)).lanes=n,e}function Oc(e,t,n,i){return(e=Pc(22,e,i,t)).elementType=M,e.lanes=n,e.stateNode={isHidden:!1},e}function Fc(e,t,n){return(e=Pc(6,e,null,t)).lanes=n,e}function Bc(e,t,n){return(t=Pc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Uc(e,t,n,i,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ft(0),this.expirationTimes=ft(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ft(0),this.identifierPrefix=i,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function zc(e,t,n,i,s,r,a,o,l){return e=new Uc(e,t,n,o,l),1===t?(t=1,!0===r&&(t|=8)):t=0,r=Pc(3,null,null,t),e.current=r,r.stateNode=e,r.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Or(r),e}function Vc(e){if(!e)return Ts;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(r(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ps(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(r(171))}if(1===e.tag){var n=e.type;if(Ps(n))return Ls(e,n,t)}return t}function Hc(e,t,n,i,s,r,a,o,l){return(e=zc(n,i,!0,e,0,r,0,o,l)).context=Vc(null),n=e.current,(r=Br(i=tc(),s=nc(n))).callback=void 0!==t&&null!==t?t:null,Ur(n,r,s),e.current.lanes=s,yt(e,s,i),sc(e,i),e}function $c(e,t,n,i){var s=t.current,r=tc(),a=nc(s);return n=Vc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Br(r,a)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Ur(s,t,a))&&(ic(e,s,a,r),zr(e,s,a)),a}function qc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Gc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Wc(e,t){Gc(e,t),(e=e.alternate)&&Gc(e,t)}Cl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ns.current)xo=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return xo=!1,function(e,t,n){switch(t.tag){case 3:Io(t),pr();break;case 5:Jr(t);break;case 1:Ps(t.type)&&js(t);break;case 4:Xr(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,s=t.memoizedProps.value;Es(_r,i._currentValue),i._currentValue=s;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(Es(ea,1&ea.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Fo(e,t,n):(Es(ea,1&ea.current),null!==(e=qo(e,t,n))?e.sibling:null);Es(ea,1&ea.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return Ho(e,t,n);t.flags|=128}if(null!==(s=t.memoizedState)&&(s.rendering=null,s.tail=null,s.lastEffect=null),Es(ea,ea.current),i)break;return null;case 22:case 23:return t.lanes=0,Ao(e,t,n)}return qo(e,t,n)}(e,t,n);xo=0!==(131072&e.flags)}else xo=!1,sr&&0!==(1048576&t.flags)&&Zs(t,Gs,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;$o(e,t),e=t.pendingProps;var s=Ds(t,ks.current);Ir(t,n),s=fa(null,t,i,e,s,n);var a=ya();return t.flags|=1,"object"===typeof s&&null!==s&&"function"===typeof s.render&&void 0===s.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ps(i)?(a=!0,js(t)):a=!1,t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,Or(t),s.updater=so,t.stateNode=s,s._reactInternals=t,lo(t,i,e,n),t=No(null,t,i,!0,a,n)):(t.tag=0,sr&&a&&er(t),wo(null,t,s,n),t=t.child),t;case 16:i=t.elementType;e:{switch($o(e,t),e=t.pendingProps,i=(s=i._init)(i._payload),t.type=i,s=t.tag=function(e){if("function"===typeof e)return Mc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===k)return 11;if(e===D)return 14}return 2}(i),e=no(i,e),s){case 0:t=To(null,t,i,e,n);break e;case 1:t=ko(null,t,i,e,n);break e;case 11:t=_o(null,t,i,e,n);break e;case 14:t=So(null,t,i,no(i.type,e),n);break e}throw Error(r(306,i,""))}return t;case 0:return i=t.type,s=t.pendingProps,To(e,t,i,s=t.elementType===i?s:no(i,s),n);case 1:return i=t.type,s=t.pendingProps,ko(e,t,i,s=t.elementType===i?s:no(i,s),n);case 3:e:{if(Io(t),null===e)throw Error(r(387));i=t.pendingProps,s=(a=t.memoizedState).element,Fr(e,t),Hr(t,i,null,n);var o=t.memoizedState;if(i=o.element,a.isDehydrated){if(a={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Do(e,t,i,n,s=co(Error(r(423)),t));break e}if(i!==s){t=Do(e,t,i,n,s=co(Error(r(424)),t));break e}for(ir=cs(t.stateNode.containerInfo.firstChild),nr=t,sr=!0,rr=null,n=wr(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(pr(),i===s){t=qo(e,t,n);break e}wo(e,t,i,n)}t=t.child}return t;case 5:return Jr(t),null===e&&cr(t),i=t.type,s=t.pendingProps,a=null!==e?e.memoizedProps:null,o=s.children,ns(i,s)?o=null:null!==a&&ns(i,a)&&(t.flags|=32),Eo(e,t),wo(e,t,o,n),t.child;case 6:return null===e&&cr(t),null;case 13:return Fo(e,t,n);case 4:return Xr(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=xr(t,null,i,n):wo(e,t,i,n),t.child;case 11:return i=t.type,s=t.pendingProps,_o(e,t,i,s=t.elementType===i?s:no(i,s),n);case 7:return wo(e,t,t.pendingProps,n),t.child;case 8:case 12:return wo(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,s=t.pendingProps,a=t.memoizedProps,o=s.value,Es(_r,i._currentValue),i._currentValue=o,null!==a)if(oi(a.value,o)){if(a.children===s.children&&!Ns.current){t=qo(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){o=a.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===a.tag){(c=Br(-1,n&-n)).tag=2;var d=a.updateQueue;if(null!==d){var u=(d=d.shared).pending;null===u?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),kr(a.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(r(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),kr(o,n,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}wo(e,t,s.children,n),t=t.child}return t;case 9:return s=t.type,i=t.pendingProps.children,Ir(t,n),i=i(s=Dr(s)),t.flags|=1,wo(e,t,i,n),t.child;case 14:return s=no(i=t.type,t.pendingProps),So(e,t,i,s=no(i.type,s),n);case 15:return Co(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,s=t.pendingProps,s=t.elementType===i?s:no(i,s),$o(e,t),t.tag=1,Ps(i)?(e=!0,js(t)):e=!1,Ir(t,n),ao(t,i,s),lo(t,i,s,n),No(null,t,i,!0,e,n);case 19:return Ho(e,t,n);case 22:return Ao(e,t,n)}throw Error(r(156,t.tag))};var Kc="function"===typeof reportError?reportError:function(e){console.error(e)};function Qc(e){this._internalRoot=e}function Xc(e){this._internalRoot=e}function Yc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zc(){}function ed(e,t,n,i,s){var r=n._reactRootContainer;if(r){var a=r;if("function"===typeof s){var o=s;s=function(){var e=qc(a);o.call(e)}}$c(t,a,e,s)}else a=function(e,t,n,i,s){if(s){if("function"===typeof i){var r=i;i=function(){var e=qc(a);r.call(e)}}var a=Hc(t,i,e,0,null,!1,0,"",Zc);return e._reactRootContainer=a,e[ms]=a.current,Vi(8===e.nodeType?e.parentNode:e),uc(),a}for(;s=e.lastChild;)e.removeChild(s);if("function"===typeof i){var o=i;i=function(){var e=qc(l);o.call(e)}}var l=zc(e,0,!1,null,0,!1,0,"",Zc);return e._reactRootContainer=l,e[ms]=l.current,Vi(8===e.nodeType?e.parentNode:e),uc(function(){$c(t,l,n,i)}),l}(n,t,e,s,i);return qc(a)}Xc.prototype.render=Qc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(r(409));$c(e,t,null,null)},Xc.prototype.unmount=Qc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;uc(function(){$c(null,e,null,null)}),t[ms]=null}},Xc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Ct();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Mt.length&&0!==t&&t<Mt[n].priority;n++);Mt.splice(n,0,e),0===n&&Ot(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ut(t.pendingLanes);0!==n&&(vt(t,1|n),sc(t,Ye()),0===(6&Nl)&&(Hl=Ye()+500,Vs()))}break;case 13:uc(function(){var t=Lr(e,1);if(null!==t){var n=tc();ic(t,e,1,n)}}),Wc(e,1)}},_t=function(e){if(13===e.tag){var t=Lr(e,134217728);if(null!==t)ic(t,e,134217728,tc());Wc(e,134217728)}},St=function(e){if(13===e.tag){var t=nc(e),n=Lr(e,t);if(null!==n)ic(n,e,t,tc());Wc(e,t)}},Ct=function(){return bt},At=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},_e=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var s=ws(i);if(!s)throw Error(r(90));W(i),J(i,s)}}}break;case"textarea":re(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},ke=dc,Ne=uc;var td={usingClientEntryPoint:!1,Events:[bs,xs,ws,Ee,Te,dc]},nd={findFiberByHostInstance:vs,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},id={bundleType:nd.bundleType,version:nd.version,rendererPackageName:nd.rendererPackageName,rendererConfig:nd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=qe(e))?null:e.stateNode},findFiberByHostInstance:nd.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var sd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!sd.isDisabled&&sd.supportsFiber)try{st=sd.inject(id),rt=sd}catch(de){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=td,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Yc(t))throw Error(r(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:_,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Yc(e))throw Error(r(299));var n=!1,i="",s=Kc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(s=t.onRecoverableError)),t=zc(e,1,!1,null,0,n,0,i,s),e[ms]=t.current,Vi(8===e.nodeType?e.parentNode:e),new Qc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(r(188));throw e=Object.keys(e).join(","),Error(r(268,e))}return e=null===(e=qe(t))?null:e.stateNode},t.flushSync=function(e){return uc(e)},t.hydrate=function(e,t,n){if(!Jc(t))throw Error(r(200));return ed(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Yc(e))throw Error(r(405));var i=null!=n&&n.hydratedSources||null,s=!1,a="",o=Kc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(s=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=Hc(t,null,e,1,null!=n?n:null,s,0,a,o),e[ms]=t.current,Vi(e),i)for(e=0;e<i.length;e++)s=(s=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,s]:t.mutableSourceEagerHydrationData.push(n,s);return new Xc(t)},t.render=function(e,t,n){if(!Jc(t))throw Error(r(200));return ed(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(r(40));return!!e._reactRootContainer&&(uc(function(){ed(null,null,e,!1,function(){e._reactRootContainer=null,e[ms]=null})}),!0)},t.unstable_batchedUpdates=dc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Jc(n))throw Error(r(200));if(null==e||void 0===e._reactInternals)throw Error(r(38));return ed(e,t,n,!1,i)},t.version="18.3.1-next-f1338f8080-20240426"},853:(e,t,n)=>{e.exports=n(234)},950:(e,t,n)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}();var i=n(43),s=n(391);const r=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):55296===(64512&s)&&i+1<e.length&&56320===(64512&e.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++i)),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<e.length;s+=3){const t=e[s],r=s+1<e.length,a=r?e[s+1]:0,o=s+2<e.length,l=o?e[s+2]:0,c=t>>2,d=(3&t)<<4|a>>4;let u=(15&a)<<2|l>>6,h=63&l;o||(h=64,r||(u=64)),i.push(n[c],n[d],n[u],n[h])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(r(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const s=e[n++];if(s<128)t[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=e[n++];t[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(r>>10)),t[i++]=String.fromCharCode(56320+(1023&r))}else{const r=e[n++],a=e[n++];t[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<e.length;){const t=n[e.charAt(s++)],r=s<e.length?n[e.charAt(s)]:0;++s;const a=s<e.length?n[e.charAt(s)]:64;++s;const l=s<e.length?n[e.charAt(s)]:64;if(++s,null==t||null==r||null==a||null==l)throw new o;const c=t<<2|r>>4;if(i.push(c),64!==a){const e=r<<4&240|a>>2;if(i.push(e),64!==l){const e=a<<6&192|l;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class o extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const l=function(e){return function(e){const t=r(e);return a.encodeByteArray(t,!0)}(e).replace(/\./g,"")},c=function(e){try{return a.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function d(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}const u=()=>{try{return d().__FIREBASE_DEFAULTS__||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"https://linesmart-api-650169261019.us-central1.run.app",REACT_APP_FIREBASE_API_KEY:"AIzaSyAaXlvuopHtTZglfghnlc_hBqGr1YzPrBk",REACT_APP_FIREBASE_AUTH_DOMAIN:"fredfix.firebaseapp.com",REACT_APP_FIREBASE_PROJECT_ID:"fredfix",REACT_APP_FIREBASE_STORAGE_BUCKET:"fredfix.firebasestorage.app",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"650169261019",REACT_APP_FIREBASE_APP_ID:"1:650169261019:web:0106d844197d7f44eca5fe"}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&c(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},h=e=>u()?.emulatorHosts?.[e],p=e=>{const t=h(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},m=()=>u()?.config,g=e=>u()?.[`_${e}`];class f{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function y(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function v(e){return(await fetch(e,{credentials:"include"})).ok}function b(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const r={iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...e};return[l(JSON.stringify({alg:"none",type:"JWT"})),l(JSON.stringify(r)),""].join(".")}const x={};let w=!1;function _(e,t){if("undefined"===typeof window||"undefined"===typeof document||!y(window.location.host)||x[e]===t||x[e]||w)return;function n(e){return`__firebase__banner__${e}`}x[e]=t;const i="__firebase__banner",s=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(x))x[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function r(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{w=!0,function(){const e=document.getElementById(i);e&&e.remove()}()},e}function a(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(i),t=n("text"),a=document.getElementById(t)||document.createElement("span"),o=n("learnmore"),l=document.getElementById(o)||document.createElement("a"),c=n("preprendIcon"),d=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(l,o);const n=r();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(d,c),t.append(d,a,l,n),document.body.appendChild(t)}s?(a.innerText="Preview backend disconnected.",d.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(d.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',a.innerText="Preview backend running in this workspace."),a.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",a):a()}function S(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function C(){const e=u()?.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){return!1}}function A(){return!C()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function E(){try{return"object"===typeof indexedDB}catch(e){return!1}}class T extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,T.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,k.prototype.create)}}class k{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(N,(e,n)=>{const i=t[n];return null!=i?String(i):`<${n}?>`})}(i,t):"Error",r=`${this.serviceName}: ${s} (${n}).`;return new T(n,r,t)}}const N=/\{\$([^}]+)}/g;function I(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const s of n){if(!i.includes(s))return!1;const n=e[s],r=t[s];if(D(n)&&D(r)){if(!I(n,r))return!1}else if(n!==r)return!1}for(const s of i)if(!n.includes(s))return!1;return!0}function D(e){return null!==e&&"object"===typeof e}function P(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function M(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}}),t}function R(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class L{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");i=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===i.next&&(i.next=j),void 0===i.error&&(i.error=j),void 0===i.complete&&(i.complete=j);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}}),this.observers.push(i),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!==typeof console&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function j(){}function O(e){return e&&e._delegate?e._delegate:e}class F{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const B="[DEFAULT]";class U{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new f;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(n)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:B})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:i});n.resolve(e)}catch(t){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[s,r]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(s)&&r.resolve(i)}return i}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(n)??new Set;i.add(e),this.onInitCallbacks.set(n,i);const s=this.instances.get(n);return s&&e(s,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch{}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(s=t,s===B?void 0:s),options:n}),this.instances.set(t,i),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch{}var s;return i||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B;return this.component?this.component.multipleInstances?e:B:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class z{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new U(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const V=[];var H;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(H||(H={}));const $={debug:H.DEBUG,verbose:H.VERBOSE,info:H.INFO,warn:H.WARN,error:H.ERROR,silent:H.SILENT},q=H.INFO,G={[H.DEBUG]:"log",[H.VERBOSE]:"log",[H.INFO]:"info",[H.WARN]:"warn",[H.ERROR]:"error"},W=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),i=G[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);for(var s=arguments.length,r=new Array(s>2?s-2:0),a=2;a<s;a++)r[a-2]=arguments[a];console[i](`[${n}]  ${e.name}:`,...r)};class K{constructor(e){this.name=e,this._logLevel=q,this._logHandler=W,this._userLogHandler=null,V.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in H))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?$[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,H.DEBUG,...t),this._logHandler(this,H.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,H.VERBOSE,...t),this._logHandler(this,H.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,H.INFO,...t),this._logHandler(this,H.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,H.WARN,...t),this._logHandler(this,H.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,H.ERROR,...t),this._logHandler(this,H.ERROR,...t)}}let Q,X;const Y=new WeakMap,J=new WeakMap,Z=new WeakMap,ee=new WeakMap,te=new WeakMap;let ne={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return J.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Z.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return re(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function ie(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(X||(X=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e.apply(ae(this),n),re(Y.get(this))}:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return re(e.apply(ae(this),n))}:function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];const r=e.call(ae(this),t,...i);return Z.set(r,t.sort?t.sort():[t]),re(r)}}function se(e){return"function"===typeof e?ie(e):(e instanceof IDBTransaction&&function(e){if(J.has(e))return;const t=new Promise((t,n)=>{const i=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",r),e.removeEventListener("abort",r)},s=()=>{t(),i()},r=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",s),e.addEventListener("error",r),e.addEventListener("abort",r)});J.set(e,t)}(e),t=e,(Q||(Q=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,ne):e);var t}function re(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const i=()=>{e.removeEventListener("success",s),e.removeEventListener("error",r)},s=()=>{t(re(e.result)),i()},r=()=>{n(e.error),i()};e.addEventListener("success",s),e.addEventListener("error",r)});return t.then(t=>{t instanceof IDBCursor&&Y.set(t,e)}).catch(()=>{}),te.set(t,e),t}(e);if(ee.has(e))return ee.get(e);const t=se(e);return t!==e&&(ee.set(e,t),te.set(t,e)),t}const ae=e=>te.get(e);const oe=["get","getKey","getAll","getAllKeys","count"],le=["put","add","delete","clear"],ce=new Map;function de(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(ce.get(t))return ce.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,s=le.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!oe.includes(n))return;const r=async function(e){const t=this.transaction(e,s?"readwrite":"readonly");let r=t.store;for(var a=arguments.length,o=new Array(a>1?a-1:0),l=1;l<a;l++)o[l-1]=arguments[l];return i&&(r=r.index(o.shift())),(await Promise.all([r[n](...o),s&&t.done]))[0]};return ce.set(t,r),r}ne=(e=>({...e,get:(t,n,i)=>de(t,n)||e.get(t,n,i),has:(t,n)=>!!de(t,n)||e.has(t,n)}))(ne);class ue{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===t?.type}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const he="@firebase/app",pe="0.14.7",me=new K("@firebase/app"),ge="@firebase/app-compat",fe="@firebase/analytics-compat",ye="@firebase/analytics",ve="@firebase/app-check-compat",be="@firebase/app-check",xe="@firebase/auth",we="@firebase/auth-compat",_e="@firebase/database",Se="@firebase/data-connect",Ce="@firebase/database-compat",Ae="@firebase/functions",Ee="@firebase/functions-compat",Te="@firebase/installations",ke="@firebase/installations-compat",Ne="@firebase/messaging",Ie="@firebase/messaging-compat",De="@firebase/performance",Pe="@firebase/performance-compat",Me="@firebase/remote-config",Re="@firebase/remote-config-compat",Le="@firebase/storage",je="@firebase/storage-compat",Oe="@firebase/firestore",Fe="@firebase/ai",Be="@firebase/firestore-compat",Ue="firebase",ze="[DEFAULT]",Ve={[he]:"fire-core",[ge]:"fire-core-compat",[ye]:"fire-analytics",[fe]:"fire-analytics-compat",[be]:"fire-app-check",[ve]:"fire-app-check-compat",[xe]:"fire-auth",[we]:"fire-auth-compat",[_e]:"fire-rtdb",[Se]:"fire-data-connect",[Ce]:"fire-rtdb-compat",[Ae]:"fire-fn",[Ee]:"fire-fn-compat",[Te]:"fire-iid",[ke]:"fire-iid-compat",[Ne]:"fire-fcm",[Ie]:"fire-fcm-compat",[De]:"fire-perf",[Pe]:"fire-perf-compat",[Me]:"fire-rc",[Re]:"fire-rc-compat",[Le]:"fire-gcs",[je]:"fire-gcs-compat",[Oe]:"fire-fst",[Be]:"fire-fst-compat",[Fe]:"fire-vertex","fire-js":"fire-js",[Ue]:"fire-js-all"},He=new Map,$e=new Map,qe=new Map;function Ge(e,t){try{e.container.addComponent(t)}catch(n){me.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function We(e){const t=e.name;if(qe.has(t))return me.debug(`There were multiple attempts to register component ${t}.`),!1;qe.set(t,e);for(const n of He.values())Ge(n,e);for(const n of $e.values())Ge(n,e);return!0}function Ke(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function Qe(e){return null!==e&&void 0!==e&&void 0!==e.settings}const Xe=new k("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Ye{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new F("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Xe.create("app-deleted",{appName:this._name})}}const Je="12.8.0";function Ze(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const i={name:ze,automaticDataCollectionEnabled:!0,...t},s=i.name;if("string"!==typeof s||!s)throw Xe.create("bad-app-name",{appName:String(s)});if(n||(n=m()),!n)throw Xe.create("no-options");const r=He.get(s);if(r){if(I(n,r.options)&&I(i,r.config))return r;throw Xe.create("duplicate-app",{appName:s})}const a=new z(s);for(const l of qe.values())a.addComponent(l);const o=new Ye(n,i,a);return He.set(s,o),o}function et(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ze;const t=He.get(e);if(!t&&e===ze&&m())return Ze();if(!t)throw Xe.create("no-app",{appName:e});return t}function tt(e,t,n){let i=Ve[e]??e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),r=t.match(/\s|\//);if(s||r){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&r&&e.push("and"),r&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void me.warn(e.join(" "))}We(new F(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}const nt="firebase-heartbeat-store";let it=null;function st(){return it||(it=function(e,t){let{blocked:n,upgrade:i,blocking:s,terminated:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=indexedDB.open(e,t),o=re(a);return i&&a.addEventListener("upgradeneeded",e=>{i(re(a.result),e.oldVersion,e.newVersion,re(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{r&&e.addEventListener("close",()=>r()),s&&e.addEventListener("versionchange",e=>s(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(nt)}catch(n){console.warn(n)}}}).catch(e=>{throw Xe.create("idb-open",{originalErrorMessage:e.message})})),it}async function rt(e,t){try{const n=(await st()).transaction(nt,"readwrite"),i=n.objectStore(nt);await i.put(t,at(e)),await n.done}catch(n){if(n instanceof T)me.warn(n.message);else{const e=Xe.create("idb-set",{originalErrorMessage:n?.message});me.warn(e.message)}}}function at(e){return`${e.name}!${e.options.appId}`}class ot{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ct(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=lt();if(null==this._heartbeatsCache?.heartbeats&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let i=1;i<e.length;i++)e[i].date<n&&(n=e[i].date,t=i);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){me.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats||0===this._heartbeatsCache.heartbeats.length)return"";const e=lt(),{heartbeatsToSend:t,unsentEntries:n}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let i=e.slice();for(const s of e){const e=n.find(e=>e.agent===s.agent);if(e){if(e.dates.push(s.date),dt(n)>t){e.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),dt(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=l(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return me.warn(e),""}}}function lt(){return(new Date).toISOString().substring(0,10)}class ct{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!E()&&new Promise((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(n){t(n)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await st()).transaction(nt),n=await t.objectStore(nt).get(at(e));return await t.done,n}catch(t){if(t instanceof T)me.warn(t.message);else{const e=Xe.create("idb-get",{originalErrorMessage:t?.message});me.warn(e.message)}}}(this.app);return e?.heartbeats?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return rt(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return rt(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function dt(e){return l(JSON.stringify({version:2,heartbeats:e})).length}var ut;ut="",We(new F("platform-logger",e=>new ue(e),"PRIVATE")),We(new F("heartbeat",e=>new ot(e),"PRIVATE")),tt(he,pe,ut),tt(he,pe,"esm2020"),tt("fire-js","");function ht(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const pt=ht,mt=new k("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),gt=new K("@firebase/auth");function ft(e){if(gt.logLevel<=H.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];gt.error(`Auth (${Je}): ${e}`,...n)}}function yt(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];throw _t(e,...n)}function vt(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return _t(e,...n)}function bt(e,t,n){const i={...pt(),[t]:n};return new k("auth","Firebase",i).create(t,{appName:e.name})}function xt(e){return bt(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function wt(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&yt(e,"argument-error"),bt(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function _t(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if("string"!==typeof e){const t=n[0],i=[...n.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(t,...i)}return mt.create(e,...n)}function St(e,t){if(!e){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];throw _t(t,...i)}}function Ct(e){const t="INTERNAL ASSERTION FAILED: "+e;throw ft(t),new Error(t)}function At(e,t){e||Ct(t)}function Et(){return"undefined"!==typeof self&&self.location?.href||""}function Tt(){return"http:"===kt()||"https:"===kt()}function kt(){return"undefined"!==typeof self&&self.location?.protocol||null}function Nt(){return!("undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(Tt()||function(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class It{constructor(e,t){this.shortDelay=e,this.longDelay=t,At(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(S())||"object"===typeof navigator&&"ReactNative"===navigator.product}get(){return Nt()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Dt(e,t){At(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Pt{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void Ct("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void Ct("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void Ct("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Mt={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Rt=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Lt=new It(3e4,6e4);function jt(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function Ot(e,t,n,i){return Ft(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},async()=>{let s={},r={};i&&("GET"===t?r=i:s={body:JSON.stringify(i)});const a=P({key:e.config.apiKey,...r}).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);const l={method:t,headers:o,...s};return"undefined"!==typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(l.referrerPolicy="no-referrer"),e.emulatorConfig&&y(e.emulatorConfig.host)&&(l.credentials="include"),Pt.fetch()(await Ut(e,e.config.apiHost,n,a),l)})}async function Ft(e,t,n){e._canInitEmulator=!1;const i={...Mt,...t};try{const t=new Vt(e),s=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const r=await s.json();if("needConfirmation"in r)throw Ht(e,"account-exists-with-different-credential",r);if(s.ok&&!("errorMessage"in r))return r;{const t=s.ok?r.errorMessage:r.error.message,[n,a]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Ht(e,"credential-already-in-use",r);if("EMAIL_EXISTS"===n)throw Ht(e,"email-already-in-use",r);if("USER_DISABLED"===n)throw Ht(e,"user-disabled",r);const o=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw bt(e,o,a);yt(e,o)}}catch(s){if(s instanceof T)throw s;yt(e,"network-request-failed",{message:String(s)})}}async function Bt(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const r=await Ot(e,t,n,i,s);return"mfaPendingCredential"in r&&yt(e,"multi-factor-auth-required",{_serverResponse:r}),r}async function Ut(e,t,n,i){const s=`${t}${n}?${i}`,r=e,a=r.config.emulator?Dt(e.config,s):`${e.config.apiScheme}://${s}`;if(Rt.includes(n)&&(await r._persistenceManagerAvailable,"COOKIE"===r._getPersistenceType())){return r._getPersistence()._getFinalTarget(a).toString()}return a}function zt(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Vt{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(vt(this.auth,"network-request-failed")),Lt.get())})}}function Ht(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const s=vt(e,t,i);return s.customData._tokenResponse=n,s}function $t(e){return void 0!==e&&void 0!==e.enterprise}class qt{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return zt(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Gt(e,t){return Ot(e,"GET","/v2/recaptchaConfig",jt(e,t))}async function Wt(e,t){return Ot(e,"POST","/v1/accounts:lookup",t)}function Kt(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function Qt(e){return 1e3*Number(e)}function Xt(e){const[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return ft("JWT malformed, contained fewer than 3 sections"),null;try{const e=c(n);return e?JSON.parse(e):(ft("Failed to decode base64 JWT payload"),null)}catch(s){return ft("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Yt(e){const t=Xt(e);return St(t,"internal-error"),St("undefined"!==typeof t.exp,"internal-error"),St("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function Jt(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(n){throw n instanceof T&&function(e){let{code:t}=e;return"auth/user-disabled"===t||"auth/user-token-expired"===t}(n)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}class Zt{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e?.code&&this.schedule(!0))}this.schedule()}}class en{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Kt(this.lastLoginAt),this.creationTime=Kt(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function tn(e){const t=e.auth,n=await e.getIdToken(),i=await Jt(e,Wt(t,{idToken:n}));St(i?.users.length,t,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const r=s.providerUserInfo?.length?nn(s.providerUserInfo):[],a=(o=e.providerData,l=r,[...o.filter(e=>!l.some(t=>t.providerId===e.providerId)),...l]);var o,l;const c=e.isAnonymous,d=!(e.email&&s.passwordHash)&&!a?.length,u=!!c&&d,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new en(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(e,h)}function nn(e){return e.map(e=>{let{providerId:t,...n}=e;return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}class sn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){St(e.idToken,"internal-error"),St("undefined"!==typeof e.idToken,"internal-error"),St("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):Yt(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){St(0!==e.length,"internal-error");const t=Yt(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?(St(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:s}=await async function(e,t){const n=await Ft(e,{},async()=>{const n=P({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:s}=e.config,r=await Ut(e,i,"/v1/token",`key=${s}`),a=await e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const o={method:"POST",headers:a,body:n};return e.emulatorConfig&&y(e.emulatorConfig.host)&&(o.credentials="include"),Pt.fetch()(r,o)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,i,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:s}=t,r=new sn;return n&&(St("string"===typeof n,"internal-error",{appName:e}),r.refreshToken=n),i&&(St("string"===typeof i,"internal-error",{appName:e}),r.accessToken=i),s&&(St("number"===typeof s,"internal-error",{appName:e}),r.expirationTime=s),r}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new sn,this.toJSON())}_performRefresh(){return Ct("not implemented")}}function rn(e,t){St("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class an{constructor(e){let{uid:t,auth:n,stsTokenManager:i,...s}=e;this.providerId="firebase",this.proactiveRefresh=new Zt(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new en(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Jt(this,this.stsTokenManager.getToken(this.auth,e));return St(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=O(e),i=await n.getIdToken(t),s=Xt(i);St(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const r="object"===typeof s.firebase?s.firebase:void 0,a=r?.sign_in_provider;return{claims:s,token:i,authTime:Kt(Qt(s.auth_time)),issuedAtTime:Kt(Qt(s.iat)),expirationTime:Kt(Qt(s.exp)),signInProvider:a||null,signInSecondFactor:r?.sign_in_second_factor||null}}(this,e)}reload(){return async function(e){const t=O(e);await tn(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(St(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new an({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){St(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await tn(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Qe(this.auth.app))return Promise.reject(xt(this.auth));const e=await this.getIdToken();return await Jt(this,async function(e,t){return Ot(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const n=t.displayName??void 0,i=t.email??void 0,s=t.phoneNumber??void 0,r=t.photoURL??void 0,a=t.tenantId??void 0,o=t._redirectEventId??void 0,l=t.createdAt??void 0,c=t.lastLoginAt??void 0,{uid:d,emailVerified:u,isAnonymous:h,providerData:p,stsTokenManager:m}=t;St(d&&m,e,"internal-error");const g=sn.fromJSON(this.name,m);St("string"===typeof d,e,"internal-error"),rn(n,e.name),rn(i,e.name),St("boolean"===typeof u,e,"internal-error"),St("boolean"===typeof h,e,"internal-error"),rn(s,e.name),rn(r,e.name),rn(a,e.name),rn(o,e.name),rn(l,e.name),rn(c,e.name);const f=new an({uid:d,auth:e,email:i,emailVerified:u,displayName:n,isAnonymous:h,photoURL:r,phoneNumber:s,tenantId:a,stsTokenManager:g,createdAt:l,lastLoginAt:c});return p&&Array.isArray(p)&&(f.providerData=p.map(e=>({...e}))),o&&(f._redirectEventId=o),f}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=new sn;i.updateFromServerResponse(t);const s=new an({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await tn(s),s}static async _fromGetAccountInfoResponse(e,t,n){const i=t.users[0];St(void 0!==i.localId,"internal-error");const s=void 0!==i.providerUserInfo?nn(i.providerUserInfo):[],r=!(i.email&&i.passwordHash)&&!s?.length,a=new sn;a.updateFromIdToken(n);const o=new an({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:r}),l={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new en(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(o,l),o}}const on=new Map;function ln(e){At(e instanceof Function,"Expected a class definition");let t=on.get(e);return t?(At(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,on.set(e,t),t)}class cn{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}cn.type="NONE";const dn=cn;function un(e,t,n){return`firebase:${e}:${t}:${n}`}class hn{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:s}=this.auth;this.fullUserKey=un(this.userKey,i.apiKey,s),this.fullPersistenceKey=un("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"===typeof e){const t=await Wt(this.auth,{idToken:e}).catch(()=>{});return t?an._fromGetAccountInfoResponse(this.auth,t,e):null}return an._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new hn(ln(dn),e,n);const i=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let s=i[0]||ln(dn);const r=un(n,e.config.apiKey,e.name);let a=null;for(const l of t)try{const t=await l._get(r);if(t){let n;if("string"===typeof t){const i=await Wt(e,{idToken:t}).catch(()=>{});if(!i)break;n=await an._fromGetAccountInfoResponse(e,i,t)}else n=an._fromJSON(e,t);l!==s&&(a=n),s=l;break}}catch{}const o=i.filter(e=>e._shouldAllowMigration);return s._shouldAllowMigration&&o.length?(s=o[0],a&&await s._set(r,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==s)try{await e._remove(r)}catch{}})),new hn(s,e,n)):new hn(s,e,n)}}function pn(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(yn(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(mn(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(bn(t))return"Blackberry";if(xn(t))return"Webos";if(gn(t))return"Safari";if((t.includes("chrome/")||fn(t))&&!t.includes("edge/"))return"Chrome";if(vn(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===n?.length)return n[1]}return"Other"}function mn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S();return/firefox\//i.test(e)}function gn(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:S()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function fn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S();return/crios\//i.test(e)}function yn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S();return/iemobile/i.test(e)}function vn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S();return/android/i.test(e)}function bn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S();return/blackberry/i.test(e)}function xn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S();return/webos/i.test(e)}function wn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function _n(){return function(){const e=S();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function Sn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S();return wn(e)||vn(e)||xn(e)||bn(e)||/windows phone/i.test(e)||yn(e)}function Cn(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=pn(S());break;case"Worker":t=`${pn(S())}-${e}`;break;default:t=e}const i=n.length?n.join(","):"FirebaseCore-web";return`${t}/JsCore/${Je}/${i}`}class An{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,i)=>{try{n(e(t))}catch(s){i(s)}});n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(i){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n?.message})}}}class En{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class Tn{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Nn(this),this.idTokenSubscription=new Nn(this),this.beforeStateQueue=new An(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=mt,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ln(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await hn.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(n){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await Wt(this,{idToken:e}),n=await an._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Qe(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const t=this.redirectUser?._redirectEventId,s=n?._redirectEventId,r=await this.tryRedirectSignIn(e);t&&t!==s||!r?.user||(n=r.user,i=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(n)}catch(s){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return St(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await tn(e)}catch(t){if("auth/network-request-failed"!==t?.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Qe(this.app))return Promise.reject(xt(this));const t=e?O(e):null;return t&&St(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&St(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Qe(this.app)?Promise.reject(xt(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Qe(this.app)?Promise.reject(xt(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ln(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return Ot(e,"GET","/v2/passwordPolicy",jt(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new En(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new k("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return Ot(e,"POST","/v2/accounts:revokeToken",jt(e,t))}(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ln(e)||this._popupRedirectResolver;St(t,this,"argument-error"),this.redirectPersistenceManager=await hn.create(this,[ln(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const s="function"===typeof t?t:t.next.bind(t);let r=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(St(a,this,"internal-error"),a.then(()=>{r||s(this.currentUser)}),"function"===typeof t){const s=e.addObserver(t,n,i);return()=>{r=!0,s()}}{const n=e.addObserver(t);return()=>{r=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return St(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Cn(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await(this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if(Qe(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await(this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken());return e?.error&&function(e){if(gt.logLevel<=H.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];gt.warn(`Auth (${Je}): ${e}`,...n)}}(`Error while retrieving App Check token: ${e.error}`),e?.token}}function kn(e){return O(e)}class Nn{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new L(e,t);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return St(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let In={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Dn(e){return In.loadJS(e)}function Pn(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Mn{constructor(){this.enterprise=new Rn}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Rn{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const Ln="NO_RECAPTCHA";class jn{constructor(e){this.type="recaptcha-enterprise",this.auth=kn(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,i){const s=window.grecaptcha;$t(s)?s.enterprise.ready(()=>{s.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(Ln)})}):i(Error("No reCAPTCHA enterprise script loaded."))}if(this.auth.settings.appVerificationDisabledForTesting){return(new Mn).execute("siteKey",{action:"verify"})}return new Promise((e,i)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{Gt(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(i=>{if(void 0!==i.recaptchaKey){const n=new qt(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(s=>{if(!t&&$t(window.grecaptcha))n(s,e,i);else{if("undefined"===typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));let t=In.recaptchaEnterpriseScript;0!==t.length&&(t+=s),Dn(t).then(()=>{n(s,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function On(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const r=new jn(e);let a;if(s)a=Ln;else try{a=await r.verify(n)}catch(l){a=await r.verify(n,!0)}const o={...t};if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in o){const e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return i?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Fn(e,t,n,i,s){if("EMAIL_PASSWORD_PROVIDER"===s){if(e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await On(e,t,n,"getOobCode"===n);return i(e,s)}return i(e,t).catch(async s=>{if("auth/missing-recaptcha-token"===s.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const s=await On(e,t,n,"getOobCode"===n);return i(e,s)}return Promise.reject(s)})}if("PHONE_PROVIDER"===s){if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){const s=await On(e,t,n);return i(e,s).catch(async s=>{if("AUDIT"===e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")&&("auth/missing-recaptcha-token"===s.code||"auth/invalid-app-credential"===s.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);const s=await On(e,t,n,!1,!0);return i(e,s)}return Promise.reject(s)})}{const s=await On(e,t,n,!1,!0);return i(e,s)}}return Promise.reject(s+" provider is not supported.")}async function Bn(e){const t=kn(e),n=await Gt(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),i=new qt(n);if(null==t.tenantId?t._agentRecaptchaConfig=i:t._tenantRecaptchaConfigs[t.tenantId]=i,i.isAnyProviderEnabled()){new jn(t).verify()}}function Un(e,t,n){const i=kn(e);St(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");const s=!!n?.disableWarnings,r=zn(t),{host:a,port:o}=function(e){const t=zn(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(i);if(s){const e=s[1];return{host:e,port:Vn(i.substr(e.length+1))}}{const[e,t]=i.split(":");return{host:e,port:Vn(t)}}}(t),l=null===o?"":`:${o}`,c={url:`${r}//${a}${l}/`},d=Object.freeze({host:a,port:o,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!i._canInitEmulator)return St(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),void St(I(c,i.config.emulator)&&I(d,i.emulatorConfig),i,"emulator-config-failed");i.config.emulator=c,i.emulatorConfig=d,i.settings.appVerificationDisabledForTesting=!0,y(a)?(v(`${r}//${a}${l}`),_("Auth",!0)):s||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function zn(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Vn(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Hn{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ct("not implemented")}_getIdTokenResponse(e){return Ct("not implemented")}_linkToIdToken(e,t){return Ct("not implemented")}_getReauthenticationResolver(e){return Ct("not implemented")}}async function $n(e,t){return Ot(e,"POST","/v1/accounts:signUp",t)}async function qn(e,t){return Bt(e,"POST","/v1/accounts:signInWithPassword",jt(e,t))}async function Gn(e,t){return Ot(e,"POST","/v1/accounts:sendOobCode",jt(e,t))}async function Wn(e,t){return Gn(e,t)}class Kn extends Hn{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new Kn(e,t,"password")}static _fromEmailAndCode(e,t){return new Kn(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Fn(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",qn,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Bt(e,"POST","/v1/accounts:signInWithEmailLink",jt(e,t))}(e,{email:this._email,oobCode:this._password});default:yt(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Fn(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",$n,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Bt(e,"POST","/v1/accounts:signInWithEmailLink",jt(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:yt(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Qn(e,t){return Bt(e,"POST","/v1/accounts:signInWithIdp",jt(e,t))}class Xn extends Hn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Xn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):yt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i,...s}=t;if(!n||!i)return null;const r=new Xn(n,i);return r.idToken=s.idToken||void 0,r.accessToken=s.accessToken||void 0,r.secret=s.secret,r.nonce=s.nonce,r.pendingToken=s.pendingToken||null,r}_getIdTokenResponse(e){return Qn(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Qn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Qn(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=P(t)}return e}}async function Yn(e,t){return Ot(e,"POST","/v1/accounts:sendVerificationCode",jt(e,t))}const Jn={USER_NOT_FOUND:"user-not-found"};class Zn extends Hn{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Zn({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Zn({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Bt(e,"POST","/v1/accounts:signInWithPhoneNumber",jt(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Bt(e,"POST","/v1/accounts:signInWithPhoneNumber",jt(e,t));if(n.temporaryProof)throw Ht(e,"account-exists-with-different-credential",n);return n}(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return async function(e,t){return Bt(e,"POST","/v1/accounts:signInWithPhoneNumber",jt(e,{...t,operation:"REAUTH"}),Jn)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:s}=e;return n||t||i||s?new Zn({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:s}):null}}class ei{constructor(e){const t=M(R(e)),n=t.apiKey??null,i=t.oobCode??null,s=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);St(n&&i&&s,"argument-error"),this.apiKey=n,this.operation=s,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=function(e){const t=M(R(e)).link,n=t?M(R(t)).deep_link_id:null,i=M(R(e)).deep_link_id;return(i?M(R(i)).link:null)||i||n||t||e}(e);try{return new ei(t)}catch{return null}}}class ti{constructor(){this.providerId=ti.PROVIDER_ID}static credential(e,t){return Kn._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=ei.parseLink(t);return St(n,"argument-error"),Kn._fromEmailAndCode(e,n.code,n.tenantId)}}ti.PROVIDER_ID="password",ti.EMAIL_PASSWORD_SIGN_IN_METHOD="password",ti.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class ni{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ii extends ni{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class si extends ii{constructor(){super("facebook.com")}static credential(e){return Xn._fromParams({providerId:si.PROVIDER_ID,signInMethod:si.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return si.credentialFromTaggedObject(e)}static credentialFromError(e){return si.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return si.credential(t.oauthAccessToken)}catch{return null}}}si.FACEBOOK_SIGN_IN_METHOD="facebook.com",si.PROVIDER_ID="facebook.com";class ri extends ii{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Xn._fromParams({providerId:ri.PROVIDER_ID,signInMethod:ri.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ri.credentialFromTaggedObject(e)}static credentialFromError(e){return ri.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:i}=t;if(!n&&!i)return null;try{return ri.credential(n,i)}catch{return null}}}ri.GOOGLE_SIGN_IN_METHOD="google.com",ri.PROVIDER_ID="google.com";class ai extends ii{constructor(){super("github.com")}static credential(e){return Xn._fromParams({providerId:ai.PROVIDER_ID,signInMethod:ai.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ai.credentialFromTaggedObject(e)}static credentialFromError(e){return ai.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return ai.credential(t.oauthAccessToken)}catch{return null}}}ai.GITHUB_SIGN_IN_METHOD="github.com",ai.PROVIDER_ID="github.com";class oi extends ii{constructor(){super("twitter.com")}static credential(e,t){return Xn._fromParams({providerId:oi.PROVIDER_ID,signInMethod:oi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return oi.credentialFromTaggedObject(e)}static credentialFromError(e){return oi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:i}=t;if(!n||!i)return null;try{return oi.credential(n,i)}catch{return null}}}async function li(e,t){return Bt(e,"POST","/v1/accounts:signUp",jt(e,t))}oi.TWITTER_SIGN_IN_METHOD="twitter.com",oi.PROVIDER_ID="twitter.com";class ci{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=await an._fromIdTokenResponse(e,n,i),r=di(n);return new ci({user:s,providerId:r,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=di(n);return new ci({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function di(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class ui extends T{constructor(e,t,n,i){super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,ui.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new ui(e,t,n,i)}}function hi(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw ui._fromErrorAndOperation(e,n,t,i);throw n})}async function pi(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=await Jt(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return ci._forOperation(e,"link",i)}async function mi(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:i}=e;if(Qe(i.app))return Promise.reject(xt(i));const s="reauthenticate";try{const r=await Jt(e,hi(i,s,t,e),n);St(r.idToken,i,"internal-error");const a=Xt(r.idToken);St(a,i,"internal-error");const{sub:o}=a;return St(e.uid===o,i,"user-mismatch"),ci._forOperation(e,s,r)}catch(r){throw"auth/user-not-found"===r?.code&&yt(i,"user-mismatch"),r}}async function gi(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Qe(e.app))return Promise.reject(xt(e));const i="signIn",s=await hi(e,i,t),r=await ci._fromIdTokenResponse(e,i,s);return n||await e._updateCurrentUser(r.user),r}async function fi(e,t){return gi(kn(e),t)}function yi(e,t,n){St(n.url?.length>0,e,"invalid-continue-uri"),St("undefined"===typeof n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),St("undefined"===typeof n.linkDomain||n.linkDomain.length>0,e,"invalid-hosting-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.linkDomain=n.linkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(St(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(St(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function vi(e){const t=kn(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function bi(e,t){let{displayName:n,photoURL:i}=t;if(void 0===n&&void 0===i)return;const s=O(e),r={idToken:await s.getIdToken(),displayName:n,photoUrl:i,returnSecureToken:!0},a=await Jt(s,async function(e,t){return Ot(e,"POST","/v1/accounts:update",t)}(s.auth,r));s.displayName=a.displayName||null,s.photoURL=a.photoUrl||null;const o=s.providerData.find(e=>{let{providerId:t}=e;return"password"===t});o&&(o.displayName=s.displayName,o.photoURL=s.photoURL),await s._updateTokensIfNecessary(a)}function xi(e,t){return Ot(e,"POST","/v2/accounts/mfaEnrollment:start",jt(e,t))}new WeakMap;const wi="__sak";class _i{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(wi,"1"),this.storage.removeItem(wi),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Si extends _i{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Sn(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);_n()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Si.type="LOCAL";const Ci=Si;function Ai(e){const t=e.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),n=RegExp(`${t}=([^;]+)`);return document.cookie.match(n)?.[1]??null}function Ei(e){return`${"http:"===window.location.protocol?"__dev_":"__HOST-"}FIREBASE_${e.split(":")[3]}`}class Ti{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(void 0===typeof window)return e;const t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set("finalTarget",e),t}async _isAvailable(){return!("boolean"===typeof isSecureContext&&!isSecureContext)&&("undefined"!==typeof navigator&&"undefined"!==typeof document&&(navigator.cookieEnabled??!0))}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=Ei(e);if(window.cookieStore){const e=await window.cookieStore.get(t);return e?.value}return Ai(t)}async _remove(e){if(!this._isAvailable())return;if(!await this._get(e))return;const t=Ei(e);document.cookie=`${t}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;const n=Ei(e);if(window.cookieStore){const e=e=>{const i=e.changed.find(e=>e.name===n);i&&t(i.value);e.deleted.find(e=>e.name===n)&&t(null)},i=()=>window.cookieStore.removeEventListener("change",e);return this.listenerUnsubscribes.set(t,i),window.cookieStore.addEventListener("change",e)}let i=Ai(n);const s=setInterval(()=>{const e=Ai(n);e!==i&&(t(e),i=e)},1e3);this.listenerUnsubscribes.set(t,()=>clearInterval(s))}_removeListener(e,t){const n=this.listenerUnsubscribes.get(t);n&&(n(),this.listenerUnsubscribes.delete(t))}}Ti.type="COOKIE";class ki extends _i{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ki.type="SESSION";const Ni=ki;class Ii{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new Ii(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:s}=t.data,r=this.handlersMap[i];if(!r?.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const a=Array.from(r).map(async e=>e(t.origin,s)),o=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(a);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Di(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let i=0;i<t;i++)n+=Math.floor(10*Math.random());return e+n}Ii.receivers=[];class Pi{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const i="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,r;return new Promise((a,o)=>{const l=Di("",20);i.port1.start();const c=setTimeout(()=>{o(new Error("unsupported_event"))},n);r={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),s=setTimeout(()=>{o(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(t.data.response);break;default:clearTimeout(c),clearTimeout(s),o(new Error("invalid_response"))}}},this.handlers.add(r),i.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[i.port2])}).finally(()=>{r&&this.removeMessageHandler(r)})}}function Mi(){return window}function Ri(){return"undefined"!==typeof Mi().WorkerGlobalScope&&"function"===typeof Mi().importScripts}const Li="firebaseLocalStorageDb",ji="firebaseLocalStorage",Oi="fbase_key";class Fi{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Bi(e,t){return e.transaction([ji],t?"readwrite":"readonly").objectStore(ji)}function Ui(){const e=indexedDB.open(Li,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(ji,{keyPath:Oi})}catch(i){n(i)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(ji)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Li);return new Fi(e).toPromise()}(),t(await Ui()))})})}async function zi(e,t,n){const i=Bi(e,!0).put({[Oi]:t,value:n});return new Fi(i).toPromise()}function Vi(e,t){const n=Bi(e,!0).delete(t);return new Fi(n).toPromise()}class Hi{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Ui()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ri()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ii._getInstance(Ri()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await async function(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}(),!this.activeServiceWorker)return;this.sender=new Pi(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Ui();return await zi(e,wi,"1"),await Vi(e,wi),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>zi(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=Bi(e,!1).get(t),i=await new Fi(n).toPromise();return void 0===i?null:i.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Vi(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=Bi(e,!1).getAll();return new Fi(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:i,value:s}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Hi.type="LOCAL";const $i=Hi;function qi(e,t){return Ot(e,"POST","/v2/accounts/mfaSignIn:start",jt(e,t))}Pn("rcb"),new It(3e4,6e4);const Gi="recaptcha";async function Wi(e,t,n){if(!e._getRecaptchaConfig())try{await Bn(e)}catch(i){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"===typeof t?{phoneNumber:t}:t,"session"in i){const t=i.session;if("phoneNumber"in i){St("enroll"===t.type,e,"internal-error");const s={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},r=Fn(e,s,"mfaSmsEnrollment",async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===Ln){St(n?.type===Gi,e,"argument-error");return xi(e,await Ki(e,t,n))}return xi(e,t)},"PHONE_PROVIDER");return(await r.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{St("signin"===t.type,e,"internal-error");const s=i.multiFactorHint?.uid||i.multiFactorUid;St(s,e,"missing-multi-factor-info");const r={mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},a=Fn(e,r,"mfaSmsSignIn",async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===Ln){St(n?.type===Gi,e,"argument-error");return qi(e,await Ki(e,t,n))}return qi(e,t)},"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{const t={phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},s=Fn(e,t,"sendVerificationCode",async(e,t)=>{if(t.captchaResponse===Ln){St(n?.type===Gi,e,"argument-error");return Yn(e,await Ki(e,t,n))}return Yn(e,t)},"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).sessionInfo}}finally{n?._reset()}}async function Ki(e,t,n){St(n.type===Gi,e,"argument-error");const i=await n.verify();St("string"===typeof i,e,"argument-error");const s={...t};if("phoneEnrollmentInfo"in s){const e=s.phoneEnrollmentInfo.phoneNumber,t=s.phoneEnrollmentInfo.captchaResponse,n=s.phoneEnrollmentInfo.clientType,r=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:i,captchaResponse:t,clientType:n,recaptchaVersion:r}}),s}if("phoneSignInInfo"in s){const e=s.phoneSignInInfo.captchaResponse,t=s.phoneSignInInfo.clientType,n=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:i,captchaResponse:e,clientType:t,recaptchaVersion:n}}),s}return Object.assign(s,{recaptchaToken:i}),s}class Qi{constructor(e){this.providerId=Qi.PROVIDER_ID,this.auth=kn(e)}verifyPhoneNumber(e,t){return Wi(this.auth,e,O(t))}static credential(e,t){return Zn._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Qi.credentialFromTaggedObject(t)}static credentialFromError(e){return Qi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:i}=t;return n&&i?Zn._fromTokenResponse(n,i):null}}function Xi(e,t){return t?ln(t):(St(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Qi.PROVIDER_ID="phone",Qi.PHONE_SIGN_IN_METHOD="phone";class Yi extends Hn{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Qn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Qn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Qn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Ji(e){return gi(e.auth,new Yi(e),e.bypassAuthState)}function Zi(e){const{auth:t,user:n}=e;return St(n,t,"internal-error"),mi(n,new Yi(e),e.bypassAuthState)}async function es(e){const{auth:t,user:n}=e;return St(n,t,"internal-error"),pi(n,new Yi(e),e.bypassAuthState)}class ts{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:s,error:r,type:a}=e;if(r)return void this.reject(r);const o={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Ji;case"linkViaPopup":case"linkViaRedirect":return es;case"reauthViaPopup":case"reauthViaRedirect":return Zi;default:yt(this.auth,"internal-error")}}resolve(e){At(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){At(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const ns=new It(2e3,1e4);class is extends ts{constructor(e,t,n,i,s){super(e,t,i,s),this.provider=n,this.authWindow=null,this.pollId=null,is.currentPopupAction&&is.currentPopupAction.cancel(),is.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return St(e,this.auth,"internal-error"),e}async onExecution(){At(1===this.filter.length,"Popup operations only handle one event");const e=Di();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(vt(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(vt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,is.currentPopupAction=null}pollUserCancellation(){const e=()=>{this.authWindow?.window?.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(vt(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,ns.get())};e()}}is.currentPopupAction=null;const ss=new Map;class rs extends ts{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=ss.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=ls(t),i=os(e);if(!await i._isAvailable())return!1;const s="true"===await i._get(n);return await i._remove(n),s}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}ss.set(this.auth._key(),e)}return this.bypassAuthState||ss.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function as(e,t){ss.set(e._key(),t)}function os(e){return ln(e._redirectPersistence)}function ls(e){return un("pendingRedirect",e.config.apiKey,e.name)}async function cs(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Qe(e.app))return Promise.reject(xt(e));const i=kn(e),s=Xi(i,t),r=new rs(i,s,n),a=await r.execute();return a&&!n&&(delete a.user._redirectEventId,await i._persistUserIfCurrent(a.user),await i._setRedirectUser(null,t)),a}class ds{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return hs(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!hs(e)){const n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(vt(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(us(e))}saveEventToCache(e){this.cachedEventUids.add(us(e)),this.lastProcessedEventTime=Date.now()}}function us(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function hs(e){let{type:t,error:n}=e;return"unknown"===t&&"auth/no-auth-event"===n?.code}const ps=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ms=/^https?/;async function gs(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e){return Ot(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}(e);for(const n of t)try{if(fs(n))return}catch{}yt(e,"unauthorized-domain")}function fs(e){const t=Et(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){const s=new URL(e);return""===s.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===i}if(!ms.test(n))return!1;if(ps.test(e))return i===e;const s=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}const ys=new It(3e4,6e4);function vs(){const e=Mi().___jsl;if(e?.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function bs(e){return new Promise((t,n)=>{function i(){vs(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{vs(),n(vt(e,"network-request-failed"))},timeout:ys.get()})}if(Mi().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else{if(!Mi().gapi?.load){const t=Pn("iframefcb");return Mi()[t]=()=>{gapi.load?i():n(vt(e,"network-request-failed"))},Dn(`${In.gapiScript}?onload=${t}`).catch(e=>n(e))}i()}}).catch(e=>{throw xs=null,e})}let xs=null;const ws=new It(5e3,15e3),_s={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Ss=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Cs(e){const t=e.config;St(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Dt(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,i={apiKey:t.apiKey,appName:e.name,v:Je},s=Ss.get(e.config.apiHost);s&&(i.eid=s);const r=e._getFrameworks();return r.length&&(i.fw=r.join(",")),`${n}?${P(i).slice(1)}`}async function As(e){const t=await function(e){return xs=xs||bs(e),xs}(e),n=Mi().gapi;return St(n,e,"internal-error"),t.open({where:document.body,url:Cs(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:_s,dontclear:!0},t=>new Promise(async(n,i)=>{await t.restyle({setHideOnLeave:!1});const s=vt(e,"network-request-failed"),r=Mi().setTimeout(()=>{i(s)},ws.get());function a(){Mi().clearTimeout(r),n(t)}t.ping(a).then(a,()=>{i(s)})}))}const Es={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Ts{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function ks(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const r=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString();let o="";const l={...Es,width:i.toString(),height:s.toString(),top:r,left:a},c=S().toLowerCase();n&&(o=fn(c)?"_blank":n),mn(c)&&(t=t||"http://localhost",l.scrollbars="yes");const d=Object.entries(l).reduce((e,t)=>{let[n,i]=t;return`${e}${n}=${i},`},"");if(function(){return wn(arguments.length>0&&void 0!==arguments[0]?arguments[0]:S())&&!!window.navigator?.standalone}(c)&&"_self"!==o)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",o),new Ts(null);const u=window.open(t||"",o,d);St(u,e,"popup-blocked");try{u.focus()}catch(h){}return new Ts(u)}const Ns="__/auth/handler",Is="emulator/auth/handler",Ds=encodeURIComponent("fac");async function Ps(e,t,n,i,s,r){St(e.config.authDomain,e,"auth-domain-config-required"),St(e.config.apiKey,e,"invalid-api-key");const a={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:Je,eventId:s};if(t instanceof ni){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(r||{}))a[e]=t}if(t instanceof ii){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(a.scopes=e.join(","))}e.tenantId&&(a.tid=e.tenantId);const o=a;for(const d of Object.keys(o))void 0===o[d]&&delete o[d];const l=await e._getAppCheckToken(),c=l?`#${Ds}=${encodeURIComponent(l)}`:"";return`${function(e){let{config:t}=e;if(!t.emulator)return`https://${t.authDomain}/${Ns}`;return Dt(t,Is)}(e)}?${P(o).slice(1)}${c}`}const Ms="webStorageSupport";const Rs=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ni,this._completeRedirectFn=cs,this._overrideRedirectResult=as}async _openPopup(e,t,n,i){At(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");return ks(e,await Ps(e,t,n,Et(),i),Di())}async _openRedirect(e,t,n,i){await this._originValidation(e);return function(e){Mi().location.href=e}(await Ps(e,t,n,Et(),i)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(At(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await As(e),n=new ds(e);return t.register("authEvent",t=>{St(t?.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ms,{type:Ms},n=>{const i=n?.[0]?.[Ms];void 0!==i&&t(!!i),yt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=gs(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Sn()||gn()||wn()}};var Ls="@firebase/auth",js="1.12.0";class Os{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){St(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Fs=g("authIdTokenMaxAge")||300;let Bs=null;var Us;In={loadJS:e=>new Promise((t,n)=>{const i=document.createElement("script");i.setAttribute("src",e),i.onload=t,i.onerror=e=>{const t=vt("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(i)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Us="Browser",We(new F("auth",(e,t)=>{let{options:n}=t;const i=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=i.options;St(a&&!a.includes(":"),"invalid-api-key",{appName:i.name});const l={apiKey:a,authDomain:o,clientPlatform:Us,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Cn(Us)},c=new Tn(i,s,r,l);return function(e,t){const n=t?.persistence||[],i=(Array.isArray(n)?n:[n]).map(ln);t?.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,t?.popupRedirectResolver)}(c,n),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),We(new F("auth-internal",e=>(e=>new Os(e))(kn(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),tt(Ls,js,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Us)),tt(Ls,js,"esm2020");var zs,Vs,Hs="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},$s={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function n(e,t,n){n||(n=0);const i=Array(16);if("string"===typeof t)for(var s=0;s<16;++s)i[s]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(s=0;s<16;++s)i[s]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],s=e.g[2];let r,a=e.g[3];r=t+(a^n&(s^a))+i[0]+3614090360&4294967295,r=a+(s^(t=n+(r<<7&4294967295|r>>>25))&(n^s))+i[1]+3905402710&4294967295,a=t+(r<<12&4294967295|r>>>20),r=s+(n^a&(t^n))+i[2]+606105819&4294967295,r=n+(t^(s=a+(r<<17&4294967295|r>>>15))&(a^t))+i[3]+3250441966&4294967295,r=t+(a^(n=s+(r<<22&4294967295|r>>>10))&(s^a))+i[4]+4118548399&4294967295,r=a+(s^(t=n+(r<<7&4294967295|r>>>25))&(n^s))+i[5]+1200080426&4294967295,a=t+(r<<12&4294967295|r>>>20),r=s+(n^a&(t^n))+i[6]+2821735955&4294967295,r=n+(t^(s=a+(r<<17&4294967295|r>>>15))&(a^t))+i[7]+4249261313&4294967295,r=t+(a^(n=s+(r<<22&4294967295|r>>>10))&(s^a))+i[8]+1770035416&4294967295,r=a+(s^(t=n+(r<<7&4294967295|r>>>25))&(n^s))+i[9]+2336552879&4294967295,a=t+(r<<12&4294967295|r>>>20),r=s+(n^a&(t^n))+i[10]+4294925233&4294967295,r=n+(t^(s=a+(r<<17&4294967295|r>>>15))&(a^t))+i[11]+2304563134&4294967295,r=t+(a^(n=s+(r<<22&4294967295|r>>>10))&(s^a))+i[12]+1804603682&4294967295,r=a+(s^(t=n+(r<<7&4294967295|r>>>25))&(n^s))+i[13]+4254626195&4294967295,a=t+(r<<12&4294967295|r>>>20),r=s+(n^a&(t^n))+i[14]+2792965006&4294967295,r=n+(t^(s=a+(r<<17&4294967295|r>>>15))&(a^t))+i[15]+1236535329&4294967295,r=t+(s^a&((n=s+(r<<22&4294967295|r>>>10))^s))+i[1]+4129170786&4294967295,r=a+(n^s&((t=n+(r<<5&4294967295|r>>>27))^n))+i[6]+3225465664&4294967295,a=t+(r<<9&4294967295|r>>>23),r=s+(t^n&(a^t))+i[11]+643717713&4294967295,r=n+(a^t&((s=a+(r<<14&4294967295|r>>>18))^a))+i[0]+3921069994&4294967295,r=t+(s^a&((n=s+(r<<20&4294967295|r>>>12))^s))+i[5]+3593408605&4294967295,r=a+(n^s&((t=n+(r<<5&4294967295|r>>>27))^n))+i[10]+38016083&4294967295,a=t+(r<<9&4294967295|r>>>23),r=s+(t^n&(a^t))+i[15]+3634488961&4294967295,r=n+(a^t&((s=a+(r<<14&4294967295|r>>>18))^a))+i[4]+3889429448&4294967295,r=t+(s^a&((n=s+(r<<20&4294967295|r>>>12))^s))+i[9]+568446438&4294967295,r=a+(n^s&((t=n+(r<<5&4294967295|r>>>27))^n))+i[14]+3275163606&4294967295,a=t+(r<<9&4294967295|r>>>23),r=s+(t^n&(a^t))+i[3]+4107603335&4294967295,r=n+(a^t&((s=a+(r<<14&4294967295|r>>>18))^a))+i[8]+1163531501&4294967295,r=t+(s^a&((n=s+(r<<20&4294967295|r>>>12))^s))+i[13]+2850285829&4294967295,r=a+(n^s&((t=n+(r<<5&4294967295|r>>>27))^n))+i[2]+4243563512&4294967295,a=t+(r<<9&4294967295|r>>>23),r=s+(t^n&(a^t))+i[7]+1735328473&4294967295,r=n+(a^t&((s=a+(r<<14&4294967295|r>>>18))^a))+i[12]+2368359562&4294967295,r=t+((n=s+(r<<20&4294967295|r>>>12))^s^a)+i[5]+4294588738&4294967295,r=a+((t=n+(r<<4&4294967295|r>>>28))^n^s)+i[8]+2272392833&4294967295,a=t+(r<<11&4294967295|r>>>21),r=s+(a^t^n)+i[11]+1839030562&4294967295,r=n+((s=a+(r<<16&4294967295|r>>>16))^a^t)+i[14]+4259657740&4294967295,r=t+((n=s+(r<<23&4294967295|r>>>9))^s^a)+i[1]+2763975236&4294967295,r=a+((t=n+(r<<4&4294967295|r>>>28))^n^s)+i[4]+1272893353&4294967295,a=t+(r<<11&4294967295|r>>>21),r=s+(a^t^n)+i[7]+4139469664&4294967295,r=n+((s=a+(r<<16&4294967295|r>>>16))^a^t)+i[10]+3200236656&4294967295,r=t+((n=s+(r<<23&4294967295|r>>>9))^s^a)+i[13]+681279174&4294967295,r=a+((t=n+(r<<4&4294967295|r>>>28))^n^s)+i[0]+3936430074&4294967295,a=t+(r<<11&4294967295|r>>>21),r=s+(a^t^n)+i[3]+3572445317&4294967295,r=n+((s=a+(r<<16&4294967295|r>>>16))^a^t)+i[6]+76029189&4294967295,r=t+((n=s+(r<<23&4294967295|r>>>9))^s^a)+i[9]+3654602809&4294967295,r=a+((t=n+(r<<4&4294967295|r>>>28))^n^s)+i[12]+3873151461&4294967295,a=t+(r<<11&4294967295|r>>>21),r=s+(a^t^n)+i[15]+530742520&4294967295,r=n+((s=a+(r<<16&4294967295|r>>>16))^a^t)+i[2]+3299628645&4294967295,r=t+(s^((n=s+(r<<23&4294967295|r>>>9))|~a))+i[0]+4096336452&4294967295,r=a+(n^((t=n+(r<<6&4294967295|r>>>26))|~s))+i[7]+1126891415&4294967295,a=t+(r<<10&4294967295|r>>>22),r=s+(t^(a|~n))+i[14]+2878612391&4294967295,r=n+(a^((s=a+(r<<15&4294967295|r>>>17))|~t))+i[5]+4237533241&4294967295,r=t+(s^((n=s+(r<<21&4294967295|r>>>11))|~a))+i[12]+1700485571&4294967295,r=a+(n^((t=n+(r<<6&4294967295|r>>>26))|~s))+i[3]+2399980690&4294967295,a=t+(r<<10&4294967295|r>>>22),r=s+(t^(a|~n))+i[10]+4293915773&4294967295,r=n+(a^((s=a+(r<<15&4294967295|r>>>17))|~t))+i[1]+2240044497&4294967295,r=t+(s^((n=s+(r<<21&4294967295|r>>>11))|~a))+i[8]+1873313359&4294967295,r=a+(n^((t=n+(r<<6&4294967295|r>>>26))|~s))+i[15]+4264355552&4294967295,a=t+(r<<10&4294967295|r>>>22),r=s+(t^(a|~n))+i[6]+2734768916&4294967295,r=n+(a^((s=a+(r<<15&4294967295|r>>>17))|~t))+i[13]+1309151649&4294967295,r=t+(s^((n=s+(r<<21&4294967295|r>>>11))|~a))+i[4]+4149444226&4294967295,r=a+(n^((t=n+(r<<6&4294967295|r>>>26))|~s))+i[11]+3174756917&4294967295,a=t+(r<<10&4294967295|r>>>22),r=s+(t^(a|~n))+i[2]+718787259&4294967295,r=n+(a^((s=a+(r<<15&4294967295|r>>>17))|~t))+i[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(s+(r<<21&4294967295|r>>>11))&4294967295,e.g[2]=e.g[2]+s&4294967295,e.g[3]=e.g[3]+a&4294967295}function i(e,t){this.h=t;const n=[];let i=!0;for(let s=e.length-1;s>=0;s--){const r=0|e[s];i&&r==t||(n[s]=r,i=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.F=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.D=function(e,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return t.prototype[n].apply(e,s)}}(t,function(){this.blockSize=-1}),t.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.v=function(e,t){void 0===t&&(t=e.length);const i=t-this.blockSize,s=this.C;let r=this.h,a=0;for(;a<t;){if(0==r)for(;a<=i;)n(this,e,a),a+=this.blockSize;if("string"===typeof e){for(;a<t;)if(s[r++]=e.charCodeAt(a++),r==this.blockSize){n(this,s),r=0;break}}else for(;a<t;)if(s[r++]=e[a++],r==this.blockSize){n(this,s),r=0;break}}this.h=r,this.o+=t},t.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let i=0;i<32;i+=8)e[t++]=this.g[n]>>>i&255;return e};var s={};function r(e){return-128<=e&&e<128?function(e,t){var n=s;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,function(e){return new i([0|e],e<0?-1:0)}):new i([0|e],e<0?-1:0)}function a(e){if(isNaN(e)||!isFinite(e))return o;if(e<0)return h(a(-e));const t=[];let n=1;for(let i=0;e>=n;i++)t[i]=e/n|0,n*=4294967296;return new i(t,0)}var o=r(0),l=r(1),c=r(16777216);function d(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function u(e){return-1==e.h}function h(e){const t=e.g.length,n=[];for(let i=0;i<t;i++)n[i]=~e.g[i];return new i(n,~e.h).add(l)}function p(e,t){return e.add(h(t))}function m(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function g(e,t){this.g=e,this.h=t}function f(e,t){if(d(t))throw Error("division by zero");if(d(e))return new g(o,o);if(u(e))return t=f(h(e),t),new g(h(t.g),h(t.h));if(u(t))return t=f(e,h(t)),new g(h(t.g),t.h);if(e.g.length>30){if(u(e)||u(t))throw Error("slowDivide_ only works with positive integers.");for(var n=l,i=t;i.l(e)<=0;)n=y(n),i=y(i);var s=v(n,1),r=v(i,1);for(i=v(i,2),n=v(n,2);!d(i);){var c=r.add(i);c.l(e)<=0&&(s=s.add(n),r=c),i=v(i,1),n=v(n,1)}return t=p(e,s.j(t)),new g(s,t)}for(s=o;e.l(t)>=0;){for(n=Math.max(1,Math.floor(e.m()/t.m())),i=(i=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,i-48),c=(r=a(n)).j(t);u(c)||c.l(e)>0;)c=(r=a(n-=i)).j(t);d(r)&&(r=l),s=s.add(r),e=p(e,c)}return new g(s,e)}function y(e){const t=e.g.length+1,n=[];for(let i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new i(n,e.h)}function v(e,t){const n=t>>5;t%=32;const s=e.g.length-n,r=[];for(let i=0;i<s;i++)r[i]=t>0?e.i(i+n)>>>t|e.i(i+n+1)<<32-t:e.i(i+n);return new i(r,e.h)}(e=i.prototype).m=function(){if(u(this))return-h(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){const i=this.i(n);e+=(i>=0?i:4294967296+i)*t,t*=4294967296}return e},e.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(u(this))return"-"+h(this).toString(e);const t=a(Math.pow(e,6));var n=this;let i="";for(;;){const s=f(n,t).g;let r=(((n=p(n,s.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(d(n=s))return r+i;for(;r.length<6;)r="0"+r;i=r+i}},e.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return u(e=p(this,e))?-1:d(e)?0:1},e.abs=function(){return u(this)?h(this):this},e.add=function(e){const t=Math.max(this.g.length,e.g.length),n=[];let s=0;for(let i=0;i<=t;i++){let t=s+(65535&this.i(i))+(65535&e.i(i)),r=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);s=r>>>16,t&=65535,r&=65535,n[i]=r<<16|t}return new i(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(d(this)||d(e))return o;if(u(this))return u(e)?h(this).j(h(e)):h(h(this).j(e));if(u(e))return h(this.j(h(e)));if(this.l(c)<0&&e.l(c)<0)return a(this.m()*e.m());const t=this.g.length+e.g.length,n=[];for(var s=0;s<2*t;s++)n[s]=0;for(s=0;s<this.g.length;s++)for(let t=0;t<e.g.length;t++){const i=this.i(s)>>>16,r=65535&this.i(s),a=e.i(t)>>>16,o=65535&e.i(t);n[2*s+2*t]+=r*o,m(n,2*s+2*t),n[2*s+2*t+1]+=i*o,m(n,2*s+2*t+1),n[2*s+2*t+1]+=r*a,m(n,2*s+2*t+1),n[2*s+2*t+2]+=i*a,m(n,2*s+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new i(n,0)},e.B=function(e){return f(this,e).h},e.and=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new i(n,this.h&e.h)},e.or=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new i(n,this.h|e.h)},e.xor=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new i(n,this.h^e.h)},t.prototype.digest=t.prototype.A,t.prototype.reset=t.prototype.u,t.prototype.update=t.prototype.v,Vs=$s.Md5=t,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.B,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=a,i.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return h(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');const i=a(Math.pow(n,8));let s=o;for(let o=0;o<t.length;o+=8){var r=Math.min(8,t.length-o);const e=parseInt(t.substring(o,o+r),n);r<8?(r=a(Math.pow(n,r)),s=s.j(r).add(a(e))):(s=s.j(i),s=s.add(a(e)))}return s},zs=$s.Integer=i}).apply("undefined"!==typeof Hs?Hs:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var qs,Gs,Ws,Ks,Qs,Xs,Ys,Js,Zs="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},er={};(function(){var e,t=Object.defineProperty;var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Zs&&Zs];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function i(e,i){if(i)e:{var s=n;e=e.split(".");for(var r=0;r<e.length-1;r++){var a=e[r];if(!(a in s))break e;s=s[a]}(i=i(r=s[e=e[e.length-1]]))!=r&&null!=i&&t(s,e,{configurable:!0,writable:!0,value:i})}}i("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}});var s=s||{},r=this||self;function a(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function o(e,t,n){return e.call.apply(e.bind,arguments)}function l(e,t,n){return(l=o).apply(null,arguments)}function c(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function d(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return t.prototype[n].apply(e,s)}}var u="undefined"!==typeof AsyncContext&&"function"===typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function h(e){const t=e.length;if(t>0){const n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function p(e,t){for(let i=1;i<arguments.length;i++){const t=arguments[i];var n=typeof t;if("array"==(n="object"!=n?n:t?Array.isArray(t)?"array":n:"null")||"object"==n&&"number"==typeof t.length){n=e.length||0;const i=t.length||0;e.length=n+i;for(let s=0;s<i;s++)e[n+s]=t[s]}else e.push(t)}}function m(e){r.setTimeout(()=>{throw e},0)}function g(){var e=x;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var f=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new y,e=>e.reset());class y{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let v,b=!1,x=new class{constructor(){this.h=this.g=null}add(e,t){const n=f.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},w=()=>{const e=Promise.resolve(void 0);v=()=>{e.then(_)}};function _(){for(var e;e=g();){try{e.h.call(e.g)}catch(n){m(n)}var t=f;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}b=!1}function S(){this.u=this.u,this.C=this.C}function C(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}S.prototype.u=!1,S.prototype.dispose=function(){this.u||(this.u=!0,this.N())},S.prototype[Symbol.dispose]=function(){this.dispose()},S.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},C.prototype.h=function(){this.defaultPrevented=!0};var A=function(){if(!r.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};r.addEventListener("test",e,t),r.removeEventListener("test",e,t)}catch(n){}return e}();function E(e){return/^[\s\xa0]*$/.test(e)}function T(e,t){C.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}d(T,C),T.prototype.init=function(e,t){const n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&T.Z.h.call(this)},T.prototype.h=function(){T.Z.h.call(this);const e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var k="closure_listenable_"+(1e6*Math.random()|0),N=0;function I(e,t,n,i,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.ha=s,this.key=++N,this.da=this.fa=!1}function D(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function P(e,t,n){for(const i in e)t.call(n,e[i],i,e)}function M(e){const t={};for(const n in e)t[n]=e[n];return t}const R="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function L(e,t){let n,i;for(let s=1;s<arguments.length;s++){for(n in i=arguments[s],i)e[n]=i[n];for(let t=0;t<R.length;t++)n=R[t],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}function j(e){this.src=e,this.g={},this.h=0}function O(e,t){const n=t.type;if(n in e.g){var i,s=e.g[n],r=Array.prototype.indexOf.call(s,t,void 0);(i=r>=0)&&Array.prototype.splice.call(s,r,1),i&&(D(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function F(e,t,n,i){for(let s=0;s<e.length;++s){const r=e[s];if(!r.da&&r.listener==t&&r.capture==!!n&&r.ha==i)return s}return-1}j.prototype.add=function(e,t,n,i,s){const r=e.toString();(e=this.g[r])||(e=this.g[r]=[],this.h++);const a=F(e,t,i,s);return a>-1?(t=e[a],n||(t.fa=!1)):((t=new I(t,this.src,r,!!i,s)).fa=n,e.push(t)),t};var B="closure_lm_"+(1e6*Math.random()|0),U={};function z(e,t,n,i,s){if(i&&i.once)return H(e,t,n,i,s);if(Array.isArray(t)){for(let r=0;r<t.length;r++)z(e,t[r],n,i,s);return null}return n=X(n),e&&e[k]?e.J(t,n,a(i)?!!i.capture:!!i,s):V(e,t,n,!1,i,s)}function V(e,t,n,i,s,r){if(!t)throw Error("Invalid event type");const o=a(s)?!!s.capture:!!s;let l=K(e);if(l||(e[B]=l=new j(e)),(n=l.add(t,n,i,o,r)).proxy)return n;if(i=function(){function e(n){return t.call(e.src,e.listener,n)}const t=W;return e}(),n.proxy=i,i.src=e,i.listener=n,e.addEventListener)A||(s=o),void 0===s&&(s=!1),e.addEventListener(t.toString(),i,s);else if(e.attachEvent)e.attachEvent(G(t.toString()),i);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(i)}return n}function H(e,t,n,i,s){if(Array.isArray(t)){for(let r=0;r<t.length;r++)H(e,t[r],n,i,s);return null}return n=X(n),e&&e[k]?e.K(t,n,a(i)?!!i.capture:!!i,s):V(e,t,n,!0,i,s)}function $(e,t,n,i,s){if(Array.isArray(t))for(var r=0;r<t.length;r++)$(e,t[r],n,i,s);else i=a(i)?!!i.capture:!!i,n=X(n),e&&e[k]?(e=e.i,(r=String(t).toString())in e.g&&((n=F(t=e.g[r],n,i,s))>-1&&(D(t[n]),Array.prototype.splice.call(t,n,1),0==t.length&&(delete e.g[r],e.h--)))):e&&(e=K(e))&&(t=e.g[t.toString()],e=-1,t&&(e=F(t,n,i,s)),(n=e>-1?t[e]:null)&&q(n))}function q(e){if("number"!==typeof e&&e&&!e.da){var t=e.src;if(t&&t[k])O(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(G(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=K(t))?(O(n,e),0==n.h&&(n.src=null,t[B]=null)):D(e)}}}function G(e){return e in U?U[e]:U[e]="on"+e}function W(e,t){if(e.da)e=!0;else{t=new T(t,this);const n=e.listener,i=e.ha||e.src;e.fa&&q(e),e=n.call(i,t)}return e}function K(e){return(e=e[B])instanceof j?e:null}var Q="__closure_events_fn_"+(1e9*Math.random()>>>0);function X(e){return"function"===typeof e?e:(e[Q]||(e[Q]=function(t){return e.handleEvent(t)}),e[Q])}function Y(){S.call(this),this.i=new j(this),this.M=this,this.G=null}function J(e,t){var n,i=e.G;if(i)for(n=[];i;i=i.G)n.push(i);if(e=e.M,i=t.type||t,"string"===typeof t)t=new C(t,e);else if(t instanceof C)t.target=t.target||e;else{var s=t;L(t=new C(i,e),s)}let r,a;if(s=!0,n)for(a=n.length-1;a>=0;a--)r=t.g=n[a],s=Z(r,i,!0,t)&&s;if(r=t.g=e,s=Z(r,i,!0,t)&&s,s=Z(r,i,!1,t)&&s,n)for(a=0;a<n.length;a++)r=t.g=n[a],s=Z(r,i,!1,t)&&s}function Z(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let s=!0;for(let r=0;r<t.length;++r){const a=t[r];if(a&&!a.da&&a.capture==n){const t=a.listener,n=a.ha||a.src;a.fa&&O(e.i,a),s=!1!==t.call(n,i)&&s}}return s&&!i.defaultPrevented}function ee(e){e.g=function(e,t){if("function"!==typeof e){if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=l(e.handleEvent,e)}return Number(t)>2147483647?-1:r.setTimeout(e,t||0)}(()=>{e.g=null,e.i&&(e.i=!1,ee(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}d(Y,S),Y.prototype[k]=!0,Y.prototype.removeEventListener=function(e,t,n,i){$(this,e,t,n,i)},Y.prototype.N=function(){if(Y.Z.N.call(this),this.i){var e=this.i;for(const t in e.g){const n=e.g[t];for(let e=0;e<n.length;e++)D(n[e]);delete e.g[t],e.h--}}this.G=null},Y.prototype.J=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},Y.prototype.K=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};class te extends S{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ee(this)}N(){super.N(),this.g&&(r.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ne(e){S.call(this),this.h=e,this.g={}}d(ne,S);var ie=[];function se(e){P(e.g,function(e,t){this.g.hasOwnProperty(t)&&q(e)},e),e.g={}}ne.prototype.N=function(){ne.Z.N.call(this),se(this)},ne.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var re=r.JSON.stringify,ae=r.JSON.parse,oe=class{stringify(e){return r.JSON.stringify(e,void 0)}parse(e){return r.JSON.parse(e,void 0)}};function le(){}function ce(){}var de={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ue(){C.call(this,"d")}function he(){C.call(this,"c")}d(ue,C),d(he,C);var pe={},me=null;function ge(){return me=me||new Y}function fe(e){C.call(this,pe.Ia,e)}function ye(e){const t=ge();J(t,new fe(t))}function ve(e,t){C.call(this,pe.STAT_EVENT,e),this.stat=t}function be(e){const t=ge();J(t,new ve(t,e))}function xe(e,t){C.call(this,pe.Ja,e),this.size=t}function we(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return r.setTimeout(function(){e()},t)}function _e(){this.g=!0}function Se(e,t,n,i){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{const r=JSON.parse(t);if(r)for(e=0;e<r.length;e++)if(Array.isArray(r[e])){var n=r[e];if(!(n.length<2)){var i=n[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(let e=1;e<i.length;e++)i[e]=""}}}return re(r)}catch(r){return t}}(e,n)+(i?" "+i:"")})}pe.Ia="serverreachability",d(fe,C),pe.STAT_EVENT="statevent",d(ve,C),pe.Ja="timingevent",d(xe,C),_e.prototype.ua=function(){this.g=!1},_e.prototype.info=function(){};var Ce,Ae={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ee={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function Te(){}function ke(e){return encodeURIComponent(String(e))}function Ne(e){var t=1;e=e.split(":");const n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function Ie(e,t,n,i){this.j=e,this.i=t,this.l=n,this.S=i||1,this.V=new ne(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new De}function De(){this.i=null,this.g="",this.h=!1}d(Te,le),Te.prototype.g=function(){return new XMLHttpRequest},Ce=new Te;var Pe={},Me={};function Re(e,t,n){e.M=1,e.A=rt(et(t)),e.u=n,e.R=!0,Le(e,null)}function Le(e,t){e.F=Date.now(),Fe(e),e.B=et(e.A);var n=e.B,i=e.S;Array.isArray(i)||(i=[String(i)]),bt(n.i,"t",i),e.C=0,n=e.j.L,e.h=new De,e.g=an(e.j,n?t:null,!e.u),e.P>0&&(e.O=new te(l(e.Y,e,e.g),e.P)),t=e.V,n=e.g,i=e.ba;var s="readystatechange";Array.isArray(s)||(s&&(ie[0]=s.toString()),s=ie);for(let r=0;r<s.length;r++){const e=z(n,s[r],i||t.handleEvent,!1,t.h||t);if(!e)break;t.g[e.key]=e}t=e.J?M(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),ye(),function(e,t,n,i,s,r){e.info(function(){if(e.g)if(r){var a="",o=r.split("&");for(let e=0;e<o.length;e++){var l=o[e].split("=");if(l.length>1){const e=l[0];l=l[1];const t=e.split("_");a=t.length>=2&&"type"==t[1]?a+(e+"=")+l+"&":a+(e+"=redacted&")}}}else a=null;else a=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+t+"\n"+n+"\n"+a})}(e.i,e.v,e.B,e.l,e.S,e.u)}function je(e){return!!e.g&&("GET"==e.v&&2!=e.M&&e.j.Aa)}function Oe(e,t){var n=e.C,i=t.indexOf("\n",n);return-1==i?Me:(n=Number(t.substring(n,i)),isNaN(n)?Pe:(i+=1)+n>t.length?Me:(t=t.slice(i,i+n),e.C=i+n,t))}function Fe(e){e.T=Date.now()+e.H,Be(e,e.H)}function Be(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=we(l(e.aa,e),t)}function Ue(e){e.D&&(r.clearTimeout(e.D),e.D=null)}function ze(e){0==e.j.I||e.K||en(e.j,e)}function Ve(e){Ue(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,se(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function He(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||Ke(n.h,e)))if(!e.L&&Ke(n.h,e)&&3==n.I){try{var i=n.Ba.g.parse(t)}catch(d){i=null}if(Array.isArray(i)&&3==i.length){var s=i;if(0==s[0]){e:if(!n.v){if(n.g){if(!(n.g.F+3e3<e.F))break e;Zt(n),Ht(n)}Xt(n),be(18)}}else n.xa=s[1],0<n.xa-n.K&&s[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=we(l(n.Va,n),6e3));We(n.h)<=1&&n.ta&&(n.ta=void 0)}else nn(n,11)}else if((e.L||n.g==e)&&Zt(n),!E(t))for(s=n.Ba.g.parse(t),t=0;t<s.length;t++){let l=s[t];const d=l[0];if(!(d<=n.K))if(n.K=d,l=l[1],2==n.I)if("c"==l[0]){n.M=l[1],n.ba=l[2];const t=l[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));const s=l[4];null!=s&&(n.za=s,n.j.info("SVER="+n.za));const d=l[5];null!=d&&"number"===typeof d&&d>0&&(i=1.5*d,n.O=i,n.j.info("backChannelRequestTimeoutMs_="+i)),i=n;const u=e.g;if(u){const e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var r=i.h;r.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(Qe(r,r.h),r.h=null))}if(i.G){const e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.wa=e,st(i.J,i.G,e))}}n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms"));var a=e;if((i=n).na=rn(i,i.L?i.ba:null,i.W),a.L){Xe(i.h,a);var o=a,c=i.O;c&&(o.H=c),o.D&&(Ue(o),Fe(o)),i.g=a}else Qt(i);n.i.length>0&&qt(n)}else"stop"!=l[0]&&"close"!=l[0]||nn(n,7);else 3==n.I&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?nn(n,7):Vt(n):"noop"!=l[0]&&n.l&&n.l.qa(l),n.A=0)}ye()}catch(d){}}Ie.prototype.ba=function(e){e=e.target;const t=this.O;t&&3==Ft(e)?t.j():this.Y(e)},Ie.prototype.Y=function(e){try{if(e==this.g)e:{const l=Ft(this.g),c=this.g.ya();this.g.ca();if(!(l<3)&&(3!=l||this.g&&(this.h.h||this.g.la()||Bt(this.g)))){this.K||4!=l||7==c||ye(),Ue(this);var t=this.g.ca();this.X=t;var n=function(e){if(!je(e))return e.g.la();const t=Bt(e.g);if(""===t)return"";let n="";const i=t.length,s=4==Ft(e.g);if(!e.h.i){if("undefined"===typeof TextDecoder)return Ve(e),ze(e),"";e.h.i=new r.TextDecoder}for(let r=0;r<i;r++)e.h.h=!0,n+=e.h.i.decode(t[r],{stream:!(s&&r==i-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,function(e,t,n,i,s,r,a){e.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+t+"\n"+n+"\n"+r+" "+a})}(this.i,this.v,this.B,this.l,this.S,l,t),this.o){if(this.U&&!this.L){t:{if(this.g){var i,s=this.g;if((i=s.g?s.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!E(i)){var a=i;break t}}a=null}if(!(e=a)){this.o=!1,this.m=3,be(12),Ve(this),ze(this);break e}Se(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,He(this,e)}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;){if(t=Oe(this,n),t==Me){4==l&&(this.m=4,be(14),e=!1),Se(this.i,this.l,null,"[Incomplete Response]");break}if(t==Pe){this.m=4,be(15),Se(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}Se(this.i,this.l,t,null),He(this,t)}if(je(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=l||0!=n.length||this.h.h||(this.m=1,be(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var o=this.j;o.g==this&&o.aa&&!o.P&&(o.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Yt(o),o.P=!0,be(11))}}else Se(this.i,this.l,n,"[Invalid Chunked Response]"),Ve(this),ze(this)}else Se(this.i,this.l,n,null),He(this,n);4==l&&Ve(this),this.o&&!this.K&&(4==l?en(this.j,this):(this.o=!1,Fe(this)))}else(function(e){const t={};e=(e.g&&Ft(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<e.length;i++){if(E(e[i]))continue;var n=Ne(e[i]);const s=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const r=t[s]||[];t[s]=r,r.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,be(12)):(this.m=0,be(13)),Ve(this),ze(this)}}}catch(l){}},Ie.prototype.cancel=function(){this.K=!0,Ve(this)},Ie.prototype.aa=function(){this.D=null;const e=Date.now();e-this.T>=0?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.B),2!=this.M&&(ye(),be(17)),Ve(this),this.m=2,ze(this)):Be(this,this.T-e)};var $e=class{constructor(e,t){this.g=e,this.map=t}};function qe(e){this.l=e||10,r.PerformanceNavigationTiming?e=(e=r.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(r.chrome&&r.chrome.loadTimes&&r.chrome.loadTimes()&&r.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ge(e){return!!e.h||!!e.g&&e.g.size>=e.j}function We(e){return e.h?1:e.g?e.g.size:0}function Ke(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Qe(e,t){e.g?e.g.add(t):e.h=t}function Xe(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Ye(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.G);return t}return h(e.i)}qe.prototype.cancel=function(){if(this.i=Ye(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var Je=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ze(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof Ze?(this.l=e.l,tt(this,e.j),this.o=e.o,this.g=e.g,nt(this,e.u),this.h=e.h,it(this,xt(e.i)),this.m=e.m):e&&(t=String(e).match(Je))?(this.l=!1,tt(this,t[1]||"",!0),this.o=at(t[2]||""),this.g=at(t[3]||"",!0),nt(this,t[4]),this.h=at(t[5]||"",!0),it(this,t[6]||"",!0),this.m=at(t[7]||"")):(this.l=!1,this.i=new mt(null,this.l))}function et(e){return new Ze(e)}function tt(e,t,n){e.j=n?at(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function nt(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function it(e,t,n){t instanceof mt?(e.i=t,function(e,t){t&&!e.j&&(gt(e),e.i=null,e.g.forEach(function(e,t){const n=t.toLowerCase();t!=n&&(ft(this,t),bt(this,n,e))},e)),e.j=t}(e.i,e.l)):(n||(t=ot(t,ht)),e.i=new mt(t,e.l))}function st(e,t,n){e.i.set(t,n)}function rt(e){return st(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function at(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ot(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,lt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function lt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Ze.prototype.toString=function(){const e=[];var t=this.j;t&&e.push(ot(t,ct,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ot(t,ct,!0),"@"),e.push(ke(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ot(n,"/"==n.charAt(0)?ut:dt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",ot(n,pt)),e.join("")},Ze.prototype.resolve=function(e){const t=et(this);let n=!!e.j;n?tt(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var i=e.h;if(n)nt(t,e.u);else if(n=!!e.h){if("/"!=i.charAt(0))if(this.g&&!this.h)i="/"+i;else{var s=t.h.lastIndexOf("/");-1!=s&&(i=t.h.slice(0,s+1)+i)}if(".."==(s=i)||"."==s)i="";else if(-1!=s.indexOf("./")||-1!=s.indexOf("/.")){i=0==s.lastIndexOf("/",0),s=s.split("/");const e=[];for(let t=0;t<s.length;){const n=s[t++];"."==n?i&&t==s.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),i&&t==s.length&&e.push("")):(e.push(n),i=!0)}i=e.join("/")}else i=s}return n?t.h=i:n=""!==e.i.toString(),n?it(t,xt(e.i)):n=!!e.m,n&&(t.m=e.m),t};var ct=/[#\/\?@]/g,dt=/[#\?:]/g,ut=/[#\?]/g,ht=/[#\?@]/g,pt=/#/g;function mt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function gt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){const i=e[n].indexOf("=");let s,r=null;i>=0?(s=e[n].substring(0,i),r=e[n].substring(i+1)):s=e[n],t(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function ft(e,t){gt(e),t=wt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function yt(e,t){return gt(e),t=wt(e,t),e.g.has(t)}function vt(e,t){gt(e);let n=[];if("string"===typeof t)yt(e,t)&&(n=n.concat(e.g.get(wt(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function bt(e,t,n){ft(e,t),n.length>0&&(e.i=null,e.g.set(wt(e,t),h(n)),e.h+=n.length)}function xt(e){const t=new mt;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function wt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function _t(e,t,n,i,s){try{s&&(s.onload=null,s.onerror=null,s.onabort=null,s.ontimeout=null),i(n)}catch(r){}}function St(){this.g=new oe}function Ct(e){this.i=e.Sb||null,this.h=e.ab||!1}function At(e,t){Y.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function Et(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function Tt(e){e.readyState=4,e.l=null,e.j=null,e.B=null,kt(e)}function kt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Nt(e){let t="";return P(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function It(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=Nt(n),"string"===typeof e?null!=n&&ke(n):st(e,t,n))}function Dt(e){Y.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(e=mt.prototype).add=function(e,t){gt(this),this.i=null,e=wt(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){gt(this),this.g.forEach(function(n,i){n.forEach(function(n){e.call(t,n,i,this)},this)},this)},e.set=function(e,t){return gt(this),this.i=null,yt(this,e=wt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&(e=vt(this,e)).length>0?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(let i=0;i<t.length;i++){var n=t[i];const s=ke(n);n=vt(this,n);for(let t=0;t<n.length;t++){let i=s;""!==n[t]&&(i+="="+ke(n[t])),e.push(i)}}return this.i=e.join("&")},d(Ct,le),Ct.prototype.g=function(){return new At(this.i,this.h)},d(At,Y),(e=At.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,kt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||r).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,Tt(this)),this.readyState=0},e.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,kt(this)),this.g&&(this.readyState=3,kt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if("undefined"!==typeof r.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Et(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},e.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Tt(this):kt(this),3==this.readyState&&Et(this)}},e.Oa=function(e){this.g&&(this.response=this.responseText=e,Tt(this))},e.Na=function(e){this.g&&(this.response=e,Tt(this))},e.ga=function(){this.g&&Tt(this)},e.setRequestHeader=function(e,t){this.A.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(At.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),d(Dt,Y);var Pt=/^https?$/i,Mt=["POST","PUT"];function Rt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,Lt(e),Ot(e)}function Lt(e){e.A||(e.A=!0,J(e,"complete"),J(e,"error"))}function jt(e){if(e.h&&"undefined"!=typeof s)if(e.v&&4==Ft(e))setTimeout(e.Ca.bind(e),0);else if(J(e,"readystatechange"),4==Ft(e)){e.h=!1;try{const s=e.ca();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var i;if(i=0===s){let t=String(e.D).match(Je)[1]||null;!t&&r.self&&r.self.location&&(t=r.self.location.protocol.slice(0,-1)),i=!Pt.test(t?t.toLowerCase():"")}n=i}if(n)J(e,"complete"),J(e,"success");else{e.o=6;try{var a=Ft(e)>2?e.g.statusText:""}catch(o){a=""}e.l=a+" ["+e.ca()+"]",Lt(e)}}finally{Ot(e)}}}function Ot(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);const i=e.g;e.g=null,t||J(e,"ready");try{i.onreadystatechange=null}catch(n){}}}function Ft(e){return e.g?e.g.readyState:0}function Bt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Ut(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function zt(e){this.za=0,this.i=[],this.j=new _e,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ut("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ut("baseRetryDelayMs",5e3,e),this.Za=Ut("retryDelaySeedMs",1e4,e),this.Ta=Ut("forwardChannelMaxRetries",2,e),this.va=Ut("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new qe(e&&e.concurrentRequestLimit),this.Ba=new St,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function Vt(e){if($t(e),3==e.I){var t=e.V++,n=et(e.J);if(st(n,"SID",e.M),st(n,"RID",t),st(n,"TYPE","terminate"),Wt(e,n),(t=new Ie(e,e.j,t)).M=2,t.A=rt(et(n)),n=!1,r.navigator&&r.navigator.sendBeacon)try{n=r.navigator.sendBeacon(t.A.toString(),"")}catch(i){}!n&&r.Image&&((new Image).src=t.A,n=!0),n||(t.g=an(t.j,null),t.g.ea(t.A)),t.F=Date.now(),Fe(t)}sn(e)}function Ht(e){e.g&&(Yt(e),e.g.cancel(),e.g=null)}function $t(e){Ht(e),e.v&&(r.clearTimeout(e.v),e.v=null),Zt(e),e.h.cancel(),e.m&&("number"===typeof e.m&&r.clearTimeout(e.m),e.m=null)}function qt(e){if(!Ge(e.h)&&!e.m){e.m=!0;var t=e.Ea;v||w(),b||(v(),b=!0),x.add(t,e),e.D=0}}function Gt(e,t){var n;n=t?t.l:e.V++;const i=et(e.J);st(i,"SID",e.M),st(i,"RID",n),st(i,"AID",e.K),Wt(e,i),e.u&&e.o&&It(i,e.u,e.o),n=new Ie(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=Kt(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),Qe(e.h,n),Re(n,i,t)}function Wt(e,t){e.H&&P(e.H,function(e,n){st(t,n,e)}),e.l&&P({},function(e,n){st(t,n,e)})}function Kt(e,t,n){n=Math.min(e.i.length,n);const i=e.l?l(e.l.Ka,e.l,e):null;e:{var s=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?n>0?(t=s[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let c=0;c<n;c++){var r=s[c].g;const n=s[c].map;if((r-=t)<0)t=Math.max(0,s[c].g-100),l=!1;else try{r="req"+r+"_"||0;try{var o=n instanceof Map?n:Object.entries(n);for(const[t,n]of o){let i=n;a(n)&&(i=re(n)),e.push(r+t+"="+encodeURIComponent(i))}}catch(Pr){throw e.push(r+"type="+encodeURIComponent("_badmap")),Pr}}catch(Pr){i&&i(n)}}if(l){o=e.join("&");break e}}o=void 0}return e=e.i.splice(0,n),t.G=e,o}function Qt(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;v||w(),b||(v(),b=!0),x.add(t,e),e.A=0}}function Xt(e){return!(e.g||e.v||e.A>=3)&&(e.Y++,e.v=we(l(e.Da,e),tn(e,e.A)),e.A++,!0)}function Yt(e){null!=e.B&&(r.clearTimeout(e.B),e.B=null)}function Jt(e){e.g=new Ie(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=et(e.na);st(t,"RID","rpc"),st(t,"SID",e.M),st(t,"AID",e.K),st(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&st(t,"TO",e.ia),st(t,"TYPE","xmlhttp"),Wt(e,t),e.u&&e.o&&It(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=rt(et(t)),n.u=null,n.R=!0,Le(n,e)}function Zt(e){null!=e.C&&(r.clearTimeout(e.C),e.C=null)}function en(e,t){var n=null;if(e.g==t){Zt(e),Yt(e),e.g=null;var i=2}else{if(!Ke(e.h,t))return;n=t.G,Xe(e.h,t),i=1}if(0!=e.I)if(t.o)if(1==i){n=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;J(i=ge(),new xe(i,n)),qt(e)}else Qt(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&function(e,t){return!(We(e.h)>=e.h.j-(e.m?1:0))&&(e.m?(e.i=t.G.concat(e.i),!0):!(1==e.I||2==e.I||e.D>=(e.Sa?0:e.Ta))&&(e.m=we(l(e.Ea,e,t),tn(e,e.D)),e.D++,!0))}(e,t)||2==i&&Xt(e)))switch(n&&n.length>0&&(t=e.h,t.i=t.i.concat(n)),s){case 1:nn(e,5);break;case 4:nn(e,10);break;case 3:nn(e,6);break;default:nn(e,2)}}function tn(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function nn(e,t){if(e.j.info("Error code "+t),2==t){var n=l(e.bb,e),i=e.Ua;const t=!i;i=new Ze(i||"//www.google.com/images/cleardot.gif"),r.location&&"http"==r.location.protocol||tt(i,"https"),rt(i),t?function(e,t){const n=new _e;if(r.Image){const i=new Image;i.onload=c(_t,n,"TestLoadImage: loaded",!0,t,i),i.onerror=c(_t,n,"TestLoadImage: error",!1,t,i),i.onabort=c(_t,n,"TestLoadImage: abort",!1,t,i),i.ontimeout=c(_t,n,"TestLoadImage: timeout",!1,t,i),r.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=e}else t(!1)}(i.toString(),n):function(e,t){new _e;const n=new AbortController,i=setTimeout(()=>{n.abort(),_t(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(i),e.ok?_t(0,0,!0,t):_t(0,0,!1,t)}).catch(()=>{clearTimeout(i),_t(0,0,!1,t)})}(i.toString(),n)}else be(2);e.I=0,e.l&&e.l.pa(t),sn(e),$t(e)}function sn(e){if(e.I=0,e.ja=[],e.l){const t=Ye(e.h);0==t.length&&0==e.i.length||(p(e.ja,t),p(e.ja,e.i),e.h.i.length=0,h(e.i),e.i.length=0),e.l.oa()}}function rn(e,t,n){var i=n instanceof Ze?et(n):new Ze(n);if(""!=i.g)t&&(i.g=t+"."+i.g),nt(i,i.u);else{var s=r.location;i=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;const e=new Ze(null);i&&tt(e,i),t&&(e.g=t),s&&nt(e,s),n&&(e.h=n),i=e}return n=e.G,t=e.wa,n&&t&&st(i,n,t),st(i,"VER",e.ka),Wt(e,i),i}function an(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Aa&&!e.ma?new Dt(new Ct({ab:n})):new Dt(e.ma)).Fa(e.L),t}function on(){}function ln(){}function cn(e,t){Y.call(this),this.g=new zt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!E(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!E(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new hn(this)}function dn(e){ue.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function un(){he.call(this),this.status=1}function hn(e){this.g=e}(e=Dt.prototype).Fa=function(e){this.H=e},e.ea=function(e,t,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ce.g(),this.g.onreadystatechange=u(l(this.Ca,this));try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(a){return void Rt(this,a)}if(e=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else{if("function"!==typeof i.keys||"function"!==typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const e of i.keys())n.set(e,i.get(e))}i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=r.FormData&&e instanceof r.FormData,!(Array.prototype.indexOf.call(Mt,t,void 0)>=0)||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[r,o]of n)this.g.setRequestHeader(r,o);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(e),this.v=!1}catch(a){Rt(this,a)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,J(this,"complete"),J(this,"abort"),Ot(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ot(this,!0)),Dt.Z.N.call(this)},e.Ca=function(){this.u||(this.B||this.v||this.j?jt(this):this.Xa())},e.Xa=function(){jt(this)},e.isActive=function(){return!!this.g},e.ca=function(){try{return Ft(this)>2?this.g.status:-1}catch(e){return-1}},e.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ae(t)}},e.ya=function(){return this.o},e.Ha=function(){return"string"===typeof this.l?this.l:String(this.l)},(e=zt.prototype).ka=8,e.I=1,e.connect=function(e,t,n,i){be(0),this.W=e,this.H=t||{},n&&void 0!==i&&(this.H.OSID=n,this.H.OAID=i),this.F=this.X,this.J=rn(this,null,this.W),qt(this)},e.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const s=new Ie(this,this.j,e);let r=this.o;if(this.U&&(r?(r=M(r),L(r,this.U)):r=this.U),null!==this.u||this.R||(s.J=r,r=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){var i=this.i[n];if(void 0===(i="__data__"in i.map&&"string"===typeof(i=i.map.__data__)?i.length:void 0))break;if((t+=i)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Kt(this,s,t),st(n=et(this.J),"RID",e),st(n,"CVER",22),this.G&&st(n,"X-HTTP-Session-Id",this.G),Wt(this,n),r&&(this.R?t="headers="+ke(Nt(r))+"&"+t:this.u&&It(n,this.u,r)),Qe(this.h,s),this.Ra&&st(n,"TYPE","init"),this.S?(st(n,"$req",t),st(n,"SID","null"),s.U=!0,Re(s,n,null)):Re(s,n,t),this.I=2}}else 3==this.I&&(e?Gt(this,e):0==this.i.length||Ge(this.h)||Gt(this))},e.Da=function(){if(this.v=null,Jt(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=we(l(this.Wa,this),e)}},e.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,be(10),Ht(this),Jt(this))},e.Va=function(){null!=this.C&&(this.C=null,Ht(this),Xt(this),be(19))},e.bb=function(e){e?(this.j.info("Successfully pinged google.com"),be(2)):(this.j.info("Failed to ping google.com"),be(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=on.prototype).ra=function(){},e.qa=function(){},e.pa=function(){},e.oa=function(){},e.isActive=function(){return!0},e.Ka=function(){},ln.prototype.g=function(e,t){return new cn(e,t)},d(cn,Y),cn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},cn.prototype.close=function(){Vt(this.g)},cn.prototype.o=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=re(e),e=n);t.i.push(new $e(t.Ya++,e)),3==t.I&&qt(t)},cn.prototype.N=function(){this.g.l=null,delete this.j,Vt(this.g),delete this.g,cn.Z.N.call(this)},d(dn,ue),d(un,he),d(hn,on),hn.prototype.ra=function(){J(this.g,"a")},hn.prototype.qa=function(e){J(this.g,new dn(e))},hn.prototype.pa=function(e){J(this.g,new un)},hn.prototype.oa=function(){J(this.g,"b")},ln.prototype.createWebChannel=ln.prototype.g,cn.prototype.send=cn.prototype.o,cn.prototype.open=cn.prototype.m,cn.prototype.close=cn.prototype.close,Js=er.createWebChannelTransport=function(){return new ln},Ys=er.getStatEventTarget=function(){return ge()},Xs=er.Event=pe,Qs=er.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Ae.NO_ERROR=0,Ae.TIMEOUT=8,Ae.HTTP_ERROR=6,Ks=er.ErrorCode=Ae,Ee.COMPLETE="complete",Ws=er.EventType=Ee,ce.EventType=de,de.OPEN="a",de.CLOSE="b",de.ERROR="c",de.MESSAGE="d",Y.prototype.listen=Y.prototype.J,Gs=er.WebChannel=ce,er.FetchXmlHttpFactory=Ct,Dt.prototype.listenOnce=Dt.prototype.K,Dt.prototype.getLastError=Dt.prototype.Ha,Dt.prototype.getLastErrorCode=Dt.prototype.ya,Dt.prototype.getStatus=Dt.prototype.ca,Dt.prototype.getResponseJson=Dt.prototype.La,Dt.prototype.getResponseText=Dt.prototype.la,Dt.prototype.send=Dt.prototype.ea,Dt.prototype.setWithCredentials=Dt.prototype.Fa,qs=er.XhrIo=Dt}).apply("undefined"!==typeof Zs?Zs:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});class tr{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}tr.UNAUTHENTICATED=new tr(null),tr.GOOGLE_CREDENTIALS=new tr("google-credentials-uid"),tr.FIRST_PARTY=new tr("first-party-uid"),tr.MOCK_USER=new tr("mock-user");let nr="12.8.0";const ir=new K("@firebase/firestore");function sr(){return ir.logLevel}function rr(e){if(ir.logLevel<=H.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const s=n.map(lr);ir.debug(`Firestore (${nr}): ${e}`,...s)}}function ar(e){if(ir.logLevel<=H.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const s=n.map(lr);ir.error(`Firestore (${nr}): ${e}`,...s)}}function or(e){if(ir.logLevel<=H.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const s=n.map(lr);ir.warn(`Firestore (${nr}): ${e}`,...s)}}function lr(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function cr(e,t,n){let i="Unexpected state";"string"==typeof t?i=t:n=t,dr(e,i,n)}function dr(e,t,n){let i=`FIRESTORE (${nr}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{i+=" CONTEXT: "+JSON.stringify(n)}catch(e){i+=" CONTEXT: "+n}throw ar(i),new Error(i)}function ur(e,t,n,i){let s="Unexpected state";"string"==typeof n?s=n:i=n,e||dr(t,s,i)}function hr(e,t){return e}const pr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class mr extends T{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class gr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class fr{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class yr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(tr.UNAUTHENTICATED))}shutdown(){}}class vr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class br{constructor(e){this.t=e,this.currentUser=tr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ur(void 0===this.o,42304);let n=this.i;const i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let s=new gr;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new gr,e.enqueueRetryable(()=>i(this.currentUser))};const r=()=>{const t=s;e.enqueueRetryable(async()=>{await t.promise,await i(this.currentUser)})},a=e=>{rr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),r())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(rr("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new gr)}},0),r()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(rr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(ur("string"==typeof t.accessToken,31837,{l:t}),new fr(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ur(null===e||"string"==typeof e,2055,{h:e}),new tr(e)}}class xr{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=tr.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class wr{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new xr(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(tr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class _r{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Sr{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Qe(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ur(void 0===this.o,3512);const n=e=>{null!=e.error&&rr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.m;return this.m=e.token,rr("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const i=e=>{rr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>i(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?i(e):rr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new _r(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(ur("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new _r(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Cr(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let i=0;i<e;i++)n[i]=Math.floor(256*Math.random());return n}class Ar{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=Cr(40);for(let i=0;i<n.length;++i)t.length<20&&n[i]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[i]%62))}return t}}function Er(e,t){return e<t?-1:e>t?1:0}function Tr(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const n=e.charAt(i),s=t.charAt(i);if(n!==s)return Ir(n)===Ir(s)?Er(n,s):Ir(n)?1:-1}return Er(e.length,t.length)}const kr=55296,Nr=57343;function Ir(e){const t=e.charCodeAt(0);return t>=kr&&t<=Nr}function Dr(e,t,n){return e.length===t.length&&e.every((e,i)=>n(e,t[i]))}const Pr="__name__";class Mr{constructor(e,t,n){void 0===t?t=0:t>e.length&&cr(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&cr(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Mr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Mr?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const n=Mr.compareSegments(e.get(i),t.get(i));if(0!==n)return n}return Er(e.length,t.length)}static compareSegments(e,t){const n=Mr.isNumericId(e),i=Mr.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?Mr.extractNumericId(e).compare(Mr.extractNumericId(t)):Tr(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return zs.fromString(e.substring(4,e.length-2))}}class Rr extends Mr{construct(e,t,n){return new Rr(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const e=[];for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(const s of n){if(s.indexOf("//")>=0)throw new mr(pr.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);e.push(...s.split("/").filter(e=>e.length>0))}return new Rr(e)}static emptyPath(){return new Rr([])}}const Lr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class jr extends Mr{construct(e,t,n){return new jr(e,t,n)}static isValidIdentifier(e){return Lr.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),jr.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Pr}static keyField(){return new jr([Pr])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new mr(pr.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let r=!1;for(;i<e.length;){const t=e[i];if("\\"===t){if(i+1===e.length)throw new mr(pr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[i+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new mr(pr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,i+=2}else"`"===t?(r=!r,i++):"."!==t||r?(n+=t,i++):(s(),i++)}if(s(),r)throw new mr(pr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new jr(t)}static emptyPath(){return new jr([])}}class Or{constructor(e){this.path=e}static fromPath(e){return new Or(Rr.fromString(e))}static fromName(e){return new Or(Rr.fromString(e).popFirst(5))}static empty(){return new Or(Rr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Rr.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Rr.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Or(new Rr(e.slice()))}}function Fr(e,t,n){if(!n)throw new mr(pr.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Br(e){if(!Or.isDocumentKey(e))throw new mr(pr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Ur(e){if(Or.isDocumentKey(e))throw new mr(pr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function zr(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function Vr(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":cr(12329,{type:typeof e})}function Hr(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new mr(pr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Vr(e);throw new mr(pr.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function $r(e,t){const n={typeString:e};return t&&(n.value=t),n}function qr(e,t){if(!zr(e))throw new mr(pr.INVALID_ARGUMENT,"JSON must be an object");let n;for(const i in t)if(t[i]){const s=t[i].typeString,r="value"in t[i]?{value:t[i].value}:void 0;if(!(i in e)){n=`JSON missing required field: '${i}'`;break}const a=e[i];if(s&&typeof a!==s){n=`JSON field '${i}' must be a ${s}.`;break}if(void 0!==r&&a!==r.value){n=`Expected '${i}' field to equal '${r.value}'`;break}}if(n)throw new mr(pr.INVALID_ARGUMENT,n);return!0}const Gr=-62135596800,Wr=1e6;class Kr{static now(){return Kr.fromMillis(Date.now())}static fromDate(e){return Kr.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*Wr);return new Kr(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new mr(pr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new mr(pr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Gr)throw new mr(pr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new mr(pr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Wr}_compareTo(e){return this.seconds===e.seconds?Er(this.nanoseconds,e.nanoseconds):Er(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Kr._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(qr(e,Kr._jsonSchema))return new Kr(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Gr;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Kr._jsonSchemaVersion="firestore/timestamp/1.0",Kr._jsonSchema={type:$r("string",Kr._jsonSchemaVersion),seconds:$r("number"),nanoseconds:$r("number")};class Qr{static fromTimestamp(e){return new Qr(e)}static min(){return new Qr(new Kr(0,0))}static max(){return new Qr(new Kr(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Xr=-1;class Yr{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}Yr.UNKNOWN_ID=-1;function Jr(e,t){const n=e.toTimestamp().seconds,i=e.toTimestamp().nanoseconds+1,s=Qr.fromTimestamp(1e9===i?new Kr(n+1,0):new Kr(n,i));return new ea(s,Or.empty(),t)}function Zr(e){return new ea(e.readTime,e.key,Xr)}class ea{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ea(Qr.min(),Or.empty(),Xr)}static max(){return new ea(Qr.max(),Or.empty(),Xr)}}function ta(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Or.comparator(e.documentKey,t.documentKey),0!==n?n:Er(e.largestBatchId,t.largestBatchId))}const na="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ia{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function sa(e){if(e.code!==pr.FAILED_PRECONDITION||e.message!==na)throw e;rr("LocalStore","Unexpectedly lost primary lease")}class ra{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&cr(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ra((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof ra?t:ra.resolve(t)}catch(e){return ra.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):ra.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):ra.reject(t)}static resolve(e){return new ra((t,n)=>{t(e)})}static reject(e){return new ra((t,n)=>{n(e)})}static waitFor(e){return new ra((t,n)=>{let i=0,s=0,r=!1;e.forEach(e=>{++i,e.next(()=>{++s,r&&s===i&&t()},e=>n(e))}),r=!0,s===i&&t()})}static or(e){let t=ra.resolve(!1);for(const n of e)t=t.next(e=>e?ra.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,i)=>{n.push(t.call(this,e,i))}),this.waitFor(n)}static mapArray(e,t){return new ra((n,i)=>{const s=e.length,r=new Array(s);let a=0;for(let o=0;o<s;o++){const l=o;t(e[l]).next(e=>{r[l]=e,++a,a===s&&n(r)},e=>i(e))}})}static doWhile(e,t){return new ra((n,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):n()};s()})}}function aa(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function oa(e){return"IndexedDbTransactionError"===e.name}class la{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}la.ce=-1;const ca=-1;function da(e){return null==e}function ua(e){return 0===e&&1/e==-1/0}function ha(e){return"number"==typeof e&&Number.isInteger(e)&&!ua(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const pa="\x01";function ma(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=fa(t)),t=ga(e.get(n),t);return fa(t)}function ga(e,t){let n=t;const i=e.length;for(let s=0;s<i;s++){const t=e.charAt(s);switch(t){case"\0":n+="\x01\x10";break;case pa:n+="\x01\x11";break;default:n+=t}}return n}function fa(e){return e+pa+"\x01"}const ya="remoteDocuments",va="owner",ba="mutationQueues",xa="mutations";const wa="documentMutations",_a="remoteDocumentsV14",Sa="remoteDocumentGlobal",Ca="targets",Aa="targetDocuments",Ea="targetGlobal",Ta="collectionParents",ka="clientMetadata",Na="bundles",Ia="namedQueries",Da="indexConfiguration",Pa="indexState",Ma="indexEntries",Ra="documentOverlays",La="globals",ja=[ba,xa,wa,ya,Ca,va,Ea,Aa,ka,Sa,Ta,Na,Ia],Oa=[ba,xa,wa,_a,Ca,va,Ea,Aa,ka,Sa,Ta,Na,Ia,Ra],Fa=Oa,Ba=[...Fa,Da,Pa,Ma];function Ua(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function za(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Va(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Ha{constructor(e,t){this.comparator=e,this.root=t||qa.EMPTY}insert(e,t){return new Ha(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,qa.BLACK,null,null))}remove(e){return new Ha(this.comparator,this.root.remove(e,this.comparator).copy(null,null,qa.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new $a(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new $a(this.root,e,this.comparator,!1)}getReverseIterator(){return new $a(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new $a(this.root,e,this.comparator,!0)}}class $a{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class qa{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=null!=n?n:qa.RED,this.left=null!=i?i:qa.EMPTY,this.right=null!=s?s:qa.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new qa(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return qa.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return qa.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,qa.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,qa.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw cr(43730,{key:this.key,value:this.value});if(this.right.isRed())throw cr(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw cr(27949);return e+(this.isRed()?0:1)}}qa.EMPTY=null,qa.RED=!0,qa.BLACK=!1,qa.EMPTY=new class{constructor(){this.size=0}get key(){throw cr(57766)}get value(){throw cr(16141)}get color(){throw cr(16727)}get left(){throw cr(29726)}get right(){throw cr(36894)}copy(e,t,n,i,s){return this}insert(e,t,n){return new qa(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ga{constructor(e){this.comparator=e,this.data=new Ha(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Wa(this.data.getIterator())}getIteratorFrom(e){return new Wa(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof Ga))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ga(this.comparator);return t.data=e,t}}class Wa{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ka{constructor(e){this.fields=e,e.sort(jr.comparator)}static empty(){return new Ka([])}unionWith(e){let t=new Ga(jr.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Ka(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Dr(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Qa extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Xa{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Qa("Invalid base64 string: "+e):e}}(e);return new Xa(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Xa(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Er(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Xa.EMPTY_BYTE_STRING=new Xa("");const Ya=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ja(e){if(ur(!!e,39018),"string"==typeof e){let t=0;const n=Ya.exec(e);if(ur(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:Za(e.seconds),nanos:Za(e.nanos)}}function Za(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function eo(e){return"string"==typeof e?Xa.fromBase64String(e):Xa.fromUint8Array(e)}const to="server_timestamp",no="__type__",io="__previous_value__",so="__local_write_time__";function ro(e){const t=(e?.mapValue?.fields||{})[no]?.stringValue;return t===to}function ao(e){const t=e.mapValue.fields[io];return ro(t)?ao(t):t}function oo(e){const t=Ja(e.mapValue.fields[so].timestampValue);return new Kr(t.seconds,t.nanos)}class lo{constructor(e,t,n,i,s,r,a,o,l,c,d){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=r,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=c,this.apiKey=d}}const co="(default)";class uo{constructor(e,t){this.projectId=e,this.database=t||co}static empty(){return new uo("","")}get isDefaultDatabase(){return this.database===co}isEqual(e){return e instanceof uo&&e.projectId===this.projectId&&e.database===this.database}}const ho="__type__",po="__max__",mo={mapValue:{fields:{__type__:{stringValue:po}}}},go="__vector__",fo="value";function yo(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ro(e)?4:Ro(e)?9007199254740991:Po(e)?10:11:cr(28295,{value:e})}function vo(e,t){if(e===t)return!0;const n=yo(e);if(n!==yo(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return oo(e).isEqual(oo(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Ja(e.timestampValue),i=Ja(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return eo(e.bytesValue).isEqual(eo(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Za(e.geoPointValue.latitude)===Za(t.geoPointValue.latitude)&&Za(e.geoPointValue.longitude)===Za(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Za(e.integerValue)===Za(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Za(e.doubleValue),i=Za(t.doubleValue);return n===i?ua(n)===ua(i):isNaN(n)&&isNaN(i)}return!1}(e,t);case 9:return Dr(e.arrayValue.values||[],t.arrayValue.values||[],vo);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},i=t.mapValue.fields||{};if(Ua(n)!==Ua(i))return!1;for(const s in n)if(n.hasOwnProperty(s)&&(void 0===i[s]||!vo(n[s],i[s])))return!1;return!0}(e,t);default:return cr(52216,{left:e})}}function bo(e,t){return void 0!==(e.values||[]).find(e=>vo(e,t))}function xo(e,t){if(e===t)return 0;const n=yo(e),i=yo(t);if(n!==i)return Er(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return Er(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Za(e.integerValue||e.doubleValue),i=Za(t.integerValue||t.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(e,t);case 3:return wo(e.timestampValue,t.timestampValue);case 4:return wo(oo(e),oo(t));case 5:return Tr(e.stringValue,t.stringValue);case 6:return function(e,t){const n=eo(e),i=eo(t);return n.compareTo(i)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),i=t.split("/");for(let s=0;s<n.length&&s<i.length;s++){const e=Er(n[s],i[s]);if(0!==e)return e}return Er(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Er(Za(e.latitude),Za(t.latitude));return 0!==n?n:Er(Za(e.longitude),Za(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return _o(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},i=t.fields||{},s=n[fo]?.arrayValue,r=i[fo]?.arrayValue,a=Er(s?.values?.length||0,r?.values?.length||0);return 0!==a?a:_o(s,r)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===mo.mapValue&&t===mo.mapValue)return 0;if(e===mo.mapValue)return 1;if(t===mo.mapValue)return-1;const n=e.fields||{},i=Object.keys(n),s=t.fields||{},r=Object.keys(s);i.sort(),r.sort();for(let a=0;a<i.length&&a<r.length;++a){const e=Tr(i[a],r[a]);if(0!==e)return e;const t=xo(n[i[a]],s[r[a]]);if(0!==t)return t}return Er(i.length,r.length)}(e.mapValue,t.mapValue);default:throw cr(23264,{he:n})}}function wo(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Er(e,t);const n=Ja(e),i=Ja(t),s=Er(n.seconds,i.seconds);return 0!==s?s:Er(n.nanos,i.nanos)}function _o(e,t){const n=e.values||[],i=t.values||[];for(let s=0;s<n.length&&s<i.length;++s){const e=xo(n[s],i[s]);if(e)return e}return Er(n.length,i.length)}function So(e){return Co(e)}function Co(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Ja(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return eo(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return Or.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const i of e.values||[])n?n=!1:t+=",",t+=Co(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",i=!0;for(const s of t)i?i=!1:n+=",",n+=`${s}:${Co(e.fields[s])}`;return n+"}"}(e.mapValue):cr(61005,{value:e})}function Ao(e){switch(yo(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=ao(e);return t?16+Ao(t):16;case 5:return 2*e.stringValue.length;case 6:return eo(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce((e,t)=>e+Ao(t),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return za(e.fields,(e,n)=>{t+=e.length+Ao(n)}),t}(e.mapValue);default:throw cr(13486,{value:e})}}function Eo(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function To(e){return!!e&&"integerValue"in e}function ko(e){return!!e&&"arrayValue"in e}function No(e){return!!e&&"nullValue"in e}function Io(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Do(e){return!!e&&"mapValue"in e}function Po(e){const t=(e?.mapValue?.fields||{})[ho]?.stringValue;return t===go}function Mo(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){const t={mapValue:{fields:{}}};return za(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Mo(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Mo(e.arrayValue.values[n]);return t}return{...e}}function Ro(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===po}class Lo{constructor(e){this.value=e}static empty(){return new Lo({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Do(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Mo(t)}setAll(e){let t=jr.emptyPath(),n={},i=[];e.forEach((e,s)=>{if(!t.isImmediateParentOf(s)){const e=this.getFieldsMap(t);this.applyChanges(e,n,i),n={},i=[],t=s.popLast()}e?n[s.lastSegment()]=Mo(e):i.push(s.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());Do(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return vo(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Do(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){za(t,(t,n)=>e[t]=n);for(const i of n)delete e[i]}clone(){return new Lo(Mo(this.value))}}function jo(e){const t=[];return za(e.fields,(e,n)=>{const i=new jr([e]);if(Do(n)){const e=jo(n.mapValue).fields;if(0===e.length)t.push(i);else for(const n of e)t.push(i.child(n))}else t.push(i)}),new Ka(t)}class Oo{constructor(e,t,n,i,s,r,a){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=r,this.documentState=a}static newInvalidDocument(e){return new Oo(e,0,Qr.min(),Qr.min(),Qr.min(),Lo.empty(),0)}static newFoundDocument(e,t,n,i){return new Oo(e,1,t,Qr.min(),n,i,0)}static newNoDocument(e,t){return new Oo(e,2,t,Qr.min(),Qr.min(),Lo.empty(),0)}static newUnknownDocument(e,t){return new Oo(e,3,t,Qr.min(),Qr.min(),Lo.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Qr.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Lo.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Lo.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Qr.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Oo&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Oo(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Fo{constructor(e,t){this.position=e,this.inclusive=t}}function Bo(e,t,n){let i=0;for(let s=0;s<e.position.length;s++){const r=t[s],a=e.position[s];if(i=r.field.isKeyField()?Or.comparator(Or.fromName(a.referenceValue),n.key):xo(a,n.data.field(r.field)),"desc"===r.dir&&(i*=-1),0!==i)break}return i}function Uo(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!vo(e.position[n],t.position[n]))return!1;return!0}class zo{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=e,this.dir=t}}function Vo(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Ho{}class $o extends Ho{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Jo(e,t,n):"array-contains"===t?new nl(e,n):"in"===t?new il(e,n):"not-in"===t?new sl(e,n):"array-contains-any"===t?new rl(e,n):new $o(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Zo(e,n):new el(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(xo(t,this.value)):null!==t&&yo(this.value)===yo(t)&&this.matchesComparison(xo(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return cr(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class qo extends Ho{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new qo(e,t)}matches(e){return Go(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Go(e){return"and"===e.op}function Wo(e){return Ko(e)&&Go(e)}function Ko(e){for(const t of e.filters)if(t instanceof qo)return!1;return!0}function Qo(e){if(e instanceof $o)return e.field.canonicalString()+e.op.toString()+So(e.value);if(Wo(e))return e.filters.map(e=>Qo(e)).join(",");{const t=e.filters.map(e=>Qo(e)).join(",");return`${e.op}(${t})`}}function Xo(e,t){return e instanceof $o?function(e,t){return t instanceof $o&&e.op===t.op&&e.field.isEqual(t.field)&&vo(e.value,t.value)}(e,t):e instanceof qo?function(e,t){return t instanceof qo&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,i)=>e&&Xo(n,t.filters[i]),!0)}(e,t):void cr(19439)}function Yo(e){return e instanceof $o?function(e){return`${e.field.canonicalString()} ${e.op} ${So(e.value)}`}(e):e instanceof qo?function(e){return e.op.toString()+" {"+e.getFilters().map(Yo).join(" ,")+"}"}(e):"Filter"}class Jo extends $o{constructor(e,t,n){super(e,t,n),this.key=Or.fromName(n.referenceValue)}matches(e){const t=Or.comparator(e.key,this.key);return this.matchesComparison(t)}}class Zo extends $o{constructor(e,t){super(e,"in",t),this.keys=tl("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class el extends $o{constructor(e,t){super(e,"not-in",t),this.keys=tl("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function tl(e,t){return(t.arrayValue?.values||[]).map(e=>Or.fromName(e.referenceValue))}class nl extends $o{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ko(t)&&bo(t.arrayValue,this.value)}}class il extends $o{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&bo(this.value.arrayValue,t)}}class sl extends $o{constructor(e,t){super(e,"not-in",t)}matches(e){if(bo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!bo(this.value.arrayValue,t)}}class rl extends $o{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ko(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>bo(this.value.arrayValue,e))}}class al{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=r,this.endAt=a,this.Te=null}}function ol(e){return new al(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function ll(e){const t=hr(e);if(null===t.Te){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>Qo(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),da(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>So(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>So(e)).join(",")),t.Te=e}return t.Te}function cl(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Vo(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Xo(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Uo(e.startAt,t.startAt)&&Uo(e.endAt,t.endAt)}function dl(e){return Or.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class ul{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=r,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function hl(e,t,n,i,s,r,a,o){return new ul(e,t,n,i,s,r,a,o)}function pl(e){return new ul(e)}function ml(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function gl(e){return null!==e.collectionGroup}function fl(e){const t=hr(e);if(null===t.Ie){t.Ie=[];const e=new Set;for(const s of t.explicitOrderBy)t.Ie.push(s),e.add(s.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",i=function(e){let t=new Ga(jr.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);i.forEach(i=>{e.has(i.canonicalString())||i.isKeyField()||t.Ie.push(new zo(i,n))}),e.has(jr.keyField().canonicalString())||t.Ie.push(new zo(jr.keyField(),n))}return t.Ie}function yl(e){const t=hr(e);return t.Ee||(t.Ee=vl(t,fl(e))),t.Ee}function vl(e,t){if("F"===e.limitType)return ol(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new zo(e.field,t)});const n=e.endAt?new Fo(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new Fo(e.startAt.position,e.startAt.inclusive):null;return ol(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}}function bl(e,t){const n=e.filters.concat([t]);return new ul(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function xl(e,t,n){return new ul(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function wl(e,t){return cl(yl(e),yl(t))&&e.limitType===t.limitType}function _l(e){return`${ll(yl(e))}|lt:${e.limitType}`}function Sl(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>Yo(e)).join(", ")}]`),da(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>So(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>So(e)).join(",")),`Target(${t})`}(yl(e))}; limitType=${e.limitType})`}function Cl(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Or.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of fl(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const i=Bo(e,t,n);return e.inclusive?i<=0:i<0}(e.startAt,fl(e),t))&&!(e.endAt&&!function(e,t,n){const i=Bo(e,t,n);return e.inclusive?i>=0:i>0}(e.endAt,fl(e),t))}(e,t)}function Al(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function El(e){return(t,n)=>{let i=!1;for(const s of fl(e)){const e=Tl(s,t,n);if(0!==e)return e;i=i||s.field.isKeyField()}return 0}}function Tl(e,t,n){const i=e.field.isKeyField()?Or.comparator(t.key,n.key):function(e,t,n){const i=t.data.field(e),s=n.data.field(e);return null!==i&&null!==s?xo(i,s):cr(42886)}(e.field,t,n);switch(e.dir){case"asc":return i;case"desc":return-1*i;default:return cr(19790,{direction:e.dir})}}class kl{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,s]of n)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){za(this.inner,(t,n)=>{for(const[i,s]of n)e(i,s)})}isEmpty(){return Va(this.inner)}size(){return this.innerSize}}const Nl=new Ha(Or.comparator);function Il(){return Nl}const Dl=new Ha(Or.comparator);function Pl(){let e=Dl;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(const s of n)e=e.insert(s.key,s);return e}function Ml(e){let t=Dl;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function Rl(){return jl()}function Ll(){return jl()}function jl(){return new kl(e=>e.toString(),(e,t)=>e.isEqual(t))}const Ol=new Ha(Or.comparator),Fl=new Ga(Or.comparator);function Bl(){let e=Fl;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(const s of n)e=e.add(s);return e}const Ul=new Ga(Er);function zl(){return Ul}function Vl(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ua(t)?"-0":t}}function Hl(e){return{integerValue:""+e}}function $l(e,t){return ha(t)?Hl(t):Vl(e,t)}class ql{constructor(){this._=void 0}}function Gl(e,t,n){return e instanceof Ql?function(e,t){const n={fields:{[no]:{stringValue:to},[so]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&ro(t)&&(t=ao(t)),t&&(n.fields[io]=t),{mapValue:n}}(n,t):e instanceof Xl?Yl(e,t):e instanceof Jl?Zl(e,t):function(e,t){const n=Kl(e,t),i=tc(n)+tc(e.Ae);return To(n)&&To(e.Ae)?Hl(i):Vl(e.serializer,i)}(e,t)}function Wl(e,t,n){return e instanceof Xl?Yl(e,t):e instanceof Jl?Zl(e,t):n}function Kl(e,t){return e instanceof ec?function(e){return To(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class Ql extends ql{}class Xl extends ql{constructor(e){super(),this.elements=e}}function Yl(e,t){const n=nc(t);for(const i of e.elements)n.some(e=>vo(e,i))||n.push(i);return{arrayValue:{values:n}}}class Jl extends ql{constructor(e){super(),this.elements=e}}function Zl(e,t){let n=nc(t);for(const i of e.elements)n=n.filter(e=>!vo(e,i));return{arrayValue:{values:n}}}class ec extends ql{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function tc(e){return Za(e.integerValue||e.doubleValue)}function nc(e){return ko(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class ic{constructor(e,t){this.field=e,this.transform=t}}class sc{constructor(e,t){this.version=e,this.transformResults=t}}class rc{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new rc}static exists(e){return new rc(void 0,e)}static updateTime(e){return new rc(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ac(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class oc{}function lc(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new vc(e.key,rc.none()):new pc(e.key,e.data,rc.none());{const n=e.data,i=Lo.empty();let s=new Ga(jr.comparator);for(let e of t.fields)if(!s.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?i.delete(e):i.set(e,t),s=s.add(e)}return new mc(e.key,i,new Ka(s.toArray()),rc.none())}}function cc(e,t,n){e instanceof pc?function(e,t,n){const i=e.value.clone(),s=fc(e.fieldTransforms,t,n.transformResults);i.setAll(s),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):e instanceof mc?function(e,t,n){if(!ac(e.precondition,t))return void t.convertToUnknownDocument(n.version);const i=fc(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(gc(e)),s.setAll(i),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function dc(e,t,n,i){return e instanceof pc?function(e,t,n,i){if(!ac(e.precondition,t))return n;const s=e.value.clone(),r=yc(e.fieldTransforms,i,t);return s.setAll(r),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null}(e,t,n,i):e instanceof mc?function(e,t,n,i){if(!ac(e.precondition,t))return n;const s=yc(e.fieldTransforms,i,t),r=t.data;return r.setAll(gc(e)),r.setAll(s),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,i):function(e,t,n){return ac(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function uc(e,t){let n=null;for(const i of e.fieldTransforms){const e=t.data.field(i.field),s=Kl(i.transform,e||null);null!=s&&(null===n&&(n=Lo.empty()),n.set(i.field,s))}return n||null}function hc(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Dr(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Xl&&t instanceof Xl||e instanceof Jl&&t instanceof Jl?Dr(e.elements,t.elements,vo):e instanceof ec&&t instanceof ec?vo(e.Ae,t.Ae):e instanceof Ql&&t instanceof Ql}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class pc extends oc{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class mc extends oc{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function gc(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const i=e.data.field(n);t.set(n,i)}}),t}function fc(e,t,n){const i=new Map;ur(e.length===n.length,32656,{Ve:n.length,de:e.length});for(let s=0;s<n.length;s++){const r=e[s],a=r.transform,o=t.data.field(r.field);i.set(r.field,Wl(a,o,n[s]))}return i}function yc(e,t,n){const i=new Map;for(const s of e){const e=s.transform,r=n.data.field(s.field);i.set(s.field,Gl(e,r,t))}return i}class vc extends oc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class bc extends oc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class xc{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const t=this.mutations[i];t.key.isEqual(e.key)&&cc(t,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=dc(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=dc(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Ll();return this.mutations.forEach(i=>{const s=e.get(i.key),r=s.overlayedDocument;let a=this.applyToLocalView(r,s.mutatedFields);a=t.has(i.key)?null:a;const o=lc(r,a);null!==o&&n.set(i.key,o),r.isValidDocument()||r.convertToNoDocument(Qr.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Bl())}isEqual(e){return this.batchId===e.batchId&&Dr(this.mutations,e.mutations,(e,t)=>hc(e,t))&&Dr(this.baseMutations,e.baseMutations,(e,t)=>hc(e,t))}}class wc{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){ur(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let i=Ol;const s=e.mutations;for(let r=0;r<s.length;r++)i=i.insert(s[r].key,n[r].version);return new wc(e,t,n,i)}}class _c{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Sc{constructor(e,t){this.count=e,this.unchangedNames=t}}var Cc,Ac;function Ec(e){switch(e){case pr.OK:return cr(64938);case pr.CANCELLED:case pr.UNKNOWN:case pr.DEADLINE_EXCEEDED:case pr.RESOURCE_EXHAUSTED:case pr.INTERNAL:case pr.UNAVAILABLE:case pr.UNAUTHENTICATED:return!1;case pr.INVALID_ARGUMENT:case pr.NOT_FOUND:case pr.ALREADY_EXISTS:case pr.PERMISSION_DENIED:case pr.FAILED_PRECONDITION:case pr.ABORTED:case pr.OUT_OF_RANGE:case pr.UNIMPLEMENTED:case pr.DATA_LOSS:return!0;default:return cr(15467,{code:e})}}function Tc(e){if(void 0===e)return ar("GRPC error has no .code"),pr.UNKNOWN;switch(e){case Cc.OK:return pr.OK;case Cc.CANCELLED:return pr.CANCELLED;case Cc.UNKNOWN:return pr.UNKNOWN;case Cc.DEADLINE_EXCEEDED:return pr.DEADLINE_EXCEEDED;case Cc.RESOURCE_EXHAUSTED:return pr.RESOURCE_EXHAUSTED;case Cc.INTERNAL:return pr.INTERNAL;case Cc.UNAVAILABLE:return pr.UNAVAILABLE;case Cc.UNAUTHENTICATED:return pr.UNAUTHENTICATED;case Cc.INVALID_ARGUMENT:return pr.INVALID_ARGUMENT;case Cc.NOT_FOUND:return pr.NOT_FOUND;case Cc.ALREADY_EXISTS:return pr.ALREADY_EXISTS;case Cc.PERMISSION_DENIED:return pr.PERMISSION_DENIED;case Cc.FAILED_PRECONDITION:return pr.FAILED_PRECONDITION;case Cc.ABORTED:return pr.ABORTED;case Cc.OUT_OF_RANGE:return pr.OUT_OF_RANGE;case Cc.UNIMPLEMENTED:return pr.UNIMPLEMENTED;case Cc.DATA_LOSS:return pr.DATA_LOSS;default:return cr(39323,{code:e})}}(Ac=Cc||(Cc={}))[Ac.OK=0]="OK",Ac[Ac.CANCELLED=1]="CANCELLED",Ac[Ac.UNKNOWN=2]="UNKNOWN",Ac[Ac.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ac[Ac.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ac[Ac.NOT_FOUND=5]="NOT_FOUND",Ac[Ac.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ac[Ac.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ac[Ac.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ac[Ac.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ac[Ac.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ac[Ac.ABORTED=10]="ABORTED",Ac[Ac.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ac[Ac.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ac[Ac.INTERNAL=13]="INTERNAL",Ac[Ac.UNAVAILABLE=14]="UNAVAILABLE",Ac[Ac.DATA_LOSS=15]="DATA_LOSS";let kc=null;function Nc(){return new TextEncoder}const Ic=new zs([4294967295,4294967295],0);function Dc(e){const t=Nc().encode(e),n=new Vs;return n.update(t),new Uint8Array(n.digest())}function Pc(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),i=t.getUint32(4,!0),s=t.getUint32(8,!0),r=t.getUint32(12,!0);return[new zs([n,i],0),new zs([s,r],0)]}class Mc{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Rc(`Invalid padding: ${t}`);if(n<0)throw new Rc(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Rc(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Rc(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=zs.fromNumber(this.ge)}ye(e,t,n){let i=e.add(t.multiply(zs.fromNumber(n)));return 1===i.compare(Ic)&&(i=new zs([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;const t=Dc(e),[n,i]=Pc(t);for(let s=0;s<this.hashCount;s++){const e=this.ye(n,i,s);if(!this.we(e))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),r=new Mc(s,i,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.ge)return;const t=Dc(e),[n,i]=Pc(t);for(let s=0;s<this.hashCount;s++){const e=this.ye(n,i,s);this.be(e)}}be(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Rc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Lc{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,jc.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Lc(Qr.min(),i,new Ha(Er),Il(),Bl())}}class jc{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new jc(n,t,Bl(),Bl(),Bl())}}class Oc{constructor(e,t,n,i){this.Se=e,this.removedTargetIds=t,this.key=n,this.De=i}}class Fc{constructor(e,t){this.targetId=e,this.Ce=t}}class Bc{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Xa.EMPTY_BYTE_STRING,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class Uc{constructor(){this.ve=0,this.Fe=Hc(),this.Me=Xa.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Bl(),t=Bl(),n=Bl();return this.Fe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:cr(38017,{changeType:s})}}),new jc(this.Me,this.xe,e,t,n)}Ke(){this.Oe=!1,this.Fe=Hc()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,ur(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class zc{constructor(e){this.Ge=e,this.ze=new Map,this.je=Il(),this.He=Vc(),this.Je=Vc(),this.Ze=new Ha(Er)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.We(),n.Ne||n.Ke(),n.Le(e.resumeToken);break;case 2:n.We(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.Qe(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:cr(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){const t=e.targetId,n=e.Ce.count,i=this.ot(t);if(i){const s=i.target;if(dl(s))if(0===n){const e=new Or(s.path);this.et(t,e,Oo.newNoDocument(e,Qr.min()))}else ur(1===n,20013,{expectedCount:n});else{const i=this._t(t);if(i!==n){const n=this.ut(e),s=n?this.ct(n,e,i):1;if(0!==s){this.it(t);const e=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,e)}kc?.lt(function(e,t,n,i,s){const r={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},a=t.unchangedNames;return a&&(r.bloomFilter={applied:0===s,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>i?.mightContain(e)??!1}),r}(i,e.Ce,this.Ge.ht(),n,s))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t;let r,a;try{r=eo(n).toUint8Array()}catch(e){if(e instanceof Qa)return or("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{a=new Mc(r,i,s)}catch(e){return or(e instanceof Rc?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===a.ge?null:a}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let i=0;return n.forEach(n=>{const s=this.Ge.ht(),r=`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`;e.mightContain(r)||(this.et(t,n,null),i++)}),i}Tt(e){const t=new Map;this.ze.forEach((n,i)=>{const s=this.ot(i);if(s){if(n.current&&dl(s.target)){const t=new Or(s.target.path);this.It(t).has(i)||this.Et(i,t)||this.et(i,t,Oo.newNoDocument(t,e))}n.Be&&(t.set(i,n.ke()),n.Ke())}});let n=Bl();this.Je.forEach((e,t)=>{let i=!0;t.forEachWhile(e=>{const t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(i=!1,!1)}),i&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));const i=new Lc(e,t,this.Ze,this.je,n);return this.je=Il(),this.He=Vc(),this.Je=Vc(),this.Ze=new Ha(Er),i}Ye(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,n),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,t)?i.qe(t,1):i.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new Uc,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new Ga(Er),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new Ga(Er),this.He=this.He.insert(e,t)),t}rt(e){const t=null!==this.ot(e);return t||rr("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Uc),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Vc(){return new Ha(Or.comparator)}function Hc(){return new Ha(Or.comparator)}const $c={asc:"ASCENDING",desc:"DESCENDING"},qc={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Gc={and:"AND",or:"OR"};class Wc{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Kc(e,t){return e.useProto3Json||da(t)?t:{value:t}}function Qc(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Xc(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Yc(e,t){return Qc(e,t.toTimestamp())}function Jc(e){return ur(!!e,49232),Qr.fromTimestamp(function(e){const t=Ja(e);return new Kr(t.seconds,t.nanos)}(e))}function Zc(e,t){return ed(e,t).canonicalString()}function ed(e,t){const n=function(e){return new Rr(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function td(e){const t=Rr.fromString(e);return ur(wd(t),10190,{key:t.toString()}),t}function nd(e,t){return Zc(e.databaseId,t.path)}function id(e,t){const n=td(t);if(n.get(1)!==e.databaseId.projectId)throw new mr(pr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new mr(pr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Or(od(n))}function sd(e,t){return Zc(e.databaseId,t)}function rd(e){const t=td(e);return 4===t.length?Rr.emptyPath():od(t)}function ad(e){return new Rr(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function od(e){return ur(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function ld(e,t,n){return{name:nd(e,t),fields:n.value.mapValue.fields}}function cd(e,t){let n;if(t instanceof pc)n={update:ld(e,t.key,t.value)};else if(t instanceof vc)n={delete:nd(e,t.key)};else if(t instanceof mc)n={update:ld(e,t.key,t.data),updateMask:xd(t.fieldMask)};else{if(!(t instanceof bc))return cr(16599,{dt:t.type});n={verify:nd(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof Ql)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Xl)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Jl)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof ec)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw cr(20930,{transform:t.transform})}(0,e))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Yc(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:cr(27497)}(e,t.precondition)),n}function dd(e,t){return{documents:[sd(e,t.path)]}}function ud(e,t){const n={structuredQuery:{}},i=t.path;let s;null!==t.collectionGroup?(s=i,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=i.popLast(),n.structuredQuery.from=[{collectionId:i.lastSegment()}]),n.parent=sd(e,s);const r=function(e){if(0!==e.length)return bd(qo.create(e,"and"))}(t.filters);r&&(n.structuredQuery.where=r);const a=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:yd(e.field),direction:md(e.dir)}}(e))}(t.orderBy);a&&(n.structuredQuery.orderBy=a);const o=Kc(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ft:n,parent:s}}function hd(e){let t=rd(e.parent);const n=e.structuredQuery,i=n.from?n.from.length:0;let s=null;if(i>0){ur(1===i,65062);const e=n.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let r=[];n.where&&(r=function(e){const t=pd(e);return t instanceof qo&&Wo(t)?t.getFilters():[t]}(n.where));let a=[];n.orderBy&&(a=function(e){return e.map(e=>function(e){return new zo(vd(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(n.orderBy));let o=null;n.limit&&(o=function(e){let t;return t="object"==typeof e?e.value:e,da(t)?null:t}(n.limit));let l=null;n.startAt&&(l=function(e){const t=!!e.before,n=e.values||[];return new Fo(n,t)}(n.startAt));let c=null;return n.endAt&&(c=function(e){const t=!e.before,n=e.values||[];return new Fo(n,t)}(n.endAt)),hl(t,s,a,r,o,"F",l,c)}function pd(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=vd(e.unaryFilter.field);return $o.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=vd(e.unaryFilter.field);return $o.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=vd(e.unaryFilter.field);return $o.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=vd(e.unaryFilter.field);return $o.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return cr(61313);default:return cr(60726)}}(e):void 0!==e.fieldFilter?function(e){return $o.create(vd(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return cr(58110);default:return cr(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return qo.create(e.compositeFilter.filters.map(e=>pd(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return cr(1026)}}(e.compositeFilter.op))}(e):cr(30097,{filter:e})}function md(e){return $c[e]}function gd(e){return qc[e]}function fd(e){return Gc[e]}function yd(e){return{fieldPath:e.canonicalString()}}function vd(e){return jr.fromServerFormat(e.fieldPath)}function bd(e){return e instanceof $o?function(e){if("=="===e.op){if(Io(e.value))return{unaryFilter:{field:yd(e.field),op:"IS_NAN"}};if(No(e.value))return{unaryFilter:{field:yd(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Io(e.value))return{unaryFilter:{field:yd(e.field),op:"IS_NOT_NAN"}};if(No(e.value))return{unaryFilter:{field:yd(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:yd(e.field),op:gd(e.op),value:e.value}}}(e):e instanceof qo?function(e){const t=e.getFilters().map(e=>bd(e));return 1===t.length?t[0]:{compositeFilter:{op:fd(e.op),filters:t}}}(e):cr(54877,{filter:e})}function xd(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function wd(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function _d(e){return!!e&&"function"==typeof e._toProto&&"ProtoValue"===e._protoValueType}class Sd{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Qr.min(),r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Qr.min(),a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Xa.EMPTY_BYTE_STRING,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new Sd(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Sd(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Sd(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Sd(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Cd{constructor(e){this.yt=e}}function Ad(e){const t=hd({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?xl(t,t.limit,"L"):t}class Ed{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Za(e.integerValue));else if("doubleValue"in e){const n=Za(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),ua(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=Ja(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(eo(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?Ro(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Po(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Nt(t)):cr(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){const n=e.fields||{};this.Ft(t,55);for(const i of Object.keys(n))this.Ot(i,t),this.Ct(n[i],t)}kt(e,t){const n=e.fields||{};this.Ft(t,53);const i=fo,s=n[i].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(Za(s)),this.Ot(i,t),this.Ct(n[i],t)}qt(e,t){const n=e.values||[];this.Ft(t,50);for(const i of n)this.Ct(i,t)}Lt(e,t){this.Ft(t,37),Or.fromName(e).path.forEach(e=>{this.Ft(t,60),this.$t(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}Ed.Wt=new Ed;class Td{constructor(){this.Sn=new kd}addToCollectionParentIndex(e,t){return this.Sn.add(t),ra.resolve()}getCollectionParents(e,t){return ra.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return ra.resolve()}deleteFieldIndex(e,t){return ra.resolve()}deleteAllFieldIndexes(e){return ra.resolve()}createTargetIndexes(e,t){return ra.resolve()}getDocumentsMatchingTarget(e,t){return ra.resolve(null)}getIndexType(e,t){return ra.resolve(0)}getFieldIndexes(e,t){return ra.resolve([])}getNextCollectionGroupToUpdate(e){return ra.resolve(null)}getMinOffset(e,t){return ra.resolve(ea.min())}getMinOffsetFromCollectionGroup(e,t){return ra.resolve(ea.min())}updateCollectionGroup(e,t,n){return ra.resolve()}updateIndexEntries(e,t){return ra.resolve()}}class kd{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new Ga(Rr.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new Ga(Rr.comparator)).toArray()}}new Uint8Array(0);const Nd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Id=41943040;class Dd{static withCacheSize(e){return new Dd(e,Dd.DEFAULT_COLLECTION_PERCENTILE,Dd.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}Dd.DEFAULT_COLLECTION_PERCENTILE=10,Dd.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Dd.DEFAULT=new Dd(Id,Dd.DEFAULT_COLLECTION_PERCENTILE,Dd.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Dd.DISABLED=new Dd(-1,0,0);class Pd{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new Pd(0)}static ar(){return new Pd(-1)}}const Md="LruGarbageCollector",Rd=1048576;function Ld(e,t){let[n,i]=e,[s,r]=t;const a=Er(n,s);return 0===a?Er(i,r):a}class jd{constructor(e){this.Pr=e,this.buffer=new Ga(Ld),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Ld(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Od{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Ar(e){rr(Md,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){oa(e)?rr(Md,"Ignoring IndexedDB error during garbage collection: ",e):await sa(e)}await this.Ar(3e5)})}}class Fd{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return ra.resolve(la.ce);const n=new jd(t);return this.Vr.forEachTarget(e,e=>n.Er(e.sequenceNumber)).next(()=>this.Vr.mr(e,e=>n.Er(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Vr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(rr("LruGarbageCollector","Garbage collection skipped; disabled"),ra.resolve(Nd)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(rr("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Nd):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let n,i,s,r,a,o,l;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(rr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),i=this.params.maximumSequenceNumbersToCollect):i=t,r=Date.now(),this.nthSequenceNumber(e,i))).next(i=>(n=i,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(s=t,o=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),sr()<=H.DEBUG&&rr("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${r-c}ms\n\tDetermined least recently used ${i} in `+(a-r)+"ms\n"+`\tRemoved ${s} targets in `+(o-a)+"ms\n"+`\tRemoved ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-c}ms`),ra.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e})))}}function Bd(e,t){return new Fd(e,t)}class Ud{constructor(){this.changes=new kl(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Oo.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?ra.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class zd{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Vd{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&dc(n.mutation,e,Ka.empty(),Kr.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,Bl()).next(()=>t))}getLocalViewOfDocuments(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Bl();const i=Rl();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(e=>{let t=Pl();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=Rl();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Bl()))}populateOverlays(e,t,n){const i=[];return n.forEach(e=>{t.has(e)||i.push(e)}),this.documentOverlayCache.getOverlays(e,i).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,i){let s=Il();const r=jl(),a=jl();return t.forEach((e,t)=>{const a=n.get(t.key);i.has(t.key)&&(void 0===a||a.mutation instanceof mc)?s=s.insert(t.key,t):void 0!==a?(r.set(t.key,a.mutation.getFieldMask()),dc(a.mutation,t,a.mutation.getFieldMask(),Kr.now())):r.set(t.key,Ka.empty())}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>r.set(e,t)),t.forEach((e,t)=>a.set(e,new zd(t,r.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){const n=jl();let i=new Ha((e,t)=>e-t),s=Bl();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const s of e)s.keys().forEach(e=>{const r=t.get(e);if(null===r)return;let a=n.get(e)||Ka.empty();a=s.applyToLocalView(r,a),n.set(e,a);const o=(i.get(s.batchId)||Bl()).add(e);i=i.insert(s.batchId,o)})}).next(()=>{const r=[],a=i.getReverseIterator();for(;a.hasNext();){const i=a.getNext(),o=i.key,l=i.value,c=Ll();l.forEach(e=>{if(!s.has(e)){const i=lc(t.get(e),n.get(e));null!==i&&c.set(e,i),s=s.add(e)}}),r.push(this.documentOverlayCache.saveOverlays(e,o,c))}return ra.waitFor(r)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,i){return function(e){return Or.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):gl(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{const r=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):ra.resolve(Rl());let a=Xr,o=s;return r.next(t=>ra.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),s.get(t)?ra.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,s)).next(()=>this.computeViews(e,o,t,Bl())).next(e=>({batchId:a,changes:Ml(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Or(t)).next(e=>{let t=Pl();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const s=t.collectionGroup;let r=Pl();return this.indexManager.getCollectionParents(e,s).next(a=>ra.forEach(a,a=>{const o=function(e,t){return new ul(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,a.child(s));return this.getDocumentsMatchingCollectionQuery(e,o,n,i).next(e=>{e.forEach((e,t)=>{r=r.insert(e,t)})})}).next(()=>r))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(r=>(s=r,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(e=>{s.forEach((t,n)=>{const i=n.getKey();null===e.get(i)&&(e=e.insert(i,Oo.newInvalidDocument(i)))});let n=Pl();return e.forEach((e,i)=>{const r=s.get(e);void 0!==r&&dc(r.mutation,i,Ka.empty(),Kr.now()),Cl(t,i)&&(n=n.insert(e,i))}),n})}}class Hd{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return ra.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Jc(e.createTime)}}(t)),ra.resolve()}getNamedQuery(e,t){return ra.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,function(e){return{name:e.name,query:Ad(e.bundledQuery),readTime:Jc(e.readTime)}}(t)),ra.resolve()}}class $d{constructor(){this.overlays=new Ha(Or.comparator),this.Lr=new Map}getOverlay(e,t){return ra.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Rl();return ra.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,i)=>{this.bt(e,t,i)}),ra.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.Lr.get(n);return void 0!==i&&(i.forEach(e=>this.overlays=this.overlays.remove(e)),this.Lr.delete(n)),ra.resolve()}getOverlaysForCollection(e,t,n){const i=Rl(),s=t.length+1,r=new Or(t.child("")),a=this.overlays.getIteratorFrom(r);for(;a.hasNext();){const e=a.getNext().value,r=e.getKey();if(!t.isPrefixOf(r.path))break;r.path.length===s&&e.largestBatchId>n&&i.set(e.getKey(),e)}return ra.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new Ha((e,t)=>e-t);const r=this.overlays.getIterator();for(;r.hasNext();){const e=r.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=s.get(e.largestBatchId);null===t&&(t=Rl(),s=s.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const a=Rl(),o=s.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=i)););return ra.resolve(a)}bt(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const e=this.Lr.get(i.largestBatchId).delete(n.key);this.Lr.set(i.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new _c(t,n));let s=this.Lr.get(t);void 0===s&&(s=Bl(),this.Lr.set(t,s)),this.Lr.set(t,s.add(n.key))}}class qd{constructor(){this.sessionToken=Xa.EMPTY_BYTE_STRING}getSessionToken(e){return ra.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ra.resolve()}}class Gd{constructor(){this.kr=new Ga(Wd.Kr),this.qr=new Ga(Wd.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const n=new Wd(e,t);this.kr=this.kr.add(n),this.qr=this.qr.add(n)}$r(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new Wd(e,t))}Qr(e,t){e.forEach(e=>this.removeReference(e,t))}Gr(e){const t=new Or(new Rr([])),n=new Wd(t,e),i=new Wd(t,e+1),s=[];return this.qr.forEachInRange([n,i],e=>{this.Wr(e),s.push(e.key)}),s}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new Or(new Rr([])),n=new Wd(t,e),i=new Wd(t,e+1);let s=Bl();return this.qr.forEachInRange([n,i],e=>{s=s.add(e.key)}),s}containsKey(e){const t=new Wd(e,0),n=this.kr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Wd{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return Or.comparator(e.key,t.key)||Er(e.Hr,t.Hr)}static Ur(e,t){return Er(e.Hr,t.Hr)||Or.comparator(e.key,t.key)}}class Kd{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new Ga(Wd.Kr)}checkEmpty(e){return ra.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const s=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new xc(s,t,n,i);this.mutationQueue.push(r);for(const a of i)this.Jr=this.Jr.add(new Wd(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return ra.resolve(r)}lookupMutationBatch(e,t){return ra.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=this.Xr(n),s=i<0?0:i;return ra.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return ra.resolve(0===this.mutationQueue.length?ca:this.Yn-1)}getAllMutationBatches(e){return ra.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Wd(t,0),i=new Wd(t,Number.POSITIVE_INFINITY),s=[];return this.Jr.forEachInRange([n,i],e=>{const t=this.Zr(e.Hr);s.push(t)}),ra.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ga(Er);return t.forEach(e=>{const t=new Wd(e,0),i=new Wd(e,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([t,i],e=>{n=n.add(e.Hr)})}),ra.resolve(this.Yr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;Or.isDocumentKey(s)||(s=s.child(""));const r=new Wd(new Or(s),0);let a=new Ga(Er);return this.Jr.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(a=a.add(e.Hr)),!0)},r),ra.resolve(this.Yr(a))}Yr(e){const t=[];return e.forEach(e=>{const n=this.Zr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){ur(0===this.ei(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Jr;return ra.forEach(t.mutations,i=>{const s=new Wd(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Jr=n})}nr(e){}containsKey(e,t){const n=new Wd(t,0),i=this.Jr.firstAfterOrEqual(n);return ra.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,ra.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Qd{constructor(e){this.ti=e,this.docs=new Ha(Or.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,r=this.ti(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:r}),this.size+=r-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return ra.resolve(n?n.document.mutableCopy():Oo.newInvalidDocument(t))}getEntries(e,t){let n=Il();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Oo.newInvalidDocument(e))}),ra.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=Il();const r=t.path,a=new Or(r.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!r.isPrefixOf(e.path))break;e.path.length>r.length+1||ta(Zr(a),n)<=0||(i.has(a.key)||Cl(t,a))&&(s=s.insert(a.key,a.mutableCopy()))}return ra.resolve(s)}getAllFromCollectionGroup(e,t,n,i){cr(9500)}ni(e,t){return ra.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new Xd(this)}getSize(e){return ra.resolve(this.size)}}class Xd extends Ud{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.Mr.addEntry(e,i)):this.Mr.removeEntry(n)}),ra.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class Yd{constructor(e){this.persistence=e,this.ri=new kl(e=>ll(e),cl),this.lastRemoteSnapshotVersion=Qr.min(),this.highestTargetId=0,this.ii=0,this.si=new Gd,this.targetCount=0,this.oi=Pd._r()}forEachTarget(e,t){return this.ri.forEach((e,n)=>t(n)),ra.resolve()}getLastRemoteSnapshotVersion(e){return ra.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ra.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),ra.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.ii&&(this.ii=t),ra.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new Pd(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,ra.resolve()}updateTargetData(e,t){return this.lr(t),ra.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,ra.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.ri.forEach((r,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.ri.delete(r),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),ra.waitFor(s).next(()=>i)}getTargetCount(e){return ra.resolve(this.targetCount)}getTargetData(e,t){const n=this.ri.get(t)||null;return ra.resolve(n)}addMatchingKeys(e,t,n){return this.si.$r(t,n),ra.resolve()}removeMatchingKeys(e,t,n){this.si.Qr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(t=>{s.push(i.markPotentiallyOrphaned(e,t))}),ra.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),ra.resolve()}getMatchingKeysForTargetId(e,t){const n=this.si.jr(t);return ra.resolve(n)}containsKey(e,t){return ra.resolve(this.si.containsKey(t))}}class Jd{constructor(e,t){this._i={},this.overlays={},this.ai=new la(0),this.ui=!1,this.ui=!0,this.ci=new qd,this.referenceDelegate=e(this),this.li=new Yd(this),this.indexManager=new Td,this.remoteDocumentCache=function(e){return new Qd(e)}(e=>this.referenceDelegate.hi(e)),this.serializer=new Cd(t),this.Pi=new Hd(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new $d,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this._i[e.toKey()];return n||(n=new Kd(t,this.referenceDelegate),this._i[e.toKey()]=n),n}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,n){rr("MemoryPersistence","Starting transaction:",e);const i=new Zd(this.ai.next());return this.referenceDelegate.Ti(),n(i).next(e=>this.referenceDelegate.Ii(i).next(()=>e)).toPromise().then(e=>(i.raiseOnCommittedEvent(),e))}Ei(e,t){return ra.or(Object.values(this._i).map(n=>()=>n.containsKey(e,t)))}}class Zd extends ia{constructor(e){super(),this.currentSequenceNumber=e}}class eu{constructor(e){this.persistence=e,this.Ri=new Gd,this.Ai=null}static Vi(e){return new eu(e)}get di(){if(this.Ai)return this.Ai;throw cr(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.di.delete(n.toString()),ra.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.di.add(n.toString()),ra.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),ra.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(e=>this.di.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.di.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ra.forEach(this.di,n=>{const i=Or.fromPath(n);return this.mi(e,i).next(e=>{e||t.removeEntry(i,Qr.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(e=>{e?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return ra.or([()=>ra.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class tu{constructor(e,t){this.persistence=e,this.fi=new kl(e=>ma(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=Bd(this,t)}static Vi(e,t){return new tu(e,t)}Ti(){}Ii(e){return ra.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}mr(e,t){return ra.forEach(this.fi,(n,i)=>this.wr(e,n,i).next(e=>e?ra.resolve():t(i)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ni(e,i=>this.wr(e,i,t).next(e=>{e||(n++,s.removeEntry(i,Qr.min()))})).next(()=>s.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),ra.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.fi.set(n,e.currentSequenceNumber),ra.resolve()}removeReference(e,t,n){return this.fi.set(n,e.currentSequenceNumber),ra.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),ra.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Ao(e.data.value)),t}wr(e,t,n){return ra.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.fi.get(t);return ra.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class nu{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Ts=n,this.Is=i}static Es(e,t){let n=Bl(),i=Bl();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new nu(e,t.fromCache,n,i)}}class iu{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class su{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=A()?8:aa(S())>0?6:4}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,i){const s={result:null};return this.gs(e,t).next(e=>{s.result=e}).next(()=>{if(!s.result)return this.ps(e,t,i,n).next(e=>{s.result=e})}).next(()=>{if(s.result)return;const n=new iu;return this.ys(e,t,n).next(i=>{if(s.result=i,this.As)return this.ws(e,t,n,i.size)})}).next(()=>s.result)}ws(e,t,n,i){return n.documentReadCount<this.Vs?(sr()<=H.DEBUG&&rr("QueryEngine","SDK will not create cache indexes for query:",Sl(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),ra.resolve()):(sr()<=H.DEBUG&&rr("QueryEngine","Query:",Sl(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.ds*i?(sr()<=H.DEBUG&&rr("QueryEngine","The SDK decides to create cache indexes for query:",Sl(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,yl(t))):ra.resolve())}gs(e,t){if(ml(t))return ra.resolve(null);let n=yl(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=xl(t,null,"F"),n=yl(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{const s=Bl(...i);return this.fs.getDocuments(e,s).next(i=>this.indexManager.getMinOffset(e,n).next(n=>{const r=this.bs(t,i);return this.Ss(t,r,s,n.readTime)?this.gs(e,xl(t,null,"F")):this.Ds(e,r,t,n)}))})))}ps(e,t,n,i){return ml(t)||i.isEqual(Qr.min())?ra.resolve(null):this.fs.getDocuments(e,n).next(s=>{const r=this.bs(t,s);return this.Ss(t,r,n,i)?ra.resolve(null):(sr()<=H.DEBUG&&rr("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Sl(t)),this.Ds(e,r,t,Jr(i,Xr)).next(e=>e))})}bs(e,t){let n=new Ga(El(e));return t.forEach((t,i)=>{Cl(e,i)&&(n=n.add(i))}),n}Ss(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ys(e,t,n){return sr()<=H.DEBUG&&rr("QueryEngine","Using full collection scan to execute query:",Sl(t)),this.fs.getDocumentsMatchingQuery(e,t,ea.min(),n)}Ds(e,t,n,i){return this.fs.getDocumentsMatchingQuery(e,n,i).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const ru="LocalStore";class au{constructor(e,t,n,i){this.persistence=e,this.Cs=t,this.serializer=i,this.vs=new Ha(Er),this.Fs=new kl(e=>ll(e),cl),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(n)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Vd(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}function ou(e,t,n,i){return new au(e,t,n,i)}async function lu(e,t){const n=hr(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let i;return n.mutationQueue.getAllMutationBatches(e).next(s=>(i=s,n.Os(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const s=[],r=[];let a=Bl();for(const e of i){s.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}return n.localDocuments.getDocuments(e,a).next(e=>({Ns:e,removedBatchIds:s,addedBatchIds:r}))})})}function cu(e){const t=hr(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.li.getLastRemoteSnapshotVersion(e))}function du(e,t,n){let i=Bl(),s=Bl();return n.forEach(e=>i=i.add(e)),t.getEntries(e,i).next(e=>{let i=Il();return n.forEach((n,r)=>{const a=e.get(n);r.isFoundDocument()!==a.isFoundDocument()&&(s=s.add(n)),r.isNoDocument()&&r.version.isEqual(Qr.min())?(t.removeEntry(n,r.readTime),i=i.insert(n,r)):!a.isValidDocument()||r.version.compareTo(a.version)>0||0===r.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(r),i=i.insert(n,r)):rr(ru,"Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",r.version)}),{Bs:i,Ls:s}})}function uu(e,t){const n=hr(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=ca),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function hu(e,t){const n=hr(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let i;return n.li.getTargetData(e,t).next(s=>s?(i=s,ra.resolve(i)):n.li.allocateTargetId(e).next(s=>(i=new Sd(t,s,"TargetPurposeListen",e.currentSequenceNumber),n.li.addTargetData(e,i).next(()=>i))))}).then(e=>{const i=n.vs.get(e.targetId);return(null===i||e.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.vs=n.vs.insert(e.targetId,e),n.Fs.set(t,e.targetId)),e})}async function pu(e,t,n){const i=hr(e),s=i.vs.get(t),r=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",r,e=>i.persistence.referenceDelegate.removeTarget(e,s))}catch(e){if(!oa(e))throw e;rr(ru,`Failed to update sequence numbers for target ${t}: ${e}`)}i.vs=i.vs.remove(t),i.Fs.delete(s.target)}function mu(e,t,n){const i=hr(e);let s=Qr.min(),r=Bl();return i.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,n){const i=hr(e),s=i.Fs.get(n);return void 0!==s?ra.resolve(i.vs.get(s)):i.li.getTargetData(t,n)}(i,e,yl(t)).next(t=>{if(t)return s=t.lastLimboFreeSnapshotVersion,i.li.getMatchingKeysForTargetId(e,t.targetId).next(e=>{r=e})}).next(()=>i.Cs.getDocumentsMatchingQuery(e,t,n?s:Qr.min(),n?r:Bl())).next(e=>(gu(i,Al(t),e),{documents:e,ks:r})))}function gu(e,t,n){let i=e.Ms.get(t)||Qr.min();n.forEach((e,t)=>{t.readTime.compareTo(i)>0&&(i=t.readTime)}),e.Ms.set(t,i)}class fu{constructor(){this.activeTargetIds=zl()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class yu{constructor(){this.vo=new fu,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,n){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new fu,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class vu{Mo(e){}shutdown(){}}const bu="ConnectivityMonitor";class xu{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){rr(bu,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){rr(bu,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let wu=null;function _u(){return null===wu?wu=268435456+Math.round(2147483648*Math.random()):wu++,"0x"+wu.toString(16)}const Su="RestConnection",Cu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class Au{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${n}/databases/${i}`,this.$o=this.databaseId.database===co?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Wo(e,t,n,i,s){const r=_u(),a=this.Qo(e,t.toUriEncodedString());rr(Su,`Sending RPC '${e}' ${r}:`,a,n);const o={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(o,i,s);const{host:l}=new URL(a),c=y(l);return this.zo(e,a,o,n,c).then(t=>(rr(Su,`Received RPC '${e}' ${r}: `,t),t),t=>{throw or(Su,`RPC '${e}' ${r} failed with error: `,t,"url: ",a,"request:",n),t})}jo(e,t,n,i,s,r){return this.Wo(e,t,n,i,s)}Go(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+nr,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}Qo(e,t){const n=Cu[e];let i=`${this.qo}/v1/${t}:${n}`;return this.databaseInfo.apiKey&&(i=`${i}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),i}terminate(){}}class Eu{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}const Tu="WebChannelConnection",ku=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};class Nu extends Au{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!Nu.c_){const e=Ys();ku(e,Xs.STAT_EVENT,e=>{e.stat===Qs.PROXY?rr(Tu,"STAT_EVENT: detected buffering proxy"):e.stat===Qs.NOPROXY&&rr(Tu,"STAT_EVENT: detected no buffering proxy")}),Nu.c_=!0}}zo(e,t,n,i,s){const r=_u();return new Promise((s,a)=>{const o=new qs;o.setWithCredentials(!0),o.listenOnce(Ws.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case Ks.NO_ERROR:const t=o.getResponseJson();rr(Tu,`XHR for RPC '${e}' ${r} received:`,JSON.stringify(t)),s(t);break;case Ks.TIMEOUT:rr(Tu,`RPC '${e}' ${r} timed out`),a(new mr(pr.DEADLINE_EXCEEDED,"Request time out"));break;case Ks.HTTP_ERROR:const n=o.getStatus();if(rr(Tu,`RPC '${e}' ${r} failed with status:`,n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=e?.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(pr).indexOf(t)>=0?t:pr.UNKNOWN}(t.status);a(new mr(e,t.message))}else a(new mr(pr.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new mr(pr.UNAVAILABLE,"Connection failed."));break;default:cr(9055,{l_:e,streamId:r,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{rr(Tu,`RPC '${e}' ${r} completed.`)}});const l=JSON.stringify(i);rr(Tu,`RPC '${e}' ${r} sending request:`,i),o.send(t,"POST",l,n,15)})}T_(e,t,n){const i=_u(),s=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=this.createWebChannelTransport(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},o=this.longPollingOptions.timeoutSeconds;void 0!==o&&(a.longPollingTimeout=Math.round(1e3*o)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Go(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const l=s.join("");rr(Tu,`Creating RPC '${e}' stream ${i}: ${l}`,a);const c=r.createWebChannel(l,a);this.I_(c);let d=!1,u=!1;const h=new Eu({Ho:t=>{u?rr(Tu,`Not sending because RPC '${e}' stream ${i} is closed:`,t):(d||(rr(Tu,`Opening RPC '${e}' stream ${i} transport.`),c.open(),d=!0),rr(Tu,`RPC '${e}' stream ${i} sending:`,t),c.send(t))},Jo:()=>c.close()});return ku(c,Gs.EventType.OPEN,()=>{u||(rr(Tu,`RPC '${e}' stream ${i} transport opened.`),h.i_())}),ku(c,Gs.EventType.CLOSE,()=>{u||(u=!0,rr(Tu,`RPC '${e}' stream ${i} transport closed`),h.o_(),this.E_(c))}),ku(c,Gs.EventType.ERROR,t=>{u||(u=!0,or(Tu,`RPC '${e}' stream ${i} transport errored. Name:`,t.name,"Message:",t.message),h.o_(new mr(pr.UNAVAILABLE,"The operation could not be completed")))}),ku(c,Gs.EventType.MESSAGE,t=>{if(!u){const n=t.data[0];ur(!!n,16349);const s=n,r=s?.error||s[0]?.error;if(r){rr(Tu,`RPC '${e}' stream ${i} received error:`,r);const t=r.status;let n=function(e){const t=Cc[e];if(void 0!==t)return Tc(t)}(t),s=r.message;void 0===n&&(n=pr.INTERNAL,s="Unknown error status: "+t+" with message "+r.message),u=!0,h.o_(new mr(n,s)),c.close()}else rr(Tu,`RPC '${e}' stream ${i} received:`,n),h.__(n)}}),Nu.u_(),setTimeout(()=>{h.s_()},0),h}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,n){super.Go(e,t,n),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return Js()}}function Iu(e){return new Nu(e)}function Du(){return"undefined"!=typeof document?document:null}function Pu(e){return new Wc(e,!0)}Nu.c_=!1;class Mu{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.Ci=e,this.timerId=t,this.R_=n,this.A_=i,this.V_=s,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),n=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-n);i>0&&rr("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}const Ru="PersistentStream";class Lu{constructor(e,t,n,i,s,r,a,o){this.Ci=e,this.b_=n,this.S_=i,this.connection=s,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Mu(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===pr.RESOURCE_EXHAUSTED?(ar(t.toString()),ar("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===pr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(e=>{let[n,i]=e;this.D_===t&&this.G_(n,i)},t=>{e(()=>{const e=new mr(pr.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){const n=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{n(()=>this.listener.Zo())}),this.stream.Yo(()=>{n(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.H_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return rr(Ru,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(rr(Ru,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ju extends Lu{constructor(e,t,n,i,s,r){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,r),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const i=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:cr(39313,{state:e})}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],r=function(e,t){return e.useProto3Json?(ur(void 0===t||"string"==typeof t,58123),Xa.fromBase64String(t||"")):(ur(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),Xa.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,o=a&&function(e){const t=void 0===e.code?pr.UNKNOWN:Tc(e.code);return new mr(t,e.message||"")}(a);n=new Bc(i,s,r,o||null)}else if("documentChange"in t){t.documentChange;const i=t.documentChange;i.document,i.document.name,i.document.updateTime;const s=id(e,i.document.name),r=Jc(i.document.updateTime),a=i.document.createTime?Jc(i.document.createTime):Qr.min(),o=new Lo({mapValue:{fields:i.document.fields}}),l=Oo.newFoundDocument(s,r,a,o),c=i.targetIds||[],d=i.removedTargetIds||[];n=new Oc(c,d,l.key,l)}else if("documentDelete"in t){t.documentDelete;const i=t.documentDelete;i.document;const s=id(e,i.document),r=i.readTime?Jc(i.readTime):Qr.min(),a=Oo.newNoDocument(s,r),o=i.removedTargetIds||[];n=new Oc([],o,a.key,a)}else if("documentRemove"in t){t.documentRemove;const i=t.documentRemove;i.document;const s=id(e,i.document),r=i.removedTargetIds||[];n=new Oc([],r,s,null)}else{if(!("filter"in t))return cr(11601,{Vt:t});{t.filter;const e=t.filter;e.targetId;const{count:i=0,unchangedNames:s}=e,r=new Sc(i,s),a=e.targetId;n=new Fc(a,r)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return Qr.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Qr.min():t.readTime?Jc(t.readTime):Qr.min()}(e);return this.listener.J_(t,n)}Z_(e){const t={};t.database=ad(this.serializer),t.addTarget=function(e,t){let n;const i=t.target;if(n=dl(i)?{documents:dd(e,i)}:{query:ud(e,i).ft},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Xc(e,t.resumeToken);const i=Kc(e,t.expectedCount);null!==i&&(n.expectedCount=i)}else if(t.snapshotVersion.compareTo(Qr.min())>0){n.readTime=Qc(e,t.snapshotVersion.toTimestamp());const i=Kc(e,t.expectedCount);null!==i&&(n.expectedCount=i)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return cr(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.K_(t)}X_(e){const t={};t.database=ad(this.serializer),t.removeTarget=e,this.K_(t)}}class Ou extends Lu{constructor(e,t,n,i,s,r){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,r),this.serializer=s}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return ur(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ur(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){ur(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=function(e,t){return e&&e.length>0?(ur(void 0!==t,14353),e.map(e=>function(e,t){let n=e.updateTime?Jc(e.updateTime):Jc(t);return n.isEqual(Qr.min())&&(n=Jc(t)),new sc(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=Jc(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=ad(this.serializer),this.K_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>cd(this.serializer,e))};this.K_(t)}}class Fu{}class Bu extends Fu{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new mr(pr.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(s=>{let[r,a]=s;return this.connection.Wo(e,ed(t,n),i,r,a)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===pr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new mr(pr.UNKNOWN,e.toString())})}jo(e,t,n,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(r=>{let[a,o]=r;return this.connection.jo(e,ed(t,n),i,a,o,s)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===pr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new mr(pr.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}function Uu(e,t,n,i){return new Bu(e,t,n,i)}class zu{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ar(t),this.aa=!1):rr("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const Vu="RemoteStore";class Hu{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=s,this.Aa.Mo(e=>{n.enqueueAndForget(async()=>{Ju(this)&&(rr(Vu,"Restarting streams for network reachability change."),await async function(e){const t=hr(e);t.Ea.add(4),await qu(t),t.Va.set("Unknown"),t.Ea.delete(4),await $u(t)}(this))})}),this.Va=new zu(n,i)}}async function $u(e){if(Ju(e))for(const t of e.Ra)await t(!0)}async function qu(e){for(const t of e.Ra)await t(!1)}function Gu(e,t){const n=hr(e);n.Ia.has(t.targetId)||(n.Ia.set(t.targetId,t),Yu(n)?Xu(n):yh(n).O_()&&Ku(n,t))}function Wu(e,t){const n=hr(e),i=yh(n);n.Ia.delete(t),i.O_()&&Qu(n,t),0===n.Ia.size&&(i.O_()?i.L_():Ju(n)&&n.Va.set("Unknown"))}function Ku(e,t){if(e.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Qr.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}yh(e).Z_(t)}function Qu(e,t){e.da.$e(t),yh(e).X_(t)}function Xu(e){e.da=new zc({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),yh(e).start(),e.Va.ua()}function Yu(e){return Ju(e)&&!yh(e).x_()&&e.Ia.size>0}function Ju(e){return 0===hr(e).Ea.size}function Zu(e){e.da=void 0}async function eh(e){e.Va.set("Online")}async function th(e){e.Ia.forEach((t,n)=>{Ku(e,t)})}async function nh(e,t){Zu(e),Yu(e)?(e.Va.ha(t),Xu(e)):e.Va.set("Unknown")}async function ih(e,t,n){if(e.Va.set("Online"),t instanceof Bc&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const i of t.targetIds)e.Ia.has(i)&&(await e.remoteSyncer.rejectListen(i,n),e.Ia.delete(i),e.da.removeTarget(i))}(e,t)}catch(n){rr(Vu,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await sh(e,n)}else if(t instanceof Oc?e.da.Xe(t):t instanceof Fc?e.da.st(t):e.da.tt(t),!n.isEqual(Qr.min()))try{const t=await cu(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.da.Tt(t);return n.targetChanges.forEach((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const s=e.Ia.get(i);s&&e.Ia.set(i,s.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const i=e.Ia.get(t);if(!i)return;e.Ia.set(t,i.withResumeToken(Xa.EMPTY_BYTE_STRING,i.snapshotVersion)),Qu(e,t);const s=new Sd(i.target,t,n,i.sequenceNumber);Ku(e,s)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){rr(Vu,"Failed to raise snapshot:",t),await sh(e,t)}}async function sh(e,t,n){if(!oa(t))throw t;e.Ea.add(1),await qu(e),e.Va.set("Offline"),n||(n=()=>cu(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{rr(Vu,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await $u(e)})}function rh(e,t){return t().catch(n=>sh(e,n,t))}async function ah(e){const t=hr(e),n=vh(t);let i=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:ca;for(;oh(t);)try{const e=await uu(t.localStore,i);if(null===e){0===t.Ta.length&&n.L_();break}i=e.batchId,lh(t,e)}catch(e){await sh(t,e)}ch(t)&&dh(t)}function oh(e){return Ju(e)&&e.Ta.length<10}function lh(e,t){e.Ta.push(t);const n=vh(e);n.O_()&&n.Y_&&n.ea(t.mutations)}function ch(e){return Ju(e)&&!vh(e).x_()&&e.Ta.length>0}function dh(e){vh(e).start()}async function uh(e){vh(e).ra()}async function hh(e){const t=vh(e);for(const n of e.Ta)t.ea(n.mutations)}async function ph(e,t,n){const i=e.Ta.shift(),s=wc.from(i,t,n);await rh(e,()=>e.remoteSyncer.applySuccessfulWrite(s)),await ah(e)}async function mh(e,t){t&&vh(e).Y_&&await async function(e,t){if(function(e){return Ec(e)&&e!==pr.ABORTED}(t.code)){const n=e.Ta.shift();vh(e).B_(),await rh(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await ah(e)}}(e,t),ch(e)&&dh(e)}async function gh(e,t){const n=hr(e);n.asyncQueue.verifyOperationInProgress(),rr(Vu,"RemoteStore received new credentials");const i=Ju(n);n.Ea.add(3),await qu(n),i&&n.Va.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ea.delete(3),await $u(n)}async function fh(e,t){const n=hr(e);t?(n.Ea.delete(2),await $u(n)):t||(n.Ea.add(2),await qu(n),n.Va.set("Unknown"))}function yh(e){return e.ma||(e.ma=function(e,t,n){const i=hr(e);return i.sa(),new ju(t,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(e.datastore,e.asyncQueue,{Zo:eh.bind(null,e),Yo:th.bind(null,e),t_:nh.bind(null,e),J_:ih.bind(null,e)}),e.Ra.push(async t=>{t?(e.ma.B_(),Yu(e)?Xu(e):e.Va.set("Unknown")):(await e.ma.stop(),Zu(e))})),e.ma}function vh(e){return e.fa||(e.fa=function(e,t,n){const i=hr(e);return i.sa(),new Ou(t,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(e.datastore,e.asyncQueue,{Zo:()=>Promise.resolve(),Yo:uh.bind(null,e),t_:mh.bind(null,e),ta:hh.bind(null,e),na:ph.bind(null,e)}),e.Ra.push(async t=>{t?(e.fa.B_(),await ah(e)):(await e.fa.stop(),e.Ta.length>0&&(rr(Vu,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class bh{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new gr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){const r=Date.now()+n,a=new bh(e,t,r,i,s);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new mr(pr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function xh(e,t){if(ar("AsyncQueue",`${t}: ${e}`),oa(e))return new mr(pr.UNAVAILABLE,`${t}: ${e}`);throw e}class wh{static emptySet(e){return new wh(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||Or.comparator(t.key,n.key):(e,t)=>Or.comparator(e.key,t.key),this.keyedMap=Pl(),this.sortedSet=new Ha(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof wh))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(!e.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new wh;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class _h{constructor(){this.ga=new Ha(Or.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):cr(63341,{Vt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class Sh{constructor(e,t,n,i,s,r,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=r,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,i,s){const r=[];return t.forEach(e=>{r.push({type:0,doc:e})}),new Sh(e,t,wh.emptySet(t),r,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&wl(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class Ch{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class Ah{constructor(){this.queries=Eh(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const n=hr(e),i=n.queries;n.queries=Eh(),i.forEach((e,n)=>{for(const i of n.ba)i.onError(t)})}(this,new mr(pr.ABORTED,"Firestore shutting down"))}}function Eh(){return new kl(e=>_l(e),wl)}async function Th(e,t){const n=hr(e);let i=3;const s=t.query;let r=n.queries.get(s);r?!r.Sa()&&t.Da()&&(i=2):(r=new Ch,i=t.Da()?0:1);try{switch(i){case 0:r.wa=await n.onListen(s,!0);break;case 1:r.wa=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(e){const n=xh(e,`Initialization of query '${Sl(t.query)}' failed`);return void t.onError(n)}n.queries.set(s,r),r.ba.push(t),t.va(n.onlineState),r.wa&&t.Fa(r.wa)&&Dh(n)}async function kh(e,t){const n=hr(e),i=t.query;let s=3;const r=n.queries.get(i);if(r){const e=r.ba.indexOf(t);e>=0&&(r.ba.splice(e,1),0===r.ba.length?s=t.Da()?0:1:!r.Sa()&&t.Da()&&(s=2))}switch(s){case 0:return n.queries.delete(i),n.onUnlisten(i,!0);case 1:return n.queries.delete(i),n.onUnlisten(i,!1);case 2:return n.onLastRemoteStoreUnlisten(i);default:return}}function Nh(e,t){const n=hr(e);let i=!1;for(const s of t){const e=s.query,t=n.queries.get(e);if(t){for(const e of t.ba)e.Fa(s)&&(i=!0);t.wa=s}}i&&Dh(n)}function Ih(e,t,n){const i=hr(e),s=i.queries.get(t);if(s)for(const r of s.ba)r.onError(n);i.queries.delete(t)}function Dh(e){e.Ca.forEach(e=>{e.next()})}var Ph,Mh;(Mh=Ph||(Ph={})).Ma="default",Mh.Cache="cache";class Rh{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Sh(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache)return!0;if(!this.Da())return!0;const n="Offline"!==t;return(!this.options.Ka||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=Sh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Ph.Cache}}class Lh{constructor(e){this.key=e}}class jh{constructor(e){this.key=e}}class Oh{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=Bl(),this.mutatedKeys=Bl(),this.eu=El(e),this.tu=new wh(this.eu)}get nu(){return this.Za}ru(e,t){const n=t?t.iu:new _h,i=t?t.tu:this.tu;let s=t?t.mutatedKeys:this.mutatedKeys,r=i,a=!1;const o="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,l="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((e,t)=>{const c=i.get(e),d=Cl(this.query,t)?t:null,u=!!c&&this.mutatedKeys.has(c.key),h=!!d&&(d.hasLocalMutations||this.mutatedKeys.has(d.key)&&d.hasCommittedMutations);let p=!1;c&&d?c.data.isEqual(d.data)?u!==h&&(n.track({type:3,doc:d}),p=!0):this.su(c,d)||(n.track({type:2,doc:d}),p=!0,(o&&this.eu(d,o)>0||l&&this.eu(d,l)<0)&&(a=!0)):!c&&d?(n.track({type:0,doc:d}),p=!0):c&&!d&&(n.track({type:1,doc:c}),p=!0,(o||l)&&(a=!0)),p&&(d?(r=r.add(d),s=h?s.add(e):s.delete(e)):(r=r.delete(e),s=s.delete(e)))}),null!==this.query.limit)for(;r.size>this.query.limit;){const e="F"===this.query.limitType?r.last():r.first();r=r.delete(e.key),s=s.delete(e.key),n.track({type:1,doc:e})}return{tu:r,iu:n,Ss:a,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const r=e.iu.ya();r.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return cr(20277,{Vt:e})}};return n(e)-n(t)}(e.type,t.type)||this.eu(e.doc,t.doc)),this.ou(n),i=i??!1;const a=t&&!i?this._u():[],o=0===this.Ya.size&&this.current&&!i?1:0,l=o!==this.Xa;return this.Xa=o,0!==r.length||l?{snapshot:new Sh(this.query,e.tu,s,r,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new _h,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Za=this.Za.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Za=this.Za.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=Bl(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Ya=this.Ya.add(e.key))});const t=[];return e.forEach(e=>{this.Ya.has(e)||t.push(new jh(e))}),this.Ya.forEach(n=>{e.has(n)||t.push(new Lh(n))}),t}cu(e){this.Za=e.ks,this.Ya=Bl();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Sh.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Xa,this.hasCachedResults)}}const Fh="SyncEngine";class Bh{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Uh{constructor(e){this.key=e,this.hu=!1}}class zh{constructor(e,t,n,i,s,r){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=r,this.Pu={},this.Tu=new kl(e=>_l(e),wl),this.Iu=new Map,this.Eu=new Set,this.Ru=new Ha(Or.comparator),this.Au=new Map,this.Vu=new Gd,this.du={},this.mu=new Map,this.fu=Pd.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function Vh(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=cp(e);let s;const r=i.Tu.get(t);return r?(i.sharedClientState.addLocalQueryTarget(r.targetId),s=r.view.lu()):s=await $h(i,t,n,!0),s}async function Hh(e,t){const n=cp(e);await $h(n,t,!0,!1)}async function $h(e,t,n,i){const s=await hu(e.localStore,yl(t)),r=s.targetId,a=e.sharedClientState.addLocalQueryTarget(r,n);let o;return i&&(o=await qh(e,t,r,"current"===a,s.resumeToken)),e.isPrimaryClient&&n&&Gu(e.remoteStore,s),o}async function qh(e,t,n,i,s){e.pu=(t,n,i)=>async function(e,t,n,i){let s=t.view.ru(n);s.Ss&&(s=await mu(e.localStore,t.query,!1).then(e=>{let{documents:n}=e;return t.view.ru(n,s)}));const r=i&&i.targetChanges.get(t.targetId),a=i&&null!=i.targetMismatches.get(t.targetId),o=t.view.applyChanges(s,e.isPrimaryClient,r,a);return ip(e,t.targetId,o.au),o.snapshot}(e,t,n,i);const r=await mu(e.localStore,t,!0),a=new Oh(t,r.ks),o=a.ru(r.documents),l=jc.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState,s),c=a.applyChanges(o,e.isPrimaryClient,l);ip(e,n,c.au);const d=new Bh(t,n,a);return e.Tu.set(t,d),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),c.snapshot}async function Gh(e,t,n){const i=hr(e),s=i.Tu.get(t),r=i.Iu.get(s.targetId);if(r.length>1)return i.Iu.set(s.targetId,r.filter(e=>!wl(e,t))),void i.Tu.delete(t);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(s.targetId),i.sharedClientState.isActiveQueryTarget(s.targetId)||await pu(i.localStore,s.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(s.targetId),n&&Wu(i.remoteStore,s.targetId),tp(i,s.targetId)}).catch(sa)):(tp(i,s.targetId),await pu(i.localStore,s.targetId,!0))}async function Wh(e,t){const n=hr(e),i=n.Tu.get(t),s=n.Iu.get(i.targetId);n.isPrimaryClient&&1===s.length&&(n.sharedClientState.removeLocalQueryTarget(i.targetId),Wu(n.remoteStore,i.targetId))}async function Kh(e,t){const n=hr(e);try{const e=await function(e,t){const n=hr(e),i=t.snapshotVersion;let s=n.vs;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const r=n.xs.newChangeBuffer({trackRemovals:!0});s=n.vs;const a=[];t.targetChanges.forEach((r,o)=>{const l=s.get(o);if(!l)return;a.push(n.li.removeMatchingKeys(e,r.removedDocuments,o).next(()=>n.li.addMatchingKeys(e,r.addedDocuments,o)));let c=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?c=c.withResumeToken(Xa.EMPTY_BYTE_STRING,Qr.min()).withLastLimboFreeSnapshotVersion(Qr.min()):r.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(r.resumeToken,i)),s=s.insert(o,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(l,c,r)&&a.push(n.li.updateTargetData(e,c))});let o=Il(),l=Bl();if(t.documentUpdates.forEach(i=>{t.resolvedLimboDocuments.has(i)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,i))}),a.push(du(e,r,t.documentUpdates).next(e=>{o=e.Bs,l=e.Ls})),!i.isEqual(Qr.min())){const t=n.li.getLastRemoteSnapshotVersion(e).next(t=>n.li.setTargetsMetadata(e,e.currentSequenceNumber,i));a.push(t)}return ra.waitFor(a).next(()=>r.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(n.vs=s,e))}(n.localStore,t);t.targetChanges.forEach((e,t)=>{const i=n.Au.get(t);i&&(ur(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?i.hu=!0:e.modifiedDocuments.size>0?ur(i.hu,14607):e.removedDocuments.size>0&&(ur(i.hu,42227),i.hu=!1))}),await ap(n,e,t)}catch(e){await sa(e)}}function Qh(e,t,n){const i=hr(e);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const e=[];i.Tu.forEach((n,i)=>{const s=i.view.va(t);s.snapshot&&e.push(s.snapshot)}),function(e,t){const n=hr(e);n.onlineState=t;let i=!1;n.queries.forEach((e,n)=>{for(const s of n.ba)s.va(t)&&(i=!0)}),i&&Dh(n)}(i.eventManager,t),e.length&&i.Pu.J_(e),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}async function Xh(e,t,n){const i=hr(e);i.sharedClientState.updateQueryState(t,"rejected",n);const s=i.Au.get(t),r=s&&s.key;if(r){let e=new Ha(Or.comparator);e=e.insert(r,Oo.newNoDocument(r,Qr.min()));const n=Bl().add(r),s=new Lc(Qr.min(),new Map,new Ha(Er),e,n);await Kh(i,s),i.Ru=i.Ru.remove(r),i.Au.delete(t),rp(i)}else await pu(i.localStore,t,!1).then(()=>tp(i,t,n)).catch(sa)}async function Yh(e,t){const n=hr(e),i=t.batch.batchId;try{const e=await function(e,t){const n=hr(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const i=t.batch.keys(),s=n.xs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,i){const s=n.batch,r=s.keys();let a=ra.resolve();return r.forEach(e=>{a=a.next(()=>i.getEntry(t,e)).next(t=>{const r=n.docVersions.get(e);ur(null!==r,48541),t.version.compareTo(r)<0&&(s.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),i.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,s))}(n,e,t,s).next(()=>s.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Bl();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,i))})}(n.localStore,t);ep(n,i,null),Zh(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await ap(n,e)}catch(e){await sa(e)}}async function Jh(e,t,n){const i=hr(e);try{const e=await function(e,t){const n=hr(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let i;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(ur(null!==t,37113),i=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,i)).next(()=>n.localDocuments.getDocuments(e,i))})}(i.localStore,t);ep(i,t,n),Zh(i,t),i.sharedClientState.updateMutationState(t,"rejected",n),await ap(i,e)}catch(n){await sa(n)}}function Zh(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function ep(e,t,n){const i=hr(e);let s=i.du[i.currentUser.toKey()];if(s){const e=s.get(t);e&&(n?e.reject(n):e.resolve(),s=s.remove(t)),i.du[i.currentUser.toKey()]=s}}function tp(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);for(const i of e.Iu.get(t))e.Tu.delete(i),n&&e.Pu.yu(i,n);e.Iu.delete(t),e.isPrimaryClient&&e.Vu.Gr(t).forEach(t=>{e.Vu.containsKey(t)||np(e,t)})}function np(e,t){e.Eu.delete(t.path.canonicalString());const n=e.Ru.get(t);null!==n&&(Wu(e.remoteStore,n),e.Ru=e.Ru.remove(t),e.Au.delete(n),rp(e))}function ip(e,t,n){for(const i of n)i instanceof Lh?(e.Vu.addReference(i.key,t),sp(e,i)):i instanceof jh?(rr(Fh,"Document no longer in limbo: "+i.key),e.Vu.removeReference(i.key,t),e.Vu.containsKey(i.key)||np(e,i.key)):cr(19791,{wu:i})}function sp(e,t){const n=t.key,i=n.path.canonicalString();e.Ru.get(n)||e.Eu.has(i)||(rr(Fh,"New document in limbo: "+n),e.Eu.add(i),rp(e))}function rp(e){for(;e.Eu.size>0&&e.Ru.size<e.maxConcurrentLimboResolutions;){const t=e.Eu.values().next().value;e.Eu.delete(t);const n=new Or(Rr.fromString(t)),i=e.fu.next();e.Au.set(i,new Uh(n)),e.Ru=e.Ru.insert(n,i),Gu(e.remoteStore,new Sd(yl(pl(n.path)),i,"TargetPurposeLimboResolution",la.ce))}}async function ap(e,t,n){const i=hr(e),s=[],r=[],a=[];i.Tu.isEmpty()||(i.Tu.forEach((e,o)=>{a.push(i.pu(o,t,n).then(e=>{if((e||n)&&i.isPrimaryClient){const t=e?!e.fromCache:n?.targetChanges.get(o.targetId)?.current;i.sharedClientState.updateQueryState(o.targetId,t?"current":"not-current")}if(e){s.push(e);const t=nu.Es(o.targetId,e);r.push(t)}}))}),await Promise.all(a),i.Pu.J_(s),await async function(e,t){const n=hr(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>ra.forEach(t,t=>ra.forEach(t.Ts,i=>n.persistence.referenceDelegate.addReference(e,t.targetId,i)).next(()=>ra.forEach(t.Is,i=>n.persistence.referenceDelegate.removeReference(e,t.targetId,i)))))}catch(e){if(!oa(e))throw e;rr(ru,"Failed to update sequence numbers: "+e)}for(const i of t){const e=i.targetId;if(!i.fromCache){const t=n.vs.get(e),i=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(i);n.vs=n.vs.insert(e,s)}}}(i.localStore,r))}async function op(e,t){const n=hr(e);if(!n.currentUser.isEqual(t)){rr(Fh,"User change. New user:",t.toKey());const e=await lu(n.localStore,t);n.currentUser=t,function(e,t){e.mu.forEach(e=>{e.forEach(e=>{e.reject(new mr(pr.CANCELLED,t))})}),e.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await ap(n,e.Ns)}}function lp(e,t){const n=hr(e),i=n.Au.get(t);if(i&&i.hu)return Bl().add(i.key);{let e=Bl();const i=n.Iu.get(t);if(!i)return e;for(const t of i){const i=n.Tu.get(t);e=e.unionWith(i.view.nu)}return e}}function cp(e){const t=hr(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Kh.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=lp.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Xh.bind(null,t),t.Pu.J_=Nh.bind(null,t.eventManager),t.Pu.yu=Ih.bind(null,t.eventManager),t}function dp(e){const t=hr(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Yh.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Jh.bind(null,t),t}class up{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Pu(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return ou(this.persistence,new su,e.initialUser,this.serializer)}Cu(e){return new Jd(eu.Vi,this.serializer)}Du(e){return new yu}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}up.provider={build:()=>new up};class hp extends up{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ur(this.persistence.referenceDelegate instanceof tu,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new Od(n,e.asyncQueue,t)}Cu(e){const t=void 0!==this.cacheSizeBytes?Dd.withCacheSize(this.cacheSizeBytes):Dd.DEFAULT;return new Jd(e=>tu.Vi(e,t),this.serializer)}}class pp{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Qh(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=op.bind(null,this.syncEngine),await fh(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Ah}createDatastore(e){const t=Pu(e.databaseInfo.databaseId),n=Iu(e.databaseInfo);return Uu(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,i,s){return new Hu(e,t,n,i,s)}(this.localStore,this.datastore,e.asyncQueue,e=>Qh(this.syncEngine,e,0),xu.v()?new xu:new vu)}createSyncEngine(e,t){return function(e,t,n,i,s,r,a){const o=new zh(e,t,n,i,s,r);return a&&(o.gu=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await async function(e){const t=hr(e);rr(Vu,"RemoteStore shutting down."),t.Ea.add(5),await qu(t),t.Aa.shutdown(),t.Va.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}pp.provider={build:()=>new pp};class mp{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):ar("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const gp="FirestoreClient";class fp{constructor(e,t,n,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this._databaseInfo=i,this.user=tr.UNAUTHENTICATED,this.clientId=Ar.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,async e=>{rr(gp,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(rr(gp,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new gr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=xh(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function yp(e,t){e.asyncQueue.verifyOperationInProgress(),rr(gp,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener(async e=>{i.isEqual(e)||(await lu(t.localStore,e),i=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function vp(e,t){e.asyncQueue.verifyOperationInProgress();const n=await bp(e);rr(gp,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>gh(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>gh(t.remoteStore,n)),e._onlineComponents=t}async function bp(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){rr(gp,"Using user provided OfflineComponentProvider");try{await yp(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===pr.FAILED_PRECONDITION||e.code===pr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;or("Error using user provided cache. Falling back to memory cache: "+n),await yp(e,new up)}}else rr(gp,"Using default OfflineComponentProvider"),await yp(e,new hp(void 0));return e._offlineComponents}async function xp(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(rr(gp,"Using user provided OnlineComponentProvider"),await vp(e,e._uninitializedComponentsProvider._online)):(rr(gp,"Using default OnlineComponentProvider"),await vp(e,new pp))),e._onlineComponents}function wp(e){return xp(e).then(e=>e.syncEngine)}async function _p(e){const t=await xp(e),n=t.eventManager;return n.onListen=Vh.bind(null,t.syncEngine),n.onUnlisten=Gh.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Hh.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=Wh.bind(null,t.syncEngine),n}function Sp(e,t){const n=new gr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){const i=dp(e);try{const e=await function(e,t){const n=hr(e),i=Kr.now(),s=t.reduce((e,t)=>e.add(t.key),Bl());let r,a;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=Il(),l=Bl();return n.xs.getEntries(e,s).next(e=>{o=e,o.forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,o)).next(s=>{r=s;const a=[];for(const e of t){const t=uc(e,r.get(e.key).overlayedDocument);null!=t&&a.push(new mc(e.key,t,jo(t.value.mapValue),rc.exists(!0)))}return n.mutationQueue.addMutationBatch(e,i,a,t)}).next(t=>{a=t;const i=t.applyToLocalDocumentSet(r,l);return n.documentOverlayCache.saveOverlays(e,t.batchId,i)})}).then(()=>({batchId:a.batchId,changes:Ml(r)}))}(i.localStore,t);i.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let i=e.du[e.currentUser.toKey()];i||(i=new Ha(Er)),i=i.insert(t,n),e.du[e.currentUser.toKey()]=i}(i,e.batchId,n),await ap(i,e.changes),await ah(i.remoteStore)}catch(e){const t=xh(e,"Failed to persist write");n.reject(t)}}(await wp(e),t,n)),n.promise}function Cp(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Ap="ComponentProvider",Ep=new Map;function Tp(e,t,n,i,s){return new lo(e,t,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,Cp(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator,i)}const kp="firestore.googleapis.com",Np=!0;class Ip{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new mr(pr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=kp,this.ssl=Np}else this.host=e.host,this.ssl=e.ssl??Np;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=Id;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<Rd)throw new mr(pr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,i){if(!0===t&&!0===i)throw new mr(pr.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Cp(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new mr(pr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new mr(pr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new mr(pr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Dp{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ip({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new mr(pr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new mr(pr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ip(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new yr;switch(e.type){case"firstParty":return new wr(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new mr(pr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Ep.get(e);t&&(rr(Ap,"Removing Datastore"),Ep.delete(e),t.terminate())}(this),Promise.resolve()}}class Pp{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Pp(this.firestore,e,this._query)}}class Mp{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Rp(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Mp(this.firestore,e,this._key)}toJSON(){return{type:Mp._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(qr(t,Mp._jsonSchema))return new Mp(e,n||null,new Or(Rr.fromString(t.referencePath)))}}Mp._jsonSchemaVersion="firestore/documentReference/1.0",Mp._jsonSchema={type:$r("string",Mp._jsonSchemaVersion),referencePath:$r("string")};class Rp extends Pp{constructor(e,t,n){super(e,t,pl(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Mp(this.firestore,null,new Or(e))}withConverter(e){return new Rp(this.firestore,e,this._path)}}function Lp(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];if(e=O(e),Fr("collection","path",t),e instanceof Dp){const n=Rr.fromString(t,...i);return Ur(n),new Rp(e,null,n)}{if(!(e instanceof Mp||e instanceof Rp))throw new mr(pr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(Rr.fromString(t,...i));return Ur(n),new Rp(e.firestore,null,n)}}function jp(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];if(e=O(e),1===arguments.length&&(t=Ar.newId()),Fr("doc","path",t),e instanceof Dp){const n=Rr.fromString(t,...i);return Br(n),new Mp(e,null,new Or(n))}{if(!(e instanceof Mp||e instanceof Rp))throw new mr(pr.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(Rr.fromString(t,...i));return Br(n),new Mp(e.firestore,e instanceof Rp?e.converter:null,new Or(n))}}const Op="AsyncQueue";class Fp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Promise.resolve();this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Mu(this,"async_queue_retry"),this._c=()=>{const e=Du();e&&rr(Op,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=Du();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Du();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new gr;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(0!==this.Yu.length){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!oa(e))throw e;rr(Op,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,ar("INTERNAL UNHANDLED ERROR: ",Bp(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=bh.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(i),i}uc(){this.nc&&cr(47125,{Pc:Bp(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do{e=this.ac,await e}while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Bp(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class Up extends Dp{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new Fp,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Fp(e),this._firestoreClient=void 0,await e}}}function zp(e){if(e._terminated)throw new mr(pr.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||Vp(e),e._firestoreClient}function Vp(e){const t=e._freezeSettings(),n=Tp(e._databaseId,e._app?.options.appId||"",e._persistenceKey,e._app?.options.apiKey,t);e._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),e._firestoreClient=new fp(e._authCredentials,e._appCheckCredentials,e._queue,n,e._componentsProvider&&function(e){const t=e?._online.build();return{_offline:e?._offline.build(t),_online:t}}(e._componentsProvider))}class Hp{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Hp(Xa.fromBase64String(e))}catch(e){throw new mr(pr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Hp(Xa.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Hp._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(qr(e,Hp._jsonSchema))return Hp.fromBase64String(e.bytes)}}Hp._jsonSchemaVersion="firestore/bytes/1.0",Hp._jsonSchema={type:$r("string",Hp._jsonSchemaVersion),bytes:$r("string")};class $p{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let i=0;i<t.length;++i)if(0===t[i].length)throw new mr(pr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new jr(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class qp{constructor(e){this._methodName=e}}class Gp{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new mr(pr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new mr(pr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Er(this._lat,e._lat)||Er(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Gp._jsonSchemaVersion}}static fromJSON(e){if(qr(e,Gp._jsonSchema))return new Gp(e.latitude,e.longitude)}}Gp._jsonSchemaVersion="firestore/geoPoint/1.0",Gp._jsonSchema={type:$r("string",Gp._jsonSchemaVersion),latitude:$r("number"),longitude:$r("number")};class Wp{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Wp._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(qr(e,Wp._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new Wp(e.vectorValues);throw new mr(pr.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Wp._jsonSchemaVersion="firestore/vectorValue/1.0",Wp._jsonSchema={type:$r("string",Wp._jsonSchemaVersion),vectorValues:$r("object")};const Kp=/^__.*__$/;class Qp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new mc(e,this.data,this.fieldMask,t,this.fieldTransforms):new pc(e,this.data,t,this.fieldTransforms)}}class Xp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new mc(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Yp(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw cr(40011,{dataSource:e})}}class Jp{constructor(e,t,n,i,s,r){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===s&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=r||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new Jp({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){const t=this.path?.child(e),n=this.contextWith({path:t,arrayElement:!1});return n.validatePathSegment(e),n}childContextForFieldPath(e){const t=this.path?.child(e),n=this.contextWith({path:t,arrayElement:!1});return n.validatePath(),n}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return mm(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(Yp(this.dataSource)&&Kp.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class Zp{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Pu(e)}createContext(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Jp({dataSource:e,methodName:t,targetDoc:n,path:jr.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function em(e){const t=e._freezeSettings(),n=Pu(e._databaseId);return new Zp(e._databaseId,!!t.ignoreUndefinedProperties,n)}function tm(e,t,n,i,s){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const a=e.createContext(r.merge||r.mergeFields?2:0,t,n,s);dm("Data must be an object, but it was:",a,i);const o=lm(i,a);let l,c;if(r.merge)l=new Ka(a.fieldMask),c=a.fieldTransforms;else if(r.mergeFields){const e=[];for(const i of r.mergeFields){const s=um(t,i,n);if(!a.contains(s))throw new mr(pr.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);gm(e,s)||e.push(s)}l=new Ka(e),c=a.fieldTransforms.filter(e=>l.covers(e.field))}else l=null,c=a.fieldTransforms;return new Qp(new Lo(o),l,c)}class nm extends qp{_toFieldTransform(e){if(2!==e.dataSource)throw 1===e.dataSource?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof nm}}class im extends qp{_toFieldTransform(e){return new ic(e.path,new Ql)}isEqual(e){return e instanceof im}}function sm(e,t,n,i){const s=e.createContext(1,t,n);dm("Data must be an object, but it was:",s,i);const r=[],a=Lo.empty();za(i,(e,i)=>{const o=pm(t,e,n);i=O(i);const l=s.childContextForFieldPath(o);if(i instanceof nm)r.push(o);else{const e=om(i,l);null!=e&&(r.push(o),a.set(o,e))}});const o=new Ka(r);return new Xp(a,o,s.fieldTransforms)}function rm(e,t,n,i,s,r){const a=e.createContext(1,t,n),o=[um(t,i,n)],l=[s];if(r.length%2!=0)throw new mr(pr.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let h=0;h<r.length;h+=2)o.push(um(t,r[h])),l.push(r[h+1]);const c=[],d=Lo.empty();for(let h=o.length-1;h>=0;--h)if(!gm(c,o[h])){const e=o[h];let t=l[h];t=O(t);const n=a.childContextForFieldPath(e);if(t instanceof nm)c.push(e);else{const i=om(t,n);null!=i&&(c.push(e),d.set(e,i))}}const u=new Ka(c);return new Xp(d,u,a.fieldTransforms)}function am(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return om(n,e.createContext(i?4:3,t))}function om(e,t){if(cm(e=O(e)))return dm("Unsupported field value:",t,e),lm(e,t);if(e instanceof qp)return function(e,t){if(!Yp(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");return function(e,t){const n=[];let i=0;for(const s of e){let e=om(s,t.childContextForArray(i));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),i++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=O(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return $l(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Kr.fromDate(e);return{timestampValue:Qc(t.serializer,n)}}if(e instanceof Kr){const n=new Kr(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Qc(t.serializer,n)}}if(e instanceof Gp)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Hp)return{bytesValue:Xc(t.serializer,e._byteString)};if(e instanceof Mp){const n=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(n))throw t.createError(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Zc(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof Wp)return function(e,t){const n=e instanceof Wp?e.toArray():e,i={fields:{[ho]:{stringValue:go},[fo]:{arrayValue:{values:n.map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return Vl(t.serializer,e)})}}}};return{mapValue:i}}(e,t);if(_d(e))return e._toProto(t.serializer);throw t.createError(`Unsupported field value: ${Vr(e)}`)}(e,t)}function lm(e,t){const n={};return Va(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):za(e,(e,i)=>{const s=om(i,t.childContextForField(e));null!=s&&(n[e]=s)}),{mapValue:{fields:n}}}function cm(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Kr||e instanceof Gp||e instanceof Hp||e instanceof Mp||e instanceof qp||e instanceof Wp||_d(e))}function dm(e,t,n){if(!cm(n)||!zr(n)){const i=Vr(n);throw"an object"===i?t.createError(e+" a custom object"):t.createError(e+" "+i)}}function um(e,t,n){if((t=O(t))instanceof $p)return t._internalPath;if("string"==typeof t)return pm(e,t);throw mm("Field path arguments must be of type string or ",e,!1,void 0,n)}const hm=new RegExp("[~\\*/\\[\\]]");function pm(e,t,n){if(t.search(hm)>=0)throw mm(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new $p(...t.split("."))._internalPath}catch(i){throw mm(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function mm(e,t,n,i,s){const r=i&&!i.isEmpty(),a=void 0!==s;let o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(r||a)&&(l+=" (found",r&&(l+=` in field ${i}`),a&&(l+=` in document ${s}`),l+=")"),new mr(pr.INVALID_ARGUMENT,o+e+l)}function gm(e,t){return e.some(e=>e.isEqual(t))}class fm{convertValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(yo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Za(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(eo(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw cr(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const n={};return za(e,(e,i)=>{n[e]=this.convertValue(i,t)}),n}convertVectorValue(e){const t=e.fields?.[fo].arrayValue?.values?.map(e=>Za(e.doubleValue));return new Wp(t)}convertGeoPoint(e){return new Gp(Za(e.latitude),Za(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=ao(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(oo(e));default:return null}}convertTimestamp(e){const t=Ja(e);return new Kr(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Rr.fromString(e);ur(wd(n),9688,{name:e});const i=new uo(n.get(1),n.get(3)),s=new Or(n.popFirst(5));return i.isEqual(t)||ar(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}class ym extends fm{constructor(e){super(),this.firestore=e}convertBytes(e){return new Hp(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Mp(this.firestore,null,t)}}function vm(){return new im("serverTimestamp")}const bm="@firebase/firestore",xm="4.10.0";function wm(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const i of t)if(i in n&&"function"==typeof n[i])return!0;return!1}(e,["next","error","complete"])}class _m{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Mp(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Sm(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){const t=this._document.data.field(um("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Sm extends _m{data(){return super.data()}}function Cm(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new mr(pr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Am{}class Em extends Am{}function Tm(e,t){let n=[];for(var i=arguments.length,s=new Array(i>2?i-2:0),r=2;r<i;r++)s[r-2]=arguments[r];t instanceof Am&&n.push(t),n=n.concat(s),function(e){const t=e.filter(e=>e instanceof Im).length,n=e.filter(e=>e instanceof km).length;if(t>1||t>0&&n>0)throw new mr(pr.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const a of n)e=a._apply(e);return e}class km extends Em{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new km(e,t,n)}_apply(e){const t=this._parse(e);return Lm(e._query,t),new Pp(e.firestore,e.converter,bl(e._query,t))}_parse(e){const t=em(e.firestore),n=function(e,t,n,i,s,r,a){let o;if(s.isKeyField()){if("array-contains"===r||"array-contains-any"===r)throw new mr(pr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on documentId().`);if("in"===r||"not-in"===r){Rm(a,r);const t=[];for(const n of a)t.push(Mm(i,e,n));o={arrayValue:{values:t}}}else o=Mm(i,e,a)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||Rm(a,r),o=am(n,t,a,"in"===r||"not-in"===r);return $o.create(s,r,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function Nm(e,t,n){const i=t,s=um("where",e);return km._create(s,i,n)}class Im extends Am{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Im(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:qo.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const i=t.getFlattenedFilters();for(const s of i)Lm(n,s),n=bl(n,s)}(e._query,t),new Pp(e.firestore,e.converter,bl(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Dm extends Em{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Dm(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new mr(pr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new mr(pr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new zo(t,n)}(e._query,this._field,this._direction);return new Pp(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new ul(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function Pm(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=um("orderBy",e);return Dm._create(n,t)}function Mm(e,t,n){if("string"==typeof(n=O(n))){if(""===n)throw new mr(pr.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!gl(t)&&-1!==n.indexOf("/"))throw new mr(pr.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const i=t.path.child(Rr.fromString(n));if(!Or.isDocumentKey(i))throw new mr(pr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return Eo(e,new Or(i))}if(n instanceof Mp)return Eo(e,n._key);throw new mr(pr.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Vr(n)}.`)}function Rm(e,t){if(!Array.isArray(e)||0===e.length)throw new mr(pr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Lm(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new mr(pr.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new mr(pr.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function jm(e,t,n){let i;return i=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,i}class Om{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Fm extends _m{constructor(e,t,n,i,s,r){super(e,t,n,i,r),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const t=new Bm(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field(um("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new mr(pr.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Fm._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}Fm._jsonSchemaVersion="firestore/documentSnapshot/1.0",Fm._jsonSchema={type:$r("string",Fm._jsonSchemaVersion),bundleSource:$r("string","DocumentSnapshot"),bundleName:$r("string"),bundle:$r("string")};class Bm extends Fm{data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(e)}}class Um{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Om(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Bm(this._firestore,this._userDataWriter,n.key,n,new Om(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(){const e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new mr(pr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const i=new Bm(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Om(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const i=new Bm(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Om(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let s=-1,r=-1;return 0!==t.type&&(s=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),r=n.indexOf(t.doc.key)),{type:zm(t.type),doc:i,oldIndex:s,newIndex:r}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new mr(pr.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Um._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Ar.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],i=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),i.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function zm(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return cr(61501,{type:e})}}Um._jsonSchemaVersion="firestore/querySnapshot/1.0",Um._jsonSchema={type:$r("string",Um._jsonSchemaVersion),bundleSource:$r("string","QuerySnapshot"),bundleName:$r("string"),bundle:$r("string")};function Vm(e){e=Hr(e,Mp);const t=Hr(e.firestore,Up);return function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=new gr;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,i,s){const r=new mp({next:o=>{r.Nu(),t.enqueueAndForget(()=>kh(e,a));const l=o.docs.has(n);!l&&o.fromCache?s.reject(new mr(pr.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&o.fromCache&&i&&"server"===i.source?s.reject(new mr(pr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(o)},error:e=>s.reject(e)}),a=new Rh(pl(n.path),r,{includeMetadataChanges:!0,Ka:!0});return Th(e,a)}(await _p(e),e.asyncQueue,t,n,i)),i.promise}(zp(t),e._key).then(n=>Km(t,e,n))}function Hm(e){e=Hr(e,Pp);const t=Hr(e.firestore,Up),n=zp(t),i=new ym(t);return Cm(e._query),function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=new gr;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,i,s){const r=new mp({next:n=>{r.Nu(),t.enqueueAndForget(()=>kh(e,a)),n.fromCache&&"server"===i.source?s.reject(new mr(pr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:e=>s.reject(e)}),a=new Rh(n,r,{includeMetadataChanges:!0,Ka:!0});return Th(e,a)}(await _p(e),e.asyncQueue,t,n,i)),i.promise}(n,e._query).then(n=>new Um(t,i,e,n))}function $m(e,t,n){e=Hr(e,Mp);const i=Hr(e.firestore,Up),s=jm(e.converter,t,n);return Wm(i,[tm(em(i),"setDoc",e._key,s,null!==e.converter,n).toMutation(e._key,rc.none())])}function qm(e,t,n){e=Hr(e,Mp);const i=Hr(e.firestore,Up),s=em(i);let r;for(var a=arguments.length,o=new Array(a>3?a-3:0),l=3;l<a;l++)o[l-3]=arguments[l];return r="string"==typeof(t=O(t))||t instanceof $p?rm(s,"updateDoc",e._key,t,n,o):sm(s,"updateDoc",e._key,t),Wm(i,[r.toMutation(e._key,rc.exists(!0))])}function Gm(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];e=O(e);let s={includeMetadataChanges:!1,source:"default"},r=0;"object"!=typeof n[r]||wm(n[r])||(s=n[r++]);const a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(wm(n[r])){const e=n[r];n[r]=e.next?.bind(e),n[r+1]=e.error?.bind(e),n[r+2]=e.complete?.bind(e)}let o,l,c;if(e instanceof Mp)l=Hr(e.firestore,Up),c=pl(e._key.path),o={next:t=>{n[r]&&n[r](Km(l,e,t))},error:n[r+1],complete:n[r+2]};else{const t=Hr(e,Pp);l=Hr(t.firestore,Up),c=t._query;const i=new ym(l);o={next:e=>{n[r]&&n[r](new Um(l,i,t,e))},error:n[r+1],complete:n[r+2]},Cm(e._query)}return function(e,t,n,i){const s=new mp(i),r=new Rh(t,s,n);return e.asyncQueue.enqueueAndForget(async()=>Th(await _p(e),r)),()=>{s.Nu(),e.asyncQueue.enqueueAndForget(async()=>kh(await _p(e),r))}}(zp(l),c,a,o)}function Wm(e,t){return Sp(zp(e),t)}function Km(e,t,n){const i=n.docs.get(t._key),s=new ym(e);return new Fm(e,s,t._key,i,new Om(n.hasPendingWrites,n.fromCache),t.converter)}new WeakMap;!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];nr=Je,We(new F("firestore",(e,n)=>{let{instanceIdentifier:i,options:s}=n;const r=e.getProvider("app").getImmediate(),a=new Up(new br(e.getProvider("auth-internal")),new Sr(r,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new mr(pr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new uo(e.options.projectId,t)}(r,i),r);return s={useFetchStreams:t,...s},a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),tt(bm,xm,e),tt(bm,xm,"esm2020")}();tt("firebase","12.8.0","app");const Qm="firebasestorage.googleapis.com",Xm="storageBucket";class Ym extends T{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(eg(e),`Firebase Storage: ${t} (${eg(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Ym.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return eg(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var Jm,Zm;function eg(e){return"storage/"+e}function tg(){return new Ym(Jm.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function ng(){return new Ym(Jm.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function ig(){return new Ym(Jm.CANCELED,"User canceled the upload/download.")}function sg(e){return new Ym(Jm.INVALID_ARGUMENT,e)}function rg(){return new Ym(Jm.APP_DELETED,"The Firebase app was deleted.")}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(Jm||(Jm={}));class ag{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=ag.makeFromUrl(e,t)}catch(s){return new ag(e,"")}if(""===n.path)return n;throw i=e,new Ym(Jm.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+i+"'.");var i}static makeFromUrl(e,t){let n=null;const i="([A-Za-z0-9.\\-_]+)";const s=new RegExp("^gs://"+i+"(/(.*))?$","i");function r(e){e.path_=decodeURIComponent(e.path)}const a=t.replace(/[.]/g,"\\."),o=[{regex:s,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${a}/v[A-Za-z0-9_]+/b/${i}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:r},{regex:new RegExp(`^https?://${t===Qm?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${i}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:r}];for(let l=0;l<o.length;l++){const t=o[l],i=t.regex.exec(e);if(i){const e=i[t.indices.bucket];let s=i[t.indices.path];s||(s=""),n=new ag(e,s),t.postModify(n);break}}if(null==n)throw function(e){return new Ym(Jm.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class og{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(){}}function lg(e,t,n,i){if(i<t)throw sg(`Invalid value for '${e}'. Expected ${t} or greater.`);if(i>n)throw sg(`Invalid value for '${e}'. Expected ${n} or less.`)}function cg(e){const t=encodeURIComponent;let n="?";for(const i in e)if(e.hasOwnProperty(i)){n=n+(t(i)+"="+t(e[i]))+"&"}return n=n.slice(0,-1),n}function dg(e,t){const n=e>=500&&e<600,i=-1!==[408,429].indexOf(e),s=-1!==t.indexOf(e);return n||i||s}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(Zm||(Zm={}));class ug{constructor(e,t,n,i,s,r,a,o,l,c,d){let u=!(arguments.length>11&&void 0!==arguments[11])||arguments[11],h=arguments.length>12&&void 0!==arguments[12]&&arguments[12];this.url_=e,this.method_=t,this.headers_=n,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=r,this.callback_=a,this.errorCallback_=o,this.timeout_=l,this.progressCallback_=c,this.connectionFactory_=d,this.retry=u,this.isUsingEmulator=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const e=(e,t)=>{if(t)return void e(!1,new hg(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const i=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(i),n.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(i),this.pendingConnection_=null;const t=n.getErrorCode()===Zm.NO_ERROR,s=n.getStatus();if(!t||dg(s,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===Zm.ABORT;return void e(!1,new hg(!1,null,t))}const r=-1!==this.successCodes_.indexOf(s);e(!0,new hg(r,n))})},t=(e,t)=>{const n=this.resolve_,i=this.reject_,s=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(s,s.getResponse());!function(e){return void 0!==e}(e)?n():n(e)}catch(r){i(r)}else if(null!==s){const e=tg();e.serverResponse=s.getErrorText(),this.errorCallback_?i(this.errorCallback_(s,e)):i(e)}else if(t.canceled){i(this.appDelete_?rg():ig())}else{i(ng())}};this.canceled_?t(0,new hg(!1,null,!0)):this.backoffId_=function(e,t,n){let i=1,s=null,r=null,a=!1,o=0;function l(){return 2===o}let c=!1;function d(){if(!c){c=!0;for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];t.apply(null,n)}}function u(t){s=setTimeout(()=>{s=null,e(p,l())},t)}function h(){r&&clearTimeout(r)}function p(e){if(c)return void h();for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];if(e)return h(),void d.call(null,e,...n);if(l()||a)return h(),void d.call(null,e,...n);let r;i<64&&(i*=2),1===o?(o=2,r=0):r=1e3*(i+Math.random()),u(r)}let m=!1;function g(e){m||(m=!0,h(),c||(null!==s?(e||(o=2),clearTimeout(s),u(0)):e||(o=1)))}return u(0),r=setTimeout(()=>{a=!0,g(!0)},n),g}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class hg{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function pg(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}class mg{constructor(e,t){this._service=e,this._location=t instanceof ag?t:ag.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new mg(e,t)}get root(){const e=new ag(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return pg(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new ag(this._location.bucket,e);return new mg(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new Ym(Jm.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function gg(e,t){const n=t?.[Xm];return null==n?null:ag.makeFromBucketSpec(n,e)}class fg{constructor(e,t,n,i,s){let r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=i,this._firebaseVersion=s,this._isUsingEmulator=r,this._bucket=null,this._host=Qm,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?ag.makeFromBucketSpec(i,this._host):gg(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=ag.makeFromBucketSpec(this._url,e):this._bucket=gg(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){lg("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){lg("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if(Qe(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new mg(this,e)}_makeRequest(e,t,n,i){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._deleted)return new og(rg());{const r=function(e,t,n,i,s,r){let a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=cg(e.urlParams),c=e.url+l,d=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(d,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(d,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}(d,r),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(d,i),new ug(c,e.method,d,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,s,a,o)}(e,this._appId,n,i,t,this._firebaseVersion,s,this._isUsingEmulator);return this._requests.add(r),r.getPromise().then(()=>this._requests.delete(r),()=>this._requests.delete(r)),r}}async makeRequestWithTokens(e,t){const[n,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,i).getPromise()}}const yg="@firebase/storage",vg="0.14.0",bg="storage";function xg(e,t){let{instanceIdentifier:n}=t;const i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return new fg(i,s,r,n,Je)}We(new F(bg,xg,"PUBLIC").setMultipleInstances(!0)),tt(yg,vg,""),tt(yg,vg,"esm2020");const wg=Ze({apiKey:"AIzaSyAaXlvuopHtTZglfghnlc_hBqGr1YzPrBk",authDomain:"fredfix.firebaseapp.com",projectId:"fredfix",storageBucket:"fredfix.firebasestorage.app",messagingSenderId:"650169261019",appId:"1:650169261019:web:0106d844197d7f44eca5fe"}),_g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:et();const t=Ke(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=Ke(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(I(n.getOptions(),t??{}))return e;yt(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Rs,persistence:[$i,Ci,Ni]}),i=g("authTokenSyncURL");if(i&&"boolean"===typeof isSecureContext&&isSecureContext){const e=new URL(i,location.origin);if(location.origin===e.origin){const t=(s=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Fs)return;const i=t?.token;Bs!==i&&(Bs=i,await fetch(s,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});!function(e,t,n){O(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e,t,n,i){O(e).onIdTokenChanged(t,n,i)}(n,e=>t(e))}}var s;const r=h("auth");return r&&Un(n,`http://${r}`),n}(wg),Sg=function(e,t){const n="object"==typeof e?e:et(),i="string"==typeof e?e:t||co,s=Ke(n,"firestore").getImmediate({identifier:i});if(!s._initialized){const e=p("firestore");e&&function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e=Hr(e,Dp);const s=y(t),r=e._getSettings(),a={...r,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${n}`;s&&(v(`https://${o}`),_("Firestore",!0)),r.host!==kp&&r.host!==o&&or("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...r,host:o,ssl:s,emulatorOptions:i};if(!I(l,a)&&(e._setSettings(l),i.mockUserToken)){let t,n;if("string"==typeof i.mockUserToken)t=i.mockUserToken,n=tr.MOCK_USER;else{t=b(i.mockUserToken,e._app?.options.projectId);const s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new mr(pr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new tr(s)}e._authCredentials=new vr(new fr(t,n))}}(s,...e)}return s}(wg),Cg=(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:et(),t=arguments.length>1?arguments[1]:void 0;e=O(e);const n=Ke(e,bg).getImmediate({identifier:t}),i=p("storage");i&&function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};!function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.host=`${t}:${n}`;const s=y(t);s&&(v(`https://${e.host}/b`),_("Storage",!0)),e._isUsingEmulator=!0,e._protocol=s?"https":"http";const{mockUserToken:r}=i;r&&(e._overrideAuthToken="string"===typeof r?r:b(r,e.app.options.projectId))}(e,t,n,i)}(n,...i)}(wg),new ri);Cg.setCustomParameters({prompt:"select_account"});var Ag=n(579);const Eg=(0,i.createContext)(),Tg=()=>{const e=(0,i.useContext)(Eg);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},kg=e=>{let{children:t}=e;const[n,s]=(0,i.useState)(null),[r,a]=(0,i.useState)(null),[o,l]=(0,i.useState)(!0),[c,d]=(0,i.useState)(null),u=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return null;try{const n=jp(Sg,"users",e.uid),i=await Vm(n);if(i.exists())return await $m(n,{lastLogin:vm()},{merge:!0}),i.data();{const{email:i,displayName:s,photoURL:r}=e,a={email:i,displayName:s||t.displayName||"",photoURL:r||"",role:t.role||"admin",companyId:t.companyId||null,employeeId:t.employeeId||null,department:t.department||null,created_at:vm(),lastLogin:vm(),...t};return await $m(n,a),a}}catch(c){throw console.error("Error creating/updating user document:",c),new Error(`Failed to save user data: ${c.message}`)}},h=async e=>{try{const t=jp(Sg,"users",e),n=await Vm(t);return n.exists()?{id:n.id,...n.data()}:null}catch(t){return console.error("Error getting user profile:",t),d(`Failed to load user profile: ${t.message}`),null}};(0,i.useEffect)(()=>{const e=function(e,t,n,i){return O(e).onAuthStateChanged(t,n,i)}(_g,async e=>{if(s(e),e){const t=await h(e.uid);a(t)}else a(null);l(!1)});return e},[]);const p={currentUser:n,userProfile:r,loading:o,error:c,signup:async function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{d(null);const{user:s}=await async function(e,t,n){if(Qe(e.app))return Promise.reject(xt(e));const i=kn(e),s=Fn(i,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",li,"EMAIL_PASSWORD_PROVIDER"),r=await s.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&vi(e),t}),a=await ci._fromIdTokenResponse(i,"signIn",r);return await i._updateCurrentUser(a.user),a}(_g,e,t);await bi(s,{displayName:n});let r=null;if(i){const e=jp(Sg,"companies",s.uid);await $m(e,{...i,ownerId:s.uid,created_at:vm(),updated_at:vm()}),r=s.uid}return await u(s,{displayName:n,companyId:r,role:"admin"}),s}catch(s){throw d(s.message),s}},login:async(e,t)=>{try{d(null);const{user:n}=await function(e,t,n){return Qe(e.app)?Promise.reject(xt(e)):fi(O(e),ti.credential(t,n)).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&vi(e),t})}(_g,e,t);return await u(n),n}catch(n){throw d(n.message),n}},loginWithGoogle:async()=>{try{d(null);const{user:e}=await async function(e,t,n){if(Qe(e.app))return Promise.reject(vt(e,"operation-not-supported-in-this-environment"));const i=kn(e);wt(e,t,ni);const s=Xi(i,n);return new is(i,"signInViaPopup",t,s).executeNotNull()}(_g,Cg);return await u(e),e}catch(e){throw d(e.message),e}},logout:async()=>{try{d(null),await function(e){return O(e).signOut()}(_g),a(null)}catch(e){throw d(e.message),e}},resetPassword:async e=>{try{d(null),await async function(e,t,n){const i=kn(e),s={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};n&&yi(i,s,n),await Fn(i,s,"getOobCode",Wn,"EMAIL_PASSWORD_PROVIDER")}(_g,e)}catch(t){throw d(t.message),t}},updateUserProfile:async e=>{try{if(d(null),!n)throw new Error("No user logged in");const t=jp(Sg,"users",n.uid);await $m(t,{...e,updated_at:vm()},{merge:!0});const i=await h(n.uid);return a(i),i}catch(t){throw d(t.message),t}},refreshUserProfile:async()=>{if(n){const e=await h(n.uid);return a(e),e}return null},createUserDocument:u};return(0,Ag.jsx)(Eg.Provider,{value:p,children:!o&&t})};var Ng={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};var Ig=(e,t)=>{const n=(0,i.forwardRef)((n,s)=>{let{color:r="currentColor",size:a=24,strokeWidth:o=2,absoluteStrokeWidth:l,children:c,...d}=n;return(0,i.createElement)("svg",{ref:s,...Ng,width:a,height:a,stroke:r,strokeWidth:l?24*Number(o)/Number(a):o,className:`lucide lucide-${u=e,u.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,...d},[...t.map(e=>{let[t,n]=e;return(0,i.createElement)(t,n)}),...(Array.isArray(c)?c:[c])||[]]);var u});return n.displayName=`${e}`,n};const Dg=Ig("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Pg=Ig("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),Mg=Ig("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Rg=Ig("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Lg=e=>{let{onSwitchToSignup:t,onForgotPassword:n}=e;const{login:s,loginWithGoogle:r,error:a}=Tg(),[o,l]=(0,i.useState)(""),[c,d]=(0,i.useState)(""),[u,h]=(0,i.useState)(!1),[p,m]=(0,i.useState)(""),g=e=>{switch(e){case"auth/user-not-found":return"No account found with this email";case"auth/wrong-password":return"Incorrect password";case"auth/invalid-email":return"Invalid email address";case"auth/user-disabled":return"This account has been disabled";case"auth/too-many-requests":return"Too many attempts. Please try again later";case"auth/popup-closed-by-user":return"Sign-in popup was closed";default:return"An error occurred. Please try again"}};return(0,Ag.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-900 via-blue-800 to-indigo-900 flex items-center justify-center p-4",children:(0,Ag.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-8",children:[(0,Ag.jsxs)("div",{className:"text-center mb-8",children:[(0,Ag.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-4",children:[(0,Ag.jsx)("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:(0,Ag.jsx)("span",{className:"text-white font-bold text-xl",children:"LS"})}),(0,Ag.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:"LineSmart"})]}),(0,Ag.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Welcome back"}),(0,Ag.jsx)("p",{className:"text-gray-500 mt-1",children:"Sign in to your account"})]}),(p||a)&&(0,Ag.jsxs)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3",children:[(0,Ag.jsx)(Dg,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),(0,Ag.jsx)("p",{className:"text-sm text-red-700",children:p||a})]}),(0,Ag.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),o&&c)try{m(""),h(!0),await s(o,c)}catch(t){m(g(t.code))}finally{h(!1)}else m("Please fill in all fields")},className:"space-y-4",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,Ag.jsxs)("div",{className:"relative",children:[(0,Ag.jsx)(Pg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,Ag.jsx)("input",{type:"email",value:o,onChange:e=>l(e.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",placeholder:"you@company.com",disabled:u})]})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,Ag.jsxs)("div",{className:"relative",children:[(0,Ag.jsx)(Mg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,Ag.jsx)("input",{type:"password",value:c,onChange:e=>d(e.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",placeholder:"Enter your password",disabled:u})]})]}),(0,Ag.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Ag.jsxs)("label",{className:"flex items-center",children:[(0,Ag.jsx)("input",{type:"checkbox",className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,Ag.jsx)("span",{className:"ml-2 text-sm text-gray-600",children:"Remember me"})]}),(0,Ag.jsx)("button",{type:"button",onClick:n,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Forgot password?"})]}),(0,Ag.jsx)("button",{type:"submit",disabled:u,className:"w-full py-2.5 px-4 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:ring-4 focus:ring-blue-200 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:u?(0,Ag.jsxs)(Ag.Fragment,{children:[(0,Ag.jsx)(Rg,{className:"w-5 h-5 animate-spin"}),"Signing in..."]}):"Sign in"})]}),(0,Ag.jsxs)("div",{className:"relative my-6",children:[(0,Ag.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,Ag.jsx)("div",{className:"w-full border-t border-gray-200"})}),(0,Ag.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,Ag.jsx)("span",{className:"px-4 bg-white text-gray-500",children:"Or continue with"})})]}),(0,Ag.jsxs)("button",{onClick:async()=>{try{m(""),h(!0),await r()}catch(e){m(g(e.code))}finally{h(!1)}},disabled:u,className:"w-full py-2.5 px-4 bg-white border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 focus:ring-4 focus:ring-gray-100 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3",children:[(0,Ag.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[(0,Ag.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,Ag.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,Ag.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,Ag.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]}),(0,Ag.jsxs)("p",{className:"mt-6 text-center text-sm text-gray-600",children:["Don't have an account?"," ",(0,Ag.jsx)("button",{onClick:t,className:"text-blue-600 hover:text-blue-700 font-medium",children:"Sign up"})]})]})})},jg=Ig("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),Og=Ig("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Fg=Ig("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),Bg=e=>{let{onSwitchToLogin:t}=e;const{signup:n,loginWithGoogle:s,error:r}=Tg(),[a,o]=(0,i.useState)(1),[l,c]=(0,i.useState)(!1),[d,u]=(0,i.useState)(""),[h,p]=(0,i.useState)(""),[m,g]=(0,i.useState)(""),[f,y]=(0,i.useState)(""),[v,b]=(0,i.useState)(""),[x,w]=(0,i.useState)(""),[_,S]=(0,i.useState)(""),[C,A]=(0,i.useState)(""),E=e=>{switch(e){case"auth/email-already-in-use":return"An account with this email already exists";case"auth/invalid-email":return"Invalid email address";case"auth/weak-password":return"Password is too weak";case"auth/popup-closed-by-user":return"Sign-in popup was closed";default:return"An error occurred. Please try again"}};return(0,Ag.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-900 via-blue-800 to-indigo-900 flex items-center justify-center p-4",children:(0,Ag.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-8",children:[(0,Ag.jsxs)("div",{className:"text-center mb-8",children:[(0,Ag.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-4",children:[(0,Ag.jsx)("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:(0,Ag.jsx)("span",{className:"text-white font-bold text-xl",children:"LS"})}),(0,Ag.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:"LineSmart"})]}),(0,Ag.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Create your account"}),(0,Ag.jsx)("p",{className:"text-gray-500 mt-1",children:"Start optimizing your workforce training"})]}),(0,Ag.jsxs)("div",{className:"flex items-center justify-center gap-4 mb-8",children:[(0,Ag.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Ag.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center "+(a>=1?"bg-blue-600 text-white":"bg-gray-200 text-gray-500"),children:a>1?(0,Ag.jsx)(jg,{className:"w-5 h-5"}):"1"}),(0,Ag.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Account"})]}),(0,Ag.jsx)("div",{className:"w-12 h-0.5 bg-gray-200",children:(0,Ag.jsx)("div",{className:"h-full bg-blue-600 transition-all "+(a>=2?"w-full":"w-0")})}),(0,Ag.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Ag.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center "+(a>=2?"bg-blue-600 text-white":"bg-gray-200 text-gray-500"),children:"2"}),(0,Ag.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Company"})]})]}),(d||r)&&(0,Ag.jsxs)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3",children:[(0,Ag.jsx)(Dg,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),(0,Ag.jsx)("p",{className:"text-sm text-red-700",children:d||r})]}),1===a&&(0,Ag.jsxs)("form",{onSubmit:e=>{e.preventDefault(),h&&m&&f&&v?m===f?m.length<6?u("Password must be at least 6 characters"):(u(""),o(2)):u("Passwords do not match"):u("Please fill in all fields")},className:"space-y-4",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),(0,Ag.jsxs)("div",{className:"relative",children:[(0,Ag.jsx)(Og,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,Ag.jsx)("input",{type:"text",value:v,onChange:e=>b(e.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",placeholder:"John Smith",disabled:l})]})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,Ag.jsxs)("div",{className:"relative",children:[(0,Ag.jsx)(Pg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,Ag.jsx)("input",{type:"email",value:h,onChange:e=>p(e.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",placeholder:"you@company.com",disabled:l})]})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,Ag.jsxs)("div",{className:"relative",children:[(0,Ag.jsx)(Mg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,Ag.jsx)("input",{type:"password",value:m,onChange:e=>g(e.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",placeholder:"Create a password",disabled:l})]})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),(0,Ag.jsxs)("div",{className:"relative",children:[(0,Ag.jsx)(Mg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,Ag.jsx)("input",{type:"password",value:f,onChange:e=>y(e.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",placeholder:"Confirm your password",disabled:l})]})]}),(0,Ag.jsx)("button",{type:"submit",className:"w-full py-2.5 px-4 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:ring-4 focus:ring-blue-200 transition-all",children:"Continue"}),(0,Ag.jsxs)("div",{className:"relative my-6",children:[(0,Ag.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,Ag.jsx)("div",{className:"w-full border-t border-gray-200"})}),(0,Ag.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,Ag.jsx)("span",{className:"px-4 bg-white text-gray-500",children:"Or continue with"})})]}),(0,Ag.jsxs)("button",{type:"button",onClick:async()=>{try{u(""),c(!0),await s()}catch(e){u(E(e.code))}finally{c(!1)}},disabled:l,className:"w-full py-2.5 px-4 bg-white border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 focus:ring-4 focus:ring-gray-100 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3",children:[(0,Ag.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[(0,Ag.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,Ag.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,Ag.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,Ag.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})]}),2===a&&(0,Ag.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),x&&_)try{u(""),c(!0);const e={name:x,industry:_,size:C,departments:[],safetyRequirements:[],defaultLanguage:"en",supportedLanguages:["en"],aiModels:{primary:"gpt-4",secondary:"claude-3"},dataSource:{type:"rag"}};await n(h,m,v,e)}catch(t){u(E(t.code))}finally{c(!1)}else u("Please fill in company details")},className:"space-y-4",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name"}),(0,Ag.jsxs)("div",{className:"relative",children:[(0,Ag.jsx)(Fg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,Ag.jsx)("input",{type:"text",value:x,onChange:e=>w(e.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",placeholder:"Your company name",disabled:l})]})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Industry"}),(0,Ag.jsxs)("select",{value:_,onChange:e=>S(e.target.value),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",disabled:l,children:[(0,Ag.jsx)("option",{value:"",children:"Select your industry"}),["Manufacturing","Construction","Healthcare","Food & Beverage","Logistics","Retail","Technology","Other"].map(e=>(0,Ag.jsx)("option",{value:e,children:e},e))]})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Size"}),(0,Ag.jsxs)("select",{value:C,onChange:e=>A(e.target.value),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",disabled:l,children:[(0,Ag.jsx)("option",{value:"",children:"Select company size"}),[{value:"small",label:"1-50 employees"},{value:"medium",label:"51-200 employees"},{value:"large",label:"201-1000 employees"},{value:"enterprise",label:"1000+ employees"}].map(e=>(0,Ag.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,Ag.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,Ag.jsx)("button",{type:"button",onClick:()=>o(1),className:"flex-1 py-2.5 px-4 bg-gray-100 text-gray-700 font-medium rounded-lg hover:bg-gray-200 transition-all",disabled:l,children:"Back"}),(0,Ag.jsx)("button",{type:"submit",disabled:l,className:"flex-1 py-2.5 px-4 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:ring-4 focus:ring-blue-200 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:l?(0,Ag.jsxs)(Ag.Fragment,{children:[(0,Ag.jsx)(Rg,{className:"w-5 h-5 animate-spin"}),"Creating..."]}):"Create Account"})]})]}),(0,Ag.jsxs)("p",{className:"mt-6 text-center text-sm text-gray-600",children:["Already have an account?"," ",(0,Ag.jsx)("button",{onClick:t,className:"text-blue-600 hover:text-blue-700 font-medium",children:"Sign in"})]})]})})},Ug=e=>{let{children:t}=e;const{currentUser:n,loading:i}=Tg();return i?(0,Ag.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,Ag.jsxs)("div",{className:"text-center",children:[(0,Ag.jsx)(Rg,{className:"w-12 h-12 text-blue-600 animate-spin mx-auto"}),(0,Ag.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):n?t:null},zg=Ig("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]),Vg=Ig("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]),Hg=Ig("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),$g=["Manufacturing","Food & Beverage","Pharmaceutical","Automotive","Aerospace","Chemical","Construction","Energy","Healthcare","Technology"],qg=["1-50 employees","51-200 employees","201-1000 employees","1001-5000 employees","5000+ employees"],Gg=["Production","Maintenance","Quality Assurance","Safety","Warehouse","Sanitation","Management","HR","Engineering","R&D","Logistics"],Wg=["OSHA Compliance","ISO 45001","SQF Food Safety","HACCP","GMP","FDA Regulations","Environmental Health","Fire Safety","Chemical Safety"],Kg=["Safety Procedures","Equipment Quality","SQF Compliance","Disciplinary Guidelines","Technical Operations","Emergency Procedures","Quality Control","Maintenance Protocols","Food Safety","Environmental Health","Onboarding Orientation","Leadership Development"],Qg=[{code:"en",name:"English",flag:"\ud83c\uddfa\ud83c\uddf8"},{code:"es",name:"Espa\xf1ol",flag:"\ud83c\uddea\ud83c\uddf8"},{code:"fr",name:"Fran\xe7ais",flag:"\ud83c\uddeb\ud83c\uddf7"},{code:"pt",name:"Portugu\xeas",flag:"\ud83c\udde7\ud83c\uddf7"},{code:"de",name:"Deutsch",flag:"\ud83c\udde9\ud83c\uddea"},{code:"it",name:"Italiano",flag:"\ud83c\uddee\ud83c\uddf9"},{code:"zh",name:"\u4e2d\u6587",flag:"\ud83c\udde8\ud83c\uddf3"},{code:"ja",name:"\u65e5\u672c\u8a9e",flag:"\ud83c\uddef\ud83c\uddf5"},{code:"ko",name:"\ud55c\uad6d\uc5b4",flag:"\ud83c\uddf0\ud83c\uddf7"},{code:"ar",name:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629",flag:"\ud83c\uddf8\ud83c\udde6"}],Xg=[{id:"free",name:"LineSmart Free Tier",description:"Free AI-powered training (limited to 50 generations/month)",isFree:!0,badge:"FREE"},{id:"openai",name:"OpenAI GPT",description:"GPT-3.5/GPT-4 models - bring your own API key for unlimited use"},{id:"claude",name:"Anthropic Claude",description:"Claude 3 Sonnet/Opus - bring your own API key"},{id:"gemini",name:"Google Gemini",description:"Gemini Pro for multimodal training - bring your own API key"},{id:"llama",name:"Local Llama",description:"Run Llama locally with Ollama - free & private, requires local setup"},{id:"custom",name:"Custom Model",description:"Connect your own fine-tuned or enterprise model"}],Yg={company:{name:"",industry:"",size:"",departments:[],customDepartments:"",safetyRequirements:[],complianceStandards:[],defaultLanguage:"en",supportedLanguages:["en","es","fr","pt","de"]},aiModels:{primary:"free",secondary:"",configs:{free:{model:"gpt-4o-mini",usesBackend:!0},openai:{apiKey:"",model:"gpt-4o-mini",endpoint:""},claude:{apiKey:"",model:"claude-3-sonnet",endpoint:""},gemini:{apiKey:"",model:"gemini-pro",endpoint:""},llama:{apiKey:"",model:"llama-2-70b",endpoint:"http://localhost:11434"},custom:{name:"",apiKey:"",model:"",endpoint:""}}},dataSource:{type:"",config:{googleDrive:{folderId:"",credentials:"",sharedDrives:[]},s3:{bucket:"",region:"",accessKey:"",secretKey:""},azure:{container:"",connectionString:"",account:""},sharepoint:{siteUrl:"",tenantId:"",clientId:"",clientSecret:""},local:{path:"",format:""}},trainingDataSettings:{enabled:!0,chunkSize:1e3,overlap:200,vectorStore:"chromadb",embeddingModel:"text-embedding-ada-002"}},onboarding:{defaultTrainings:[],departmentSpecific:{},probationPeriod:90,checkpoints:[],mentorAssignment:!0},supervisorPermissions:{canCreateDepartmentTraining:!0,canCreateIndividualTraining:!0,canModifyTraining:!0,canViewAllEmployees:!0,canAssignTraining:!0,requiresApproval:!1}},Jg={title:"",department:"",trainingType:"",description:"",objectives:"",documents:[],assignedEmployees:[],dueDate:"",sourceDocs:[],aiModel:"primary",language:"en",trainingScope:"department",supervisorId:null,quizConfig:{questionCount:5,passingScore:80,style:"mixed"}},Zg={name:"",department:"",position:"",email:"",hireDate:"",directSupervisor:"",preferredLanguage:"en"},ef=[{id:1,name:"John Smith",department:"Maintenance",position:"Senior Technician",role:"employee",supervisor:"Mike Rodriguez",hireDate:"2023-01-15",preferredLanguage:"en",completedTrainings:8,totalTrainings:12,lastTraining:"2024-07-20",performance:92,certifications:["OSHA 30","Electrical Safety"],trainingHistory:[{id:1,title:"Lockout/Tagout Procedures",date:"2024-07-20",score:95,status:"completed",language:"en",sourceDocs:["Manual_LOTO_v2.pdf","Safety_Protocol_2024.docx"]},{id:2,title:"Equipment Maintenance",date:"2024-07-15",score:88,status:"completed",language:"en",sourceDocs:["Maintenance_Guide.pdf"]},{id:3,title:"Safety Protocols",date:"2024-07-10",score:92,status:"completed",language:"en",sourceDocs:["Company_Safety_Manual.pdf","OSHA_Guidelines.pdf"]}],recommendedTrainings:[{title:"Advanced Hydraulic Systems",reason:"Based on recent equipment updates and internal documentation analysis",priority:"high",sourceDocs:["Hydraulic_Manual_2024.pdf"]},{title:"Emergency Response",reason:"Due for annual recertification per company policy",priority:"medium",sourceDocs:["Emergency_Procedures.docx"]}]},{id:2,name:"Sarah Johnson",department:"Production",position:"Line Operator",role:"employee",supervisor:"Lisa Chen",hireDate:"2023-06-01",preferredLanguage:"en",completedTrainings:6,totalTrainings:10,lastTraining:"2024-07-18",performance:85,certifications:["Food Safety"],trainingHistory:[{id:4,title:"SQF Compliance",date:"2024-07-18",score:82,status:"completed",language:"en",sourceDocs:["SQF_Manual.pdf"]},{id:5,title:"Quality Control",date:"2024-07-12",score:88,status:"completed",language:"en",sourceDocs:["Quality_Guidelines.pdf"]}],recommendedTrainings:[{title:"Advanced Quality Control",reason:"Based on recent quality metrics",priority:"high"},{title:"Team Leadership",reason:"Career development opportunity",priority:"low"}]},{id:3,name:"Mike Rodriguez",department:"Safety",position:"Safety Coordinator",role:"supervisor",supervisor:"Director of Operations",hireDate:"2022-11-10",preferredLanguage:"en",completedTrainings:15,totalTrainings:18,lastTraining:"2024-07-22",performance:96,certifications:["OSHA 30","First Aid","Environmental Safety"],supervisesEmployees:[1],canCreateTraining:!0,trainingHistory:[{id:6,title:"Hazard Communication",date:"2024-07-22",score:98,status:"completed",language:"en",sourceDocs:["OSHA_Standards.pdf"]},{id:7,title:"Incident Investigation",date:"2024-07-17",score:94,status:"completed",language:"en",sourceDocs:["Investigation_Manual.pdf"]}],recommendedTrainings:[{title:"Industrial Hygiene",reason:"Skill enhancement opportunity",priority:"medium"}]},{id:4,name:"Mar\xeda Garc\xeda",department:"Production",position:"Line Operator",role:"employee",supervisor:"Lisa Chen",hireDate:"2024-02-15",preferredLanguage:"es",completedTrainings:3,totalTrainings:8,lastTraining:"2024-07-10",performance:78,certifications:["Basic Safety"],trainingHistory:[{id:8,title:"Orientaci\xf3n de Seguridad",date:"2024-07-10",score:85,status:"completed",language:"es",sourceDocs:["Manual_Seguridad_ES.pdf"]},{id:9,title:"Procedimientos de Calidad",date:"2024-06-20",score:82,status:"completed",language:"es",sourceDocs:["Calidad_Manual_ES.pdf"]}],recommendedTrainings:[{title:"Seguridad Alimentaria Avanzada",reason:"Necesario para certificaci\xf3n departamental",priority:"high"},{title:"Comunicaci\xf3n en el Lugar de Trabajo",reason:"Mejora de habilidades de comunicaci\xf3n",priority:"medium"}]},{id:5,name:"Lisa Chen",department:"Production",position:"Production Supervisor",role:"supervisor",supervisor:"Director of Operations",hireDate:"2021-08-10",preferredLanguage:"en",completedTrainings:20,totalTrainings:22,lastTraining:"2024-07-25",performance:94,certifications:["Production Management","Lean Manufacturing","Food Safety"],supervisesEmployees:[2,4],canCreateTraining:!0,trainingHistory:[{id:10,title:"Leadership Development",date:"2024-07-25",score:96,status:"completed",language:"en",sourceDocs:["Leadership_Guide.pdf"]}],recommendedTrainings:[{title:"Advanced Lean Manufacturing",reason:"Process improvement initiative",priority:"medium"}]}],tf=["welcome","company","ai-models","complete"],nf={admin:{name:"Administrator",description:"Full access to all company data and settings",level:1,canViewAllEmployees:!0,canViewAllDepartments:!0,canManageUsers:!0,canInviteUsers:!0,canManageSettings:!0,canCreateTraining:!0,canAssignTraining:!0,canApproveTraining:!0,canDeleteTraining:!0,canViewReports:!0,canExportData:!0},manager:{name:"Manager",description:"Department management and training approval",level:2,canViewAllEmployees:!1,canViewAllDepartments:!1,canManageUsers:!1,canInviteUsers:!0,canManageSettings:!1,canCreateTraining:!0,canAssignTraining:!0,canApproveTraining:!0,canDeleteTraining:!1,canViewReports:!0,canExportData:!0},supervisor:{name:"Supervisor",description:"Team oversight and training creation",level:3,canViewAllEmployees:!1,canViewAllDepartments:!1,canManageUsers:!1,canInviteUsers:!1,canManageSettings:!1,canCreateTraining:!0,canAssignTraining:!0,canApproveTraining:!1,canDeleteTraining:!1,canViewReports:!0,canExportData:!1},lead:{name:"Team Lead",description:"Lead a team and assign training",level:4,canViewAllEmployees:!1,canViewAllDepartments:!1,canManageUsers:!1,canInviteUsers:!1,canManageSettings:!1,canCreateTraining:!1,canAssignTraining:!0,canApproveTraining:!1,canDeleteTraining:!1,canViewReports:!0,canExportData:!1},technician:{name:"Technician",description:"Technical role with own training access",level:5,canViewAllEmployees:!1,canViewAllDepartments:!1,canManageUsers:!1,canInviteUsers:!1,canManageSettings:!1,canCreateTraining:!1,canAssignTraining:!1,canApproveTraining:!1,canDeleteTraining:!1,canViewReports:!1,canExportData:!1},operator:{name:"Operator",description:"Production/operations role with own training access",level:5,canViewAllEmployees:!1,canViewAllDepartments:!1,canManageUsers:!1,canInviteUsers:!1,canManageSettings:!1,canCreateTraining:!1,canAssignTraining:!1,canApproveTraining:!1,canDeleteTraining:!1,canViewReports:!1,canExportData:!1},employee:{name:"Employee",description:"General employee with own training access",level:6,canViewAllEmployees:!1,canViewAllDepartments:!1,canManageUsers:!1,canInviteUsers:!1,canManageSettings:!1,canCreateTraining:!1,canAssignTraining:!1,canApproveTraining:!1,canDeleteTraining:!1,canViewReports:!1,canExportData:!1}},sf={Production:["Line Operator","Machine Operator","Production Lead","Production Supervisor","Production Manager"],Maintenance:["Maintenance Technician","Electrician","Mechanic","Maintenance Lead","Maintenance Supervisor","Maintenance Manager"],"Quality Assurance":["QA Inspector","QA Technician","QA Lead","QA Supervisor","QA Manager"],Safety:["Safety Coordinator","Safety Specialist","Safety Supervisor","Safety Manager","EHS Manager"],Warehouse:["Warehouse Associate","Forklift Operator","Shipping Clerk","Warehouse Lead","Warehouse Supervisor","Warehouse Manager"],Sanitation:["Sanitation Worker","Sanitation Lead","Sanitation Supervisor","Sanitation Manager"],Management:["Director","Plant Manager","Operations Manager","General Manager"],HR:["HR Coordinator","HR Specialist","HR Manager","HR Director"],Engineering:["Process Engineer","Manufacturing Engineer","Engineering Manager"],"R&D":["Research Scientist","R&D Technician","R&D Manager"],Logistics:["Logistics Coordinator","Logistics Analyst","Logistics Manager"]},rf={prefix:"EMP",digits:4,format:"PREFIX-NUMBER"},af={pending:{label:"Pending",color:"yellow"},accepted:{label:"Accepted",color:"green"},expired:{label:"Expired",color:"red"},cancelled:{label:"Cancelled",color:"gray"}};const of=new class{async generateEmployeeId(e){const t=jp(Sg,"companies",e),n=await Vm(t);let i=1;if(n.exists()){i=(n.data().lastEmployeeNumber||0)+1}await qm(t,{lastEmployeeNumber:i});const{prefix:s,digits:r}=rf;return`${s}-${String(i).padStart(r,"0")}`}async createInvitation(e,t,n){const{email:i,role:s,department:r,position:a,name:o}=n,l=await this.generateEmployeeId(e),c=this.generateInviteCode(),d=new Date;d.setDate(d.getDate()+7);const u={email:i.toLowerCase(),name:o,role:s,department:r,position:a,employeeId:l,companyId:e,invitedBy:t,inviteCode:c,status:"pending",createdAt:vm(),expiresAt:d.toISOString(),acceptedAt:null},h=jp(Lp(Sg,"companies",e,"invitations"));return await $m(h,u),{id:h.id,...u,inviteLink:this.generateInviteLink(e,c)}}generateInviteCode(){const e="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let t="";for(let n=0;n<6;n++)t+=e.charAt(Math.floor(32*Math.random()));return t}generateInviteLink(e,t){return`${window.location.origin}/join?company=${e}&code=${t}`}async verifyInvitation(e,t){const n=Tm(Lp(Sg,"companies",e,"invitations"),Nm("inviteCode","==",t),Nm("status","==","pending")),i=await Hm(n);if(i.empty)return{valid:!1,error:"Invalid or expired invitation code"};const s=i.docs[0],r=s.data();return new Date(r.expiresAt)<new Date?(await qm(s.ref,{status:"expired"}),{valid:!1,error:"Invitation has expired"}):{valid:!0,invitation:{id:s.id,...r}}}async acceptInvitation(e,t,n){const i=await this.verifyInvitation(e,t);if(!i.valid)throw new Error(i.error);const{invitation:s}=i,r=jp(Sg,"companies",e,"invitations",s.id);await qm(r,{status:"accepted",acceptedAt:vm(),acceptedBy:n});const a=jp(Sg,"users",n);await $m(a,{companyId:e,employeeId:s.employeeId,role:s.role,department:s.department,position:s.position,onboardingStatus:"in_progress",invitedBy:s.invitedBy,joinedAt:vm(),updated_at:vm()},{merge:!0});const o=jp(Sg,"companies",e,"employees",s.employeeId);return await $m(o,{userId:n,employeeId:s.employeeId,name:s.name,email:s.email,role:s.role,department:s.department,position:s.position,status:"active",hireDate:(new Date).toISOString().split("T")[0],completedTrainings:0,totalTrainings:0,onboardingStatus:"in_progress",createdAt:vm(),updatedAt:vm()}),{success:!0,employeeId:s.employeeId,role:s.role,department:s.department}}async getCompanyInvitations(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=Lp(Sg,"companies",e,"invitations");let i;i=t?Tm(n,Nm("status","==",t),Pm("createdAt","desc")):Tm(n,Pm("createdAt","desc"));return(await Hm(i)).docs.map(e=>({id:e.id,...e.data()}))}async cancelInvitation(e,t){const n=jp(Sg,"companies",e,"invitations",t);await qm(n,{status:"cancelled",cancelledAt:vm()})}async resendInvitation(e,t){const n=jp(Sg,"companies",e,"invitations",t);if(!(await Vm(n)).exists())throw new Error("Invitation not found");const i=this.generateInviteCode(),s=new Date;return s.setDate(s.getDate()+7),await qm(n,{inviteCode:i,expiresAt:s.toISOString(),status:"pending",resentAt:vm()}),{inviteCode:i,inviteLink:this.generateInviteLink(e,i)}}async getCompanyMembers(e){const t=Tm(Lp(Sg,"companies",e,"employees"),Pm("createdAt","desc"));return(await Hm(t)).docs.map(e=>({id:e.id,...e.data()}))}async updateUserRole(e,t,n){const i=jp(Sg,"companies",e,"employees",t),s=await Vm(i);if(!s.exists())throw new Error("Employee not found");const r=s.data();if(await qm(i,{role:n,updatedAt:vm()}),r.userId){const e=jp(Sg,"users",r.userId);await qm(e,{role:n,updated_at:vm()})}}async deactivateUser(e,t){const n=jp(Sg,"companies",e,"employees",t);await qm(n,{status:"inactive",deactivatedAt:vm()})}async reactivateUser(e,t){const n=jp(Sg,"companies",e,"employees",t);await qm(n,{status:"active",reactivatedAt:vm()})}async completeOnboarding(e,t,n){const i=jp(Sg,"companies",e,"employees",t);await qm(i,{onboardingStatus:"completed",onboardingCompletedAt:vm()});const s=jp(Sg,"users",n);await qm(s,{onboardingStatus:"completed",updated_at:vm()})}},lf=()=>{var e;const{currentUser:t,signup:n,login:s,loginWithGoogle:r}=Tg(),a=(0,i.useMemo)(()=>new URLSearchParams(window.location.search),[]),o=a.get("company"),l=a.get("code"),c=e=>{window.location.href=e},[d,u]=(0,i.useState)("verify"),[h,p]=(0,i.useState)(null),[m,g]=(0,i.useState)(null),[f,y]=(0,i.useState)(null),[v,b]=(0,i.useState)(!0),[x,w]=(0,i.useState)(!0),[_,S]=(0,i.useState)({email:"",password:"",confirmPassword:""}),[C,A]=(0,i.useState)(!1),[E,T]=(0,i.useState)(null);(0,i.useEffect)(()=>{k()},[o,l]),(0,i.useEffect)(()=>{t&&h&&"auth"===d&&N()},[t,h,d]);const k=async()=>{if(!o||!l)return y("Invalid invitation link. Please check the link and try again."),void b(!1);try{const e=await of.verifyInvitation(o,l);if(!e.valid)return y(e.error),void b(!1);p(e.invitation),S(t=>({...t,email:e.invitation.email})),u("auth")}catch(e){y("Error verifying invitation: "+e.message)}b(!1)},N=async()=>{b(!0);try{await of.acceptInvitation(o,l,t.uid),u("complete")}catch(e){y("Error accepting invitation: "+e.message)}b(!1)},I=()=>{c("/")};return v&&"verify"===d?(0,Ag.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,Ag.jsxs)("div",{className:"text-center",children:[(0,Ag.jsx)(zg,{className:"h-8 w-8 animate-spin text-blue-600 mx-auto mb-4"}),(0,Ag.jsx)("p",{className:"text-gray-600",children:"Verifying invitation..."})]})}):f?(0,Ag.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,Ag.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-8 max-w-md w-full text-center",children:[(0,Ag.jsx)(Dg,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),(0,Ag.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Invitation Error"}),(0,Ag.jsx)("p",{className:"text-gray-600 mb-6",children:f}),(0,Ag.jsx)("button",{onClick:()=>c("/"),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Go to Homepage"})]})}):"complete"===d?(0,Ag.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,Ag.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-8 max-w-md w-full text-center",children:[(0,Ag.jsx)(jg,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),(0,Ag.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Welcome to the Team!"}),(0,Ag.jsx)("p",{className:"text-gray-600 mb-6",children:"Your account has been set up successfully."}),(0,Ag.jsx)("div",{className:"bg-gray-50 rounded-lg p-4 mb-6 text-left",children:(0,Ag.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,Ag.jsxs)("div",{className:"flex justify-between",children:[(0,Ag.jsx)("span",{className:"text-gray-500",children:"Employee ID:"}),(0,Ag.jsx)("span",{className:"font-mono font-medium",children:null===h||void 0===h?void 0:h.employeeId})]}),(0,Ag.jsxs)("div",{className:"flex justify-between",children:[(0,Ag.jsx)("span",{className:"text-gray-500",children:"Role:"}),(0,Ag.jsx)("span",{className:"font-medium",children:null===(D=nf[null===h||void 0===h?void 0:h.role])||void 0===D?void 0:D.name})]}),(0,Ag.jsxs)("div",{className:"flex justify-between",children:[(0,Ag.jsx)("span",{className:"text-gray-500",children:"Department:"}),(0,Ag.jsx)("span",{className:"font-medium",children:null===h||void 0===h?void 0:h.department})]})]})}),(0,Ag.jsx)("button",{onClick:I,className:"w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium",children:"Go to Dashboard"})]})}):(0,Ag.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,Ag.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-8 max-w-md w-full",children:[(0,Ag.jsxs)("div",{className:"text-center mb-8",children:[(0,Ag.jsxs)("div",{className:"flex items-center justify-center space-x-2 mb-4",children:[(0,Ag.jsx)(Vg,{className:"h-8 w-8 text-blue-600"}),(0,Ag.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Line Smart"})]}),(0,Ag.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"You're Invited!"}),(0,Ag.jsxs)("p",{className:"text-gray-600",children:["You've been invited to join as a ",(0,Ag.jsx)("strong",{children:null===(e=nf[null===h||void 0===h?void 0:h.role])||void 0===e?void 0:e.name})," in the"," ",(0,Ag.jsx)("strong",{children:null===h||void 0===h?void 0:h.department})," department."]})]}),(0,Ag.jsx)("div",{className:"bg-blue-50 rounded-lg p-4 mb-6",children:(0,Ag.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Ag.jsx)(Hg,{className:"h-5 w-5 text-blue-600"}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("div",{className:"font-medium text-blue-900",children:null===h||void 0===h?void 0:h.name}),(0,Ag.jsxs)("div",{className:"text-sm text-blue-700",children:["Employee ID: ",null===h||void 0===h?void 0:h.employeeId]})]})]})}),(0,Ag.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),T(null),A(!0);try{if(x)await s(_.email,_.password);else{if(_.password!==_.confirmPassword)throw new Error("Passwords do not match");await n(_.email,_.password,h.name)}}catch(t){T(t.message)}A(!1)},className:"space-y-4",children:[E&&(0,Ag.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:E}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),(0,Ag.jsx)("input",{type:"email",required:!0,value:_.email,onChange:e=>S({..._,email:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"your@email.com"})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,Ag.jsx)("input",{type:"password",required:!0,value:_.password,onChange:e=>S({..._,password:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter your password"})]}),!x&&(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),(0,Ag.jsx)("input",{type:"password",required:!0,value:_.confirmPassword,onChange:e=>S({..._,confirmPassword:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Confirm your password"})]}),(0,Ag.jsx)("button",{type:"submit",disabled:C,className:"w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 font-medium",children:C?"Please wait...":x?"Sign In & Join":"Create Account & Join"}),(0,Ag.jsxs)("div",{className:"relative my-4",children:[(0,Ag.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,Ag.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,Ag.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,Ag.jsx)("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with"})})]}),(0,Ag.jsxs)("button",{type:"button",onClick:async()=>{T(null),A(!0);try{await r()}catch(e){T(e.message)}A(!1)},disabled:C,className:"w-full px-4 py-3 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium flex items-center justify-center space-x-2",children:[(0,Ag.jsxs)("svg",{className:"h-5 w-5",viewBox:"0 0 24 24",children:[(0,Ag.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,Ag.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,Ag.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,Ag.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),(0,Ag.jsx)("span",{children:"Sign in with Google"})]}),(0,Ag.jsxs)("p",{className:"text-center text-sm text-gray-600 mt-4",children:[x?"Don't have an account? ":"Already have an account? ",(0,Ag.jsx)("button",{type:"button",onClick:()=>w(!x),className:"text-blue-600 hover:text-blue-700 font-medium",children:x?"Create one":"Sign in"})]})]})]})});var D},cf=(0,i.createContext)(),df=()=>{const e=(0,i.useContext)(cf);if(!e)throw new Error("useCompany must be used within a CompanyProvider");return e},uf=async e=>{try{const t=jp(Sg,"companies",e),n=await Vm(t);let i=1;if(n.exists()){i=(n.data().lastEmployeeNumber||0)+1}await qm(t,{lastEmployeeNumber:i});const{prefix:s,digits:r}=rf;return`${s}-${String(i).padStart(r,"0")}`}catch(t){throw console.error("Error generating employee ID:",t),new Error(`Failed to generate employee ID: ${t.message}`)}},hf=e=>{let{children:t}=e;const{userProfile:n,currentUser:s}=Tg(),[r,a]=(0,i.useState)(null),[o,l]=(0,i.useState)([]),[c,d]=(0,i.useState)([]),[u,h]=(0,i.useState)(!0),[p,m]=(0,i.useState)(null),g=null===n||void 0===n?void 0:n.companyId,f=(null===n||void 0===n?void 0:n.role)||"employee",y=null===n||void 0===n?void 0:n.department,v=nf[f]||nf.employee,b=(0,i.useMemo)(()=>o.length?v.canViewAllEmployees?o:["manager","supervisor"].includes(f)&&y?o.filter(e=>e.department===y):"lead"===f&&y?o.filter(e=>e.department===y&&["technician","operator","employee"].includes(e.role)):["technician","operator","employee"].includes(f)?o.filter(e=>e.userId===(null===s||void 0===s?void 0:s.uid)):o:[],[o,v,f,y,s]);(0,i.useEffect)(()=>{if(!g)return void h(!1);return Gm(jp(Sg,"companies",g),e=>{e.exists()?a({id:e.id,...e.data()}):a(null),h(!1)},e=>{console.error("Error fetching company:",e),m(e.message),h(!1)})},[g]),(0,i.useEffect)(()=>{if(!g)return;return Gm(Tm(Lp(Sg,"companies",g,"employees")),e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));l(t)},e=>{console.error("Error fetching employees:",e),m(e.message)})},[g]),(0,i.useEffect)(()=>{if(!g)return;return Gm(Tm(Lp(Sg,"companies",g,"trainings")),e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));d(t)},e=>{console.error("Error fetching trainings:",e),m(e.message)})},[g]);const x=(0,i.useCallback)(async e=>{try{m(null);const n=g||(null===s||void 0===s?void 0:s.uid);if(!n)throw new Error("No company ID available");const i=jp(Sg,"companies",n),r=await Vm(i),a=!r.exists();if(r.exists()?await qm(i,{...e,updated_at:vm()}):await $m(i,{...e,ownerId:null===s||void 0===s?void 0:s.uid,lastEmployeeNumber:0,created_at:vm(),updated_at:vm()}),null!==s&&void 0!==s&&s.uid)try{const e=jp(Sg,"users",s.uid),t=await Vm(e);if(!t.exists())throw new Error("User document not found");const i=t.data()||{};let r=i.employeeId;if(!r&&a){r=await uf(n);const e=jp(Sg,"companies",n,"employees",r);await $m(e,{userId:s.uid,employeeId:r,name:s.displayName||i.displayName||"Admin",email:s.email,role:"admin",department:"Management",position:"Administrator",status:"active",hireDate:(new Date).toISOString().split("T")[0],completedTrainings:0,totalTrainings:0,createdAt:vm(),updatedAt:vm()})}await qm(e,{companyId:n,employeeId:r||i.employeeId,role:i.role||"admin",updated_at:vm()}),console.log("\ud83d\udc64 User assigned to company:",n,"Employee ID:",r||i.employeeId)}catch(t){console.error("Error updating user profile:",t),m(`Company saved but failed to update user profile: ${t.message}`)}return n}catch(n){throw console.error("Error saving company:",n),m(`Failed to save company: ${n.message}`),n}},[g,s]),w=(0,i.useCallback)(async e=>{try{if(m(null),!g)throw new Error("No company ID");if(!e.name||!e.email)throw new Error("Employee name and email are required");const t=await uf(g),n=jp(Sg,"companies",g,"employees",t);return await $m(n,{...e,employeeId:t,status:"active",completedTrainings:0,totalTrainings:0,performance:0,certifications:[],trainingHistory:[],recommendedTrainings:[],created_at:vm(),updated_at:vm()}),console.log("\ud83d\udc64 New employee created with ID:",t),t}catch(t){throw console.error("Error adding employee:",t),m(`Failed to add employee: ${t.message}`),t}},[g]),_=(0,i.useCallback)(async(e,t)=>{try{if(m(null),!g)throw new Error("No company ID");if(!e)throw new Error("No employee ID provided");const n=jp(Sg,"companies",g,"employees",e);await qm(n,{...t,updated_at:vm()})}catch(n){throw console.error("Error updating employee:",n),m(`Failed to update employee: ${n.message}`),n}},[g]),S=(0,i.useCallback)(async e=>{try{if(m(null),!g)throw new Error("No company ID");if(!e.title)throw new Error("Training title is required");const t=jp(Lp(Sg,"companies",g,"trainings"));return await $m(t,{...e,createdBy:null===s||void 0===s?void 0:s.uid,created_at:vm(),updated_at:vm()}),t.id}catch(t){throw console.error("Error saving training:",t),m(`Failed to save training: ${t.message}`),t}},[g,s]),C=(0,i.useCallback)(async e=>{try{if(m(null),!g)throw new Error("No company ID");if(!e.employeeId)throw new Error("Employee ID is required");if(!e.trainingId)throw new Error("Training ID is required");const t=jp(Lp(Sg,"companies",g,"quizResults"));if(await $m(t,{...e,completedAt:vm()}),e.passed&&e.employeeId){const t=jp(Sg,"companies",g,"employees",e.employeeId),n=await Vm(t);if(n.exists()){const i=n.data();await qm(t,{completedTrainings:(i.completedTrainings||0)+1,trainingHistory:[...i.trainingHistory||[],{trainingId:e.trainingId,title:e.trainingTitle,score:e.percentage,completedAt:(new Date).toISOString()}],updated_at:vm()})}else console.warn("Employee not found for quiz result update:",e.employeeId)}return t.id}catch(t){throw console.error("Error saving quiz result:",t),m(`Failed to save quiz result: ${t.message}`),t}},[g]),A={company:r,employees:b,trainings:c,loading:u,error:p,userRole:f,rolePermissions:v,userDepartment:y,saveCompany:x,addEmployee:w,updateEmployee:_,saveTraining:S,saveQuizResult:C};return(0,Ag.jsx)(cf.Provider,{value:A,children:t})},pf=e=>{const t=Qg.find(t=>t.code===e);return t?`${t.flag} ${t.name}`:e},mf=e=>{if(!e)throw new Error("Empty response from AI");let t=e;const n=e.match(/```(?:json)?\s*([\s\S]*?)```/);if(n)t=n[1].trim(),console.log("\ud83d\udccb Extracted JSON from code block");else{const n=e.match(/\{[\s\S]*\}/);n&&(t=n[0],console.log("\ud83d\udccb Extracted JSON object from response"))}try{const e=JSON.parse(t);if(e.training&&Array.isArray(e.quiz))return console.log("\u2705 Successfully parsed training response with",e.quiz.length,"quiz questions"),e;if(e.training&&!e.quiz)return console.log("\u26a0\ufe0f No quiz found, adding empty quiz array"),e.quiz=[],e;throw new Error("Invalid response structure - missing training or quiz")}catch(i){console.error("\u274c JSON parse error:",i.message),console.log("Raw content (first 500 chars):",t.substring(0,500));try{let e=t;e.endsWith("}")||(e+="]}}");const n=JSON.parse(e);return console.log("\u26a0\ufe0f Recovered partial JSON response"),n}catch{throw new Error("Failed to parse AI response as JSON: "+i.message)}}},gf=()=>{const[e,t]=(0,i.useState)("welcome"),[n,s]=(0,i.useState)(Yg),[r,a]=(0,i.useState)(!1),o=(0,i.useCallback)(()=>{const n=tf.indexOf(e);n<tf.length-1&&t(tf[n+1])},[e]),l=(0,i.useCallback)(()=>{const n=tf.indexOf(e);n>0&&t(tf[n-1])},[e]),c=(0,i.useCallback)((e,t)=>{s(n=>({...n,company:{...n.company,[e]:t}}))},[]),d=(0,i.useCallback)((e,t)=>{s(n=>({...n,aiModels:{...n.aiModels,[e]:t}}))},[]),u=(0,i.useCallback)((e,t,n)=>{s(i=>({...i,aiModels:{...i.aiModels,configs:{...i.aiModels.configs,[e]:{...i.aiModels.configs[e],[t]:n}}}}))},[]),h=(0,i.useCallback)((e,t)=>{s(n=>({...n,dataSource:{...n.dataSource,[e]:t}}))},[]),p=(0,i.useCallback)((e,t,n)=>{s(i=>({...i,dataSource:{...i.dataSource,config:{...i.dataSource.config,[e]:{...i.dataSource.config[e],[t]:n}}}}))},[]),m=(0,i.useCallback)((e,t)=>{s(n=>({...n,dataSource:{...n.dataSource,ragSettings:{...n.dataSource.ragSettings,[e]:t}}}))},[]),g=(0,i.useCallback)((e,t)=>{s(n=>({...n,onboarding:{...n.onboarding,[e]:t}}))},[]),f=(0,i.useCallback)((e,t)=>{const n=(e=>{const t={Manufacturing:{departments:["Production","Maintenance","Quality Assurance","Safety","Engineering"],safetyRequirements:["OSHA Compliance","ISO 45001","Environmental Health"],defaultTrainings:["Safety Orientation","Equipment Training","Quality Procedures"]},"Food & Beverage":{departments:["Production","Quality Assurance","Sanitation","Warehouse","Maintenance"],safetyRequirements:["SQF Food Safety","HACCP","FDA Regulations","GMP"],defaultTrainings:["Food Safety Fundamentals","HACCP Principles","Sanitation Procedures"]},Healthcare:{departments:["Clinical","Nursing","Administration","Maintenance","Safety"],safetyRequirements:["OSHA Compliance","HIPAA","Infection Control"],defaultTrainings:["HIPAA Training","Infection Control","Patient Safety"]}};return t[e]||t.Manufacturing})(t);s(e=>({...e,company:{...e.company,departments:n.departments,safetyRequirements:n.safetyRequirements},onboarding:{...e.onboarding,defaultTrainings:n.defaultTrainings}}))},[]),y=(0,i.useCallback)(async(e,t)=>new Promise(e=>{setTimeout(()=>{e({success:!0,message:"Connection successful"})},2e3)}),[]),v=(0,i.useCallback)((e,t)=>{s(n=>({...n,company:{...n.company,departments:t?[...n.company.departments,e]:n.company.departments.filter(t=>t!==e)}}))},[]),b=(0,i.useCallback)((e,t)=>{s(n=>({...n,company:{...n.company,safetyRequirements:t?[...n.company.safetyRequirements,e]:n.company.safetyRequirements.filter(t=>t!==e)}}))},[]),x=(0,i.useCallback)((e,t)=>{s(n=>({...n,company:{...n.company,supportedLanguages:t?[...n.company.supportedLanguages,e]:n.company.supportedLanguages.filter(t=>t!==e)}}))},[]),w=(0,i.useCallback)((e,t)=>{s(n=>({...n,onboarding:{...n.onboarding,defaultTrainings:t?[...n.onboarding.defaultTrainings,e]:n.onboarding.defaultTrainings.filter(t=>t!==e)}}))},[]),_="complete"===e,S=tf.indexOf(e)+1,C=tf.length;return{setupStep:e,setSetupStep:t,setupConfig:n,setSetupConfig:s,handleSetupNext:o,handleSetupPrev:l,updateCompanyConfig:c,updateAIModelConfig:d,updateAIModelAPIConfig:u,updateDataSourceConfig:h,updateDataSourceTypeConfig:p,updateRAGSettings:m,updateOnboardingConfig:g,generateCompanyConfig:f,testConnection:y,toggleDepartment:v,toggleSafetyRequirement:b,toggleSupportedLanguage:x,toggleOnboardingTraining:w,completedSetup:r||_,setCompletedSetup:a,currentStepIndex:S,totalSteps:C,progressPercentage:S/C*100}};const ff="object"===typeof process&&process+""==="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&"browser"!==process.type),yf=[.001,0,0,.001,0,0],vf=1.35,bf=1,xf=2,wf=4,_f=16,Sf=32,Cf=64,Af=128,Ef=256,Tf={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},kf="pdfjs_internal_editor_",Nf={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},If={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},Df=1,Pf=2,Mf=0,Rf=1,Lf=2,jf=3,Of=3,Ff=4,Bf={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Uf={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},zf=1,Vf=2,Hf=3,$f=4,qf=5,Gf={ERRORS:0,WARNINGS:1,INFOS:5},Wf={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},Kf=0,Qf=1,Xf=2,Yf=3,Jf=4;let Zf=Gf.WARNINGS;function ey(e){Number.isInteger(e)&&(Zf=e)}function ty(){return Zf}function ny(e){Zf>=Gf.INFOS&&console.info(`Info: ${e}`)}function iy(e){Zf>=Gf.WARNINGS&&console.warn(`Warning: ${e}`)}function sy(e){throw new Error(e)}function ry(e,t){e||sy(t)}function ay(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e)return null;if(n&&"string"===typeof e){if(n.addDefaultProtocol&&e.startsWith("www.")){const t=e.match(/\./g);t?.length>=2&&(e=`http://${e}`)}if(n.tryConvertEncoding)try{e=decodeURIComponent(escape(e))}catch{}}const i=t?URL.parse(e,t):URL.parse(e);return function(e){switch(e?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(i)?i:null}function oy(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=URL.parse(e);return i?(i.hash=t,i.href):n&&ay(e,"http://example.com")?e.split("#",1)[0]+""+(t?`#${t}`:""):""}function ly(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Object.defineProperty(e,t,{value:n,enumerable:!i,configurable:!0,writable:!1}),n}const cy=function(){function e(e,t){this.message=e,this.name=t}return e.prototype=new Error,e.constructor=e,e}();class dy extends cy{constructor(e,t){super(e,"PasswordException"),this.code=t}}class uy extends cy{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class hy extends cy{constructor(e){super(e,"InvalidPDFException")}}class py extends cy{constructor(e,t,n){super(e,"ResponseException"),this.status=t,this.missing=n}}class my extends cy{constructor(e){super(e,"FormatError")}}class gy extends cy{constructor(e){super(e,"AbortException")}}function fy(e){"object"===typeof e&&void 0!==e?.length||sy("Invalid argument for bytesToString");const t=e.length,n=8192;if(t<n)return String.fromCharCode.apply(null,e);const i=[];for(let s=0;s<t;s+=n){const r=Math.min(s+n,t),a=e.subarray(s,r);i.push(String.fromCharCode.apply(null,a))}return i.join("")}function yy(e){"string"!==typeof e&&sy("Invalid argument for stringToBytes");const t=e.length,n=new Uint8Array(t);for(let i=0;i<t;++i)n[i]=255&e.charCodeAt(i);return n}class vy{static get isLittleEndian(){return ly(this,"isLittleEndian",function(){const e=new Uint8Array(4);return e[0]=1,1===new Uint32Array(e.buffer,0,1)[0]}())}static get isEvalSupported(){return ly(this,"isEvalSupported",function(){try{return new Function(""),!0}catch{return!1}}())}static get isOffscreenCanvasSupported(){return ly(this,"isOffscreenCanvasSupported","undefined"!==typeof OffscreenCanvas)}static get isImageDecoderSupported(){return ly(this,"isImageDecoderSupported","undefined"!==typeof ImageDecoder)}static get isFloat16ArraySupported(){return ly(this,"isFloat16ArraySupported","undefined"!==typeof Float16Array)}static get isSanitizerSupported(){return ly(this,"isSanitizerSupported","undefined"!==typeof Sanitizer)}static get platform(){const{platform:e,userAgent:t}=navigator;return ly(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){return ly(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const by=Array.from(Array(256).keys(),e=>e.toString(16).padStart(2,"0"));class xy{static makeHexColor(e,t,n){return`#${by[e]}${by[t]}${by[n]}`}static domMatrixToTransform(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static multiplyByDOMMatrix(e,t){return[e[0]*t.a+e[2]*t.b,e[1]*t.a+e[3]*t.b,e[0]*t.c+e[2]*t.d,e[1]*t.c+e[3]*t.d,e[0]*t.e+e[2]*t.f+e[4],e[1]*t.e+e[3]*t.f+e[5]]}static applyTransform(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=e[n],s=e[n+1];e[n]=i*t[0]+s*t[2]+t[4],e[n+1]=i*t[1]+s*t[3]+t[5]}static applyTransformToBezier(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=t[0],s=t[1],r=t[2],a=t[3],o=t[4],l=t[5];for(let c=0;c<6;c+=2){const t=e[n+c],d=e[n+c+1];e[n+c]=t*i+d*r+o,e[n+c+1]=t*s+d*a+l}}static applyInverseTransform(e,t){const n=e[0],i=e[1],s=t[0]*t[3]-t[1]*t[2];e[0]=(n*t[3]-i*t[2]+t[2]*t[5]-t[4]*t[3])/s,e[1]=(-n*t[1]+i*t[0]+t[4]*t[1]-t[5]*t[0])/s}static axialAlignedBoundingBox(e,t,n){const i=t[0],s=t[1],r=t[2],a=t[3],o=t[4],l=t[5],c=e[0],d=e[1],u=e[2],h=e[3];let p=i*c+o,m=p,g=i*u+o,f=g,y=a*d+l,v=y,b=a*h+l,x=b;if(0!==s||0!==r){const e=s*c,t=s*u,n=r*d,i=r*h;p+=n,f+=n,g+=i,m+=i,y+=e,x+=e,b+=t,v+=t}n[0]=Math.min(n[0],p,g,m,f),n[1]=Math.min(n[1],y,b,v,x),n[2]=Math.max(n[2],p,g,m,f),n[3]=Math.max(n[3],y,b,v,x)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const n=e[0],i=e[1],s=e[2],r=e[3],a=n**2+i**2,o=n*s+i*r,l=s**2+r**2,c=(a+l)/2,d=Math.sqrt(c**2-(a*l-o**2));t[0]=Math.sqrt(c+d||1),t[1]=Math.sqrt(c-d||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>i)return null;const s=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),r=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return s>r?null:[n,s,i,r]}static pointBoundingBox(e,t,n){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}static rectBoundingBox(e,t,n,i,s){s[0]=Math.min(s[0],e,n),s[1]=Math.min(s[1],t,i),s[2]=Math.max(s[2],e,n),s[3]=Math.max(s[3],t,i)}static#e(e,t,n,i,s,r,a,o,l,c){if(l<=0||l>=1)return;const d=1-l,u=l*l,h=u*l,p=d*(d*(d*e+3*l*t)+3*u*n)+h*i,m=d*(d*(d*s+3*l*r)+3*u*a)+h*o;c[0]=Math.min(c[0],p),c[1]=Math.min(c[1],m),c[2]=Math.max(c[2],p),c[3]=Math.max(c[3],m)}static#t(e,t,n,i,s,r,a,o,l,c,d,u){if(Math.abs(l)<1e-12)return void(Math.abs(c)>=1e-12&&this.#e(e,t,n,i,s,r,a,o,-d/c,u));const h=c**2-4*d*l;if(h<0)return;const p=Math.sqrt(h),m=2*l;this.#e(e,t,n,i,s,r,a,o,(-c+p)/m,u),this.#e(e,t,n,i,s,r,a,o,(-c-p)/m,u)}static bezierBoundingBox(e,t,n,i,s,r,a,o,l){l[0]=Math.min(l[0],e,a),l[1]=Math.min(l[1],t,o),l[2]=Math.max(l[2],e,a),l[3]=Math.max(l[3],t,o),this.#t(e,n,s,a,t,i,r,o,3*(3*(n-s)-e+a),6*(e-2*n+s),3*(n-e),l),this.#t(e,n,s,a,t,i,r,o,3*(3*(i-r)-t+o),6*(t-2*i+r),3*(i-t),l)}}let wy=null,_y=null;function Sy(){if("function"===typeof crypto.randomUUID)return crypto.randomUUID();const e=new Uint8Array(32);return crypto.getRandomValues(e),fy(e)}const Cy="pdfjs_internal_id_";function Ay(e,t,n){return Math.min(Math.max(e,t),n)}function Ey(e){return Uint8Array.prototype.toBase64?e.toBase64():btoa(fy(e))}"function"!==typeof Promise.try&&(Promise.try=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return new Promise(t=>{t(e(...n))})}),"function"!==typeof Math.sumPrecise&&(Math.sumPrecise=function(e){return e.reduce((e,t)=>e+t,0)});class Ty{static textContent(e){const t=[],n={items:t,styles:Object.create(null)};return function e(n){if(!n)return;let i=null;const s=n.name;if("#text"===s)i=n.value;else{if(!Ty.shouldBuildText(s))return;n?.attributes?.textContent?i=n.attributes.textContent:n.value&&(i=n.value)}if(null!==i&&t.push({str:i}),n.children)for(const t of n.children)e(t)}(e),n}static shouldBuildText(e){return!("textarea"===e||"input"===e||"option"===e||"select"===e)}}class ky{static setupStorage(e,t,n,i,s){const r=i.getValue(t,{value:null});switch(n.name){case"textarea":if(null!==r.value&&(e.textContent=r.value),"print"===s)break;e.addEventListener("input",e=>{i.setValue(t,{value:e.target.value})});break;case"input":if("radio"===n.attributes.type||"checkbox"===n.attributes.type){if(r.value===n.attributes.xfaOn?e.setAttribute("checked",!0):r.value===n.attributes.xfaOff&&e.removeAttribute("checked"),"print"===s)break;e.addEventListener("change",e=>{i.setValue(t,{value:e.target.checked?e.target.getAttribute("xfaOn"):e.target.getAttribute("xfaOff")})})}else{if(null!==r.value&&e.setAttribute("value",r.value),"print"===s)break;e.addEventListener("input",e=>{i.setValue(t,{value:e.target.value})})}break;case"select":if(null!==r.value){e.setAttribute("value",r.value);for(const e of n.children)e.attributes.value===r.value?e.attributes.selected=!0:e.attributes.hasOwnProperty("selected")&&delete e.attributes.selected}e.addEventListener("input",e=>{const n=e.target.options,s=-1===n.selectedIndex?"":n[n.selectedIndex].value;i.setValue(t,{value:s})})}}static setAttributes(e){let{html:t,element:n,storage:i=null,intent:s,linkService:r}=e;const{attributes:a}=n,o=t instanceof HTMLAnchorElement;"radio"===a.type&&(a.name=`${a.name}-${s}`);for(const[l,c]of Object.entries(a))if(null!==c&&void 0!==c)switch(l){case"class":c.length&&t.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",c);break;case"style":Object.assign(t.style,c);break;case"textContent":t.textContent=c;break;default:(!o||"href"!==l&&"newWindow"!==l)&&t.setAttribute(l,c)}o&&r.addLinkAttributes(t,a.href,a.newWindow),i&&a.dataId&&this.setupStorage(t,a.dataId,n,i)}static render(e){const t=e.annotationStorage,n=e.linkService,i=e.xfaHtml,s=e.intent||"display",r=document.createElement(i.name);i.attributes&&this.setAttributes({html:r,element:i,intent:s,linkService:n});const a="richText"!==s,o=e.div;if(o.append(r),e.viewport){const t=`matrix(${e.viewport.transform.join(",")})`;o.style.transform=t}a&&o.setAttribute("class","xfaLayer xfaFont");const l=[];if(0===i.children.length){if(i.value){const e=document.createTextNode(i.value);r.append(e),a&&Ty.shouldBuildText(i.name)&&l.push(e)}return{textDivs:l}}const c=[[i,-1,r]];for(;c.length>0;){const[e,i,r]=c.at(-1);if(i+1===e.children.length){c.pop();continue}const o=e.children[++c.at(-1)[1]];if(null===o)continue;const{name:d}=o;if("#text"===d){const e=document.createTextNode(o.value);l.push(e),r.append(e);continue}const u=o?.attributes?.xmlns?document.createElementNS(o.attributes.xmlns,d):document.createElement(d);if(r.append(u),o.attributes&&this.setAttributes({html:u,element:o,storage:t,intent:s,linkService:n}),o.children?.length>0)c.push([o,-1,u]);else if(o.value){const e=document.createTextNode(o.value);a&&Ty.shouldBuildText(d)&&l.push(e),u.append(e)}}for(const d of o.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))d.setAttribute("readOnly",!0);return{textDivs:l}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const Ny="http://www.w3.org/2000/svg";class Iy{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=(()=>this.CSS/this.PDF)()}async function Dy(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text";if(Oy(e,document.baseURI)){const n=await fetch(e);if(!n.ok)throw new Error(n.statusText);switch(t){case"arraybuffer":return n.arrayBuffer();case"blob":return n.blob();case"json":return n.json()}return n.text()}return new Promise((n,i)=>{const s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType=t,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE)if(200!==s.status&&0!==s.status)i(new Error(s.statusText));else{switch(t){case"arraybuffer":case"blob":case"json":return void n(s.response)}n(s.responseText)}},s.send(null)})}class Py{constructor(e){let{viewBox:t,userUnit:n,scale:i,rotation:s,offsetX:r=0,offsetY:a=0,dontFlip:o=!1}=e;this.viewBox=t,this.userUnit=n,this.scale=i,this.rotation=s,this.offsetX=r,this.offsetY=a,i*=n;const l=(t[2]+t[0])/2,c=(t[3]+t[1])/2;let d,u,h,p,m,g,f,y;switch(s%=360,s<0&&(s+=360),s){case 180:d=-1,u=0,h=0,p=1;break;case 90:d=0,u=1,h=1,p=0;break;case 270:d=0,u=-1,h=-1,p=0;break;case 0:d=1,u=0,h=0,p=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(h=-h,p=-p),0===d?(m=Math.abs(c-t[1])*i+r,g=Math.abs(l-t[0])*i+a,f=(t[3]-t[1])*i,y=(t[2]-t[0])*i):(m=Math.abs(l-t[0])*i+r,g=Math.abs(c-t[1])*i+a,f=(t[2]-t[0])*i,y=(t[3]-t[1])*i),this.transform=[d*i,u*i,h*i,p*i,m-d*i*l-h*i*c,g-u*i*l-p*i*c],this.width=f,this.height=y}get rawDims(){const e=this.viewBox;return ly(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone(){let{scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:i=this.offsetY,dontFlip:s=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Py({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:i,dontFlip:s})}convertToViewportPoint(e,t){const n=[e,t];return xy.applyTransform(n,this.transform),n}convertToViewportRectangle(e){const t=[e[0],e[1]];xy.applyTransform(t,this.transform);const n=[e[2],e[3]];return xy.applyTransform(n,this.transform),[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){const n=[e,t];return xy.applyInverseTransform(n,this.transform),n}}class My extends cy{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super(e,"RenderingCancelledException"),this.extraDelay=t}}function Ry(e){const t=e.length;let n=0;for(;n<t&&""===e[n].trim();)n++;return"data:"===e.substring(n,n+5).toLowerCase()}function Ly(e){return"string"===typeof e&&/\.pdf$/i.test(e)}class jy{started=(()=>Object.create(null))();times=[];time(e){e in this.started&&iy(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||iy(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:n}of this.times)t=Math.max(n.length,t);for(const{name:n,start:i,end:s}of this.times)e.push(`${n.padEnd(t)} ${s-i}ms\n`);return e.join("")}}function Oy(e,t){const n=t?URL.parse(e,t):URL.parse(e);return"http:"===n?.protocol||"https:"===n?.protocol}function Fy(e){e.preventDefault()}function By(e){e.preventDefault(),e.stopPropagation()}class Uy{static#n;static toDateObject(e){if(e instanceof Date)return e;if(!e||"string"!==typeof e)return null;this.#n||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const t=this.#n.exec(e);if(!t)return null;const n=parseInt(t[1],10);let i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let s=parseInt(t[3],10);s=s>=1&&s<=31?s:1;let r=parseInt(t[4],10);r=r>=0&&r<=23?r:0;let a=parseInt(t[5],10);a=a>=0&&a<=59?a:0;let o=parseInt(t[6],10);o=o>=0&&o<=59?o:0;const l=t[7]||"Z";let c=parseInt(t[8],10);c=c>=0&&c<=23?c:0;let d=parseInt(t[9],10)||0;return d=d>=0&&d<=59?d:0,"-"===l?(r+=c,a+=d):"+"===l&&(r-=c,a-=d),new Date(Date.UTC(n,i,s,r,a,o))}}function zy(e){if(e.startsWith("#")){const t=parseInt(e.slice(1),16);return[(16711680&t)>>16,(65280&t)>>8,255&t]}return e.startsWith("rgb(")?e.slice(4,-1).split(",").map(e=>parseInt(e)):e.startsWith("rgba(")?e.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(iy(`Not a valid color format: "${e}"`),[0,0,0])}function Vy(e){const{a:t,b:n,c:i,d:s,e:r,f:a}=e.getTransform();return[t,n,i,s,r,a]}function Hy(e){const{a:t,b:n,c:i,d:s,e:r,f:a}=e.getTransform().invertSelf();return[t,n,i,s,r,a]}function $y(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(t instanceof Py){const{pageWidth:i,pageHeight:s}=t.rawDims,{style:r}=e,a=vy.isCSSRoundSupported,o=`var(--total-scale-factor) * ${i}px`,l=`var(--total-scale-factor) * ${s}px`,c=a?`round(down, ${o}, var(--scale-round-x))`:`calc(${o})`,d=a?`round(down, ${l}, var(--scale-round-y))`:`calc(${l})`;n&&t.rotation%180!==0?(r.width=d,r.height=c):(r.width=c,r.height=d)}i&&e.setAttribute("data-main-rotation",t.rotation)}class qy{constructor(){const{pixelRatio:e}=qy;this.sx=e,this.sy=e}get scaled(){return 1!==this.sx||1!==this.sy}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,r=1/0,a=1/0,o=1/0;(n=qy.capPixels(n,s))>0&&(r=Math.sqrt(n/(e*t))),-1!==i&&(a=i/e,o=i/t);const l=Math.min(r,a,o);return(this.sx>l||this.sy>l)&&(this.sx=l,this.sy=l,!0)}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const n=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,n):n}return e}}const Gy=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class Wy{static get isDarkMode(){return ly(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}function Ky(e,t){const n=e[0]/255,i=e[1]/255,s=e[2]/255,r=Math.max(n,i,s),a=Math.min(n,i,s),o=(r+a)/2;if(r===a)t[0]=t[1]=0;else{const e=r-a;switch(t[1]=o<.5?e/(r+a):e/(2-r-a),r){case n:t[0]=60*((i-s)/e+(i<s?6:0));break;case i:t[0]=60*((s-n)/e+2);break;case s:t[0]=60*((n-i)/e+4)}}t[2]=o}function Qy(e,t){const n=e[0],i=e[1],s=e[2],r=(1-Math.abs(2*s-1))*i,a=r*(1-Math.abs(n/60%2-1)),o=s-r/2;switch(Math.floor(n/60)){case 0:t[0]=r+o,t[1]=a+o,t[2]=o;break;case 1:t[0]=a+o,t[1]=r+o,t[2]=o;break;case 2:t[0]=o,t[1]=r+o,t[2]=a+o;break;case 3:t[0]=o,t[1]=a+o,t[2]=r+o;break;case 4:t[0]=a+o,t[1]=o,t[2]=r+o;break;case 5:case 6:t[0]=r+o,t[1]=o,t[2]=a+o}}function Xy(e){return e<=.03928?e/12.92:((e+.055)/1.055)**2.4}function Yy(e,t,n){Qy(e,n),n.map(Xy);const i=.2126*n[0]+.7152*n[1]+.0722*n[2];Qy(t,n),n.map(Xy);const s=.2126*n[0]+.7152*n[1]+.0722*n[2];return i>s?(i+.05)/(s+.05):(s+.05)/(i+.05)}const Jy=new Map;function Zy(e,t){let{html:n,dir:i,className:s}=e;const r=document.createDocumentFragment();if("string"===typeof n){const e=document.createElement("p");e.dir=i||"auto";const t=n.split(/(?:\r\n?|\n)/);for(let n=0,i=t.length;n<i;++n){const s=t[n];e.append(document.createTextNode(s)),n<i-1&&e.append(document.createElement("br"))}r.append(e)}else ky.render({xfaHtml:n,div:r,intent:"richText"});r.firstElementChild.classList.add("richText",s),t.append(r)}function ev(e){const t=new Path2D;if(!e)return t;for(let n=0,i=e.length;n<i;)switch(e[n++]){case Kf:t.moveTo(e[n++],e[n++]);break;case Qf:t.lineTo(e[n++],e[n++]);break;case Xf:t.bezierCurveTo(e[n++],e[n++],e[n++],e[n++],e[n++],e[n++]);break;case Yf:t.quadraticCurveTo(e[n++],e[n++],e[n++],e[n++]);break;case Jf:t.closePath();break;default:iy(`Unrecognized drawing path operator: ${e[n-1]}`)}return t}class tv{#i=null;#s=null;#r;#a=null;#o=null;#l=null;#c=null;#d=null;static#u=null;constructor(e){this.#r=e,tv.#u||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const e=this.#i=document.createElement("div");e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=this.#r._uiManager._signal;t instanceof AbortSignal&&!t.aborted&&(e.addEventListener("contextmenu",Fy,{signal:t}),e.addEventListener("pointerdown",tv.#h,{signal:t}));const n=this.#a=document.createElement("div");n.className="buttons",e.append(n);const i=this.#r.toolbarPosition;if(i){const{style:t}=e,n="ltr"===this.#r._uiManager.direction?1-i[0]:i[0];t.insetInlineEnd=100*n+"%",t.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return this.#i}static#h(e){e.stopPropagation()}#p(e){this.#r._focusEventsAllowed=!1,By(e)}#m(e){this.#r._focusEventsAllowed=!0,By(e)}#g(e){const t=this.#r._uiManager._signal;return t instanceof AbortSignal&&!t.aborted&&(e.addEventListener("focusin",this.#p.bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",this.#m.bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Fy,{signal:t}),!0)}hide(){this.#i.classList.add("hidden"),this.#s?.hideDropdown()}show(){this.#i.classList.remove("hidden"),this.#o?.shown(),this.#l?.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=this.#r,n=document.createElement("button");n.classList.add("basic","deleteButton"),n.tabIndex=0,n.setAttribute("data-l10n-id",tv.#u[e]),this.#g(n)&&n.addEventListener("click",e=>{t.delete()},{signal:t._signal}),this.#a.append(n)}get#f(){const e=document.createElement("div");return e.className="divider",e}async addAltText(e){const t=await e.render();this.#g(t),this.#a.append(t,this.#f),this.#o=e}addComment(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.#l)return;const n=e.renderForToolbar();if(!n)return;this.#g(n);const i=this.#c=this.#f;t?(this.#a.insertBefore(n,t),this.#a.insertBefore(i,t)):this.#a.append(n,i),this.#l=e,e.toolbar=this}addColorPicker(e){if(this.#s)return;this.#s=e;const t=e.renderButton();this.#g(t),this.#a.append(t,this.#f)}async addEditSignatureButton(e){const t=this.#d=await e.renderEditButton(this.#r);this.#g(t),this.#a.append(t,this.#f)}removeButton(e){if("comment"===e)this.#l?.removeToolbarCommentButton(),this.#l=null,this.#c?.remove(),this.#c=null}async addButton(e,t){switch(e){case"colorPicker":t&&this.addColorPicker(t);break;case"altText":t&&await this.addAltText(t);break;case"editSignature":t&&await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break;case"comment":t&&this.addComment(t)}}async addButtonBefore(e,t,n){if(!t&&"comment"===e)return;const i=this.#a.querySelector(n);i&&"comment"===e&&this.addComment(t,i)}updateEditSignatureButton(e){this.#d&&(this.#d.title=e)}remove(){this.#i.remove(),this.#s?.destroy(),this.#s=null}}class nv{#a=null;#i=null;#y;constructor(e){this.#y=e}#v(){const e=this.#i=document.createElement("div");e.className="editToolbar",e.setAttribute("role","toolbar");const t=this.#y._signal;t instanceof AbortSignal&&!t.aborted&&e.addEventListener("contextmenu",Fy,{signal:t});const n=this.#a=document.createElement("div");return n.className="buttons",e.append(n),this.#y.hasCommentManager()&&this.#b("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#y.commentSelection("floating_button")}),this.#b("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#y.highlightSelection("floating_button")}),e}#x(e,t){let n=0,i=0;for(const s of e){const e=s.y+s.height;if(e<n)continue;const r=s.x+(t?s.width:0);e>n?(i=r,n=e):t?r>i&&(i=r):r<i&&(i=r)}return[t?1-i:i,n]}show(e,t,n){const[i,s]=this.#x(t,n),{style:r}=this.#i||=this.#v();e.append(this.#i),r.insetInlineEnd=100*i+"%",r.top=`calc(${100*s}% + var(--editor-toolbar-vert-offset))`}hide(){this.#i.remove()}#b(e,t,n,i){const s=document.createElement("button");s.classList.add("basic",e),s.tabIndex=0,s.setAttribute("data-l10n-id",t);const r=document.createElement("span");s.append(r),r.className="visuallyHidden",r.setAttribute("data-l10n-id",n);const a=this.#y._signal;a instanceof AbortSignal&&!a.aborted&&(s.addEventListener("contextmenu",Fy,{signal:a}),s.addEventListener("click",i,{signal:a})),this.#a.append(s)}}function iv(e,t,n){for(const i of n)t.addEventListener(i,e[i].bind(e))}class sv{static#w=NaN;static#_=null;static#S=NaN;static#C=null;static initializeAndAddPointerId(e){(sv.#_||=new Set).add(e)}static setPointer(e,t){sv.#w||=t,sv.#C??=e}static setTimeStamp(e){sv.#S=e}static isSamePointerId(e){return sv.#w===e}static isSamePointerIdOrRemove(e){return sv.#w===e||(sv.#_?.delete(e),!1)}static isSamePointerType(e){return sv.#C===e}static isInitializedAndDifferentPointerType(e){return null!==sv.#C&&!sv.isSamePointerType(e)}static isSameTimeStamp(e){return sv.#S===e}static isUsingMultiplePointers(){return sv.#_?.size>=1}static clearPointerType(){sv.#C=null}static clearPointerIds(){sv.#w=NaN,sv.#_=null}static clearTimeStamp(){sv.#S=NaN}}class rv{#A=0;get id(){return`${kf}${this.#A++}`}}class av{#E=(()=>Sy())();#A=0;#T=null;static get _isSVGFittingCanvas(){const e=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),t=new Image;t.src='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>';return ly(this,"_isSVGFittingCanvas",t.decode().then(()=>(e.drawImage(t,0,0,1,1,0,0,1,3),0===new Uint32Array(e.getImageData(0,0,1,1).data.buffer)[0])))}async#k(e,t){this.#T||=new Map;let n=this.#T.get(e);if(null===n)return null;if(n?.bitmap)return n.refCounter+=1,n;try{let e;if(n||={bitmap:null,id:`image_${this.#E}_${this.#A++}`,refCounter:0,isSvg:!1},"string"===typeof t?(n.url=t,e=await Dy(t,"blob")):t instanceof File?e=n.file=t:t instanceof Blob&&(e=t),"image/svg+xml"===e.type){const t=av._isSVGFittingCanvas,i=new FileReader,s=new Image,r=new Promise((e,r)=>{s.onload=()=>{n.bitmap=s,n.isSvg=!0,e()},i.onload=async()=>{const e=n.svgUrl=i.result;s.src=await t?`${e}#svgView(preserveAspectRatio(none))`:e},s.onerror=i.onerror=r});i.readAsDataURL(e),await r}else n.bitmap=await createImageBitmap(e);n.refCounter=1}catch(i){iy(i),n=null}return this.#T.set(e,n),n&&this.#T.set(n.id,n),n}async getFromFile(e){const{lastModified:t,name:n,size:i,type:s}=e;return this.#k(`${t}_${n}_${i}_${s}`,e)}async getFromUrl(e){return this.#k(e,e)}async getFromBlob(e,t){const n=await t;return this.#k(e,n)}async getFromId(e){this.#T||=new Map;const t=this.#T.get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:e}=t;return delete t.blobPromise,this.getFromBlob(t.id,e)}return this.getFromUrl(t.url)}getFromCanvas(e,t){this.#T||=new Map;let n=this.#T.get(e);if(n?.bitmap)return n.refCounter+=1,n;const i=new OffscreenCanvas(t.width,t.height);return i.getContext("2d").drawImage(t,0,0),n={bitmap:i.transferToImageBitmap(),id:`image_${this.#E}_${this.#A++}`,refCounter:1,isSvg:!1},this.#T.set(e,n),this.#T.set(n.id,n),n}getSvgUrl(e){const t=this.#T.get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){this.#T||=new Map;const t=this.#T.get(e);if(!t)return;if(t.refCounter-=1,0!==t.refCounter)return;const{bitmap:n}=t;if(!t.url&&!t.file){const e=new OffscreenCanvas(n.width,n.height);e.getContext("bitmaprenderer").transferFromImageBitmap(n),t.blobPromise=e.convertToBlob()}n.close?.(),t.bitmap=null}isValidId(e){return e.startsWith(`image_${this.#E}_`)}}class ov{#N=[];#I=!1;#D;#P=-1;constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128;this.#D=e}add(e){let{cmd:t,undo:n,post:i,mustExec:s,type:r=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}=e;if(s&&t(),this.#I)return;const l={cmd:t,undo:n,post:i,type:r};if(-1===this.#P)return this.#N.length>0&&(this.#N.length=0),this.#P=0,void this.#N.push(l);if(a&&this.#N[this.#P].type===r)return o&&(l.undo=this.#N[this.#P].undo),void(this.#N[this.#P]=l);const c=this.#P+1;c===this.#D?this.#N.splice(0,1):(this.#P=c,c<this.#N.length&&this.#N.splice(c)),this.#N.push(l)}undo(){if(-1===this.#P)return;this.#I=!0;const{undo:e,post:t}=this.#N[this.#P];e(),t?.(),this.#I=!1,this.#P-=1}redo(){if(this.#P<this.#N.length-1){this.#P+=1,this.#I=!0;const{cmd:e,post:t}=this.#N[this.#P];e(),t?.(),this.#I=!1}}hasSomethingToUndo(){return-1!==this.#P}hasSomethingToRedo(){return this.#P<this.#N.length-1}cleanType(e){if(-1!==this.#P){for(let t=this.#P;t>=0;t--)if(this.#N[t].type!==e)return this.#N.splice(t+1,this.#P-t),void(this.#P=t);this.#N.length=0,this.#P=-1}}destroy(){this.#N=null}}class lv{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=vy.platform;for(const[n,i,s={}]of e)for(const e of n){const n=e.startsWith("mac+");t&&n?(this.callbacks.set(e.slice(4),{callback:i,options:s}),this.allKeys.add(e.split("+").at(-1))):t||n||(this.callbacks.set(e,{callback:i,options:s}),this.allKeys.add(e.split("+").at(-1)))}}#M(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t}exec(e,t){if(!this.allKeys.has(t.key))return;const n=this.callbacks.get(this.#M(t));if(!n)return;const{callback:i,options:{bubbles:s=!1,args:r=[],checker:a=null}}=n;a&&!a(e,t)||(i.bind(e,...r,t)(),s||By(t))}}class cv{static _colorsMapping=(()=>new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]))();get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return function(e){const t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);for(const n of e.keys()){t.style.color=n;const i=window.getComputedStyle(t).color;e.set(n,zy(i))}t.remove()}(e),ly(this,"_colors",e)}convert(e){const t=zy(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[n,i]of this._colors)if(i.every((e,n)=>e===t[n]))return cv._colorsMapping.get(n);return t}getHexCode(e){const t=this._colors.get(e);return t?xy.makeHexColor(...t):e}}class dv{#R=(()=>new AbortController)();#L=null;#j=null;#O=(()=>new Map)();#F=(()=>new Map)();#B=null;#U=null;#z=null;#V=(()=>new ov)();#H=null;#$=null;#q=null;#G=0;#W=(()=>new Set)();#K=null;#Q=null;#X=(()=>new Set)();_editorUndoBar=null;#Y=!1;#J=!1;#Z=!1;#ee=null;#te=null;#ne=null;#ie=null;#se=!1;#re=null;#ae=(()=>new rv)();#oe=!1;#le=!1;#ce=!1;#de=null;#ue=null;#he=null;#pe=null;#me=null;#ge=(()=>Nf.NONE)();#fe=(()=>new Set)();#ye=null;#ve=null;#be=null;#xe=null;#we=null;#_e={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#Se=[0,0];#Ce=null;#Ae=null;#Ee=null;#Te=null;#ke=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const e=dv.prototype,t=e=>e.#Ae.contains(document.activeElement)&&"BUTTON"!==document.activeElement.tagName&&e.hasSomethingToControl(),n=(e,t)=>{let{target:n}=t;if(n instanceof HTMLInputElement){const{type:e}=n;return"text"!==e&&"number"!==e}return!0},i=this.TRANSLATE_SMALL,s=this.TRANSLATE_BIG;return ly(this,"_keyboardManager",new lv([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(e,t)=>{let{target:n}=t;return!(n instanceof HTMLButtonElement)&&e.#Ae.contains(n)&&!e.isEnterHandled}}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(e,t)=>{let{target:n}=t;return!(n instanceof HTMLButtonElement)&&e.#Ae.contains(document.activeElement)}}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}]]))}constructor(e,t,n,i,s,r,a,o,l,c,d,u,h,p,m,g){const f=this._signal=this.#R.signal;this.#Ae=e,this.#Ee=t,this.#Te=n,this.#B=i,this.#H=s,this.#ve=r,this.#we=o,this._eventBus=a,a._on("editingaction",this.onEditingAction.bind(this),{signal:f}),a._on("pagechanging",this.onPageChanging.bind(this),{signal:f}),a._on("scalechanging",this.onScaleChanging.bind(this),{signal:f}),a._on("rotationchanging",this.onRotationChanging.bind(this),{signal:f}),a._on("setpreference",this.onSetPreference.bind(this),{signal:f}),a._on("switchannotationeditorparams",e=>this.updateParams(e.type,e.value),{signal:f}),window.addEventListener("pointerdown",()=>{this.#le=!0},{capture:!0,signal:f}),window.addEventListener("pointerup",()=>{this.#le=!1},{capture:!0,signal:f}),this.#Ne(),this.#Ie(),this.#De(),this.#U=o.annotationStorage,this.#ee=o.filterFactory,this.#be=l,this.#ie=c||null,this.#Y=d,this.#J=u,this.#Z=h,this.#me=p||null,this.viewParameters={realScale:Iy.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=m||null,this._supportsPinchToZoom=!1!==g,s?.setSidebarUiManager(this)}destroy(){this.#ke?.resolve(),this.#ke=null,this.#R?.abort(),this.#R=null,this._signal=null;for(const e of this.#F.values())e.destroy();this.#F.clear(),this.#O.clear(),this.#X.clear(),this.#pe?.clear(),this.#L=null,this.#fe.clear(),this.#V.destroy(),this.#B?.destroy(),this.#H?.destroy(),this.#ve?.destroy(),this.#re?.hide(),this.#re=null,this.#he?.destroy(),this.#he=null,this.#j=null,this.#te&&(clearTimeout(this.#te),this.#te=null),this.#Ce&&(clearTimeout(this.#Ce),this.#Ce=null),this._editorUndoBar?.destroy(),this.#we=null}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return this.#me}get useNewAltTextFlow(){return this.#J}get useNewAltTextWhenAddingImage(){return this.#Z}get hcmFilter(){return ly(this,"hcmFilter",this.#be?this.#ee.addHCMFilter(this.#be.foreground,this.#be.background):"none")}get direction(){return ly(this,"direction",getComputedStyle(this.#Ae).direction)}get _highlightColors(){return ly(this,"_highlightColors",this.#ie?new Map(this.#ie.split(",").map(e=>(e=e.split("=").map(e=>e.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColors(){const{_highlightColors:e}=this;if(!e)return ly(this,"highlightColors",null);const t=new Map,n=!!this.#be;for(const[i,s]of e){const e=i.endsWith("_HCM");n&&e?t.set(i.replace("_HCM",""),s):n||e||t.set(i,s)}return ly(this,"highlightColors",t)}get highlightColorNames(){return ly(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}getNonHCMColor(e){if(!this._highlightColors)return e;const t=this.highlightColorNames.get(e);return this._highlightColors.get(t)||e}getNonHCMColorName(e){return this.highlightColorNames.get(e)||e}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#q=e}setMainHighlightColorPicker(e){this.#he=e}editAltText(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.#B?.editAltText(this,e,t)}hasCommentManager(){return!!this.#H}editComment(e,t,n,i){this.#H?.showDialog(this,e,t,n,i)}selectComment(e,t){const n=this.#F.get(e),i=n?.getEditorByUID(t);i?.toggleComment(!0,!0)}updateComment(e){this.#H?.updateComment(e.getData())}updatePopupColor(e){this.#H?.updatePopupColor(e)}removeComment(e){this.#H?.removeComments([e.uid])}toggleComment(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this.#H?.toggleCommentPopup(e,t,n)}makeCommentColor(e,t){return e&&this.#H?.makeCommentColor(e,t)||null}getCommentDialogElement(){return this.#H?.dialogElement||null}async waitForEditorsRendered(e){if(this.#F.has(e-1))return;const{resolve:t,promise:n}=Promise.withResolvers(),i=n=>{n.pageNumber===e&&(this._eventBus._off("editorsrendered",i),t())};this._eventBus.on("editorsrendered",i),await n}getSignature(e){this.#ve?.getSignature({uiManager:this,editor:e})}get signatureManager(){return this.#ve}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference(e){let{name:t,value:n}=e;if("enableNewAltTextWhenAddingImage"===t)this.#Z=n}onPageChanging(e){let{pageNumber:t}=e;this.#G=t-1}focusMainContainer(){this.#Ae.focus()}findParent(e,t){for(const n of this.#F.values()){const{x:i,y:s,width:r,height:a}=n.div.getBoundingClientRect();if(e>=i&&e<=i+r&&t>=s&&t<=s+a)return n}return null}disableUserSelect(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.#Ee.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#X.add(e)}removeShouldRescale(e){this.#X.delete(e)}onScaleChanging(e){let{scale:t}=e;this.commitOrRemove(),this.viewParameters.realScale=t*Iy.PDF_TO_CSS_UNITS;for(const n of this.#X)n.onScaleChanging();this.#q?.onScaleChanging()}onRotationChanging(e){let{pagesRotation:t}=e;this.commitOrRemove(),this.viewParameters.rotation=t}#Pe(e){let{anchorNode:t}=e;return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#Me(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const n of this.#F.values())if(n.hasTextLayer(e))return n;return null}highlightSelection(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=document.getSelection();if(!n||n.isCollapsed)return;const{anchorNode:i,anchorOffset:s,focusNode:r,focusOffset:a}=n,o=n.toString(),l=this.#Pe(n).closest(".textLayer"),c=this.getSelectionBoxes(l);if(!c)return;n.empty();const d=this.#Me(l),u=this.#ge===Nf.NONE,h=()=>{const n=d?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:c,anchorNode:i,anchorOffset:s,focusNode:r,focusOffset:a,text:o});u&&this.showAllEditors("highlight",!0,!0),t&&n?.editComment()};u?this.switchToMode(Nf.HIGHLIGHT,h):h()}commentSelection(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.highlightSelection(e,!0)}#Re(){const e=document.getSelection();if(!e||e.isCollapsed)return;const t=this.#Pe(e).closest(".textLayer"),n=this.getSelectionBoxes(t);n&&(this.#re||=new nv(this),this.#re.show(t,n,"ltr"===this.direction))}getAndRemoveDataFromAnnotationStorage(e){if(!this.#U)return null;const t=`${kf}${e}`,n=this.#U.getRawValue(t);return n&&this.#U.remove(t),n}addToAnnotationStorage(e){e.isEmpty()||!this.#U||this.#U.has(e.id)||this.#U.setValue(e.id,e)}a11yAlert(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.#Te;n&&(n.setAttribute("data-l10n-id",e),t?n.setAttribute("data-l10n-args",JSON.stringify(t)):n.removeAttribute("data-l10n-args"))}#Le(){const e=document.getSelection();if(!e||e.isCollapsed)return void(this.#ye&&(this.#re?.hide(),this.#ye=null,this.#je({hasSelectedText:!1})));const{anchorNode:t}=e;if(t===this.#ye)return;const n=this.#Pe(e).closest(".textLayer");if(n){if(this.#re?.hide(),this.#ye=t,this.#je({hasSelectedText:!0}),(this.#ge===Nf.HIGHLIGHT||this.#ge===Nf.NONE)&&(this.#ge===Nf.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#se=this.isShiftKeyDown,!this.isShiftKeyDown)){const e=this.#ge===Nf.HIGHLIGHT?this.#Me(n):null;if(e?.toggleDrawing(),this.#le){const t=new AbortController,n=this.combinedSignal(t),i=n=>{"pointerup"===n.type&&0!==n.button||(t.abort(),e?.toggleDrawing(!0),"pointerup"===n.type&&this.#Oe("main_toolbar"))};window.addEventListener("pointerup",i,{signal:n}),window.addEventListener("blur",i,{signal:n})}else e?.toggleDrawing(!0),this.#Oe("main_toolbar")}}else this.#ye&&(this.#re?.hide(),this.#ye=null,this.#je({hasSelectedText:!1}))}#Oe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.#ge===Nf.HIGHLIGHT?this.highlightSelection(e):this.#Y&&this.#Re()}#Ne(){document.addEventListener("selectionchange",this.#Le.bind(this),{signal:this._signal})}#Fe(){if(this.#ne)return;this.#ne=new AbortController;const e=this.combinedSignal(this.#ne);window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})}#Be(){this.#ne?.abort(),this.#ne=null}blur(){if(this.isShiftKeyDown=!1,this.#se&&(this.#se=!1,this.#Oe("main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of this.#fe)if(t.div.contains(e)){this.#ue=[t,e],t._focusEventsAllowed=!1;break}}focus(){if(!this.#ue)return;const[e,t]=this.#ue;this.#ue=null,t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}#De(){if(this.#de)return;this.#de=new AbortController;const e=this.combinedSignal(this.#de);window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})}#Ue(){this.#de?.abort(),this.#de=null}#ze(){if(this.#$)return;this.#$=new AbortController;const e=this.combinedSignal(this.#$);document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})}#Ve(){this.#$?.abort(),this.#$=null}#Ie(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})}addEditListeners(){this.#De(),this.setEditingState(!0)}removeEditListeners(){this.#Ue(),this.setEditingState(!1)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const n of this.#Q)if(n.isHandlingMimeForPasting(t))return e.dataTransfer.dropEffect="copy",void e.preventDefault()}drop(e){for(const t of e.dataTransfer.items)for(const n of this.#Q)if(n.isHandlingMimeForPasting(t.type))return n.paste(t,this.currentLayer),void e.preventDefault()}copy(e){if(e.preventDefault(),this.#L?.commitOrRemove(),!this.hasSelection)return;const t=[];for(const n of this.#fe){const e=n.serialize(!0);e&&t.push(e)}0!==t.length&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const r of t.items)for(const e of this.#Q)if(e.isHandlingMimeForPasting(r.type))return void e.paste(r,this.currentLayer);let n=t.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(s){return void iy(`paste: "${s.message}".`)}if(!Array.isArray(n))return;this.unselectAll();const i=this.currentLayer;try{const e=[];for(const r of n){const t=await i.deserialize(r);if(!t)return;e.push(t)}const t=()=>{for(const t of e)this.#He(t);this.#$e(e)},s=()=>{for(const t of e)t.remove()};this.addCommands({cmd:t,undo:s,mustExec:!0})}catch(s){iy(`paste: "${s.message}".`)}}keydown(e){this.isShiftKeyDown||"Shift"!==e.key||(this.isShiftKeyDown=!0),this.#ge===Nf.NONE||this.isEditorHandlingKeyboard||dv._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&"Shift"===e.key&&(this.isShiftKeyDown=!1,this.#se&&(this.#se=!1,this.#Oe("main_toolbar")))}onEditingAction(e){let{name:t}=e;switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu")}}#je(e){Object.entries(e).some(e=>{let[t,n]=e;return this.#_e[t]!==n})&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#_e,e)}),this.#ge===Nf.HIGHLIGHT&&!1===e.hasSelectedEditor&&this.#qe([[If.HIGHLIGHT_FREE,!0]]))}#qe(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#Fe(),this.#ze(),this.#je({isEditing:this.#ge!==Nf.NONE,isEmpty:this.#Ge(),hasSomethingToUndo:this.#V.hasSomethingToUndo(),hasSomethingToRedo:this.#V.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#Be(),this.#Ve(),this.#je({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#Q){this.#Q=e;for(const e of this.#Q)this.#qe(e.defaultPropertiesToUpdate)}}getId(){return this.#ae.id}get currentLayer(){return this.#F.get(this.#G)}getLayer(e){return this.#F.get(e)}get currentPageIndex(){return this.#G}addLayer(e){this.#F.set(e.pageIndex,e),this.#oe?e.enable():e.disable()}removeLayer(e){this.#F.delete(e.pageIndex)}async updateMode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(this.#ge!==e&&(!this.#ke||(await this.#ke.promise,this.#ke))){if(this.#ke=Promise.withResolvers(),this.#q?.commitOrRemove(),this.#ge===Nf.POPUP&&this.#H?.hideSidebar(),this.#H?.destroyPopup(),this.#ge=e,e===Nf.NONE){this.setEditingState(!1),this.#We();for(const e of this.#O.values())e.hideStandaloneCommentButton();return this._editorUndoBar?.hide(),this.toggleComment(null),void this.#ke.resolve()}for(const e of this.#O.values())e.addStandaloneCommentButton();e===Nf.SIGNATURE&&await(this.#ve?.loadSignatures()),n&&sv.clearPointerType(),this.setEditingState(!0),await this.#Ke(),this.unselectAll();for(const t of this.#F.values())t.updateMode(e);if(e===Nf.POPUP){this.#j||=await this.#we.getAnnotationsByType(new Set(this.#Q.map(e=>e._editorType)));const e=new Set,t=[];for(const n of this.#O.values()){const{annotationElementId:i,hasComment:s,deleted:r}=n;i&&e.add(i),s&&!r&&t.push(n.getData())}for(const n of this.#j){const{id:i,popupRef:s,contentsObj:r}=n;s&&r?.str&&!e.has(i)&&!this.#W.has(i)&&t.push(n)}this.#H?.showSidebar(t)}if(!t)return i&&this.addNewEditorFromKeyboard(),void this.#ke.resolve();for(const e of this.#O.values())e.uid===t?(this.setSelected(e),r?e.editComment():s?e.enterInEditMode():e.focus()):e.unselect();this.#ke.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==this.#ge&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){if(this.#Q){switch(e){case If.CREATE:return void this.currentLayer.addNewEditor(t);case If.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#xe||=new Map).set(e,t),this.showAllEditors("highlight",t)}if(this.hasSelection)for(const n of this.#fe)n.updateParams(e,t);else for(const n of this.#Q)n.updateDefaultParams(e,t)}}showAllEditors(e,t){for(const n of this.#O.values())n.editorType===e&&n.show(t);(this.#xe?.get(If.HIGHLIGHT_SHOW_ALL)??!0)!==t&&this.#qe([[If.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.#ce!==e){this.#ce=e;for(const t of this.#F.values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}async#Ke(){if(!this.#oe){this.#oe=!0;const e=[];for(const t of this.#F.values())e.push(t.enable());await Promise.all(e);for(const t of this.#O.values())t.enable()}}#We(){if(this.unselectAll(),this.#oe){this.#oe=!1;for(const e of this.#F.values())e.disable();for(const e of this.#O.values())e.disable()}}*getEditors(e){for(const t of this.#O.values())t.pageIndex===e&&(yield t)}getEditor(e){return this.#O.get(e)}addEditor(e){this.#O.set(e.id,e)}removeEditor(e){e.div.contains(document.activeElement)&&(this.#te&&clearTimeout(this.#te),this.#te=setTimeout(()=>{this.focusMainContainer(),this.#te=null},0)),this.#O.delete(e.id),e.annotationElementId&&this.#pe?.delete(e.annotationElementId),this.unselect(e),e.annotationElementId&&this.#W.has(e.annotationElementId)||this.#U?.remove(e.id)}addDeletedAnnotationElement(e){this.#W.add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return this.#W.has(e)}removeDeletedAnnotationElement(e){this.#W.delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}#He(e){const t=this.#F.get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))}setActiveEditor(e){this.#L!==e&&(this.#L=e,e&&this.#qe(e.propertiesToUpdate))}get#Qe(){let e=null;for(e of this.#fe);return e}updateUI(e){this.#Qe===e&&this.#qe(e.propertiesToUpdate)}updateUIForDefaultProperties(e){this.#qe(e.defaultPropertiesToUpdate)}toggleSelected(e){if(this.#fe.has(e))return this.#fe.delete(e),e.unselect(),void this.#je({hasSelectedEditor:this.hasSelection});this.#fe.add(e),e.select(),this.#qe(e.propertiesToUpdate),this.#je({hasSelectedEditor:!0})}setSelected(e){this.updateToolbar({mode:e.mode,editId:e.uid}),this.#q?.commitOrRemove();for(const t of this.#fe)t!==e&&t.unselect();this.#fe.clear(),this.#fe.add(e),e.select(),this.#qe(e.propertiesToUpdate),this.#je({hasSelectedEditor:!0})}isSelected(e){return this.#fe.has(e)}get firstSelectedEditor(){return this.#fe.values().next().value}unselect(e){e.unselect(),this.#fe.delete(e),this.#je({hasSelectedEditor:this.hasSelection})}get hasSelection(){return 0!==this.#fe.size}get isEnterHandled(){return 1===this.#fe.size&&this.firstSelectedEditor.isEnterHandled}undo(){this.#V.undo(),this.#je({hasSomethingToUndo:this.#V.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#Ge()}),this._editorUndoBar?.hide()}redo(){this.#V.redo(),this.#je({hasSomethingToUndo:!0,hasSomethingToRedo:this.#V.hasSomethingToRedo(),isEmpty:this.#Ge()})}addCommands(e){this.#V.add(e),this.#je({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#Ge()})}cleanUndoStack(e){this.#V.cleanType(e)}#Ge(){if(0===this.#O.size)return!0;if(1===this.#O.size)for(const e of this.#O.values())return e.isEmpty();return!1}delete(){this.commitOrRemove();const e=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...this.#fe],n=()=>{for(const e of t)this.#He(e)};this.addCommands({cmd:()=>{this._editorUndoBar?.show(n,1===t.length?t[0].editorType:t.length);for(const e of t)e.remove()},undo:n,mustExec:!0})}commitOrRemove(){this.#L?.commitOrRemove()}hasSomethingToControl(){return this.#L||this.hasSelection}#$e(e){for(const t of this.#fe)t.unselect();this.#fe.clear();for(const t of e)t.isEmpty()||(this.#fe.add(t),t.select());this.#je({hasSelectedEditor:this.hasSelection})}selectAll(){for(const e of this.#fe)e.commit();this.#$e(this.#O.values())}unselectAll(){if((!this.#L||(this.#L.commitOrRemove(),this.#ge===Nf.NONE))&&!this.#q?.commitOrRemove()&&this.hasSelection){for(const e of this.#fe)e.unselect();this.#fe.clear(),this.#je({hasSelectedEditor:!1})}}translateSelectedEditors(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]||this.commitOrRemove(),!this.hasSelection)return;this.#Se[0]+=e,this.#Se[1]+=t;const[n,i]=this.#Se,s=[...this.#fe];this.#Ce&&clearTimeout(this.#Ce),this.#Ce=setTimeout(()=>{this.#Ce=null,this.#Se[0]=this.#Se[1]=0,this.addCommands({cmd:()=>{for(const e of s)this.#O.has(e.id)&&(e.translateInPage(n,i),e.translationDone())},undo:()=>{for(const e of s)this.#O.has(e.id)&&(e.translateInPage(-n,-i),e.translationDone())},mustExec:!1})},1e3);for(const r of s)r.translateInPage(e,t),r.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#K=new Map;for(const e of this.#fe)this.#K.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#K)return!1;this.disableUserSelect(!1);const e=this.#K;this.#K=null;let t=!1;for(const[{x:i,y:s,pageIndex:r},a]of e)a.newX=i,a.newY=s,a.newPageIndex=r,t||=i!==a.savedX||s!==a.savedY||r!==a.savedPageIndex;if(!t)return!1;const n=(e,t,n,i)=>{if(this.#O.has(e.id)){const s=this.#F.get(i);s?e._setParentAndPosition(s,t,n):(e.pageIndex=i,e.x=t,e.y=n)}};return this.addCommands({cmd:()=>{for(const[t,{newX:i,newY:s,newPageIndex:r}]of e)n(t,i,s,r)},undo:()=>{for(const[t,{savedX:i,savedY:s,savedPageIndex:r}]of e)n(t,i,s,r)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(this.#K)for(const n of this.#K.keys())n.drag(e,t)}rebuild(e){if(null===e.parent){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||1===this.#fe.size&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return this.#L===e}getActive(){return this.#L}getMode(){return this.#ge}isEditingMode(){return this.#ge!==Nf.NONE}get imageManager(){return ly(this,"imageManager",new av)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let l=0,c=t.rangeCount;l<c;l++)if(!e.contains(t.getRangeAt(l).commonAncestorContainer))return null;const{x:n,y:i,width:s,height:r}=e.getBoundingClientRect();let a;switch(e.getAttribute("data-main-rotation")){case"90":a=(e,t,a,o)=>({x:(t-i)/r,y:1-(e+a-n)/s,width:o/r,height:a/s});break;case"180":a=(e,t,a,o)=>({x:1-(e+a-n)/s,y:1-(t+o-i)/r,width:a/s,height:o/r});break;case"270":a=(e,t,a,o)=>({x:1-(t+o-i)/r,y:(e-n)/s,width:o/r,height:a/s});break;default:a=(e,t,a,o)=>({x:(e-n)/s,y:(t-i)/r,width:a/s,height:o/r})}const o=[];for(let l=0,c=t.rangeCount;l<c;l++){const e=t.getRangeAt(l);if(!e.collapsed)for(const{x:t,y:n,width:i,height:s}of e.getClientRects())0!==i&&0!==s&&o.push(a(t,n,i,s))}return 0===o.length?null:o}addChangedExistingAnnotation(e){let{annotationElementId:t,id:n}=e;(this.#z||=new Map).set(t,n)}removeChangedExistingAnnotation(e){let{annotationElementId:t}=e;this.#z?.delete(t)}renderAnnotationElement(e){const t=this.#z?.get(e.data.id);if(!t)return;const n=this.#U.getRawValue(t);n&&(this.#ge!==Nf.NONE||n.hasBeenModified)&&n.renderAnnotationElement(e)}setMissingCanvas(e,t,n){const i=this.#pe?.get(e);i&&(i.setCanvas(t,n),this.#pe.delete(e))}addMissingCanvas(e,t){(this.#pe||=new Map).set(e,t)}}class uv{#o=null;#Xe=!1;#Ye=null;#Je=null;#Ze=null;#et=null;#tt=!1;#nt=null;#r=null;#it=null;#st=null;#rt=!1;static#at=null;static _l10n=null;constructor(e){this.#r=e,this.#rt=e._uiManager.useNewAltTextFlow,uv.#at||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(e){uv._l10n??=e}async render(){const e=this.#Ye=document.createElement("button");e.className="altText",e.tabIndex="0";const t=this.#Je=document.createElement("span");e.append(t),this.#rt?(e.classList.add("new"),e.setAttribute("data-l10n-id",uv.#at.missing),t.setAttribute("data-l10n-id",uv.#at["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=this.#r._uiManager._signal;e.addEventListener("contextmenu",Fy,{signal:n}),e.addEventListener("pointerdown",e=>e.stopPropagation(),{signal:n});const i=e=>{e.preventDefault(),this.#r._uiManager.editAltText(this.#r),this.#rt&&this.#r._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#ot}})};return e.addEventListener("click",i,{capture:!0,signal:n}),e.addEventListener("keydown",t=>{t.target===e&&"Enter"===t.key&&(this.#tt=!0,i(t))},{signal:n}),await this.#lt(),e}get#ot(){return(this.#o?"added":null===this.#o&&this.guessedText&&"review")||"missing"}finish(){this.#Ye&&(this.#Ye.focus({focusVisible:this.#tt}),this.#tt=!1)}isEmpty(){return this.#rt?null===this.#o:!this.#o&&!this.#Xe}hasData(){return this.#rt?null!==this.#o||!!this.#it:this.isEmpty()}get guessedText(){return this.#it}async setGuessedText(e){null===this.#o&&(this.#it=e,this.#st=await uv._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e}),this.#lt())}toggleAltTextBadge(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.#rt||this.#o)return this.#nt?.remove(),void(this.#nt=null);if(!this.#nt){const e=this.#nt=document.createElement("div");e.className="noAltTextBadge",this.#r.div.append(e)}this.#nt.classList.toggle("hidden",!e)}serialize(e){let t=this.#o;return e||this.#it!==t||(t=this.#st),{altText:t,decorative:this.#Xe,guessedText:this.#it,textWithDisclaimer:this.#st}}get data(){return{altText:this.#o,decorative:this.#Xe}}set data(e){let{altText:t,decorative:n,guessedText:i,textWithDisclaimer:s,cancel:r=!1}=e;i&&(this.#it=i,this.#st=s),this.#o===t&&this.#Xe===n||(r||(this.#o=t,this.#Xe=n),this.#lt())}toggle(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.#Ye&&(!e&&this.#et&&(clearTimeout(this.#et),this.#et=null),this.#Ye.disabled=!e)}shown(){this.#r._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#ot}})}destroy(){this.#Ye?.remove(),this.#Ye=null,this.#Je=null,this.#Ze=null,this.#nt?.remove(),this.#nt=null}async#lt(){const e=this.#Ye;if(!e)return;if(this.#rt){if(e.classList.toggle("done",!!this.#o),e.setAttribute("data-l10n-id",uv.#at[this.#ot]),this.#Je?.setAttribute("data-l10n-id",uv.#at[`${this.#ot}-label`]),!this.#o)return void this.#Ze?.remove()}else{if(!this.#o&&!this.#Xe)return e.classList.remove("done"),void this.#Ze?.remove();e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=this.#Ze;if(!t){this.#Ze=t=document.createElement("span"),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${this.#r.id}`;const n=100,i=this.#r._uiManager._signal;i.addEventListener("abort",()=>{clearTimeout(this.#et),this.#et=null},{once:!0}),e.addEventListener("mouseenter",()=>{this.#et=setTimeout(()=>{this.#et=null,this.#Ze.classList.add("show"),this.#r._reportTelemetry({action:"alt_text_tooltip"})},n)},{signal:i}),e.addEventListener("mouseleave",()=>{this.#et&&(clearTimeout(this.#et),this.#et=null),this.#Ze?.classList.remove("show")},{signal:i})}this.#Xe?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=this.#o),t.parentNode||e.append(t);const n=this.#r.getElementForAltText();n?.setAttribute("aria-describedby",t.id)}}class hv{#ct=null;#dt=null;#ut=!1;#r=null;#ht=null;#pt=null;#mt=null;#gt=null;#ft=!1;#yt=null;constructor(e){this.#r=e}renderForToolbar(){const e=this.#dt=document.createElement("button");return e.className="comment",this.#v(e,!1)}renderForStandalone(){const e=this.#ct=document.createElement("button");e.className="annotationCommentButton";const t=this.#r.commentButtonPosition;if(t){const{style:n}=e;n.insetInlineEnd=`calc(${100*("ltr"===this.#r._uiManager.direction?1-t[0]:t[0])}% - var(--comment-button-dim))`,n.top=`calc(${100*t[1]}% - var(--comment-button-dim))`;const i=this.#r.commentButtonColor;i&&(n.backgroundColor=i)}return this.#v(e,!0)}focusButton(){setTimeout(()=>{(this.#ct??this.#dt)?.focus()},0)}onUpdatedColor(){if(!this.#ct)return;const e=this.#r.commentButtonColor;e&&(this.#ct.style.backgroundColor=e),this.#r._uiManager.updatePopupColor(this.#r)}get commentButtonWidth(){return(this.#ct?.getBoundingClientRect().width??0)/this.#r.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#yt)return this.#yt;if(!this.#ct)return null;const{x:e,y:t,height:n}=this.#ct.getBoundingClientRect(),{x:i,y:s,width:r,height:a}=this.#r.parent.boundingClientRect;return[(e-i)/r,(t+n-s)/a]}set commentPopupPositionInLayer(e){this.#yt=e}hasDefaultPopupPosition(){return null===this.#yt}removeStandaloneCommentButton(){this.#ct?.remove(),this.#ct=null}removeToolbarCommentButton(){this.#dt?.remove(),this.#dt=null}setCommentButtonStates(e){let{selected:t,hasPopup:n}=e;this.#ct&&(this.#ct.classList.toggle("selected",t),this.#ct.ariaExpanded=n)}#v(e,t){if(!this.#r._uiManager.hasCommentManager())return null;e.tabIndex="0",e.ariaHasPopup="dialog",t?(e.ariaControls="commentPopup",e.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(e.ariaControlsElements=[this.#r._uiManager.getCommentDialogElement()],e.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const n=this.#r._uiManager._signal;if(!(n instanceof AbortSignal)||n.aborted)return e;e.addEventListener("contextmenu",Fy,{signal:n}),t&&(e.addEventListener("focusin",e=>{this.#r._focusEventsAllowed=!1,By(e)},{capture:!0,signal:n}),e.addEventListener("focusout",e=>{this.#r._focusEventsAllowed=!0,By(e)},{capture:!0,signal:n})),e.addEventListener("pointerdown",e=>e.stopPropagation(),{signal:n});const i=t=>{t.preventDefault(),e===this.#dt?this.edit():this.#r.toggleComment(!0)};return e.addEventListener("click",i,{capture:!0,signal:n}),e.addEventListener("keydown",t=>{t.target===e&&"Enter"===t.key&&(this.#ut=!0,i(t))},{signal:n}),e.addEventListener("pointerenter",()=>{this.#r.toggleComment(!1,!0)},{signal:n}),e.addEventListener("pointerleave",()=>{this.#r.toggleComment(!1,!1)},{signal:n}),e}edit(e){const t=this.commentPopupPositionInLayer;let n,i;if(t)[n,i]=t;else{[n,i]=this.#r.commentButtonPosition;const{width:e,height:t,x:s,y:r}=this.#r;n=s+n*e,i=r+i*t}const s=this.#r.parent.boundingClientRect,{x:r,y:a,width:o,height:l}=s;this.#r._uiManager.editComment(this.#r,r+n*o,a+i*l,{...e,parentDimensions:s})}finish(){this.#dt&&(this.#dt.focus({focusVisible:this.#ut}),this.#ut=!1)}isDeleted(){return this.#ft||""===this.#mt}isEmpty(){return null===this.#mt}hasBeenEdited(){return this.isDeleted()||this.#mt!==this.#ht}serialize(){return this.data}get data(){return{text:this.#mt,richText:this.#pt,date:this.#gt,deleted:this.isDeleted()}}set data(e){if(e!==this.#mt&&(this.#pt=null),null===e)return this.#mt="",void(this.#ft=!0);this.#mt=e,this.#gt=new Date,this.#ft=!1}setInitialText(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.#ht=e,this.data=e,this.#gt=null,this.#pt=t}shown(){}destroy(){this.#dt?.remove(),this.#dt=null,this.#ct?.remove(),this.#ct=null,this.#mt="",this.#pt=null,this.#gt=null,this.#r=null,this.#ut=!1,this.#ft=!1}}class pv{#Ae;#vt=!1;#bt=null;#xt;#wt;#_t;#St;#Ct=null;#At;#Et=null;#Tt;#kt=null;constructor(e){let{container:t,isPinchingDisabled:n=null,isPinchingStopped:i=null,onPinchStart:s=null,onPinching:r=null,onPinchEnd:a=null,signal:o}=e;this.#Ae=t,this.#bt=i,this.#xt=n,this.#wt=s,this.#_t=r,this.#St=a,this.#Tt=new AbortController,this.#At=AbortSignal.any([o,this.#Tt.signal]),t.addEventListener("touchstart",this.#Nt.bind(this),{passive:!1,signal:this.#At})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/qy.pixelRatio}#Nt(e){if(this.#xt?.())return;if(1===e.touches.length){if(this.#Ct)return;const e=this.#Ct=new AbortController,t=AbortSignal.any([this.#At,e.signal]),n=this.#Ae,i={capture:!0,signal:t,passive:!1},s=e=>{"touch"===e.pointerType&&(this.#Ct?.abort(),this.#Ct=null)};return n.addEventListener("pointerdown",e=>{"touch"===e.pointerType&&(By(e),s(e))},i),n.addEventListener("pointerup",s,i),void n.addEventListener("pointercancel",s,i)}if(!this.#kt){this.#kt=new AbortController;const e=AbortSignal.any([this.#At,this.#kt.signal]),t=this.#Ae,n={signal:e,capture:!1,passive:!1};t.addEventListener("touchmove",this.#It.bind(this),n);const i=this.#Dt.bind(this);t.addEventListener("touchend",i,n),t.addEventListener("touchcancel",i,n),n.capture=!0,t.addEventListener("pointerdown",By,n),t.addEventListener("pointermove",By,n),t.addEventListener("pointercancel",By,n),t.addEventListener("pointerup",By,n),this.#wt?.()}if(By(e),2!==e.touches.length||this.#bt?.())return void(this.#Et=null);let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]),this.#Et={touch0X:t.screenX,touch0Y:t.screenY,touch1X:n.screenX,touch1Y:n.screenY}}#It(e){if(!this.#Et||2!==e.touches.length)return;By(e);let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]);const{screenX:i,screenY:s}=t,{screenX:r,screenY:a}=n,o=this.#Et,{touch0X:l,touch0Y:c,touch1X:d,touch1Y:u}=o,h=d-l,p=u-c,m=r-i,g=a-s,f=Math.hypot(m,g)||1,y=Math.hypot(h,p)||1;if(!this.#vt&&Math.abs(y-f)<=pv.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(o.touch0X=i,o.touch0Y=s,o.touch1X=r,o.touch1Y=a,!this.#vt)return void(this.#vt=!0);const v=[(i+r)/2,(s+a)/2];this.#_t?.(v,y,f)}#Dt(e){e.touches.length>=2||(this.#kt&&(this.#kt.abort(),this.#kt=null,this.#St?.()),this.#Et&&(By(e),this.#Et=null,this.#vt=!1))}destroy(){this.#Tt?.abort(),this.#Tt=null,this.#Ct?.abort(),this.#Ct=null}}class mv{#Pt=null;#Mt=null;#o=null;#l=null;#ct=null;#Rt=!1;#Lt=null;#jt="";#Ot=null;#Ft=null;#Bt=null;#Ut=null;#zt=null;#Vt="";#Ht=!1;#$t=null;#qt=!1;#Gt=!1;#Wt=!1;#Kt=null;#Qt=0;#Xt=0;#Yt=null;#Jt=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=(()=>Object.create(null))();_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#Zt=!1;#en=(()=>mv._zIndex++)();static _borderLineWidth=-1;static _colorManager=(()=>new cv)();static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const e=mv.prototype._resizeWithKeyboard,t=dv.TRANSLATE_SMALL,n=dv.TRANSLATE_BIG;return ly(this,"_resizerKeyboardManager",new lv([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],mv.prototype._stopResizingWithKeyboard]]))}constructor(e){this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null,this.creationDate=e.creationDate||new Date,this.modificationDate=e.modificationDate||null,this.canAddComment=!0;const{rotation:t,rawDims:{pageWidth:n,pageHeight:i,pageX:s,pageY:r}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,i],this.pageTranslation=[s,r];const[a,o]=this.parentDimensions;this.x=e.x/a,this.y=e.y/o,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return ly(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new gv({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(mv._l10n??=e,mv._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),-1!==mv._borderLineWidth)return;const n=getComputedStyle(document.documentElement);mv._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){sy("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#Zt}set _isDraggable(e){this.#Zt=e,this.div?.classList.toggle("draggable",e)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(2*e),this.y+=this.width*e/(2*t);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(2*e),this.y-=this.width*e/(2*t);break;default:this.x-=this.width/2,this.y-=this.height/2}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#en}setParent(e){null!==e?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):(this.#tn(),this.#Ut?.remove(),this.#Ut=null),this.parent=e}focusin(e){this._focusEventsAllowed&&(this.#Ht?this.#Ht=!1:this.parent.setSelected(this))}focusout(e){if(!this._focusEventsAllowed)return;if(!this.isAttachedToDOM)return;const t=e.relatedTarget;t?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,i){const[s,r]=this.parentDimensions;[n,i]=this.screenToPageTranslation(n,i),this.x=(e+n)/s,this.y=(t+i)/r,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[n,i]=this.parentDimensions;this.setAt(e*n,t*i,this.width*n,this.height*i),this._onTranslated()}#nn(e,t,n){let[i,s]=e;[t,n]=this.screenToPageTranslation(t,n),this.x+=t/i,this.y+=n/s,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(e,t){this.#nn(this.parentDimensions,e,t)}translateInPage(e,t){this.#$t||=[this.x,this.y,this.width,this.height],this.#nn(this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){this.#$t||=[this.x,this.y,this.width,this.height];const{div:n,parentDimensions:[i,s]}=this;if(this.x+=e/i,this.y+=t/s,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:e,y:t}=this.div.getBoundingClientRect();this.parent.findNewParent(this,e,t)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:a}=this;const[o,l]=this.getBaseTranslation();r+=o,a+=l;const{style:c}=n;c.left=`${(100*r).toFixed(2)}%`,c.top=`${(100*a).toFixed(2)}%`,this._onTranslating(r,a),n.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!this.#$t&&(this.#$t[0]!==this.x||this.#$t[1]!==this.y)}get _hasBeenResized(){return!!this.#$t&&(this.#$t[2]!==this.width||this.#$t[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:n}=mv,i=n/e,s=n/t;switch(this.rotation){case 90:return[-i,s];case 180:return[i,s];case 270:return[i,-s];default:return[-i,-s]}}get _mustFixPosition(){return!0}fixAndSetPosition(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rotation;const{div:{style:t},pageDimensions:[n,i]}=this;let{x:s,y:r,width:a,height:o}=this;if(a*=n,o*=i,s*=n,r*=i,this._mustFixPosition)switch(e){case 0:s=Ay(s,0,n-a),r=Ay(r,0,i-o);break;case 90:s=Ay(s,0,n-o),r=Ay(r,a,i);break;case 180:s=Ay(s,a,n),r=Ay(r,o,i);break;case 270:s=Ay(s,o,n),r=Ay(r,0,i-a)}this.x=s/=n,this.y=r/=i;const[l,c]=this.getBaseTranslation();s+=l,r+=c,t.left=`${(100*s).toFixed(2)}%`,t.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}static#in(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}screenToPageTranslation(e,t){return mv.#in(e,t,this.parentRotation)}pageTranslationToScreen(e,t){return mv.#in(e,t,360-this.parentRotation)}#sn(e){switch(e){case 90:{const[e,t]=this.pageDimensions;return[0,-e/t,t/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,t]=this.pageDimensions;return[0,e/t,-t/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,n]}=this;return[t*e,n*e]}setDims(){const{div:{style:e},width:t,height:n}=this;e.width=`${(100*t).toFixed(2)}%`,e.height=`${(100*n).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#rn(){if(this.#Ot)return;this.#Ot=document.createElement("div"),this.#Ot.classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const n of e){const e=document.createElement("div");this.#Ot.append(e),e.classList.add("resizer",n),e.setAttribute("data-resizer-name",n),e.addEventListener("pointerdown",this.#an.bind(this,n),{signal:t}),e.addEventListener("contextmenu",Fy,{signal:t}),e.tabIndex=-1}this.div.prepend(this.#Ot)}#an(e,t){t.preventDefault();const{isMac:n}=vy.platform;if(0!==t.button||t.ctrlKey&&n)return;this.#o?.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,this.#Ft=[t.screenX,t.screenY];const s=new AbortController,r=this._uiManager.combinedSignal(s);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#on.bind(this,e),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",By,{passive:!1,signal:r}),window.addEventListener("contextmenu",Fy,{signal:r}),this.#Bt={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const a=this.parent.div.style.cursor,o=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const l=()=>{s.abort(),this.parent.togglePointerEvents(!0),this.#o?.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=a,this.div.style.cursor=o,this.#ln()};window.addEventListener("pointerup",l,{signal:r}),window.addEventListener("blur",l,{signal:r})}#cn(e,t,n,i){this.width=n,this.height=i,this.x=e,this.y=t,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#ln(){if(!this.#Bt)return;const{savedX:e,savedY:t,savedWidth:n,savedHeight:i}=this.#Bt;this.#Bt=null;const s=this.x,r=this.y,a=this.width,o=this.height;s===e&&r===t&&a===n&&o===i||this.addCommands({cmd:this.#cn.bind(this,s,r,a,o),undo:this.#cn.bind(this,e,t,n,i),mustExec:!0})}static _round(e){return Math.round(1e4*e)/1e4}#on(e,t){const[n,i]=this.parentDimensions,s=this.x,r=this.y,a=this.width,o=this.height,l=mv.MIN_SIZE/n,c=mv.MIN_SIZE/i,d=this.#sn(this.rotation),u=(e,t)=>[d[0]*e+d[2]*t,d[1]*e+d[3]*t],h=this.#sn(360-this.rotation);let p,m,g=!1,f=!1;switch(e){case"topLeft":g=!0,p=(e,t)=>[0,0],m=(e,t)=>[e,t];break;case"topMiddle":p=(e,t)=>[e/2,0],m=(e,t)=>[e/2,t];break;case"topRight":g=!0,p=(e,t)=>[e,0],m=(e,t)=>[0,t];break;case"middleRight":f=!0,p=(e,t)=>[e,t/2],m=(e,t)=>[0,t/2];break;case"bottomRight":g=!0,p=(e,t)=>[e,t],m=(e,t)=>[0,0];break;case"bottomMiddle":p=(e,t)=>[e/2,t],m=(e,t)=>[e/2,0];break;case"bottomLeft":g=!0,p=(e,t)=>[0,t],m=(e,t)=>[e,0];break;case"middleLeft":f=!0,p=(e,t)=>[0,t/2],m=(e,t)=>[e,t/2]}const y=p(a,o),v=m(a,o);let b=u(...v);const x=mv._round(s+b[0]),w=mv._round(r+b[1]);let _,S,C=1,A=1;if(t.fromKeyboard)({deltaX:_,deltaY:S}=t);else{const{screenX:e,screenY:n}=t,[i,s]=this.#Ft;[_,S]=this.screenToPageTranslation(e-i,n-s),this.#Ft[0]=e,this.#Ft[1]=n}if([_,S]=((e,t)=>[h[0]*e+h[2]*t,h[1]*e+h[3]*t])(_/n,S/i),g){const e=Math.hypot(a,o);C=A=Math.max(Math.min(Math.hypot(v[0]-y[0]-_,v[1]-y[1]-S)/e,1/a,1/o),l/a,c/o)}else f?C=Ay(Math.abs(v[0]-y[0]-_),l,1)/a:A=Ay(Math.abs(v[1]-y[1]-S),c,1)/o;const E=mv._round(a*C),T=mv._round(o*A);b=u(...m(E,T));const k=x-b[0],N=w-b[1];this.#$t||=[this.x,this.y,this.width,this.height],this.width=E,this.height=T,this.x=k,this.y=N,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#o?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#Gt)return this._editToolbar;this._editToolbar=new tv(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,n]of e)await this._editToolbar.addButton(t,n);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#o?.destroy()}addContainer(e){const t=this._editToolbar?.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#o||(uv.initialize(mv._l10n),this.#o=new uv(this),this.#Pt&&(this.#o.data=this.#Pt,this.#Pt=null)),this.#o}get altTextData(){return this.#o?.data}set altTextData(e){this.#o&&(this.#o.data=e)}get guessedAltText(){return this.#o?.guessedText}async setGuessedAltText(e){await(this.#o?.setGuessedText(e))}serializeAltText(e){return this.#o?.serialize(e)}hasAltText(){return!!this.#o&&!this.#o.isEmpty()}hasAltTextData(){return this.#o?.hasData()??!1}focusCommentButton(){this.#l?.focusButton()}addCommentButton(){return this.canAddComment?this.#l||=new hv(this):null}addStandaloneCommentButton(){this._uiManager.hasCommentManager()&&(this.#ct?this._uiManager.isEditingMode()&&this.#ct.classList.remove("hidden"):this.hasComment&&(this.#ct=this.#l.renderForStandalone(),this.div.append(this.#ct)))}removeStandaloneCommentButton(){this.#l.removeStandaloneCommentButton(),this.#ct=null}hideStandaloneCommentButton(){this.#ct?.classList.add("hidden")}get comment(){const{data:{richText:e,text:t,date:n,deleted:i}}=this.#l;return{text:t,richText:e,date:n,deleted:i,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(e){this.#l||=new hv(this),this.#l.data=e,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData(e){let{comment:t,popupRef:n,richText:i}=e;if(!n)return;if(this.#l||=new hv(this),this.#l.setInitialText(t,i),!this.annotationElementId)return;const s=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);s&&this.updateFromAnnotationLayer(s)}get hasEditedComment(){return this.#l?.hasBeenEdited()}get hasDeletedComment(){return this.#l?.isDeleted()}get hasComment(){return!!this.#l&&!this.#l.isEmpty()&&!this.#l.isDeleted()}async editComment(e){this.#l||=new hv(this),this.#l.edit(e)}toggleComment(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this.hasComment&&this._uiManager.toggleComment(this,e,t)}setSelectedCommentButton(e){this.#l.setSelectedButton(e)}addComment(e){if(this.hasEditedComment){const t=180,n=100,[,,,i]=e.rect,[s]=this.pageDimensions,[r]=this.pageTranslation,a=r+s+1,o=i-n,l=a+t;e.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[a,o,l,i]}}}updateFromAnnotationLayer(e){let{popup:{contents:t,deleted:n}}=e;this.#l.data=n?null:t}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=this.#Rt?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),this.#dn();const[t,n]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*n/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/n).toFixed(2)}%`);const[i,s]=this.getInitialTranslation();return this.translate(i,s),iv(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#Jt||=new pv({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#un.bind(this),onPinching:this.#hn.bind(this),onPinchEnd:this.#pn.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),e}#un(){this.#Bt={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#o?.toggle(!1),this.parent.togglePointerEvents(!1)}#hn(e,t,n){let i=n/t*.7+1-.7;if(1===i)return;const s=this.#sn(this.rotation),r=(e,t)=>[s[0]*e+s[2]*t,s[1]*e+s[3]*t],[a,o]=this.parentDimensions,l=this.x,c=this.y,d=this.width,u=this.height,h=mv.MIN_SIZE/a,p=mv.MIN_SIZE/o;i=Math.max(Math.min(i,1/d,1/u),h/d,p/u);const m=mv._round(d*i),g=mv._round(u*i);if(m===d&&g===u)return;this.#$t||=[l,c,d,u];const f=r(d/2,u/2),y=mv._round(l+f[0]),v=mv._round(c+f[1]),b=r(m/2,g/2);this.x=y-b[0],this.y=v-b[1],this.width=m,this.height=g,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#pn(){this.#o?.toggle(!0),this.parent.togglePointerEvents(!0),this.#ln()}pointerdown(e){const{isMac:t}=vy.platform;0!==e.button||e.ctrlKey&&t?e.preventDefault():(this.#Ht=!0,this._isDraggable?this.#mn(e):this.#gn(e))}#gn(e){const{isMac:t}=vy.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}#mn(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let n=!1;const i=new AbortController,s=this._uiManager.combinedSignal(i),r={capture:!0,passive:!1,signal:s},a=e=>{i.abort(),this.#Lt=null,this.#Ht=!1,this._uiManager.endDragSession()||this.#gn(e),n&&this._onStopDragging()};t&&(this.#Qt=e.clientX,this.#Xt=e.clientY,this.#Lt=e.pointerId,this.#jt=e.pointerType,window.addEventListener("pointermove",e=>{n||(n=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:t,clientY:i,pointerId:s}=e;if(s!==this.#Lt)return void By(e);const[r,a]=this.screenToPageTranslation(t-this.#Qt,i-this.#Xt);this.#Qt=t,this.#Xt=i,this._uiManager.dragSelectedEditors(r,a)},r),window.addEventListener("touchmove",By,r),window.addEventListener("pointerdown",e=>{e.pointerType===this.#jt&&(this.#Jt||e.isPrimary)&&a(e),By(e)},r));const o=e=>{this.#Lt&&this.#Lt!==e.pointerId?By(e):a(e)};window.addEventListener("pointerup",o,{signal:s}),window.addEventListener("blur",o,{signal:s})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#Kt&&clearTimeout(this.#Kt),this.#Kt=setTimeout(()=>{this.#Kt=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.rotation;const i=this.parentScale,[s,r]=this.pageDimensions,[a,o]=this.pageTranslation,l=e/i,c=t/i,d=this.x*s,u=this.y*r,h=this.width*s,p=this.height*r;switch(n){case 0:return[d+l+a,r-u-c-p+o,d+l+h+a,r-u-c+o];case 90:return[d+c+a,r-u+l+o,d+c+p+a,r-u+l+h+o];case 180:return[d-l-h+a,r-u+c+o,d-l+a,r-u+c+p+o];case 270:return[d-c-p+a,r-u-l-h+o,d-c+a,r-u-l+o];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[n,i,s,r]=e,a=s-n,o=r-i;switch(this.rotation){case 0:return[n,t-r,a,o];case 90:return[n,t-i,o,a];case 180:return[s,t-i,a,o];case 270:return[s,t-r,o,a];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&mv._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#l?.onUpdatedColor()}getData(){const{comment:{text:e,color:t,date:n,opacity:i,deleted:s,richText:r},uid:a,pageIndex:o,creationDate:l,modificationDate:c}=this;return{id:a,pageIndex:o,rect:this.getPDFRect(),richText:r,contentsObj:{str:e},creationDate:l,modificationDate:n||c,popupRef:!s,color:t,opacity:i}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return!this.isInEditMode()&&(this.parent.setEditingState(!1),this.#Gt=!0,!0)}disableEditMode(){return!!this.isInEditMode()&&(this.parent.setEditingState(!0),this.#Gt=!1,!0)}isInEditMode(){return this.#Gt}shouldGetKeyboardEvents(){return this.#Wt}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:n,right:i}=this.getClientDimensions(),{innerHeight:s,innerWidth:r}=window;return t<r&&i>0&&e<s&&n>0}#dn(){if(this.#zt||!this.div)return;this.#zt=new AbortController;const e=this._uiManager.combinedSignal(this.#zt);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})}rebuild(){this.#dn()}rotate(e){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(e,t,n){const i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n,annotationElementId:e.annotationElementId,creationDate:e.creationDate,modificationDate:e.modificationDate});i.rotation=e.rotation,i.#Pt=e.accessibilityData,i._isCopy=e.isCopy||!1;const[s,r]=i.pageDimensions,[a,o,l,c]=i.getRectInCurrentCoords(e.rect,r);return i.x=a/s,i.y=o/r,i.width=l/s,i.height=c/r,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||null!==this.serialize())}remove(){if(this.#zt?.abort(),this.#zt=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),this.#Kt&&(clearTimeout(this.#Kt),this.#Kt=null),this.#tn(),this.removeEditToolbar(),this.#Yt){for(const e of this.#Yt.values())clearTimeout(e);this.#Yt=null}this.parent=null,this.#Jt?.destroy(),this.#Jt=null,this.#Ut?.remove(),this.#Ut=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#rn(),this.#Ot.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return"ltr"===this._uiManager.direction?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[e,t]}=this,[n,i,s,r]=this.getPDFRect();return[mv._round(n+(s-n)*e),mv._round(i+(r-i)*(1-t))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#l.commentPopupPositionInLayer}set commentPopupPosition(e){this.#l.commentPopupPositionInLayer=e}hasDefaultPopupPosition(){return this.#l.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#l.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(e){this.#l?.setCommentButtonStates(e)}keydown(e){if(!this.isResizable||e.target!==this.div||"Enter"!==e.key)return;this._uiManager.setSelected(this),this.#Bt={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const t=this.#Ot.children;if(!this.#Mt){this.#Mt=Array.from(t);const e=this.#fn.bind(this),n=this.#yn.bind(this),i=this._uiManager._signal;for(const t of this.#Mt){const s=t.getAttribute("data-resizer-name");t.setAttribute("role","spinbutton"),t.addEventListener("keydown",e,{signal:i}),t.addEventListener("blur",n,{signal:i}),t.addEventListener("focus",this.#vn.bind(this,s),{signal:i}),t.setAttribute("data-l10n-id",mv._l10nResizer[s])}}const n=this.#Mt[0];let i=0;for(const r of t){if(r===n)break;i++}const s=(360-this.rotation+this.parentRotation)%360/90*(this.#Mt.length/4);if(s!==i){if(s<i)for(let t=0;t<i-s;t++)this.#Ot.append(this.#Ot.firstElementChild);else if(s>i)for(let t=0;t<s-i;t++)this.#Ot.firstElementChild.before(this.#Ot.lastElementChild);let e=0;for(const n of t){const t=this.#Mt[e++].getAttribute("data-resizer-name");n.setAttribute("data-l10n-id",mv._l10nResizer[t])}}this.#bn(0),this.#Wt=!0,this.#Ot.firstElementChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}#fn(e){mv._resizerKeyboardManager.exec(this,e)}#yn(e){this.#Wt&&e.relatedTarget?.parentNode!==this.#Ot&&this.#tn()}#vn(e){this.#Vt=this.#Wt?e:""}#bn(e){if(this.#Mt)for(const t of this.#Mt)t.tabIndex=e}_resizeWithKeyboard(e,t){this.#Wt&&this.#on(this.#Vt,{deltaX:e,deltaY:t,fromKeyboard:!0})}#tn(){this.#Wt=!1,this.#bn(-1),this.#ln()}_stopResizingWithKeyboard(){this.#tn(),this.div.focus()}select(){this.isSelected&&this._editToolbar?this._editToolbar.show():(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),this._editToolbar?(this._editToolbar?.show(),this.#o?.toggleAltTextBadge(!1)):this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()}))}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#Ot?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#o?.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){"BUTTON"!==e.target.nodeName&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#qt}set isEditing(e){this.#qt=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){this.#Yt||=new Map;const{action:t}=e;let n=this.#Yt.get(t);return n&&clearTimeout(n),n=setTimeout(()=>{this._reportTelemetry(e),this.#Yt.delete(t),0===this.#Yt.size&&(this.#Yt=null)},mv._telemetryTimeout),void this.#Yt.set(t,n)}e.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._isVisible;this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),this.#Rt=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#Rt=!0}updateFakeAnnotationElement(e){if(this.#Ut||this.deleted)return this.deleted?(this.#Ut.remove(),void(this.#Ut=null)):void((this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#Ut.updateEdited({rect:this.getPDFRect(),popup:this.comment}));this.#Ut=e.addFakeAnnotation(this)}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t=e.container.querySelector(".annotationContent");if(t){if("CANVAS"===t.nodeName){const e=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.before(t)}}else t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);return t}resetAnnotationElement(e){const{firstElementChild:t}=e.container;"DIV"===t?.nodeName&&t.classList.contains("annotationContent")&&t.remove()}}class gv extends mv{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const fv=3285377520,yv=4294901760,vv=65535;class bv{constructor(e){this.h1=e?4294967295&e:fv,this.h2=e?4294967295&e:fv}update(e){let t,n;if("string"===typeof e){t=new Uint8Array(2*e.length),n=0;for(let i=0,s=e.length;i<s;i++){const s=e.charCodeAt(i);s<=255?t[n++]=s:(t[n++]=s>>>8,t[n++]=255&s)}}else{if(!ArrayBuffer.isView(e))throw new Error("Invalid data format, must be a string or TypedArray.");t=e.slice(),n=t.byteLength}const i=n>>2,s=n-4*i,r=new Uint32Array(t.buffer,0,i);let a=0,o=0,l=this.h1,c=this.h2;const d=3432918353,u=461845907,h=11601,p=13715;for(let m=0;m<i;m++)1&m?(a=r[m],a=a*d&yv|a*h&vv,a=a<<15|a>>>17,a=a*u&yv|a*p&vv,l^=a,l=l<<13|l>>>19,l=5*l+3864292196):(o=r[m],o=o*d&yv|o*h&vv,o=o<<15|o>>>17,o=o*u&yv|o*p&vv,c^=o,c=c<<13|c>>>19,c=5*c+3864292196);switch(a=0,s){case 3:a^=t[4*i+2]<<16;case 2:a^=t[4*i+1]<<8;case 1:a^=t[4*i],a=a*d&yv|a*h&vv,a=a<<15|a>>>17,a=a*u&yv|a*p&vv,1&i?l^=a:c^=a}this.h1=l,this.h2=c}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=3981806797*e&yv|36045*e&vv,t=4283543511*t&yv|(2950163797*(t<<16|e>>>16)&yv)>>>16,e^=t>>>1,e=444984403*e&yv|60499*e&vv,t=3301882366*t&yv|(3120437893*(t<<16|e>>>16)&yv)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const xv=Object.freeze({map:null,hash:"",transfer:void 0});class wv{#xn=!1;#wn=null;#_n=null;#Sn=(()=>new Map)();constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const n=this.#Sn.get(e);return void 0===n?t:Object.assign(t,n)}getRawValue(e){return this.#Sn.get(e)}remove(e){const t=this.#Sn.get(e);if(void 0!==t&&(t instanceof mv&&this.#_n.delete(t.annotationElementId),this.#Sn.delete(e),0===this.#Sn.size&&this.resetModified(),"function"===typeof this.onAnnotationEditor)){for(const e of this.#Sn.values())if(e instanceof mv)return;this.onAnnotationEditor(null)}}setValue(e,t){const n=this.#Sn.get(e);let i=!1;if(void 0!==n)for(const[s,r]of Object.entries(t))n[s]!==r&&(i=!0,n[s]=r);else i=!0,this.#Sn.set(e,t);i&&this.#Cn(),t instanceof mv&&((this.#_n||=new Map).set(t.annotationElementId,t),"function"===typeof this.onAnnotationEditor&&this.onAnnotationEditor(t.constructor._type))}has(e){return this.#Sn.has(e)}get size(){return this.#Sn.size}#Cn(){this.#xn||(this.#xn=!0,"function"===typeof this.onSetModified&&this.onSetModified())}resetModified(){this.#xn&&(this.#xn=!1,"function"===typeof this.onResetModified&&this.onResetModified())}get print(){return new _v(this)}get serializable(){if(0===this.#Sn.size)return xv;const e=new Map,t=new bv,n=[],i=Object.create(null);let s=!1;for(const[r,a]of this.#Sn){const n=a instanceof mv?a.serialize(!1,i):a;n&&(e.set(r,n),t.update(`${r}:${JSON.stringify(n)}`),s||=!!n.bitmap)}if(s)for(const r of e.values())r.bitmap&&n.push(r.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:xv}get editorStats(){let e=null;const t=new Map;let n=0,i=0;for(const s of this.#Sn.values()){if(!(s instanceof mv)){s.popup&&(s.popup.deleted?i+=1:n+=1);continue}s.isCommentDeleted?i+=1:s.hasEditedComment&&(n+=1);const r=s.telemetryFinalData;if(!r)continue;const{type:a}=r;t.has(a)||t.set(a,Object.getPrototypeOf(s).constructor),e||=Object.create(null);const o=e[a]||=new Map;for(const[e,t]of Object.entries(r)){if("type"===e)continue;let n=o.get(e);n||(n=new Map,o.set(e,n));const i=n.get(t)??0;n.set(t,i+1)}}if((i>0||n>0)&&(e||=Object.create(null),e.comments={deleted:i,edited:n}),!e)return null;for(const[s,r]of t)e[s]=r.computeTelemetryFinalData(e[s]);return e}resetModifiedIds(){this.#wn=null}updateEditor(e,t){const n=this.#_n?.get(e);return!!n&&(n.updateFromAnnotationLayer(t),!0)}getEditor(e){return this.#_n?.get(e)||null}get modifiedIds(){if(this.#wn)return this.#wn;const e=[];if(this.#_n)for(const t of this.#_n.values())t.serialize()&&e.push(t.annotationElementId);return this.#wn={ids:new Set(e),hash:e.join(",")}}[Symbol.iterator](){return this.#Sn.entries()}}class _v extends wv{#An;constructor(e){super();const{map:t,hash:n,transfer:i}=e.serializable,s=structuredClone(t,i?{transfer:i}:null);this.#An={map:s,hash:n,transfer:i}}get print(){sy("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#An}get modifiedIds(){return ly(this,"modifiedIds",{ids:new Set,hash:""})}}class Sv{#En=(()=>new Set)();constructor(e){let{ownerDocument:t=globalThis.document,styleElement:n=null}=e;this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),this.#En.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(e){let{systemFontInfo:t,disableFontFace:n,_inspectFont:i}=e;if(t&&!this.#En.has(t.loadedName)){if(ry(!n,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:e,src:n,style:s}=t,r=new FontFace(e,n,s);this.addNativeFontFace(r);try{await r.load(),this.#En.add(e),i?.(t)}catch{iy(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(r)}return}sy("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo)return void await this.loadSystemFont(e);if(this.isFontLoadingAPISupported){const t=e.createNativeFontFace();if(t){this.addNativeFontFace(t);try{await t.loaded}catch(n){throw iy(`Failed to load font '${t.family}': '${n}'.`),e.disableFontFace=!0,n}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(t=>{const n=this._queueLoadingCallback(t);this._prepareFontLoadEvent(e,n)})}}get isFontLoadingAPISupported(){return ly(this,"isFontLoadingAPISupported",!!this._document?.fonts)}get isSyncFontLoadingSupported(){return ly(this,"isSyncFontLoadingSupported",ff||vy.platform.isFirefox)}_queueLoadingCallback(e){const{loadingRequests:t}=this,n={done:!1,complete:function(){for(ry(!n.done,"completeRequest() cannot be called twice."),n.done=!0;t.length>0&&t[0].done;){const e=t.shift();setTimeout(e.callback,0)}},callback:e};return t.push(n),n}get _loadTestFont(){return ly(this,"_loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))}_prepareFontLoadEvent(e,t){function n(e,t){return e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|255&e.charCodeAt(t+3)}function i(e,t,n,i){return e.substring(0,t)+i+e.substring(t+n)}let s,r;const a=this._document.createElement("canvas");a.width=1,a.height=1;const o=a.getContext("2d");let l=0;const c=`lt${Date.now()}${this.loadTestFontId++}`;let d=this._loadTestFont;d=i(d,976,c.length,c);const u=1482184792;let h=n(d,16);for(s=0,r=c.length-3;s<r;s+=4)h=h-u+n(c,s)|0;var p;s<c.length&&(h=h-u+n(c+"XXX",s)|0),d=i(d,16,4,(p=h,String.fromCharCode(p>>24&255,p>>16&255,p>>8&255,255&p)));const m=`@font-face {font-family:"${c}";src:${`url(data:font/opentype;base64,${btoa(d)});`}}`;this.insertRule(m);const g=this._document.createElement("div");g.style.visibility="hidden",g.style.width=g.style.height="10px",g.style.position="absolute",g.style.top=g.style.left="0px";for(const f of[e.loadedName,c]){const e=this._document.createElement("span");e.textContent="Hi",e.style.fontFamily=f,g.append(e)}this._document.body.append(g),function e(t,n){if(++l>30)return iy("Load test font never loaded."),void n();o.font="30px "+t,o.fillText(".",0,20),o.getImageData(0,0,1,1).data[3]>0?n():setTimeout(e.bind(null,t,n))}(c,()=>{g.remove(),t.complete()})}}class Cv{#Tn;constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;this.compiledGlyphs=Object.create(null),this.#Tn=e,this._inspectFont=t,n&&Object.assign(this,n),i&&(this.charProcOperatorList=i)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(this.cssFontInfo){const t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}else e=new FontFace(this.loadedName,this.data,{});return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${Ey(this.data)});`;let t;if(this.cssFontInfo){let n=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(n+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${n}src:${e}}`}else t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;return this._inspectFont?.(this,e),t}getPathGenerator(e,t){if(void 0!==this.compiledGlyphs[t])return this.compiledGlyphs[t];const n=this.loadedName+"_path_"+t;let i;try{i=e.get(n)}catch(r){iy(`getPathGenerator - ignoring character: "${r}".`)}const s=ev(i?.path);return this.fontExtraProperties||e.delete(n),this.compiledGlyphs[t]=s}get black(){return this.#Tn.black}get bold(){return this.#Tn.bold}get disableFontFace(){return this.#Tn.disableFontFace??!1}set disableFontFace(e){ly(this,"disableFontFace",!!e)}get fontExtraProperties(){return this.#Tn.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#Tn.isInvalidPDFjsFont}get isType3Font(){return this.#Tn.isType3Font}get italic(){return this.#Tn.italic}get missingFile(){return this.#Tn.missingFile}get remeasure(){return this.#Tn.remeasure}get vertical(){return this.#Tn.vertical}get ascent(){return this.#Tn.ascent}get defaultWidth(){return this.#Tn.defaultWidth}get descent(){return this.#Tn.descent}get bbox(){return this.#Tn.bbox}set bbox(e){ly(this,"bbox",e)}get fontMatrix(){return this.#Tn.fontMatrix}get fallbackName(){return this.#Tn.fallbackName}get loadedName(){return this.#Tn.loadedName}get mimetype(){return this.#Tn.mimetype}get name(){return this.#Tn.name}get data(){return this.#Tn.data}clearData(){this.#Tn.clearData()}get cssFontInfo(){return this.#Tn.cssFontInfo}get systemFontInfo(){return this.#Tn.systemFontInfo}get defaultVMetrics(){return this.#Tn.defaultVMetrics}}class Av{#kn;#Nn;#In;static strings=["fontFamily","fontWeight","italicAngle"];static write(e){const t=new TextEncoder,n={};let i=0;for(const l of Av.strings){const s=t.encode(e[l]);n[l]=s,i+=4+s.length}const s=new ArrayBuffer(i),r=new Uint8Array(s),a=new DataView(s);let o=0;for(const l of Av.strings){const e=n[l],t=e.length;a.setUint32(o,t),r.set(e,o+4),o+=4+t}return ry(o===s.byteLength,"CssFontInfo.write: Buffer overflow"),s}constructor(e){this.#kn=e,this.#Nn=new DataView(this.#kn),this.#In=new TextDecoder}#Dn(e){ry(e<Av.strings.length,"Invalid string index");let t=0;for(let i=0;i<e;i++)t+=this.#Nn.getUint32(t)+4;const n=this.#Nn.getUint32(t);return this.#In.decode(new Uint8Array(this.#kn,t+4,n))}get fontFamily(){return this.#Dn(0)}get fontWeight(){return this.#Dn(1)}get italicAngle(){return this.#Dn(2)}}class Ev{#kn;#Nn;#In;static strings=["css","loadedName","baseFontName","src"];static write(e){const t=new TextEncoder,n={};let i=0;for(const u of Ev.strings){const s=t.encode(e[u]);n[u]=s,i+=4+s.length}i+=4;let s,r,a=1+i;e.style&&(s=t.encode(e.style.style),r=t.encode(e.style.weight),a+=4+s.length+4+r.length);const o=new ArrayBuffer(a),l=new Uint8Array(o),c=new DataView(o);let d=0;c.setUint8(d++,e.guessFallback?1:0),c.setUint32(d,0),d+=4,i=0;for(const u of Ev.strings){const e=n[u],t=e.length;i+=4+t,c.setUint32(d,t),l.set(e,d+4),d+=4+t}return c.setUint32(d-i-4,i),e.style&&(c.setUint32(d,s.length),l.set(s,d+4),d+=4+s.length,c.setUint32(d,r.length),l.set(r,d+4),d+=4+r.length),ry(d<=o.byteLength,"SubstitionInfo.write: Buffer overflow"),o.transferToFixedLength(d)}constructor(e){this.#kn=e,this.#Nn=new DataView(this.#kn),this.#In=new TextDecoder}get guessFallback(){return 0!==this.#Nn.getUint8(0)}#Dn(e){ry(e<Ev.strings.length,"Invalid string index");let t=5;for(let i=0;i<e;i++)t+=this.#Nn.getUint32(t)+4;const n=this.#Nn.getUint32(t);return this.#In.decode(new Uint8Array(this.#kn,t+4,n))}get css(){return this.#Dn(0)}get loadedName(){return this.#Dn(1)}get baseFontName(){return this.#Dn(2)}get src(){return this.#Dn(3)}get style(){let e=1;e+=4+this.#Nn.getUint32(e);const t=this.#Nn.getUint32(e),n=this.#In.decode(new Uint8Array(this.#kn,e+4,t));e+=4+t;const i=this.#Nn.getUint32(e);return{style:n,weight:this.#In.decode(new Uint8Array(this.#kn,e+4,i))}}}class Tv{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#Pn=(()=>Math.ceil(2*this.bools.length/8))();static#Mn=(()=>this.#Pn+8*this.numbers.length)();static#Rn=(()=>this.#Mn+1+8)();static#Ln=(()=>this.#Rn+1+48)();static#jn=(()=>this.#Ln+1+6)();#kn;#In;#Nn;constructor(e){let{data:t,extra:n}=e;this.#kn=t,this.#In=new TextDecoder,this.#Nn=new DataView(this.#kn),n&&Object.assign(this,n)}#On(e){ry(e<Tv.bools.length,"Invalid boolean index");const t=Math.floor(e/4),n=2*e%8,i=this.#Nn.getUint8(t)>>n&3;return 0===i?void 0:2===i}get black(){return this.#On(0)}get bold(){return this.#On(1)}get disableFontFace(){return this.#On(2)}get fontExtraProperties(){return this.#On(3)}get isInvalidPDFjsFont(){return this.#On(4)}get isType3Font(){return this.#On(5)}get italic(){return this.#On(6)}get missingFile(){return this.#On(7)}get remeasure(){return this.#On(8)}get vertical(){return this.#On(9)}#Fn(e){return ry(e<Tv.numbers.length,"Invalid number index"),this.#Nn.getFloat64(Tv.#Pn+8*e)}get ascent(){return this.#Fn(0)}get defaultWidth(){return this.#Fn(1)}get descent(){return this.#Fn(2)}get bbox(){let e=Tv.#Mn;if(0===this.#Nn.getUint8(e))return;e+=1;const t=[];for(let n=0;n<4;n++)t.push(this.#Nn.getInt16(e,!0)),e+=2;return t}get fontMatrix(){let e=Tv.#Rn;if(0===this.#Nn.getUint8(e))return;e+=1;const t=[];for(let n=0;n<6;n++)t.push(this.#Nn.getFloat64(e,!0)),e+=8;return t}get defaultVMetrics(){let e=Tv.#Ln;if(0===this.#Nn.getUint8(e))return;e+=1;const t=[];for(let n=0;n<3;n++)t.push(this.#Nn.getInt16(e,!0)),e+=2;return t}#Dn(e){ry(e<Tv.strings.length,"Invalid string index");let t=Tv.#jn+4;for(let s=0;s<e;s++)t+=this.#Nn.getUint32(t)+4;const n=this.#Nn.getUint32(t),i=new Uint8Array(n);return i.set(new Uint8Array(this.#kn,t+4,n)),this.#In.decode(i)}get fallbackName(){return this.#Dn(0)}get loadedName(){return this.#Dn(1)}get mimetype(){return this.#Dn(2)}get name(){return this.#Dn(3)}get data(){let e=Tv.#jn;e+=4+this.#Nn.getUint32(e);e+=4+this.#Nn.getUint32(e);e+=4+this.#Nn.getUint32(e);const t=this.#Nn.getUint32(e);if(0!==t)return new Uint8Array(this.#kn,e+4,t)}clearData(){let e=Tv.#jn;e+=4+this.#Nn.getUint32(e);e+=4+this.#Nn.getUint32(e);e+=4+this.#Nn.getUint32(e);const t=this.#Nn.getUint32(e);new Uint8Array(this.#kn,e+4,t).fill(0),this.#Nn.setUint32(e,0)}get cssFontInfo(){let e=Tv.#jn;e+=4+this.#Nn.getUint32(e);e+=4+this.#Nn.getUint32(e);const t=this.#Nn.getUint32(e);if(0===t)return null;const n=new Uint8Array(t);return n.set(new Uint8Array(this.#kn,e+4,t)),new Av(n.buffer)}get systemFontInfo(){let e=Tv.#jn;e+=4+this.#Nn.getUint32(e);const t=this.#Nn.getUint32(e);if(0===t)return null;const n=new Uint8Array(t);return n.set(new Uint8Array(this.#kn,e+4,t)),new Ev(n.buffer)}static write(e){const t=e.systemFontInfo?Ev.write(e.systemFontInfo):null,n=e.cssFontInfo?Av.write(e.cssFontInfo):null,i=new TextEncoder,s={};let r=0;for(const m of Tv.strings)s[m]=i.encode(e[m]),r+=4+s[m].length;const a=Tv.#jn+4+r+4+(t?t.byteLength:0)+4+(n?n.byteLength:0)+4+(e.data?e.data.length:0),o=new ArrayBuffer(a),l=new Uint8Array(o),c=new DataView(o);let d=0;const u=Tv.bools.length;let h=0,p=0;for(let m=0;m<u;m++){const t=e[Tv.bools[m]];h|=(void 0===t?0:t?2:1)<<p,p+=2,8!==p&&m!==u-1||(c.setUint8(d++,h),h=0,p=0)}ry(d===Tv.#Pn,"FontInfo.write: Boolean properties offset mismatch");for(const m of Tv.numbers)c.setFloat64(d,e[m]),d+=8;if(ry(d===Tv.#Mn,"FontInfo.write: Number properties offset mismatch"),e.bbox){c.setUint8(d++,4);for(const t of e.bbox)c.setInt16(d,t,!0),d+=2}else c.setUint8(d++,0),d+=8;if(ry(d===Tv.#Rn,"FontInfo.write: BBox properties offset mismatch"),e.fontMatrix){c.setUint8(d++,6);for(const t of e.fontMatrix)c.setFloat64(d,t,!0),d+=8}else c.setUint8(d++,0),d+=48;if(ry(d===Tv.#Ln,"FontInfo.write: FontMatrix properties offset mismatch"),e.defaultVMetrics){c.setUint8(d++,1);for(const t of e.defaultVMetrics)c.setInt16(d,t,!0),d+=2}else c.setUint8(d++,0),d+=6;ry(d===Tv.#jn,"FontInfo.write: DefaultVMetrics properties offset mismatch"),c.setUint32(Tv.#jn,0),d+=4;for(const m of Tv.strings){const e=s[m],t=e.length;c.setUint32(d,t),l.set(e,d+4),d+=4+t}if(c.setUint32(Tv.#jn,d-Tv.#jn-4),t){const e=t.byteLength;c.setUint32(d,e),ry(d+4+e<=o.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),l.set(new Uint8Array(t),d+4),d+=4+e}else c.setUint32(d,0),d+=4;if(n){const e=n.byteLength;c.setUint32(d,e),ry(d+4+e<=o.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),l.set(new Uint8Array(n),d+4),d+=4+e}else c.setUint32(d,0),d+=4;return void 0===e.data?(c.setUint32(d,0),d+=4):(c.setUint32(d,e.data.length),l.set(e.data,d+4),d+=4+e.data.length),ry(d<=o.byteLength,"FontInfo.write: Buffer overflow"),o.transferToFixedLength(d)}}class kv{static#Bn=0;static#Un=1;static#zn=2;static#Vn=3;static#Hn=4;static#$n=8;static#qn=12;static#Gn=16;constructor(e){this.buffer=e,this.view=new DataView(e),this.data=new Uint8Array(e)}static write(e){let t,n=null,i=[],s=[],r=[],a=[],o=null,l=null;switch(e[0]){case"RadialAxial":t="axial"===e[1]?1:2,n=e[2],r=e[3],1===t?i.push(...e[4],...e[5]):i.push(e[4][0],e[4][1],e[6],e[5][0],e[5][1],e[7]);break;case"Mesh":t=3,o=e[1],i=e[2],s=e[3],a=e[4]||[],n=e[6],l=e[7];break;default:throw new Error(`Unsupported pattern type: ${e[0]}`)}const c=Math.floor(i.length/2),d=Math.floor(s.length/3),u=r.length,h=a.length;let p=0;for(const v of a)p+=1,p=4*Math.ceil(p/4),p+=4+4*v.coords.length,p+=4+4*v.colors.length,void 0!==v.verticesPerRow&&(p+=4);const m=new ArrayBuffer(20+8*c+3*d+8*u+(n?16:0)+(l?3:0)+p),g=new DataView(m),f=new Uint8Array(m);g.setUint8(kv.#Bn,t),g.setUint8(kv.#Un,n?1:0),g.setUint8(kv.#zn,l?1:0),g.setUint8(kv.#Vn,o),g.setUint32(kv.#Hn,c,!0),g.setUint32(kv.#$n,d,!0),g.setUint32(kv.#qn,u,!0),g.setUint32(kv.#Gn,h,!0);let y=20;new Float32Array(m,y,2*c).set(i),y+=8*c,f.set(s,y),y+=3*d;for(const[v,b]of r)g.setFloat32(y,v,!0),y+=4,g.setUint32(y,parseInt(b.slice(1),16),!0),y+=4;if(n)for(const v of n)g.setFloat32(y,v,!0),y+=4;l&&(f.set(l,y),y+=3);for(let v=0;v<a.length;v++){const e=a[v];g.setUint8(y,e.type),y+=1,y=4*Math.ceil(y/4),g.setUint32(y,e.coords.length,!0),y+=4;new Int32Array(m,y,e.coords.length).set(e.coords),y+=4*e.coords.length,g.setUint32(y,e.colors.length,!0),y+=4;new Int32Array(m,y,e.colors.length).set(e.colors),y+=4*e.colors.length,void 0!==e.verticesPerRow&&(g.setUint32(y,e.verticesPerRow,!0),y+=4)}return m}getIR(){const e=this.view,t=this.data[kv.#Bn],n=!!this.data[kv.#Un],i=!!this.data[kv.#zn],s=e.getUint32(kv.#Hn,!0),r=e.getUint32(kv.#$n,!0),a=e.getUint32(kv.#qn,!0),o=e.getUint32(kv.#Gn,!0);let l=20;const c=new Float32Array(this.buffer,l,2*s);l+=8*s;const d=new Uint8Array(this.buffer,l,3*r);l+=3*r;const u=[];for(let g=0;g<a;++g){const t=e.getFloat32(l,!0);l+=4;const n=e.getUint32(l,!0);l+=4,u.push([t,`#${n.toString(16).padStart(6,"0")}`])}let h=null;if(n){h=[];for(let t=0;t<4;++t)h.push(e.getFloat32(l,!0)),l+=4}let p=null;i&&(p=new Uint8Array(this.buffer,l,3),l+=3);const m=[];for(let g=0;g<o;++g){const t=e.getUint8(l);l+=1,l=4*Math.ceil(l/4);const n=e.getUint32(l,!0);l+=4;const i=new Int32Array(this.buffer,l,n);l+=4*n;const s=e.getUint32(l,!0);l+=4;const r=new Int32Array(this.buffer,l,s);l+=4*s;const a={type:t,coords:i,colors:r};t===Pf&&(a.verticesPerRow=e.getUint32(l,!0),l+=4),m.push(a)}if(1===t)return["RadialAxial","axial",h,u,Array.from(c.slice(0,2)),Array.from(c.slice(2,4)),null,null];if(2===t)return["RadialAxial","radial",h,u,[c[0],c[1]],[c[3],c[4]],c[2],c[5]];if(3===t){const e=this.data[kv.#Vn];let t=null;if(c.length>0){let e=c[0],n=c[0],i=c[1],s=c[1];for(let t=0;t<c.length;t+=2){const r=c[t],a=c[t+1];e=e>r?r:e,i=i>a?a:i,n=n<r?r:n,s=s<a?a:s}t=[e,i,n,s]}return["Mesh",e,c,d,m,t,h,p]}throw new Error(`Unsupported pattern kind: ${t}`)}}class Nv{static write(e){let t,n;return vy.isFloat16ArraySupported?(n=new ArrayBuffer(2*e.length),t=new Float16Array(n)):(n=new ArrayBuffer(4*e.length),t=new Float32Array(n)),t.set(e),n}#kn;constructor(e){this.#kn=e}get path(){return vy.isFloat16ArraySupported?new Float16Array(this.#kn):new Float32Array(this.#kn)}}function Iv(e){if("string"!==typeof e)return null;if(e.endsWith("/"))return e;throw new Error(`Invalid factory url: "${e}" must include trailing slash.`)}const Dv=e=>"object"===typeof e&&Number.isInteger(e?.num)&&e.num>=0&&Number.isInteger(e?.gen)&&e.gen>=0,Pv=function(e,t,n){if(!Array.isArray(n)||n.length<2)return!1;const[i,s,...r]=n;if(!e(i)&&!Number.isInteger(i))return!1;if(!t(s))return!1;const a=r.length;let o=!0;switch(s.name){case"XYZ":if(a<2||a>3)return!1;break;case"Fit":case"FitB":return 0===a;case"FitH":case"FitBH":case"FitV":case"FitBV":if(a>1)return!1;break;case"FitR":if(4!==a)return!1;o=!1;break;default:return!1}for(const l of r)if(!("number"===typeof l||o&&null===l))return!1;return!0}.bind(null,Dv,e=>"object"===typeof e&&"string"===typeof e?.name);class Mv{#Wn=(()=>new Map)();#Kn=(()=>Promise.resolve())();postMessage(e,t){const n={data:structuredClone(e,t?{transfer:t}:null)};this.#Kn.then(()=>{for(const[e]of this.#Wn)e.call(this,n)})}addEventListener(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=null;if(n?.signal instanceof AbortSignal){const{signal:s}=n;if(s.aborted)return void iy("LoopbackPort - cannot use an `aborted` signal.");const r=()=>this.removeEventListener(e,t);i=()=>s.removeEventListener("abort",r),s.addEventListener("abort",r)}this.#Wn.set(t,i)}removeEventListener(e,t){const n=this.#Wn.get(t);n?.(),this.#Wn.delete(t)}terminate(){for(const[,e]of this.#Wn)e?.();this.#Wn.clear()}}const Rv=1,Lv=2,jv=1,Ov=2,Fv=3,Bv=4,Uv=5,zv=6,Vv=7,Hv=8;function $v(){}function qv(e){if(e instanceof gy||e instanceof hy||e instanceof dy||e instanceof py||e instanceof uy)return e;switch(e instanceof Error||"object"===typeof e&&null!==e||sy('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),e.name){case"AbortException":return new gy(e.message);case"InvalidPDFException":return new hy(e.message);case"PasswordException":return new dy(e.message,e.code);case"ResponseException":return new py(e.message,e.status,e.missing);case"UnknownErrorException":return new uy(e.message,e.details)}return new uy(e.message,e.toString())}class Gv{#Qn=(()=>new AbortController)();constructor(e,t,n){this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",this.#Xn.bind(this),{signal:this.#Qn.signal})}#Xn(e){let{data:t}=e;if(t.targetName!==this.sourceName)return;if(t.stream)return void this.#Yn(t);if(t.callback){const e=t.callbackId,n=this.callbackCapabilities[e];if(!n)throw new Error(`Cannot resolve callback ${e}`);if(delete this.callbackCapabilities[e],t.callback===Rv)n.resolve(t.data);else{if(t.callback!==Lv)throw new Error("Unexpected callback case");n.reject(qv(t.reason))}return}const n=this.actionHandler[t.action];if(!n)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const e=this.sourceName,i=t.sourceName,s=this.comObj;return void Promise.try(n,t.data).then(function(n){s.postMessage({sourceName:e,targetName:i,callback:Rv,callbackId:t.callbackId,data:n})},function(n){s.postMessage({sourceName:e,targetName:i,callback:Lv,callbackId:t.callbackId,reason:qv(n)})})}t.streamId?this.#Jn(t):n(t.data)}on(e,t){const n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){const i=this.callbackId++,s=Promise.withResolvers();this.callbackCapabilities[i]=s;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},n)}catch(r){s.reject(r)}return s.promise}sendWithStream(e,t,n,i){const s=this.streamId++,r=this.sourceName,a=this.targetName,o=this.comObj;return new ReadableStream({start:n=>{const l=Promise.withResolvers();return this.streamControllers[s]={controller:n,startCall:l,pullCall:null,cancelCall:null,isClosed:!1},o.postMessage({sourceName:r,targetName:a,action:e,streamId:s,data:t,desiredSize:n.desiredSize},i),l.promise},pull:e=>{const t=Promise.withResolvers();return this.streamControllers[s].pullCall=t,o.postMessage({sourceName:r,targetName:a,stream:zv,streamId:s,desiredSize:e.desiredSize}),t.promise},cancel:e=>{ry(e instanceof Error,"cancel must have a valid reason");const t=Promise.withResolvers();return this.streamControllers[s].cancelCall=t,this.streamControllers[s].isClosed=!0,o.postMessage({sourceName:r,targetName:a,stream:jv,streamId:s,reason:qv(e)}),t.promise}},n)}#Jn(e){const t=e.streamId,n=this.sourceName,i=e.sourceName,s=this.comObj,r=this,a=this.actionHandler[e.action],o={enqueue(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0;if(this.isCancelled)return;const o=this.desiredSize;this.desiredSize-=r,o>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),s.postMessage({sourceName:n,targetName:i,stream:Bv,streamId:t,chunk:e},a)},close(){this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:n,targetName:i,stream:Fv,streamId:t}),delete r.streamSinks[t])},error(e){ry(e instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:n,targetName:i,stream:Uv,streamId:t,reason:qv(e)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};o.sinkCapability.resolve(),o.ready=o.sinkCapability.promise,this.streamSinks[t]=o,Promise.try(a,e.data,o).then(function(){s.postMessage({sourceName:n,targetName:i,stream:Hv,streamId:t,success:!0})},function(e){s.postMessage({sourceName:n,targetName:i,stream:Hv,streamId:t,reason:qv(e)})})}#Yn(e){const t=e.streamId,n=this.sourceName,i=e.sourceName,s=this.comObj,r=this.streamControllers[t],a=this.streamSinks[t];switch(e.stream){case Hv:e.success?r.startCall.resolve():r.startCall.reject(qv(e.reason));break;case Vv:e.success?r.pullCall.resolve():r.pullCall.reject(qv(e.reason));break;case zv:if(!a){s.postMessage({sourceName:n,targetName:i,stream:Vv,streamId:t,success:!0});break}a.desiredSize<=0&&e.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=e.desiredSize,Promise.try(a.onPull||$v).then(function(){s.postMessage({sourceName:n,targetName:i,stream:Vv,streamId:t,success:!0})},function(e){s.postMessage({sourceName:n,targetName:i,stream:Vv,streamId:t,reason:qv(e)})});break;case Bv:if(ry(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(e.chunk);break;case Fv:if(ry(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),this.#Zn(r,t);break;case Uv:ry(r,"error should have stream controller"),r.controller.error(qv(e.reason)),this.#Zn(r,t);break;case Ov:e.success?r.cancelCall.resolve():r.cancelCall.reject(qv(e.reason)),this.#Zn(r,t);break;case jv:if(!a)break;const o=qv(e.reason);Promise.try(a.onCancel||$v,o).then(function(){s.postMessage({sourceName:n,targetName:i,stream:Ov,streamId:t,success:!0})},function(e){s.postMessage({sourceName:n,targetName:i,stream:Ov,streamId:t,reason:qv(e)})}),a.sinkCapability.reject(o),a.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async#Zn(e,t){await Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[t]}destroy(){this.#Qn?.abort(),this.#Qn=null}}class Wv{#ei=!1;constructor(e){let{enableHWA:t=!1}=e;this.#ei=t}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!this.#ei})}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){sy("Abstract method `_createCanvas` called.")}}class Kv extends Wv{constructor(e){let{ownerDocument:t=globalThis.document,enableHWA:n=!1}=e;super({enableHWA:n}),this._document=t}_createCanvas(e,t){const n=this._document.createElement("canvas");return n.width=e,n.height=t,n}}class Qv{constructor(e){let{baseUrl:t=null,isCompressed:n=!0}=e;this.baseUrl=t,this.isCompressed=n}async fetch(e){let{name:t}=e;if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const n=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(n).then(e=>({cMapData:e,isCompressed:this.isCompressed})).catch(e=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${n}`)})}async _fetch(e){sy("Abstract method `_fetch` called.")}}class Xv extends Qv{async _fetch(e){const t=await Dy(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):yy(t)}}class Yv{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,n,i,s){return"none"}destroy(){}}class Jv extends Yv{#ti;#ni;#ii;#si;#ri;#ai;#A=0;constructor(e){let{docId:t,ownerDocument:n=globalThis.document}=e;super(),this.#si=t,this.#ri=n}get#T(){return this.#ni||=new Map}get#oi(){return this.#ai||=new Map}get#li(){if(!this.#ii){const e=this.#ri.createElement("div"),{style:t}=e;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;const n=this.#ri.createElementNS(Ny,"svg");n.setAttribute("width",0),n.setAttribute("height",0),this.#ii=this.#ri.createElementNS(Ny,"defs"),e.append(n),n.append(this.#ii),this.#ri.body.append(e)}return this.#ii}#ci(e){if(1===e.length){const t=e[0],n=new Array(256);for(let e=0;e<256;e++)n[e]=t[e]/255;const i=n.join(",");return[i,i,i]}const[t,n,i]=e,s=new Array(256),r=new Array(256),a=new Array(256);for(let o=0;o<256;o++)s[o]=t[o]/255,r[o]=n[o]/255,a[o]=i[o]/255;return[s.join(","),r.join(","),a.join(",")]}#di(e){if(void 0===this.#ti){this.#ti="";const e=this.#ri.URL;e!==this.#ri.baseURI&&(Ry(e)?iy('#createUrl: ignore "data:"-URL for performance reasons.'):this.#ti=oy(e,""))}return`url(${this.#ti}#${e})`}addFilter(e){if(!e)return"none";let t=this.#T.get(e);if(t)return t;const[n,i,s]=this.#ci(e),r=1===e.length?n:`${n}${i}${s}`;if(t=this.#T.get(r),t)return this.#T.set(e,t),t;const a=`g_${this.#si}_transfer_map_${this.#A++}`,o=this.#di(a);this.#T.set(e,o),this.#T.set(r,o);const l=this.#ui(a);return this.#hi(n,i,s,l),o}addHCMFilter(e,t){const n=`${e}-${t}`,i="base";let s=this.#oi.get(i);if(s?.key===n)return s.url;if(s?(s.filter?.remove(),s.key=n,s.url="none",s.filter=null):(s={key:n,url:"none",filter:null},this.#oi.set(i,s)),!e||!t)return s.url;const r=this.#pi(e);e=xy.makeHexColor(...r);const a=this.#pi(t);if(t=xy.makeHexColor(...a),this.#li.style.color="","#000000"===e&&"#ffffff"===t||e===t)return s.url;const o=new Array(256);for(let h=0;h<=255;h++){const e=h/255;o[h]=e<=.03928?e/12.92:((e+.055)/1.055)**2.4}const l=o.join(","),c=`g_${this.#si}_hcm_filter`,d=s.filter=this.#ui(c);this.#hi(l,l,l,d),this.#mi(d);const u=(e,t)=>{const n=r[e]/255,i=a[e]/255,s=new Array(t+1);for(let r=0;r<=t;r++)s[r]=n+r/t*(i-n);return s.join(",")};return this.#hi(u(0,5),u(1,5),u(2,5),d),s.url=this.#di(c),s.url}addAlphaFilter(e){let t=this.#T.get(e);if(t)return t;const[n]=this.#ci([e]),i=`alpha_${n}`;if(t=this.#T.get(i),t)return this.#T.set(e,t),t;const s=`g_${this.#si}_alpha_map_${this.#A++}`,r=this.#di(s);this.#T.set(e,r),this.#T.set(i,r);const a=this.#ui(s);return this.#gi(n,a),r}addLuminosityFilter(e){let t,n,i=this.#T.get(e||"luminosity");if(i)return i;if(e?([t]=this.#ci([e]),n=`luminosity_${t}`):n="luminosity",i=this.#T.get(n),i)return this.#T.set(e,i),i;const s=`g_${this.#si}_luminosity_map_${this.#A++}`,r=this.#di(s);this.#T.set(e,r),this.#T.set(n,r);const a=this.#ui(s);return this.#fi(a),e&&this.#gi(t,a),r}addHighlightHCMFilter(e,t,n,i,s){const r=`${t}-${n}-${i}-${s}`;let a=this.#oi.get(e);if(a?.key===r)return a.url;if(a?(a.filter?.remove(),a.key=r,a.url="none",a.filter=null):(a={key:r,url:"none",filter:null},this.#oi.set(e,a)),!t||!n)return a.url;const[o,l]=[t,n].map(this.#pi.bind(this));let c=Math.round(.2126*o[0]+.7152*o[1]+.0722*o[2]),d=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),[u,h]=[i,s].map(this.#pi.bind(this));d<c&&([c,d,u,h]=[d,c,h,u]),this.#li.style.color="";const p=(e,t,n)=>{const i=new Array(256),s=(d-c)/n,r=e/255,a=(t-e)/(255*n);let o=0;for(let l=0;l<=n;l++){const e=Math.round(c+l*s),t=r+l*a;for(let n=o;n<=e;n++)i[n]=t;o=e+1}for(let l=o;l<256;l++)i[l]=i[o-1];return i.join(",")},m=`g_${this.#si}_hcm_${e}_filter`,g=a.filter=this.#ui(m);return this.#mi(g),this.#hi(p(u[0],h[0],5),p(u[1],h[1],5),p(u[2],h[2],5),g),a.url=this.#di(m),a.url}destroy(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this.#ai?.size||(this.#ii?.parentNode.parentNode.remove(),this.#ii=null,this.#ni?.clear(),this.#ni=null,this.#ai?.clear(),this.#ai=null,this.#A=0)}#fi(e){const t=this.#ri.createElementNS(Ny,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(t)}#mi(e){const t=this.#ri.createElementNS(Ny,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)}#ui(e){const t=this.#ri.createElementNS(Ny,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),this.#li.append(t),t}#yi(e,t,n){const i=this.#ri.createElementNS(Ny,t);i.setAttribute("type","discrete"),i.setAttribute("tableValues",n),e.append(i)}#hi(e,t,n,i){const s=this.#ri.createElementNS(Ny,"feComponentTransfer");i.append(s),this.#yi(s,"feFuncR",e),this.#yi(s,"feFuncG",t),this.#yi(s,"feFuncB",n)}#gi(e,t){const n=this.#ri.createElementNS(Ny,"feComponentTransfer");t.append(n),this.#yi(n,"feFuncA",e)}#pi(e){return this.#li.style.color=e,zy(getComputedStyle(this.#li).getPropertyValue("color"))}}class Zv{constructor(e){let{baseUrl:t=null}=e;this.baseUrl=t}async fetch(e){let{filename:t}=e;if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const n=`${this.baseUrl}${t}`;return this._fetch(n).catch(e=>{throw new Error(`Unable to load font data at: ${n}`)})}async _fetch(e){sy("Abstract method `_fetch` called.")}}class eb extends Zv{async _fetch(e){const t=await Dy(e,"arraybuffer");return new Uint8Array(t)}}class tb{constructor(e){let{baseUrl:t=null}=e;this.baseUrl=t}async fetch(e){let{filename:t}=e;if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const n=`${this.baseUrl}${t}`;return this._fetch(n).catch(e=>{throw new Error(`Unable to load wasm data at: ${n}`)})}async _fetch(e){sy("Abstract method `_fetch` called.")}}class nb extends tb{async _fetch(e){const t=await Dy(e,"arraybuffer");return new Uint8Array(t)}}async function ib(e){const t=process.getBuiltinModule("fs"),n=await t.promises.readFile(e);return new Uint8Array(n)}ff&&iy("Please use the `legacy` build in Node.js environments.");class sb extends Yv{}class rb extends Wv{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire("file:///home/runner/work/LineSmart/LineSmart/node_modules/pdfjs-dist/build/pdf.mjs")("@napi-rs/canvas").createCanvas(e,t)}}class ab extends Qv{async _fetch(e){return ib(e)}}class ob extends Zv{async _fetch(e){return ib(e)}}class lb extends tb{async _fetch(e){return ib(e)}}const cb="__forcedDependency",{floor:db,ceil:ub}=Math;function hb(e,t,n,i,s,r){e[4*t+0]=Math.min(e[4*t+0],n),e[4*t+1]=Math.min(e[4*t+1],i),e[4*t+2]=Math.max(e[4*t+2],s),e[4*t+3]=Math.max(e[4*t+3],r)}const pb=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class mb{#vi;#bi;constructor(e,t){this.#vi=e,this.#bi=t}get length(){return this.#vi.length}isEmpty(e){return this.#vi[e]===pb}minX(e){return this.#bi[4*e+0]/256}minY(e){return this.#bi[4*e+1]/256}maxX(e){return(this.#bi[4*e+2]+1)/256}maxY(e){return(this.#bi[4*e+3]+1)/256}}const gb=(e,t)=>{if(!e)return;let n=e.get(t);return n||(n={dependencies:new Set,isRenderingOperation:!1},e.set(t,n)),n};class fb{#xi={__proto__:null};#wi=(()=>({__proto__:null,transform:[],moveText:[],sameLineText:[],[cb]:[]}))();#_i=(()=>new Map)();#Si=[];#Ci=[];#Ai=[[1,0,0,1,0,0]];#Ei=[-1/0,-1/0,1/0,1/0];#Ti=(()=>new Float64Array([1/0,1/0,-1/0,-1/0]))();#ki=-1;#Ni=(()=>new Set)();#Ii=(()=>new Map)();#Di=(()=>new Map)();#Pi;#Mi;#Ri;#vi;#Li;constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.#Pi=e.width,this.#Mi=e.height,this.#ji(t),n&&(this.#Li=new Map)}growOperationsCount(e){e>=this.#vi.length&&this.#ji(e,this.#vi)}#ji(e,t){const n=new ArrayBuffer(4*e);this.#Ri=new Uint8ClampedArray(n),this.#vi=new Uint32Array(n),t&&t.length>0?(this.#vi.set(t),this.#vi.fill(pb,t.length)):this.#vi.fill(pb)}save(e){return this.#xi={__proto__:this.#xi},this.#wi={__proto__:this.#wi,transform:{__proto__:this.#wi.transform},moveText:{__proto__:this.#wi.moveText},sameLineText:{__proto__:this.#wi.sameLineText},[cb]:{__proto__:this.#wi[cb]}},this.#Ei={__proto__:this.#Ei},this.#Si.push(e),this}restore(e){const t=Object.getPrototypeOf(this.#xi);if(null===t)return this;this.#xi=t,this.#wi=Object.getPrototypeOf(this.#wi),this.#Ei=Object.getPrototypeOf(this.#Ei);const n=this.#Si.pop();return void 0!==n&&(gb(this.#Li,e)?.dependencies.add(n),this.#vi[e]=this.#vi[n]),this}recordOpenMarker(e){return this.#Si.push(e),this}getOpenMarker(){return 0===this.#Si.length?null:this.#Si.at(-1)}recordCloseMarker(e){const t=this.#Si.pop();return void 0!==t&&(gb(this.#Li,e)?.dependencies.add(t),this.#vi[e]=this.#vi[t]),this}beginMarkedContent(e){return this.#Ci.push(e),this}endMarkedContent(e){const t=this.#Ci.pop();return void 0!==t&&(gb(this.#Li,e)?.dependencies.add(t),this.#vi[e]=this.#vi[t]),this}pushBaseTransform(e){return this.#Ai.push(xy.multiplyByDOMMatrix(this.#Ai.at(-1),e.getTransform())),this}popBaseTransform(){return this.#Ai.length>1&&this.#Ai.pop(),this}recordSimpleData(e,t){return this.#xi[e]=t,this}recordIncrementalData(e,t){return this.#wi[e].push(t),this}resetIncrementalData(e,t){return this.#wi[e].length=0,this}recordNamedData(e,t){return this.#_i.set(e,t),this}recordSimpleDataFromNamed(e,t,n){this.#xi[e]=this.#_i.get(t)??n}recordFutureForcedDependency(e,t){return this.recordIncrementalData(cb,t),this}inheritSimpleDataAsFutureForcedDependencies(e){for(const t of e)t in this.#xi&&this.recordFutureForcedDependency(t,this.#xi[t]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const e of this.#Ni)this.recordFutureForcedDependency(cb,e);return this}resetBBox(e){return this.#ki!==e&&(this.#ki=e,this.#Ti[0]=1/0,this.#Ti[1]=1/0,this.#Ti[2]=-1/0,this.#Ti[3]=-1/0),this}recordClipBox(e,t,n,i,s,r){const a=xy.multiplyByDOMMatrix(this.#Ai.at(-1),t.getTransform()),o=[1/0,1/0,-1/0,-1/0];xy.axialAlignedBoundingBox([n,s,i,r],a,o);const l=xy.intersect(this.#Ei,o);return l?(this.#Ei[0]=l[0],this.#Ei[1]=l[1],this.#Ei[2]=l[2],this.#Ei[3]=l[3]):(this.#Ei[0]=this.#Ei[1]=1/0,this.#Ei[2]=this.#Ei[3]=-1/0),this}recordBBox(e,t,n,i,s,r){const a=this.#Ei;if(a[0]===1/0)return this;const o=xy.multiplyByDOMMatrix(this.#Ai.at(-1),t.getTransform());if(a[0]===-1/0)return xy.axialAlignedBoundingBox([n,s,i,r],o,this.#Ti),this;const l=[1/0,1/0,-1/0,-1/0];return xy.axialAlignedBoundingBox([n,s,i,r],o,l),this.#Ti[0]=Math.min(this.#Ti[0],Math.max(l[0],a[0])),this.#Ti[1]=Math.min(this.#Ti[1],Math.max(l[1],a[1])),this.#Ti[2]=Math.max(this.#Ti[2],Math.min(l[2],a[2])),this.#Ti[3]=Math.max(this.#Ti[3],Math.min(l[3],a[3])),this}recordCharacterBBox(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6?arguments[6]:void 0;const o=n.bbox;let l,c;if(o&&(l=o[2]!==o[0]&&o[3]!==o[1]&&this.#Di.get(n),!1!==l&&(c=[0,0,0,0],xy.axialAlignedBoundingBox(o,n.fontMatrix,c),1===i&&0===s&&0===r||xy.scaleMinMax([i,0,0,-i,s,r],c),l)))return this.recordBBox(e,t,c[0],c[2],c[1],c[3]);if(!a)return this.recordFullPageBBox(e);const d=a();return o&&c&&void 0===l&&(l=c[0]<=s-d.actualBoundingBoxLeft&&c[2]>=s+d.actualBoundingBoxRight&&c[1]<=r-d.actualBoundingBoxAscent&&c[3]>=r+d.actualBoundingBoxDescent,this.#Di.set(n,l),l)?this.recordBBox(e,t,c[0],c[2],c[1],c[3]):this.recordBBox(e,t,s-d.actualBoundingBoxLeft,s+d.actualBoundingBoxRight,r-d.actualBoundingBoxAscent,r+d.actualBoundingBoxDescent)}recordFullPageBBox(e){return this.#Ti[0]=Math.max(0,this.#Ei[0]),this.#Ti[1]=Math.max(0,this.#Ei[1]),this.#Ti[2]=Math.min(this.#Pi,this.#Ei[2]),this.#Ti[3]=Math.min(this.#Mi,this.#Ei[3]),this}getSimpleIndex(e){return this.#xi[e]}recordDependencies(e,t){const n=this.#Ni,i=this.#xi,s=this.#wi;for(const r of t)r in this.#xi?n.add(i[r]):r in s&&s[r].forEach(n.add,n);return this}recordNamedDependency(e,t){return this.#_i.has(t)&&this.#Ni.add(this.#_i.get(t)),this}recordOperation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.recordDependencies(e,[cb]),this.#Li){const t=gb(this.#Li,e),{dependencies:n}=t;this.#Ni.forEach(n.add,n),this.#Si.forEach(n.add,n),this.#Ci.forEach(n.add,n),n.delete(e),t.isRenderingOperation=!0}if(this.#ki===e){const n=db(256*this.#Ti[0]/this.#Pi),i=db(256*this.#Ti[1]/this.#Mi),s=ub(256*this.#Ti[2]/this.#Pi),r=ub(256*this.#Ti[3]/this.#Mi);hb(this.#Ri,e,n,i,s,r);for(const t of this.#Ni)t!==e&&hb(this.#Ri,t,n,i,s,r);for(const t of this.#Si)t!==e&&hb(this.#Ri,t,n,i,s,r);for(const t of this.#Ci)t!==e&&hb(this.#Ri,t,n,i,s,r);t||(this.#Ni.clear(),this.#ki=-1)}return this}recordShowTextOperation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=Array.from(this.#Ni);this.recordOperation(e,t),this.recordIncrementalData("sameLineText",e);for(const i of n)this.recordIncrementalData("sameLineText",i);return this}bboxToClipBoxDropOperation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.#ki===e&&(this.#ki=-1,this.#Ei[0]=Math.max(this.#Ei[0],this.#Ti[0]),this.#Ei[1]=Math.max(this.#Ei[1],this.#Ti[1]),this.#Ei[2]=Math.min(this.#Ei[2],this.#Ti[2]),this.#Ei[3]=Math.min(this.#Ei[3],this.#Ti[3]),t||this.#Ni.clear()),this}_takePendingDependencies(){const e=this.#Ni;return this.#Ni=new Set,e}_extractOperation(e){const t=this.#Ii.get(e);return this.#Ii.delete(e),t}_pushPendingDependencies(e){for(const t of e)this.#Ni.add(t)}take(){return this.#Di.clear(),new mb(this.#vi,this.#Ri)}takeDebugMetadata(){return this.#Li}}class yb{#Oi;#Fi;#Bi;#Ui=0;#zi=0;constructor(e,t,n){if(e instanceof yb&&e.#Bi===!!n)return e;this.#Oi=e,this.#Fi=t,this.#Bi=!!n}growOperationsCount(){throw new Error("Unreachable")}save(e){return this.#zi++,this.#Oi.save(this.#Fi),this}restore(e){return this.#zi>0&&(this.#Oi.restore(this.#Fi),this.#zi--),this}recordOpenMarker(e){return this.#Ui++,this}getOpenMarker(){return this.#Ui>0?this.#Fi:this.#Oi.getOpenMarker()}recordCloseMarker(e){return this.#Ui--,this}beginMarkedContent(e){return this}endMarkedContent(e){return this}pushBaseTransform(e){return this.#Oi.pushBaseTransform(e),this}popBaseTransform(){return this.#Oi.popBaseTransform(),this}recordSimpleData(e,t){return this.#Oi.recordSimpleData(e,this.#Fi),this}recordIncrementalData(e,t){return this.#Oi.recordIncrementalData(e,this.#Fi),this}resetIncrementalData(e,t){return this.#Oi.resetIncrementalData(e,this.#Fi),this}recordNamedData(e,t){return this}recordSimpleDataFromNamed(e,t,n){return this.#Oi.recordSimpleDataFromNamed(e,t,this.#Fi),this}recordFutureForcedDependency(e,t){return this.#Oi.recordFutureForcedDependency(e,this.#Fi),this}inheritSimpleDataAsFutureForcedDependencies(e){return this.#Oi.inheritSimpleDataAsFutureForcedDependencies(e),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#Oi.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(e){return this.#Bi||this.#Oi.resetBBox(this.#Fi),this}recordClipBox(e,t,n,i,s,r){return this.#Bi||this.#Oi.recordClipBox(this.#Fi,t,n,i,s,r),this}recordBBox(e,t,n,i,s,r){return this.#Bi||this.#Oi.recordBBox(this.#Fi,t,n,i,s,r),this}recordCharacterBBox(e,t,n,i,s,r,a){return this.#Bi||this.#Oi.recordCharacterBBox(this.#Fi,t,n,i,s,r,a),this}recordFullPageBBox(e){return this.#Bi||this.#Oi.recordFullPageBBox(this.#Fi),this}getSimpleIndex(e){return this.#Oi.getSimpleIndex(e)}recordDependencies(e,t){return this.#Oi.recordDependencies(this.#Fi,t),this}recordNamedDependency(e,t){return this.#Oi.recordNamedDependency(this.#Fi,t),this}recordOperation(e){return this.#Oi.recordOperation(this.#Fi,!0),this}recordShowTextOperation(e){return this.#Oi.recordShowTextOperation(this.#Fi,!0),this}bboxToClipBoxDropOperation(e){return this.#Bi||this.#Oi.bboxToClipBoxDropOperation(this.#Fi,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const vb=["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],bb=["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],xb=["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],wb=["filter","fillColor","fillAlpha"],_b=["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],Sb=["transform"],Cb=["transform","fillColor"],Ab="Fill",Eb="Stroke",Tb="Shading";function kb(e,t){if(!t)return;const n=t[2]-t[0],i=t[3]-t[1],s=new Path2D;s.rect(t[0],t[1],n,i),e.clip(s)}class Nb{isModifyingCurrentTransform(){return!1}getPattern(){sy("Abstract method `getPattern` called.")}}class Ib extends Nb{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}isOriginBased(){return 0===this._p0[0]&&0===this._p0[1]&&(!this.isRadial()||0===this._p1[0]&&0===this._p1[1])}isRadial(){return"radial"===this._type}_createGradient(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this._p0,s=this._p1;if(n&&(i=i.slice(),s=s.slice(),xy.applyTransform(i,n),xy.applyTransform(s,n)),"axial"===this._type)t=e.createLinearGradient(i[0],i[1],s[0],s[1]);else if("radial"===this._type){let r=this._r0,a=this._r1;if(n){const e=new Float32Array(2);xy.singularValueDecompose2dScale(n,e),r*=e[0],a*=e[0]}t=e.createRadialGradient(i[0],i[1],r,s[0],s[1],a)}for(const r of this._colorStops)t.addColorStop(r[0],r[1]);return t}getPattern(e,t,n,i){let s;if(i===Eb||i===Ab){if(this.isOriginBased()){let i=xy.transform(n,t.baseTransform);this.matrix&&(i=xy.transform(i,this.matrix));const s=.001,r=Math.hypot(i[0],i[1]),a=Math.hypot(i[2],i[3]),o=(i[0]*i[2]+i[1]*i[3])/(r*a);if(Math.abs(o)<s){if(!this.isRadial())return this._createGradient(e,i);if(Math.abs(r-a)<s)return this._createGradient(e,i)}}const r=t.current.getClippedPathBoundingBox(i,Vy(e))||[0,0,0,0],a=Math.ceil(r[2]-r[0])||1,o=Math.ceil(r[3]-r[1])||1,l=t.cachedCanvases.getCanvas("pattern",a,o),c=l.context;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.beginPath(),c.rect(0,0,c.canvas.width,c.canvas.height),c.translate(-r[0],-r[1]),n=xy.transform(n,[1,0,0,1,r[0],r[1]]),c.transform(...t.baseTransform),this.matrix&&c.transform(...this.matrix),kb(c,this._bbox),c.fillStyle=this._createGradient(c),c.fill(),s=e.createPattern(l.canvas,"no-repeat");const d=new DOMMatrix(n);s.setTransform(d)}else kb(e,this._bbox),s=this._createGradient(e);return s}}function Db(e,t,n,i,s,r,a,o){const l=t.coords,c=t.colors,d=e.data,u=4*e.width;let h;l[n+1]>l[i+1]&&(h=n,n=i,i=h,h=r,r=a,a=h),l[i+1]>l[s+1]&&(h=i,i=s,s=h,h=a,a=o,o=h),l[n+1]>l[i+1]&&(h=n,n=i,i=h,h=r,r=a,a=h);const p=(l[n]+t.offsetX)*t.scaleX,m=(l[n+1]+t.offsetY)*t.scaleY,g=(l[i]+t.offsetX)*t.scaleX,f=(l[i+1]+t.offsetY)*t.scaleY,y=(l[s]+t.offsetX)*t.scaleX,v=(l[s+1]+t.offsetY)*t.scaleY;if(m>=v)return;const b=c[r],x=c[r+1],w=c[r+2],_=c[a],S=c[a+1],C=c[a+2],A=c[o],E=c[o+1],T=c[o+2],k=Math.round(m),N=Math.round(v);let I,D,P,M,R,L,j,O;for(let F=k;F<=N;F++){if(F<f){const e=F<m?0:(m-F)/(m-f);I=p-(p-g)*e,D=b-(b-_)*e,P=x-(x-S)*e,M=w-(w-C)*e}else{let e;e=F>v?1:f===v?0:(f-F)/(f-v),I=g-(g-y)*e,D=_-(_-A)*e,P=S-(S-E)*e,M=C-(C-T)*e}let e;e=F<m?0:F>v?1:(m-F)/(m-v),R=p-(p-y)*e,L=b-(b-A)*e,j=x-(x-E)*e,O=w-(w-T)*e;const t=Math.round(Math.min(I,R)),n=Math.round(Math.max(I,R));let i=u*F+4*t;for(let s=t;s<=n;s++)e=(I-s)/(I-R),e<0?e=0:e>1&&(e=1),d[i++]=D-(D-L)*e|0,d[i++]=P-(P-j)*e|0,d[i++]=M-(M-O)*e|0,d[i++]=255}}function Pb(e,t,n){const i=t.coords,s=t.colors;let r,a;switch(t.type){case Pf:const o=t.verticesPerRow,l=Math.floor(i.length/o)-1,c=o-1;for(r=0;r<l;r++){let t=r*o;for(let r=0;r<c;r++,t++)Db(e,n,i[t],i[t+1],i[t+o],s[t],s[t+1],s[t+o]),Db(e,n,i[t+o+1],i[t+1],i[t+o],s[t+o+1],s[t+1],s[t+o])}break;case Df:for(r=0,a=i.length;r<a;r+=3)Db(e,n,i[r],i[r+1],i[r+2],s[r],s[r+1],s[r+2]);break;default:throw new Error("illegal figure")}}class Mb extends Nb{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,n){const i=Math.floor(this._bounds[0]),s=Math.floor(this._bounds[1]),r=Math.ceil(this._bounds[2])-i,a=Math.ceil(this._bounds[3])-s,o=Math.min(Math.ceil(Math.abs(r*e[0]*1.1)),3e3),l=Math.min(Math.ceil(Math.abs(a*e[1]*1.1)),3e3),c=r/o,d=a/l,u={coords:this._coords,colors:this._colors,offsetX:-i,offsetY:-s,scaleX:1/c,scaleY:1/d},h=o+4,p=l+4,m=n.getCanvas("mesh",h,p),g=m.context,f=g.createImageData(o,l);if(t){const e=f.data;for(let n=0,i=e.length;n<i;n+=4)e[n]=t[0],e[n+1]=t[1],e[n+2]=t[2],e[n+3]=255}for(const y of this._figures)Pb(f,y,u);g.putImageData(f,2,2);return{canvas:m.canvas,offsetX:i-2*c,offsetY:s-2*d,scaleX:c,scaleY:d}}isModifyingCurrentTransform(){return!0}getPattern(e,t,n,i){kb(e,this._bbox);const s=new Float32Array(2);if(i===Tb)xy.singularValueDecompose2dScale(Vy(e),s);else if(this.matrix){xy.singularValueDecompose2dScale(this.matrix,s);const[e,n]=s;xy.singularValueDecompose2dScale(t.baseTransform,s),s[0]*=e,s[1]*=n}else xy.singularValueDecompose2dScale(t.baseTransform,s);const r=this._createMeshCanvas(s,i===Tb?null:this._background,t.cachedCanvases);return i!==Tb&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(r.offsetX,r.offsetY),e.scale(r.scaleX,r.scaleY),e.createPattern(r.canvas,"no-repeat")}}class Rb extends Nb{getPattern(){return"hotpink"}}const Lb=1,jb=2;class Ob{static MAX_PATTERN_SIZE=3e3;constructor(e,t,n,i){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=n,this.baseTransform=i}createPatternCanvas(e,t){const{bbox:n,operatorList:i,paintType:s,tilingType:r,color:a,canvasGraphicsFactory:o}=this;let{xstep:l,ystep:c}=this;l=Math.abs(l),c=Math.abs(c),ny("TilingType: "+r);const d=n[0],u=n[1],h=n[2],p=n[3],m=h-d,g=p-u,f=new Float32Array(2);xy.singularValueDecompose2dScale(this.matrix,f);const[y,v]=f;xy.singularValueDecompose2dScale(this.baseTransform,f);const b=y*f[0],x=v*f[1];let w=m,_=g,S=!1,C=!1;const A=Math.ceil(l*b),E=Math.ceil(c*x);A>=Math.ceil(m*b)?w=l:S=!0,E>=Math.ceil(g*x)?_=c:C=!0;const T=this.getSizeAndScale(w,this.ctx.canvas.width,b),k=this.getSizeAndScale(_,this.ctx.canvas.height,x),N=e.cachedCanvases.getCanvas("pattern",T.size,k.size),I=N.context,D=o.createCanvasGraphics(I,t);if(D.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(D,s,a),I.translate(-T.scale*d,-k.scale*u),D.transform(0,T.scale,0,0,k.scale,0,0),I.save(),D.dependencyTracker?.save(),this.clipBbox(D,d,u,h,p),D.baseTransform=Vy(D.ctx),D.executeOperatorList(i),D.endDrawing(),D.dependencyTracker?.restore(),I.restore(),S||C){const t=N.canvas;S&&(w=l),C&&(_=c);const n=this.getSizeAndScale(w,this.ctx.canvas.width,b),i=this.getSizeAndScale(_,this.ctx.canvas.height,x),s=n.size,r=i.size,a=e.cachedCanvases.getCanvas("pattern-workaround",s,r),o=a.context,h=S?Math.floor(m/l):0,p=C?Math.floor(g/c):0;for(let e=0;e<=h;e++)for(let n=0;n<=p;n++)o.drawImage(t,s*e,r*n,s,r,0,0,s,r);return{canvas:a.canvas,scaleX:n.scale,scaleY:i.scale,offsetX:d,offsetY:u}}return{canvas:N.canvas,scaleX:T.scale,scaleY:k.scale,offsetX:d,offsetY:u}}getSizeAndScale(e,t,n){const i=Math.max(Ob.MAX_PATTERN_SIZE,t);let s=Math.ceil(e*n);return s>=i?s=i:n=s/e,{scale:n,size:s}}clipBbox(e,t,n,i,s){const r=i-t,a=s-n;e.ctx.rect(t,n,r,a),xy.axialAlignedBoundingBox([t,n,i,s],Vy(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){const i=e.ctx,s=e.current;switch(t){case Lb:const{fillStyle:e,strokeStyle:r}=this.ctx;i.fillStyle=s.fillColor=e,i.strokeStyle=s.strokeColor=r;break;case jb:i.fillStyle=i.strokeStyle=n,s.fillColor=s.strokeColor=n;break;default:throw new my(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,n,i,s){let r=n;i!==Tb&&(r=xy.transform(r,t.baseTransform),this.matrix&&(r=xy.transform(r,this.matrix)));const a=this.createPatternCanvas(t,s);let o=new DOMMatrix(r);o=o.translate(a.offsetX,a.offsetY),o=o.scale(1/a.scaleX,1/a.scaleY);const l=e.createPattern(a.canvas,"repeat");return l.setTransform(o),l}}function Fb(e){let{src:t,srcPos:n=0,dest:i,width:s,height:r,nonBlackColor:a=4294967295,inverseDecode:o=!1}=e;const l=vy.isLittleEndian?4278190080:255,[c,d]=o?[a,l]:[l,a],u=s>>3,h=7&s,p=t.length;i=new Uint32Array(i.buffer);let m=0;for(let g=0;g<r;g++){for(const s=n+u;n<s;n++){const e=n<p?t[n]:255;i[m++]=128&e?d:c,i[m++]=64&e?d:c,i[m++]=32&e?d:c,i[m++]=16&e?d:c,i[m++]=8&e?d:c,i[m++]=4&e?d:c,i[m++]=2&e?d:c,i[m++]=1&e?d:c}if(0===h)continue;const e=n<p?t[n++]:255;for(let t=0;t<h;t++)i[m++]=e&1<<7-t?d:c}return{srcPos:n,destPos:m}}const Bb=16,Ub=new DOMMatrix,zb=new Float32Array(2),Vb=new Float32Array([1/0,1/0,-1/0,-1/0]);class Hb{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let i;return void 0!==this.cache[e]?(i=this.cache[e],this.canvasFactory.reset(i,t,n)):(i=this.canvasFactory.create(t,n),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function $b(e,t,n,i,s,r,a,o,l,c){const[d,u,h,p,m,g]=Vy(e);if(0===u&&0===h){const f=a*d+m,y=Math.round(f),v=o*p+g,b=Math.round(v),x=(a+l)*d+m,w=Math.abs(Math.round(x)-y)||1,_=(o+c)*p+g,S=Math.abs(Math.round(_)-b)||1;return e.setTransform(Math.sign(d),0,0,Math.sign(p),y,b),e.drawImage(t,n,i,s,r,0,0,w,S),e.setTransform(d,u,h,p,m,g),[w,S]}if(0===d&&0===p){const f=o*h+m,y=Math.round(f),v=a*u+g,b=Math.round(v),x=(o+c)*h+m,w=Math.abs(Math.round(x)-y)||1,_=(a+l)*u+g,S=Math.abs(Math.round(_)-b)||1;return e.setTransform(0,Math.sign(u),Math.sign(h),0,y,b),e.drawImage(t,n,i,s,r,0,0,S,w),e.setTransform(d,u,h,p,m,g),[S,w]}e.drawImage(t,n,i,s,r,a,o,l,c);return[Math.hypot(d,u)*l,Math.hypot(h,p)*c]}class qb{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=(()=>yf)();leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=(()=>Mf)();textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(e,t,n){n?.(this),this.clipBox=new Float32Array([0,0,e,t]),this.minMax=Vb.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ab,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.minMax.slice();if(e===Eb){t||sy("Stroke bounding box must include transform."),xy.singularValueDecompose2dScale(t,zb);const e=zb[0]*this.lineWidth/2,i=zb[1]*this.lineWidth/2;n[0]-=e,n[1]-=i,n[2]+=e,n[3]+=i}return n}updateClipFromPath(){const e=xy.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(Vb,0)}getClippedPathBoundingBox(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ab,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return xy.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function Gb(e,t){if(t instanceof ImageData)return void e.putImageData(t,0,0);const n=t.height,i=t.width,s=n%Bb,r=(n-s)/Bb,a=0===s?r:r+1,o=e.createImageData(i,Bb);let l,c=0;const d=t.data,u=o.data;let h,p,m,g;if(t.kind===Bf.GRAYSCALE_1BPP){const t=d.byteLength,n=new Uint32Array(u.buffer,0,u.byteLength>>2),g=n.length,f=i+7>>3,y=4294967295,v=vy.isLittleEndian?4278190080:255;for(h=0;h<a;h++){for(m=h<r?Bb:s,l=0,p=0;p<m;p++){const e=t-c;let s=0;const r=e>f?i:8*e-7,a=-8&r;let o=0,u=0;for(;s<a;s+=8)u=d[c++],n[l++]=128&u?y:v,n[l++]=64&u?y:v,n[l++]=32&u?y:v,n[l++]=16&u?y:v,n[l++]=8&u?y:v,n[l++]=4&u?y:v,n[l++]=2&u?y:v,n[l++]=1&u?y:v;for(;s<r;s++)0===o&&(u=d[c++],o=128),n[l++]=u&o?y:v,o>>=1}for(;l<g;)n[l++]=0;e.putImageData(o,0,h*Bb)}}else if(t.kind===Bf.RGBA_32BPP){for(p=0,g=i*Bb*4,h=0;h<r;h++)u.set(d.subarray(c,c+g)),c+=g,e.putImageData(o,0,p),p+=Bb;h<a&&(g=i*s*4,u.set(d.subarray(c,c+g)),e.putImageData(o,0,p))}else{if(t.kind!==Bf.RGB_24BPP)throw new Error(`bad image kind: ${t.kind}`);for(m=Bb,g=i*m,h=0;h<a;h++){for(h>=r&&(m=s,g=i*m),l=0,p=g;p--;)u[l++]=d[c++],u[l++]=d[c++],u[l++]=d[c++],u[l++]=255;e.putImageData(o,0,h*Bb)}}}function Wb(e,t){if(t.bitmap)return void e.drawImage(t.bitmap,0,0);const n=t.height,i=t.width,s=n%Bb,r=(n-s)/Bb,a=0===s?r:r+1,o=e.createImageData(i,Bb);let l=0;const c=t.data,d=o.data;for(let u=0;u<a;u++){const t=u<r?Bb:s;({srcPos:l}=Fb({src:c,srcPos:l,dest:d,width:i,height:t,nonBlackColor:0})),e.putImageData(o,0,u*Bb)}}function Kb(e,t){const n=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of n)void 0!==e[i]&&(t[i]=e[i]);void 0!==e.setLineDash&&(t.setLineDash(e.getLineDash()),t.lineDashOffset=e.lineDashOffset)}function Qb(e){e.strokeStyle=e.fillStyle="#000000",e.fillRule="nonzero",e.globalAlpha=1,e.lineWidth=1,e.lineCap="butt",e.lineJoin="miter",e.miterLimit=10,e.globalCompositeOperation="source-over",e.font="10px sans-serif",void 0!==e.setLineDash&&(e.setLineDash([]),e.lineDashOffset=0);const{filter:t}=e;"none"!==t&&""!==t&&(e.filter="none")}function Xb(e,t){if(t)return!0;xy.singularValueDecompose2dScale(e,zb);const n=Math.fround(qy.pixelRatio*Iy.PDF_TO_CSS_UNITS);return zb[0]<=n&&zb[1]<=n}const Yb=["butt","round","square"],Jb=["miter","round","bevel"],Zb={},ex={};class tx{constructor(e,t,n,i,s,r,a,o,l){let{optionalContentConfig:c,markedContentStack:d=null}=r;this.ctx=e,this.current=new qb(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=i,this.filterFactory=s,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=d||[],this.optionalContentConfig=c,this.cachedCanvases=new Hb(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=a,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=o,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=l??null}getObject(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"string"===typeof t?(this.dependencyTracker?.recordNamedDependency(e,t),t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t)):n}beginDrawing(e){let{transform:t,viewport:n,transparency:i=!1,background:s=null}=e;const r=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,r,a),this.ctx.fillStyle=o,i){const e=this.cachedCanvases.getCanvas("transparent",r,a);this.compositeCtx=this.ctx,this.transparentCanvas=e.canvas,this.ctx=e.context,this.ctx.save(),this.ctx.transform(...Vy(this.compositeCtx))}this.ctx.save(),Qb(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...n.transform),this.viewportScale=n.scale,this.baseTransform=Vy(this.ctx)}executeOperatorList(e,t,n,i,s){const r=e.argsArray,a=e.fnArray;let o=t||0;const l=r.length;if(l===o)return o;const c=l-o>10&&"function"===typeof n,d=c?Date.now()+15:0;let u=0;const h=this.commonObjs,p=this.objs;let m,g;for(;;){if(void 0!==i&&o===i.nextBreakPoint)return i.breakIt(o,n),o;if(!s||s(o))if(m=a[o],g=r[o]??null,m!==Wf.dependency)null===g?this[m](o):this[m](o,...g);else for(const e of g){this.dependencyTracker?.recordNamedData(e,o);const t=e.startsWith("g_")?h:p;if(!t.has(e))return t.get(e,n),o}if(o++,o===l)return o;if(c&&++u>10){if(Date.now()>d)return n(),o;u=0}}}#Vi(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#Vi(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#Hi()}#Hi(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if("none"!==e){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}_scaleImage(e,t){const n=e.width??e.displayWidth,i=e.height??e.displayHeight;let s,r,a=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),l=n,c=i,d="prescale1";for(;a>2&&l>1||o>2&&c>1;){let t=l,n=c;a>2&&l>1&&(t=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l/2),a/=l/t),o>2&&c>1&&(n=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c)/2,o/=c/n),s=this.cachedCanvases.getCanvas(d,t,n),r=s.context,r.clearRect(0,0,t,n),r.drawImage(e,0,0,l,c,0,0,t,n),e=s.canvas,l=t,c=n,d="prescale1"===d?"prescale2":"prescale1"}return{img:e,paintWidth:l,paintHeight:c}}_createMaskCanvas(e,t){const n=this.ctx,{width:i,height:s}=t,r=this.current.fillColor,a=this.current.patternFill,o=Vy(n);let l,c,d,u;if((t.bitmap||t.data)&&t.count>1){const n=t.bitmap||t.data.buffer;c=JSON.stringify(a?o:[o.slice(0,4),r]),l=this._cachedBitmapsMap.get(n),l||(l=new Map,this._cachedBitmapsMap.set(n,l));const i=l.get(c);if(i&&!a){const t=Math.round(Math.min(o[0],o[2])+o[4]),n=Math.round(Math.min(o[1],o[3])+o[5]);return this.dependencyTracker?.recordDependencies(e,Cb),{canvas:i,offsetX:t,offsetY:n}}d=i}d||(u=this.cachedCanvases.getCanvas("maskCanvas",i,s),Wb(u.context,t));let h=xy.transform(o,[1/i,0,0,-1/s,0,0]);h=xy.transform(h,[1,0,0,1,0,-s]);const p=Vb.slice();xy.axialAlignedBoundingBox([0,0,i,s],h,p);const[m,g,f,y]=p,v=Math.round(f-m)||1,b=Math.round(y-g)||1,x=this.cachedCanvases.getCanvas("fillCanvas",v,b),w=x.context,_=m,S=g;w.translate(-_,-S),w.transform(...h),d||(d=this._scaleImage(u.canvas,Hy(w)),d=d.img,l&&a&&l.set(c,d)),w.imageSmoothingEnabled=Xb(Vy(w),t.interpolate),$b(w,d,0,0,d.width,d.height,0,0,i,s),w.globalCompositeOperation="source-in";const C=xy.transform(Hy(w),[1,0,0,1,-_,-S]);return w.fillStyle=a?r.getPattern(n,this,C,Ab,e):r,w.fillRect(0,0,i,s),l&&!a&&(this.cachedCanvases.delete("fillCanvas"),l.set(c,x.canvas)),this.dependencyTracker?.recordDependencies(e,Cb),{canvas:x.canvas,offsetX:Math.round(_),offsetY:Math.round(S)}}setLineWidth(e,t){this.dependencyTracker?.recordSimpleData("lineWidth",e),t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(e,t){this.dependencyTracker?.recordSimpleData("lineCap",e),this.ctx.lineCap=Yb[t]}setLineJoin(e,t){this.dependencyTracker?.recordSimpleData("lineJoin",e),this.ctx.lineJoin=Jb[t]}setMiterLimit(e,t){this.dependencyTracker?.recordSimpleData("miterLimit",e),this.ctx.miterLimit=t}setDash(e,t,n){this.dependencyTracker?.recordSimpleData("dash",e);const i=this.ctx;void 0!==i.setLineDash&&(i.setLineDash(t),i.lineDashOffset=n)}setRenderingIntent(e,t){}setFlatness(e,t){}setGState(e,t){for(const[n,i]of t)switch(n){case"LW":this.setLineWidth(e,i);break;case"LC":this.setLineCap(e,i);break;case"LJ":this.setLineJoin(e,i);break;case"ML":this.setMiterLimit(e,i);break;case"D":this.setDash(e,i[0],i[1]);break;case"RI":this.setRenderingIntent(e,i);break;case"FL":this.setFlatness(e,i);break;case"Font":this.setFont(e,i[0],i[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",e),this.current.strokeAlpha=i;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",e),this.ctx.globalAlpha=this.current.fillAlpha=i;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",e),this.ctx.globalCompositeOperation=i;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",e),this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",e),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i)}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(e){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,n=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(i,t,n);this.suspendedCtx=this.ctx;const r=this.ctx=s.context;r.setTransform(this.suspendedCtx.getTransform()),Kb(this.suspendedCtx,r),function(e,t){if(e._removeMirroring)throw new Error("Context is already forwarding operations.");e.__originalSave=e.save,e.__originalRestore=e.restore,e.__originalRotate=e.rotate,e.__originalScale=e.scale,e.__originalTranslate=e.translate,e.__originalTransform=e.transform,e.__originalSetTransform=e.setTransform,e.__originalResetTransform=e.resetTransform,e.__originalClip=e.clip,e.__originalMoveTo=e.moveTo,e.__originalLineTo=e.lineTo,e.__originalBezierCurveTo=e.bezierCurveTo,e.__originalRect=e.rect,e.__originalClosePath=e.closePath,e.__originalBeginPath=e.beginPath,e._removeMirroring=()=>{e.save=e.__originalSave,e.restore=e.__originalRestore,e.rotate=e.__originalRotate,e.scale=e.__originalScale,e.translate=e.__originalTranslate,e.transform=e.__originalTransform,e.setTransform=e.__originalSetTransform,e.resetTransform=e.__originalResetTransform,e.clip=e.__originalClip,e.moveTo=e.__originalMoveTo,e.lineTo=e.__originalLineTo,e.bezierCurveTo=e.__originalBezierCurveTo,e.rect=e.__originalRect,e.closePath=e.__originalClosePath,e.beginPath=e.__originalBeginPath,delete e._removeMirroring},e.save=function(){t.save(),this.__originalSave()},e.restore=function(){t.restore(),this.__originalRestore()},e.translate=function(e,n){t.translate(e,n),this.__originalTranslate(e,n)},e.scale=function(e,n){t.scale(e,n),this.__originalScale(e,n)},e.transform=function(e,n,i,s,r,a){t.transform(e,n,i,s,r,a),this.__originalTransform(e,n,i,s,r,a)},e.setTransform=function(e,n,i,s,r,a){t.setTransform(e,n,i,s,r,a),this.__originalSetTransform(e,n,i,s,r,a)},e.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},e.rotate=function(e){t.rotate(e),this.__originalRotate(e)},e.clip=function(e){t.clip(e),this.__originalClip(e)},e.moveTo=function(e,n){t.moveTo(e,n),this.__originalMoveTo(e,n)},e.lineTo=function(e,n){t.lineTo(e,n),this.__originalLineTo(e,n)},e.bezierCurveTo=function(e,n,i,s,r,a){t.bezierCurveTo(e,n,i,s,r,a),this.__originalBezierCurveTo(e,n,i,s,r,a)},e.rect=function(e,n,i,s){t.rect(e,n,i,s),this.__originalRect(e,n,i,s)},e.closePath=function(){t.closePath(),this.__originalClosePath()},e.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}(r,this.suspendedCtx),this.setGState(e,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Kb(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,i){const s=i[0],r=i[1],a=i[2]-s,o=i[3]-r;0!==a&&0!==o&&(this.genericComposeSMask(t.context,n,a,o,t.subtype,t.backdrop,t.transferMap,s,r,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,i,s,r,a,o,l,c,d){let u=e.canvas,h=o-c,p=l-d;if(r)if(h<0||p<0||h+n>u.width||p+i>u.height){const e=this.cachedCanvases.getCanvas("maskExtension",n,i),t=e.context;t.drawImage(u,-h,-p),t.globalCompositeOperation="destination-atop",t.fillStyle=r,t.fillRect(0,0,n,i),t.globalCompositeOperation="source-over",u=e.canvas,h=p=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const t=new Path2D;t.rect(h,p,n,i),e.clip(t),e.globalCompositeOperation="destination-atop",e.fillStyle=r,e.fillRect(h,p,n,i),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),"Alpha"===s&&a?t.filter=this.filterFactory.addAlphaFilter(a):"Luminosity"===s&&(t.filter=this.filterFactory.addLuminosityFilter(a));const m=new Path2D;m.rect(o,l,n,i),t.clip(m),t.globalCompositeOperation="destination-in",t.drawImage(u,h,p,n,i,o,l,n,i),t.restore()}save(e){this.inSMaskMode&&Kb(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone(),this.dependencyTracker?.save(e)}restore(e){this.dependencyTracker?.restore(e),0!==this.stateStack.length?(this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&Kb(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null):this.inSMaskMode&&this.endSMaskMode()}transform(e,t,n,i,s,r,a){this.dependencyTracker?.recordIncrementalData("transform",e),this.ctx.transform(t,n,i,s,r,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n,i){let[s]=n;if(!i)return s||=n[0]=new Path2D,void this[t](e,s);if(null!==this.dependencyTracker){const n=t===Wf.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(e).recordBBox(e,this.ctx,i[0]-n,i[2]+n,i[1]-n,i[3]+n).recordDependencies(e,["transform"])}s instanceof Path2D||(s=n[0]=ev(s)),xy.axialAlignedBoundingBox(i,Vy(this.ctx),this.current.minMax),this[t](e,s),this._pathStartIdx=e}closePath(e){this.ctx.closePath()}stroke(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=this.ctx,s=this.current.strokeColor;if(i.globalAlpha=this.current.strokeAlpha,this.contentVisible)if("object"===typeof s&&s?.getPattern){const n=s.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.strokeStyle=s.getPattern(i,this,Hy(i),Eb,e),n){const e=new Path2D;e.addPath(t,i.getTransform().invertSelf().multiplySelf(n)),t=e}this.rescaleAndStroke(t,!1),i.restore()}else this.rescaleAndStroke(t,!0);this.dependencyTracker?.recordDependencies(e,vb),n&&this.consumePath(e,t,this.current.getClippedPathBoundingBox(Eb,Vy(this.ctx))),i.globalAlpha=this.current.fillAlpha}closeStroke(e,t){this.stroke(e,t)}fill(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=this.ctx,s=this.current.fillColor;let r=!1;if(this.current.patternFill){const n=s.isModifyingCurrentTransform()?i.getTransform():null;if(this.dependencyTracker?.save(e),i.save(),i.fillStyle=s.getPattern(i,this,Hy(i),Ab,e),n){const e=new Path2D;e.addPath(t,i.getTransform().invertSelf().multiplySelf(n)),t=e}r=!0}const a=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==a&&(this.pendingEOFill?(i.fill(t,"evenodd"),this.pendingEOFill=!1):i.fill(t)),this.dependencyTracker?.recordDependencies(e,bb),r&&(i.restore(),this.dependencyTracker?.restore(e)),n&&this.consumePath(e,t,a)}eoFill(e,t){this.pendingEOFill=!0,this.fill(e,t)}fillStroke(e,t){this.fill(e,t,!1),this.stroke(e,t,!1),this.consumePath(e,t)}eoFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}closeFillStroke(e,t){this.fillStroke(e,t)}closeEOFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}endPath(e,t){this.consumePath(e,t)}rawFillPath(e,t){this.ctx.fill(t),this.dependencyTracker?.recordDependencies(e,wb).recordOperation(e)}clip(e){this.dependencyTracker?.recordFutureForcedDependency("clipMode",e),this.pendingClip=Zb}eoClip(e){this.dependencyTracker?.recordFutureForcedDependency("clipMode",e),this.pendingClip=ex}beginText(e){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(e).resetIncrementalData("sameLineText").resetIncrementalData("moveText",e)}endText(e){const t=this.pendingTextPaths,n=this.ctx;if(this.dependencyTracker){const{dependencyTracker:n}=this;void 0!==t&&n.recordFutureForcedDependency("textClip",n.getOpenMarker()).recordFutureForcedDependency("textClip",e),n.recordCloseMarker(e)}if(void 0!==t){const e=new Path2D,i=n.getTransform().invertSelf();for(const{transform:n,x:s,y:r,fontSize:a,path:o}of t)o&&e.addPath(o,new DOMMatrix(n).preMultiplySelf(i).translate(s,r).scale(a,-a));n.clip(e)}delete this.pendingTextPaths}setCharSpacing(e,t){this.dependencyTracker?.recordSimpleData("charSpacing",e),this.current.charSpacing=t}setWordSpacing(e,t){this.dependencyTracker?.recordSimpleData("wordSpacing",e),this.current.wordSpacing=t}setHScale(e,t){this.dependencyTracker?.recordSimpleData("hScale",e),this.current.textHScale=t/100}setLeading(e,t){this.dependencyTracker?.recordSimpleData("leading",e),this.current.leading=-t}setFont(e,t,n){this.dependencyTracker?.recordSimpleData("font",e).recordSimpleDataFromNamed("fontObj",t,e);const i=this.commonObjs.get(t),s=this.current;if(!i)throw new Error(`Can't find font for ${t}`);if(s.fontMatrix=i.fontMatrix||yf,0!==s.fontMatrix[0]&&0!==s.fontMatrix[3]||iy("Invalid font matrix for font "+t),n<0?(n=-n,s.fontDirection=-1):s.fontDirection=1,this.current.font=i,this.current.fontSize=n,i.isType3Font)return;const r=i.loadedName||"sans-serif",a=i.systemFontInfo?.css||`"${r}", ${i.fallbackName}`;let o="normal";i.black?o="900":i.bold&&(o="bold");const l=i.italic?"italic":"normal";let c=n;n<16?c=16:n>100&&(c=100),this.current.fontSizeScale=n/c,this.ctx.font=`${l} ${o} ${c}px ${a}`}setTextRenderingMode(e,t){this.dependencyTracker?.recordSimpleData("textRenderingMode",e),this.current.textRenderingMode=t}setTextRise(e,t){this.dependencyTracker?.recordSimpleData("textRise",e),this.current.textRise=t}moveText(e,t,n){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",e),this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=n}setLeadingMoveText(e,t,n){this.setLeading(e,-n),this.moveText(e,t,n)}setTextMatrix(e,t){this.dependencyTracker?.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",e);const{current:n}=this;n.textMatrix=t,n.textMatrixScale=Math.hypot(t[0],t[1]),n.x=n.lineX=0,n.y=n.lineY=0}nextLine(e){this.moveText(e,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??e)}#$i(e,t,n){const i=new Path2D;return i.addPath(e,new DOMMatrix(n).invertSelf().multiplySelf(t)),i}paintChar(e,t,n,i,s,r){const a=this.ctx,o=this.current,l=o.font,c=o.textRenderingMode,d=o.fontSize/o.fontSizeScale,u=c&Of,h=!!(c&Ff),p=o.patternFill&&!l.missingFile,m=o.patternStroke&&!l.missingFile;let g;if((l.disableFontFace||h||p||m)&&!l.missingFile&&(g=l.getPathGenerator(this.commonObjs,t)),g&&(l.disableFontFace||p||m)){let t;if(a.save(),a.translate(n,i),a.scale(d,-d),this.dependencyTracker?.recordCharacterBBox(e,a,l),u===Mf||u===Lf)if(s){t=a.getTransform(),a.setTransform(...s);const e=this.#$i(g,t,s);a.fill(e)}else a.fill(g);if(u===Rf||u===Lf)if(r){t||=a.getTransform(),a.setTransform(...r);const{a:e,b:n,c:i,d:s}=t,o=xy.inverseTransform(r),l=xy.transform([e,n,i,s,0,0],o);xy.singularValueDecompose2dScale(l,zb),a.lineWidth*=Math.max(zb[0],zb[1])/d,a.stroke(this.#$i(g,t,r))}else a.lineWidth/=d,a.stroke(g);a.restore()}else u!==Mf&&u!==Lf||(a.fillText(t,n,i),this.dependencyTracker?.recordCharacterBBox(e,a,l,d,n,i,()=>a.measureText(t))),u!==Rf&&u!==Lf||(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(e,a,l,d,n,i,()=>a.measureText(t)).recordDependencies(e,vb),a.strokeText(t,n,i));if(h){(this.pendingTextPaths||=[]).push({transform:Vy(a),x:n,y:i,fontSize:d,path:g}),this.dependencyTracker?.recordCharacterBBox(e,a,l,d,n,i)}}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let n=!1;for(let i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){n=!0;break}return ly(this,"isFontSubpixelAAEnabled",n)}showText(e,t){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(e,_b).resetBBox(e),this.current.textRenderingMode&Ff&&this.dependencyTracker.recordFutureForcedDependency("textClip",e).inheritPendingDependenciesAsFutureForcedDependencies());const n=this.current,i=n.font;if(i.isType3Font)return this.showType3Text(e,t),void this.dependencyTracker?.recordShowTextOperation(e);const s=n.fontSize;if(0===s)return void this.dependencyTracker?.recordOperation(e);const r=this.ctx,a=n.fontSizeScale,o=n.charSpacing,l=n.wordSpacing,c=n.fontDirection,d=n.textHScale*c,u=t.length,h=i.vertical,p=h?1:-1,m=i.defaultVMetrics,g=s*n.fontMatrix[0],f=n.textRenderingMode===Mf&&!i.disableFontFace&&!n.patternFill;let y,v;r.save(),n.textMatrix&&r.transform(...n.textMatrix),r.translate(n.x,n.y+n.textRise),c>0?r.scale(d,-1):r.scale(d,1);const b=n.textRenderingMode&Of,x=b===Rf||b===Lf;if((b===Mf||b===Lf)&&n.patternFill){r.save();const t=n.fillColor.getPattern(r,this,Hy(r),Ab,e);y=Vy(r),r.restore(),r.fillStyle=t}if(x&&n.patternStroke){r.save();const t=n.strokeColor.getPattern(r,this,Hy(r),Eb,e);v=Vy(r),r.restore(),r.strokeStyle=t}let w=n.lineWidth;const _=n.textMatrixScale;if(0===_||0===w?x&&(w=this.getSinglePixelWidth()):w/=_,1!==a&&(r.scale(a,a),w/=a),r.lineWidth=w,i.isInvalidPDFjsFont){const i=[];let s=0;for(const e of t)i.push(e.unicode),s+=e.width;const a=i.join("");if(r.fillText(a,0,0),null!==this.dependencyTracker){const t=r.measureText(a);this.dependencyTracker.recordBBox(e,this.ctx,-t.actualBoundingBoxLeft,t.actualBoundingBoxRight,-t.actualBoundingBoxAscent,t.actualBoundingBoxDescent).recordShowTextOperation(e)}return n.x+=s*g*d,r.restore(),void this.compose()}let S,C=0;for(S=0;S<u;++S){const n=t[S];if("number"===typeof n){C+=p*n*s/1e3;continue}let d=!1;const u=(n.isSpace?l:0)+o,b=n.fontChar,x=n.accent;let w,_,A,E=n.width;if(h){const e=n.vmetric||m,t=-(n.vmetric?e[1]:.5*E)*g,i=e[2]*g;E=e?-e[0]:E,w=t/a,_=(C+i)/a}else w=C/a,_=0;if(i.remeasure&&E>0){A=r.measureText(b);const e=1e3*A.width/s*a;if(E<e&&this.isFontSubpixelAAEnabled){const t=E/e;d=!0,r.save(),r.scale(t,1),w/=t}else E!==e&&(w+=(E-e)/2e3*s/a)}if(this.contentVisible&&(n.isInFont||i.missingFile))if(f&&!x)r.fillText(b,w,_),this.dependencyTracker?.recordCharacterBBox(e,r,A?{bbox:null}:i,s/a,w,_,()=>A??r.measureText(b));else if(this.paintChar(e,b,w,_,y,v),x){const t=w+s*x.offset.x/a,n=_-s*x.offset.y/a;this.paintChar(e,x.fontChar,t,n,y,v)}C+=h?E*g-u*c:E*g+u*c,d&&r.restore()}h?n.y-=C:n.x+=C*d,r.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(e)}showType3Text(e,t){const n=this.ctx,i=this.current,s=i.font,r=i.fontSize,a=i.fontDirection,o=s.vertical?1:-1,l=i.charSpacing,c=i.wordSpacing,d=i.textHScale*a,u=i.fontMatrix||yf,h=t.length;let p,m,g,f;if(i.textRenderingMode===jf||0===r)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),i.textMatrix&&n.transform(...i.textMatrix),n.translate(i.x,i.y+i.textRise),n.scale(d,a);const y=this.dependencyTracker;for(this.dependencyTracker=y?new yb(y,e):null,p=0;p<h;++p){if(m=t[p],"number"===typeof m){f=o*m*r/1e3,this.ctx.translate(f,0),i.x+=f*d;continue}const e=(m.isSpace?c:0)+l,a=s.charProcOperatorList[m.operatorListId];a?this.contentVisible&&(this.save(),n.scale(r,r),n.transform(...u),this.executeOperatorList(a),this.restore()):iy(`Type3 character "${m.operatorListId}" is not available.`);const h=[m.width,0];xy.applyTransform(h,u),g=h[0]*r+e,n.translate(g,0),i.x+=g*d}n.restore(),y&&(this.dependencyTracker=y)}setCharWidth(e,t,n){}setCharWidthAndBounds(e,t,n,i,s,r,a){const o=new Path2D;o.rect(i,s,r-i,a-s),this.ctx.clip(o),this.dependencyTracker?.recordBBox(e,this.ctx,i,r,s,a).recordClipBox(e,this.ctx,i,r,s,a),this.endPath(e)}getColorN_Pattern(e,t){let n;if("TilingPattern"===t[0]){const e=this.baseTransform||Vy(this.ctx),i={createCanvasGraphics:(e,t)=>new tx(e,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new yb(this.dependencyTracker,t,!0):null)};n=new Ob(t,this.ctx,i,e)}else n=this._getPattern(e,t[1],t[2]);return n}setStrokeColorN(e){this.dependencyTracker?.recordSimpleData("strokeColor",e);for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.current.strokeColor=this.getColorN_Pattern(e,n),this.current.patternStroke=!0}setFillColorN(e){this.dependencyTracker?.recordSimpleData("fillColor",e);for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.current.fillColor=this.getColorN_Pattern(e,n),this.current.patternFill=!0}setStrokeRGBColor(e,t){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(e){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t){this.dependencyTracker?.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(e){this.dependencyTracker?.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t){let n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.cachedPatterns.has(t)?n=this.cachedPatterns.get(t):(n=function(e){switch(e[0]){case"RadialAxial":return new Ib(e);case"Mesh":return new Mb(e);case"Dummy":return new Rb}throw new Error(`Unknown IR type: ${e[0]}`)}(this.getObject(e,t)),this.cachedPatterns.set(t,n)),i&&(n.matrix=i),n}shadingFill(e,t){if(!this.contentVisible)return;const n=this.ctx;this.save(e);const i=this._getPattern(e,t);n.fillStyle=i.getPattern(n,this,Hy(n),Tb,e);const s=Hy(n);if(s){const{width:e,height:t}=n.canvas,i=Vb.slice();xy.axialAlignedBoundingBox([0,0,e,t],s,i);const[r,a,o,l]=i;this.ctx.fillRect(r,a,o-r,l-a)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(e).recordFullPageBBox(e).recordDependencies(e,Sb).recordDependencies(e,bb).recordOperation(e),this.compose(this.current.getClippedPathBoundingBox()),this.restore(e)}beginInlineImage(){sy("Should not call beginInlineImage")}beginImageData(){sy("Should not call beginImageData")}paintFormXObjectBegin(e,t,n){if(this.contentVisible&&(this.save(e),this.baseTransformStack.push(this.baseTransform),t&&this.transform(e,...t),this.baseTransform=Vy(this.ctx),n)){xy.axialAlignedBoundingBox(n,this.baseTransform,this.current.minMax);const[t,i,s,r]=n,a=new Path2D;a.rect(t,i,s-t,r-i),this.ctx.clip(a),this.dependencyTracker?.recordClipBox(e,this.ctx,t,s,i,r),this.endPath(e)}}paintFormXObjectEnd(e){this.contentVisible&&(this.restore(e),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e,t){if(!this.contentVisible)return;this.save(e),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const n=this.ctx;t.isolated||ny("TODO: Support non-isolated groups."),t.knockout&&iy("Knockout groups not supported.");const i=Vy(n);if(t.matrix&&n.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let s=Vb.slice();xy.axialAlignedBoundingBox(t.bbox,Vy(n),s);const r=[0,0,n.canvas.width,n.canvas.height];s=xy.intersect(s,r)||[0,0,0,0];const a=Math.floor(s[0]),o=Math.floor(s[1]),l=Math.max(Math.ceil(s[2])-a,1),c=Math.max(Math.ceil(s[3])-o,1);this.current.startNewPathAndClipBox([0,0,l,c]);let d="groupAt"+this.groupLevel;t.smask&&(d+="_smask_"+this.smaskCounter++%2);const u=this.cachedCanvases.getCanvas(d,l,c),h=u.context;h.translate(-a,-o),h.transform(...i);let p=new Path2D;const[m,g,f,y]=t.bbox;if(p.rect(m,g,f-m,y-g),t.matrix){const e=new Path2D;e.addPath(p,new DOMMatrix(t.matrix)),p=e}h.clip(p),t.smask&&this.smaskStack.push({canvas:u.canvas,context:h,offsetX:a,offsetY:o,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}),t.smask&&!this.dependencyTracker||(n.setTransform(1,0,0,1,0,0),n.translate(a,o),n.save()),Kb(n,h),this.ctx=h,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(n),this.setGState(e,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}endGroup(e,t){if(!this.contentVisible)return;this.groupLevel--;const n=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),t.smask)this.tempSMask=this.smaskStack.pop(),this.restore(e),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const t=Vy(this.ctx);this.restore(e),this.ctx.save(),this.ctx.setTransform(...t);const i=Vb.slice();xy.axialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],t,i),this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(i)}}beginAnnotation(e,t,n,i,s,r){if(this.#Vi(),Qb(this.ctx),this.ctx.save(),this.save(e),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),n){const s=n[2]-n[0],a=n[3]-n[1];if(r&&this.annotationCanvasMap){(i=i.slice())[4]-=n[0],i[5]-=n[1],(n=n.slice())[0]=n[1]=0,n[2]=s,n[3]=a,xy.singularValueDecompose2dScale(Vy(this.ctx),zb);const{viewportScale:e}=this,r=Math.ceil(s*this.outputScaleX*e),o=Math.ceil(a*this.outputScaleY*e);this.annotationCanvas=this.canvasFactory.create(r,o);const{canvas:l,context:c}=this.annotationCanvas;this.annotationCanvasMap.set(t,l),this.annotationCanvas.savedCtx=this.ctx,this.ctx=c,this.ctx.save(),this.ctx.setTransform(zb[0],0,0,-zb[1],0,a*zb[1]),Qb(this.ctx)}else{Qb(this.ctx),this.endPath(e);const t=new Path2D;t.rect(n[0],n[1],s,a),this.ctx.clip(t)}}this.current=new qb(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(e,...i),this.transform(e,...s)}endAnnotation(e){this.annotationCanvas&&(this.ctx.restore(),this.#Hi(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e,t){if(!this.contentVisible)return;const n=t.count;(t=this.getObject(e,t.data,t)).count=n;const i=this.ctx,s=this._createMaskCanvas(e,t),r=s.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(r,s.offsetX,s.offsetY),this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,s.offsetX,s.offsetX+r.width,s.offsetY,s.offsetY+r.height).recordOperation(e),i.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0;if(!this.contentVisible)return;t=this.getObject(e,t.data,t);const o=this.ctx;o.save();const l=Vy(o);o.transform(n,i,s,r,0,0);const c=this._createMaskCanvas(e,t);o.setTransform(1,0,0,1,c.offsetX-l[4],c.offsetY-l[5]),this.dependencyTracker?.resetBBox(e);for(let d=0,u=a.length;d<u;d+=2){const t=xy.transform(l,[n,i,s,r,a[d],a[d+1]]);o.drawImage(c.canvas,t[4],t[5]),this.dependencyTracker?.recordBBox(e,this.ctx,t[4],t[4]+c.canvas.width,t[5],t[5]+c.canvas.height)}o.restore(),this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageMaskXObjectGroup(e,t){if(!this.contentVisible)return;const n=this.ctx,i=this.current.fillColor,s=this.current.patternFill;this.dependencyTracker?.resetBBox(e).recordDependencies(e,Cb);for(const r of t){const{data:t,width:a,height:o,transform:l}=r,c=this.cachedCanvases.getCanvas("maskCanvas",a,o),d=c.context;d.save();Wb(d,this.getObject(e,t,r)),d.globalCompositeOperation="source-in",d.fillStyle=s?i.getPattern(d,this,Hy(n),Ab,e):i,d.fillRect(0,0,a,o),d.restore(),n.save(),n.transform(...l),n.scale(1,-1),$b(n,c.canvas,0,0,a,o,0,-1,1,1),this.dependencyTracker?.recordBBox(e,n,0,a,0,o),n.restore()}this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageXObject(e,t){if(!this.contentVisible)return;const n=this.getObject(e,t);n?this.paintInlineImageXObject(e,n):iy("Dependent image isn't ready yet")}paintImageXObjectRepeat(e,t,n,i,s){if(!this.contentVisible)return;const r=this.getObject(e,t);if(!r)return void iy("Dependent image isn't ready yet");const a=r.width,o=r.height,l=[];for(let c=0,d=s.length;c<d;c+=2)l.push({transform:[n,0,0,i,s[c],s[c+1]],x:0,y:0,w:a,h:o});this.paintInlineImageXObjectGroup(e,r,l)}applyTransferMapsToCanvas(e){return"none"!==this.current.transferMaps&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if("none"===this.current.transferMaps)return e.bitmap;const{bitmap:t,width:n,height:i}=e,s=this.cachedCanvases.getCanvas("inlineImage",n,i),r=s.context;return r.filter=this.current.transferMaps,r.drawImage(t,0,0),r.filter="none",s.canvas}paintInlineImageXObject(e,t){if(!this.contentVisible)return;const n=t.width,i=t.height,s=this.ctx;this.save(e);const{filter:r}=s;let a;if("none"!==r&&""!==r&&(s.filter="none"),s.scale(1/n,-1/i),t.bitmap)a=this.applyTransferMapsToBitmap(t);else if("function"===typeof HTMLElement&&t instanceof HTMLElement||!t.data)a=t;else{const e=this.cachedCanvases.getCanvas("inlineImage",n,i).context;Gb(e,t),a=this.applyTransferMapsToCanvas(e)}const o=this._scaleImage(a,Hy(s));s.imageSmoothingEnabled=Xb(Vy(s),t.interpolate),this.dependencyTracker?.resetBBox(e).recordBBox(e,s,0,n,-i,0).recordDependencies(e,xb).recordOperation(e),$b(s,o.img,0,0,o.paintWidth,o.paintHeight,0,-i,n,i),this.compose(),this.restore(e)}paintInlineImageXObjectGroup(e,t,n){if(!this.contentVisible)return;const i=this.ctx;let s;if(t.bitmap)s=t.bitmap;else{const e=t.width,n=t.height,i=this.cachedCanvases.getCanvas("inlineImage",e,n).context;Gb(i,t),s=this.applyTransferMapsToCanvas(i)}this.dependencyTracker?.resetBBox(e);for(const r of n)i.save(),i.transform(...r.transform),i.scale(1,-1),$b(i,s,r.x,r.y,r.w,r.h,0,-1,1,1),this.dependencyTracker?.recordBBox(e,i,0,1,-1,0),i.restore();this.dependencyTracker?.recordOperation(e),this.compose()}paintSolidColorImageMask(e){this.contentVisible&&(this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,0,1,0,1).recordDependencies(e,bb).recordOperation(e),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e,t){}markPointProps(e,t,n){}beginMarkedContent(e,t){this.dependencyTracker?.beginMarkedContent(e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t,n){this.dependencyTracker?.beginMarkedContent(e),"OC"===t?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(e){this.dependencyTracker?.endMarkedContent(e),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(e){}endCompat(e){}consumePath(e,t,n){const i=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(n);const s=this.ctx;this.pendingClip?(i||(this.pendingClip===ex?s.clip(t,"evenodd"):s.clip(t)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(e).recordFutureForcedDependency("clipPath",e)):this.dependencyTracker?.recordOperation(e),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=Vy(this.ctx);if(0===e[1]&&0===e[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(-1===this._cachedScaleForStroking[0]){const{lineWidth:e}=this.current,{a:t,b:n,c:i,d:s}=this.ctx.getTransform();let r,a;if(0===n&&0===i){const n=Math.abs(t),i=Math.abs(s);if(n===i)if(0===e)r=a=1/n;else{const t=n*e;r=a=t<1?1/t:1}else if(0===e)r=1/n,a=1/i;else{const t=n*e,s=i*e;r=t<1?1/t:1,a=s<1?1/s:1}}else{const o=Math.abs(t*s-n*i),l=Math.hypot(t,n),c=Math.hypot(i,s);if(0===e)r=c/o,a=l/o;else{const t=e*o;r=c>t?c/t:1,a=l>t?l/t:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:n,current:{lineWidth:i}}=this,[s,r]=this.getScaleForStroking();if(s===r)return n.lineWidth=(i||1)*s,void n.stroke(e);const a=n.getLineDash();t&&n.save(),n.scale(s,r),Ub.a=1/s,Ub.d=1/r;const o=new Path2D;if(o.addPath(e,Ub),a.length>0){const e=Math.max(s,r);n.setLineDash(a.map(t=>t/e)),n.lineDashOffset/=e}n.lineWidth=i||1,n.stroke(o),t&&n.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}for(const eS in Wf)void 0!==tx.prototype[eS]&&(tx.prototype[Wf[eS]]=tx.prototype[eS]);class nx{static#qi=null;static#Gi="";static get workerPort(){return this.#qi}static set workerPort(e){if(!("undefined"!==typeof Worker&&e instanceof Worker)&&null!==e)throw new Error("Invalid `workerPort` type.");this.#qi=e}static get workerSrc(){return this.#Gi}static set workerSrc(e){if("string"!==typeof e)throw new Error("Invalid `workerSrc` type.");this.#Gi=e}}class ix{#Wi;#Ki;constructor(e){let{parsedData:t,rawData:n}=e;this.#Wi=t,this.#Ki=n}getRaw(){return this.#Ki}get(e){return this.#Wi.get(e)??null}[Symbol.iterator](){return this.#Wi.entries()}}const sx=Symbol("INTERNAL");class rx{#Qi=!1;#Xi=!1;#Yi=!1;#Ji=!0;constructor(e,t){let{name:n,intent:i,usage:s,rbGroups:r}=t;this.#Qi=!!(e&xf),this.#Xi=!!(e&wf),this.name=n,this.intent=i,this.usage=s,this.rbGroups=r}get visible(){if(this.#Yi)return this.#Ji;if(!this.#Ji)return!1;const{print:e,view:t}=this.usage;return this.#Qi?"OFF"!==t?.viewState:!this.#Xi||"OFF"!==e?.printState}_setVisible(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e!==sx&&sy("Internal method `_setVisible` called."),this.#Yi=n,this.#Ji=t}}class ax{#Zi=null;#es=(()=>new Map)();#ts=null;#ns=null;constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xf;if(this.renderingIntent=t,this.name=null,this.creator=null,null!==e){this.name=e.name,this.creator=e.creator,this.#ns=e.order;for(const n of e.groups)this.#es.set(n.id,new rx(t,n));if("OFF"===e.baseState)for(const e of this.#es.values())e._setVisible(sx,!1);for(const t of e.on)this.#es.get(t)._setVisible(sx,!0);for(const t of e.off)this.#es.get(t)._setVisible(sx,!1);this.#ts=this.getHash()}}#is(e){const t=e.length;if(t<2)return!0;const n=e[0];for(let i=1;i<t;i++){const t=e[i];let s;if(Array.isArray(t))s=this.#is(t);else{if(!this.#es.has(t))return iy(`Optional content group not found: ${t}`),!0;s=this.#es.get(t).visible}switch(n){case"And":if(!s)return!1;break;case"Or":if(s)return!0;break;case"Not":return!s;default:return!0}}return"And"===n}isVisible(e){if(0===this.#es.size)return!0;if(!e)return ny("Optional content group not defined."),!0;if("OCG"===e.type)return this.#es.has(e.id)?this.#es.get(e.id).visible:(iy(`Optional content group not found: ${e.id}`),!0);if("OCMD"===e.type){if(e.expression)return this.#is(e.expression);if(!e.policy||"AnyOn"===e.policy){for(const t of e.ids){if(!this.#es.has(t))return iy(`Optional content group not found: ${t}`),!0;if(this.#es.get(t).visible)return!0}return!1}if("AllOn"===e.policy){for(const t of e.ids){if(!this.#es.has(t))return iy(`Optional content group not found: ${t}`),!0;if(!this.#es.get(t).visible)return!1}return!0}if("AnyOff"===e.policy){for(const t of e.ids){if(!this.#es.has(t))return iy(`Optional content group not found: ${t}`),!0;if(!this.#es.get(t).visible)return!0}return!1}if("AllOff"===e.policy){for(const t of e.ids){if(!this.#es.has(t))return iy(`Optional content group not found: ${t}`),!0;if(this.#es.get(t).visible)return!1}return!0}return iy(`Unknown optional content policy ${e.policy}.`),!0}return iy(`Unknown group type ${e.type}.`),!0}setVisibility(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=this.#es.get(e);if(i){if(n&&t&&i.rbGroups.length)for(const t of i.rbGroups)for(const n of t)n!==e&&this.#es.get(n)?._setVisible(sx,!1,!0);i._setVisible(sx,!!t,!0),this.#Zi=null}else iy(`Optional content group not found: ${e}`)}setOCGState(e){let t,{state:n,preserveRB:i}=e;for(const s of n){switch(s){case"ON":case"OFF":case"Toggle":t=s;continue}const e=this.#es.get(s);if(e)switch(t){case"ON":this.setVisibility(s,!0,i);break;case"OFF":this.setVisibility(s,!1,i);break;case"Toggle":this.setVisibility(s,!e.visible,i)}}this.#Zi=null}get hasInitialVisibility(){return null===this.#ts||this.getHash()===this.#ts}getOrder(){return this.#es.size?this.#ns?this.#ns.slice():[...this.#es.keys()]:null}getGroup(e){return this.#es.get(e)||null}getHash(){if(null!==this.#Zi)return this.#Zi;const e=new bv;for(const[t,n]of this.#es)e.update(`${t}:${n.visible}`);return this.#Zi=e.hexdigest()}[Symbol.iterator](){return this.#es.entries()}}class ox{constructor(e,t){let{disableRange:n=!1,disableStream:i=!1}=t;ry(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:s,initialData:r,progressiveDone:a,contentDispositionFilename:o}=e;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,r?.length>0){const e=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(e)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!i,this._isRangeSupported=!n,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((e,t)=>{this._onReceiveData({begin:e,chunk:t})}),e.addProgressListener((e,t)=>{this._onProgress({loaded:e,total:t})}),e.addProgressiveReadListener(e=>{this._onReceiveData({chunk:e})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData(e){let{begin:t,chunk:n}=e;const i=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;if(void 0===t)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{ry(this._rangeReaders.some(function(e){return e._begin===t&&(e._enqueue(i),!0)}),"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){void 0===e.total?this._rangeReaders[0]?.onProgress?.({loaded:e.loaded}):this._fullRequestReader?.onProgress?.({loaded:e.loaded,total:e.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){ry(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new lx(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new cx(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}}class lx{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._stream=e,this._done=n||!1,this._filename=Ly(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(const s of this._queuedChunks)this._loaded+=s.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length>0){this._requests.shift().resolve({value:e,done:!1})}else this._queuedChunks.push(e);this._loaded+=e.byteLength}}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0){return{value:this._queuedChunks.shift(),done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class cx{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(0===this._requests.length)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function dx(e,t){const n=new Headers;if(!e||!t||"object"!==typeof t)return n;for(const i in t){const e=t[i];void 0!==e&&n.append(i,e)}return n}function ux(e){return URL.parse(e)?.origin??null}function hx(e){let{responseHeaders:t,isHttp:n,rangeChunkSize:i,disableRange:s}=e;const r={allowRangeRequests:!1,suggestedLength:void 0},a=parseInt(t.get("Content-Length"),10);if(!Number.isInteger(a))return r;if(r.suggestedLength=a,a<=2*i)return r;if(s||!n)return r;if("bytes"!==t.get("Accept-Ranges"))return r;return"identity"!==(t.get("Content-Encoding")||"identity")||(r.allowRangeRequests=!0),r}function px(e){const t=e.get("Content-Disposition");if(t){let e=function(e){let t=!0,n=i("filename\\*","i").exec(e);if(n){n=n[1];let e=a(n);return e=unescape(e),e=o(e),e=l(e),r(e)}if(n=function(e){const t=[];let n;const s=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(n=s.exec(e));){let[,e,i,s]=n;if(e=parseInt(e,10),e in t){if(0===e)break}else t[e]=[i,s]}const r=[];for(let i=0;i<t.length&&i in t;++i){let[e,n]=t[i];n=a(n),e&&(n=unescape(n),0===i&&(n=o(n))),r.push(n)}return r.join("")}(e),n)return r(l(n));if(n=i("filename","i").exec(e),n){n=n[1];let e=a(n);return e=l(e),r(e)}function i(e,t){return new RegExp("(?:^|;)\\s*"+e+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',t)}function s(e,n){if(e){if(!/^[\x00-\xFF]+$/.test(n))return n;try{const i=new TextDecoder(e,{fatal:!0}),s=yy(n);n=i.decode(s),t=!1}catch{}}return n}function r(e){return t&&/[\x80-\xff]/.test(e)&&(e=s("utf-8",e),t&&(e=s("iso-8859-1",e))),e}function a(e){if(e.startsWith('"')){const t=e.slice(1).split('\\"');for(let e=0;e<t.length;++e){const n=t[e].indexOf('"');-1!==n&&(t[e]=t[e].slice(0,n),t.length=e+1),t[e]=t[e].replaceAll(/\\(.)/g,"$1")}e=t.join('"')}return e}function o(e){const t=e.indexOf("'");return-1===t?e:s(e.slice(0,t),e.slice(t+1).replace(/^[^']*'/,""))}function l(e){return!e.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(e)?e:e.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(e,t,n,i){if("q"===n||"Q"===n)return s(t,i=(i=i.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,function(e,t){return String.fromCharCode(parseInt(t,16))}));try{i=atob(i)}catch{}return s(t,i)})}return""}(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(Ly(e))return e}return null}function mx(e,t){return new py(`Unexpected server response (${e}) while retrieving PDF "${t}".`,e,404===e||0===e&&t.startsWith("file:"))}function gx(e){return 200===e||206===e}function fx(e,t,n){return{method:"GET",headers:e,signal:n.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function yx(e){return e instanceof Uint8Array?e.buffer:e instanceof ArrayBuffer?e:(iy(`getArrayBuffer - unexpected data format: ${e}`),new Uint8Array(e).buffer)}class vx{_responseOrigin=null;constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=dx(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ry(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new bx(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new xx(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class bx{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const n=new Headers(e.headers),i=t.url;fetch(i,fx(n,this._withCredentials,this._abortController)).then(t=>{if(e._responseOrigin=ux(t.url),!gx(t.status))throw mx(t.status,i);this._reader=t.body.getReader(),this._headersCapability.resolve();const n=t.headers,{allowRangeRequests:s,suggestedLength:r}=hx({responseHeaders:n,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=s,this._contentLength=r||this._contentLength,this._filename=px(n),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new gy("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:yx(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}class xx{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;const i=e.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const s=new Headers(e.headers);s.append("Range",`bytes=${t}-${n-1}`);const r=i.url;fetch(r,fx(s,this._withCredentials,this._abortController)).then(t=>{const n=ux(t.url);if(n!==e._responseOrigin)throw new Error(`Expected range response-origin "${n}" to match "${e._responseOrigin}".`);if(!gx(t.status))throw mx(t.status,r);this._readCapability.resolve(),this._reader=t.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded}),{value:yx(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}class wx{_responseOrigin=null;constructor(e){let{url:t,httpHeaders:n,withCredentials:i}=e;this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=dx(this.isHttp,n),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,n=this.currXhrId++,i=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[s,r]of this.headers)t.setRequestHeader(s,r);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=206):i.expectedStatus=200,t.responseType="arraybuffer",ry(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){const n=this.pendingRequests[e];n&&n.onProgress?.(t)}onStateChange(e,t){const n=this.pendingRequests[e];if(!n)return;const i=n.xhr;if(i.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),4!==i.readyState)return;if(!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],0===i.status&&this.isHttp)return void n.onError(i.status);const s=i.status||200;if(!(200===s&&206===n.expectedStatus)&&s!==n.expectedStatus)return void n.onError(i.status);const r=function(e){const t=e.response;return"string"!==typeof t?t:yy(t).buffer}(i);if(206===s){const e=i.getResponseHeader("Content-Range"),t=/bytes (\d+)-(\d+)\/(\d+)/.exec(e);t?n.onDone({begin:parseInt(t[1],10),chunk:r}):(iy('Missing or invalid "Content-Range" header.'),n.onError(0))}else r?n.onDone({begin:0,chunk:r}):n.onError(i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class _x{constructor(e){this._source=e,this._manager=new wx(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return ry(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Sx(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const n=new Cx(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class Sx{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=ux(t.responseURL);const n=t.getAllResponseHeaders(),i=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(e=>{const[t,...n]=e.split(": ");return[t,n.join(": ")]}):[]),{allowRangeRequests:s,suggestedLength:r}=hx({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});s&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=px(i),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e)if(this._requests.length>0){this._requests.shift().resolve({value:e.chunk,done:!1})}else this._cachedChunks.push(e.chunk);if(this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=mx(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0){return{value:this._cachedChunks.shift(),done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Cx{constructor(e,t,n){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const e=ux(this._manager.getRequestXhr(this._requestId)?.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(e){const t=e.chunk;if(this._requests.length>0){this._requests.shift().resolve({value:t,done:!1})}else this._queuedChunk=t;this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??=mx(e,this._url);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(null!==this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const Ax=/^[a-z][a-z0-9\-+.]+:/i;class Ex{constructor(e){this.source=e,this.url=function(e){if(Ax.test(e))return new URL(e);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(e))}(e.url),ry("file:"===this.url.protocol,"PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ry(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Tx(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new kx(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class Tx{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(e=>{this._contentLength=e.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},e=>{"ENOENT"===e.code&&(e=mx(0,this._url.href)),this._storedError=e,this._headersCapability.reject(e)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();if(null===e)return this._readCapability=Promise.withResolvers(),this.read();this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength});return{value:new Uint8Array(e).buffer,done:!1}}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new gy("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class kx{constructor(e,t,n){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=e.source;this._isStreamingSupported=!i.disableStream;const s=process.getBuiltinModule("fs");this._setReadableStream(s.createReadStream(this._url,{start:t,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();if(null===e)return this._readCapability=Promise.withResolvers(),this.read();this._loaded+=e.length,this.onProgress?.({loaded:this._loaded});return{value:new Uint8Array(e).buffer,done:!1}}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Nx=Symbol("INITIAL_DATA");class Ix{#ss=(()=>Object.create(null))();#rs(e){return this.#ss[e]||={...Promise.withResolvers(),data:Nx}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t){const n=this.#rs(e);return n.promise.then(()=>t(n.data)),null}const n=this.#ss[e];if(!n||n.data===Nx)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){const t=this.#ss[e];return!!t&&t.data!==Nx}delete(e){const t=this.#ss[e];return!(!t||t.data===Nx)&&(delete this.#ss[e],!0)}resolve(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.#rs(e);n.data=t,n.resolve()}clear(){for(const e in this.#ss){const{data:t}=this.#ss[e];t?.bitmap?.close()}this.#ss=Object.create(null)}*[Symbol.iterator](){for(const e in this.#ss){const{data:t}=this.#ss[e];t!==Nx&&(yield[e,t])}}}class Dx{#as=(()=>Promise.withResolvers())();#Ae=null;#os=!1;#ls=(()=>!!globalThis.FontInspector?.enabled)();#cs=null;#ds=null;#us=0;#hs=0;#ps=null;#ms=null;#gs=0;#fs=0;#ys=(()=>Object.create(null))();#vs=[];#bs=null;#xs=[];#ws=(()=>new WeakMap)();#_s=null;static#Ss=(()=>new Map)();static#Cs=(()=>new Map)();static#As=(()=>new WeakMap)();static#Es=null;static#Ts=(()=>new Set)();constructor(e){let{textContentSource:t,container:n,viewport:i}=e;if(t instanceof ReadableStream)this.#bs=t;else{if("object"!==typeof t)throw new Error('No "textContentSource" parameter specified.');this.#bs=new ReadableStream({start(e){e.enqueue(t),e.close()}})}this.#Ae=this.#ms=n,this.#fs=i.scale*qy.pixelRatio,this.#gs=i.rotation,this.#ds={div:null,properties:null,ctx:null};const{pageWidth:s,pageHeight:r,pageX:a,pageY:o}=i.rawDims;this.#_s=[1,0,0,-1,-a,o+r],this.#hs=s,this.#us=r,Dx.#ks(),n.style.setProperty("--min-font-size",Dx.#Es),$y(n,i),this.#as.promise.finally(()=>{Dx.#Ts.delete(this),this.#ds=null,this.#ys=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=vy.platform;return ly(this,"fontFamilyMap",new Map([["sans-serif",(e&&t?"Calibri, ":"")+"sans-serif"],["monospace",(e&&t?"Lucida Console, ":"")+"monospace"]]))}render(){const e=()=>{this.#ps.read().then(t=>{let{value:n,done:i}=t;i?this.#as.resolve():(this.#cs??=n.lang,Object.assign(this.#ys,n.styles),this.#Ns(n.items),e())},this.#as.reject)};return this.#ps=this.#bs.getReader(),Dx.#Ts.add(this),e(),this.#as.promise}update(e){let{viewport:t,onBefore:n=null}=e;const i=t.scale*qy.pixelRatio,s=t.rotation;if(s!==this.#gs&&(n?.(),this.#gs=s,$y(this.#ms,{rotation:s})),i!==this.#fs){n?.(),this.#fs=i;const e={div:null,properties:null,ctx:Dx.#Is(this.#cs)};for(const t of this.#xs)e.properties=this.#ws.get(t),e.div=t,this.#Ds(e)}}cancel(){const e=new gy("TextLayer task cancelled.");this.#ps?.cancel(e).catch(()=>{}),this.#ps=null,this.#as.reject(e)}get textDivs(){return this.#xs}get textContentItemsStr(){return this.#vs}#Ns(e){if(this.#os)return;this.#ds.ctx??=Dx.#Is(this.#cs);const t=this.#xs,n=this.#vs;for(const i of e){if(t.length>1e5)return iy("Ignoring additional textDivs for performance reasons."),void(this.#os=!0);if(void 0!==i.str)n.push(i.str),this.#Ps(i);else if("beginMarkedContentProps"===i.type||"beginMarkedContent"===i.type){const e=this.#Ae;this.#Ae=document.createElement("span"),this.#Ae.classList.add("markedContent"),i.id&&this.#Ae.setAttribute("id",`${i.id}`),e.append(this.#Ae)}else"endMarkedContent"===i.type&&(this.#Ae=this.#Ae.parentNode)}}#Ps(e){const t=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:""!==e.str,hasEOL:e.hasEOL,fontSize:0};this.#xs.push(t);const i=xy.transform(this.#_s,e.transform);let s=Math.atan2(i[1],i[0]);const r=this.#ys[e.fontName];r.vertical&&(s+=Math.PI/2);let a=this.#ls&&r.fontSubstitution||r.fontFamily;a=Dx.fontFamilyMap.get(a)||a;const o=Math.hypot(i[2],i[3]),l=o*Dx.#Ms(a,r,this.#cs);let c,d;0===s?(c=i[4],d=i[5]-l):(c=i[4]+l*Math.sin(s),d=i[5]-l*Math.cos(s));const u=t.style;u.left=`${(100*c/this.#hs).toFixed(2)}%`,u.top=`${(100*d/this.#us).toFixed(2)}%`,u.setProperty("--font-height",`${o.toFixed(2)}px`),u.fontFamily=a,n.fontSize=o,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,this.#ls&&(t.dataset.fontName=r.fontSubstitutionLoadedName||e.fontName),0!==s&&(n.angle=s*(180/Math.PI));let h=!1;if(e.str.length>1)h=!0;else if(" "!==e.str&&e.transform[0]!==e.transform[3]){const t=Math.abs(e.transform[0]),n=Math.abs(e.transform[3]);t!==n&&Math.max(t,n)/Math.min(t,n)>1.5&&(h=!0)}if(h&&(n.canvasWidth=r.vertical?e.height:e.width),this.#ws.set(t,n),this.#ds.div=t,this.#ds.properties=n,this.#Ds(this.#ds),n.hasText&&this.#Ae.append(t),n.hasEOL){const e=document.createElement("br");e.setAttribute("role","presentation"),this.#Ae.append(e)}}#Ds(e){const{div:t,properties:n,ctx:i}=e,{style:s}=t;if(0!==n.canvasWidth&&n.hasText){const{fontFamily:e}=s,{canvasWidth:r,fontSize:a}=n;Dx.#Rs(i,a*this.#fs,e);const{width:o}=i.measureText(t.textContent);o>0&&s.setProperty("--scale-x",r*this.#fs/o)}0!==n.angle&&s.setProperty("--rotate",`${n.angle}deg`)}static cleanup(){if(!(this.#Ts.size>0)){this.#Ss.clear();for(const{canvas:e}of this.#Cs.values())e.remove();this.#Cs.clear()}}static#Is(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.#Cs.get(e||="");if(!t){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=e,document.body.append(n),t=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#Cs.set(e,t),this.#As.set(t,{size:0,family:""})}return t}static#Rs(e,t,n){const i=this.#As.get(e);t===i.size&&n===i.family||(e.font=`${t}px ${n}`,i.size=t,i.family=n)}static#ks(){if(null!==this.#Es)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),this.#Es=e.getBoundingClientRect().height,e.remove()}static#Ms(e,t,n){const i=this.#Ss.get(e);if(i)return i;const s=this.#Is(n);s.canvas.width=s.canvas.height=30,this.#Rs(s,30,e);const r=s.measureText(""),a=r.fontBoundingBoxAscent,o=Math.abs(r.fontBoundingBoxDescent);s.canvas.width=s.canvas.height=0;let l=.8;return a?l=a/(a+o):(vy.platform.isFirefox&&iy("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?l=t.ascent:t.descent&&(l=1+t.descent)),this.#Ss.set(e,l),l}}function Px(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"string"===typeof e||e instanceof URL?e={url:e}:(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t=new Mx,{docId:n}=t,i=e.url?function(e){if(e instanceof URL)return e.href;if("string"===typeof e){if(ff)return e;const t=URL.parse(e,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}(e.url):null,s=e.data?function(e){if(ff&&"undefined"!==typeof Buffer&&e instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength)return e;if("string"===typeof e)return yy(e);if(e instanceof ArrayBuffer||ArrayBuffer.isView(e)||"object"===typeof e&&!isNaN(e?.length))return new Uint8Array(e);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}(e.data):null,r=e.httpHeaders||null,a=!0===e.withCredentials,o=e.password??null,l=e.range instanceof Rx?e.range:null,c=Number.isInteger(e.rangeChunkSize)&&e.rangeChunkSize>0?e.rangeChunkSize:65536;let d=e.worker instanceof Ox?e.worker:null;const u=e.verbosity,h="string"!==typeof e.docBaseUrl||Ry(e.docBaseUrl)?null:e.docBaseUrl,p=Iv(e.cMapUrl),m=!1!==e.cMapPacked,g=e.CMapReaderFactory||(ff?ab:Xv),f=Iv(e.iccUrl),y=Iv(e.standardFontDataUrl),v=e.StandardFontDataFactory||(ff?ob:eb),b=Iv(e.wasmUrl),x=e.WasmFactory||(ff?lb:nb),w=!0!==e.stopAtErrors,_=Number.isInteger(e.maxImageSize)&&e.maxImageSize>-1?e.maxImageSize:-1,S=!1!==e.isEvalSupported,C="boolean"===typeof e.isOffscreenCanvasSupported?e.isOffscreenCanvasSupported:!ff,A="boolean"===typeof e.isImageDecoderSupported?e.isImageDecoderSupported:!ff&&(vy.platform.isFirefox||!globalThis.chrome),E=Number.isInteger(e.canvasMaxAreaInBytes)?e.canvasMaxAreaInBytes:-1,T="boolean"===typeof e.disableFontFace?e.disableFontFace:ff,k=!0===e.fontExtraProperties,N=!0===e.enableXfa,I=e.ownerDocument||globalThis.document,D=!0===e.disableRange,P=!0===e.disableStream,M=!0===e.disableAutoFetch,R=!0===e.pdfBug,L=e.CanvasFactory||(ff?rb:Kv),j=e.FilterFactory||(ff?sb:Jv),O=!0===e.enableHWA,F=!1!==e.useWasm,B=l?l.length:e.length??NaN,U="boolean"===typeof e.useSystemFonts?e.useSystemFonts:!ff&&!T,z="boolean"===typeof e.useWorkerFetch?e.useWorkerFetch:!!(g===Xv&&v===eb&&x===nb&&p&&y&&b&&Oy(p,document.baseURI)&&Oy(y,document.baseURI)&&Oy(b,document.baseURI));ey(u);const V={canvasFactory:new L({ownerDocument:I,enableHWA:O}),filterFactory:new j({docId:n,ownerDocument:I}),cMapReaderFactory:z?null:new g({baseUrl:p,isCompressed:m}),standardFontDataFactory:z?null:new v({baseUrl:y}),wasmFactory:z?null:new x({baseUrl:b})};d||(d=Ox.create({verbosity:u,port:nx.workerPort}),t._worker=d);const H={docId:n,apiVersion:"5.4.530",data:s,password:o,disableAutoFetch:M,rangeChunkSize:c,length:B,docBaseUrl:h,enableXfa:N,evaluatorOptions:{maxImageSize:_,disableFontFace:T,ignoreErrors:w,isEvalSupported:S,isOffscreenCanvasSupported:C,isImageDecoderSupported:A,canvasMaxAreaInBytes:E,fontExtraProperties:k,useSystemFonts:U,useWasm:F,useWorkerFetch:z,cMapUrl:p,iccUrl:f,standardFontDataUrl:y,wasmUrl:b}},$={ownerDocument:I,pdfBug:R,styleElement:null,loadingParams:{disableAutoFetch:M,enableXfa:N}};return d.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const e=d.messageHandler.sendWithPromise("GetDocRequest",H,s?[s.buffer]:null);let o;if(l)o=new ox(l,{disableRange:D,disableStream:P});else if(!s){if(!i)throw new Error("getDocument - no `url` parameter provided.");const e=Oy(i)?vx:ff?Ex:_x;o=new e({url:i,length:B,httpHeaders:r,withCredentials:a,rangeChunkSize:c,disableRange:D,disableStream:P})}return e.then(e=>{if(t.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const i=new Gv(n,e,d.port),s=new Fx(i,t,o,$,V,O);t._transport=s,i.send("Ready",null)})}).catch(t._capability.reject),t}class Mx{static#si=0;_capability=(()=>Promise.withResolvers())();_transport=null;_worker=null;docId=(()=>"d"+Mx.#si++)();destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await(this._transport?.destroy())}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class Rx{#as=(()=>Promise.withResolvers())();#Ls=[];#js=[];#Os=[];#Fs=[];constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=i}addRangeListener(e){this.#Fs.push(e)}addProgressListener(e){this.#Os.push(e)}addProgressiveReadListener(e){this.#js.push(e)}addProgressiveDoneListener(e){this.#Ls.push(e)}onDataRange(e,t){for(const n of this.#Fs)n(e,t)}onDataProgress(e,t){this.#as.promise.then(()=>{for(const n of this.#Os)n(e,t)})}onDataProgressiveRead(e){this.#as.promise.then(()=>{for(const t of this.#js)t(e)})}onDataProgressiveDone(){this.#as.promise.then(()=>{for(const e of this.#Ls)e()})}transportReady(){this.#as.resolve()}requestDataRange(e,t){sy("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class Lx{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return ly(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(e,t){return this._transport.getAnnotationsByType(e,t)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){let{intent:e="display"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}extractPages(e){return this._transport.extractPages(e)}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class jx{#Bs=!1;constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=i?new jy:null,this._pdfBug=i,this.commonObjs=n.commonObjs,this.objs=new Ix,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport(){let{scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:i=0,dontFlip:s=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Py({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:i,dontFlip:s})}getAnnotations(){let{intent:e="display"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return ly(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render(e){let{canvasContext:t,canvas:n=t.canvas,viewport:i,intent:s="display",annotationMode:r=Tf.ENABLE,transform:a=null,background:o=null,optionalContentConfigPromise:l=null,annotationCanvasMap:c=null,pageColors:d=null,printAnnotationStorage:u=null,isEditing:h=!1,recordOperations:p=!1,operationsFilter:m=null}=e;this._stats?.time("Overall");const g=this._transport.getRenderingIntent(s,r,u,h),{renderingIntent:f,cacheKey:y}=g;this.#Bs=!1,l||=this._transport.getOptionalContentConfig(f);let v=this._intentStates.get(y);v||(v=Object.create(null),this._intentStates.set(y,v)),v.streamReaderCancelTimeout&&(clearTimeout(v.streamReaderCancelTimeout),v.streamReaderCancelTimeout=null);const b=!!(f&wf);v.displayReadyCapability||(v.displayReadyCapability=Promise.withResolvers(),v.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(g));const x=Boolean(this._pdfBug&&globalThis.StepperManager?.enabled),w=!this.recordedBBoxes&&(p||x),_=e=>{if(v.renderTasks.delete(S),w){const e=S.gfx?.dependencyTracker.take();e&&(S.stepper&&S.stepper.setOperatorBBoxes(e,S.gfx.dependencyTracker.takeDebugMetadata()),p&&(this.recordedBBoxes=e))}b&&(this.#Bs=!0),this.#Us(),e?(S.capability.reject(e),this._abortOperatorList({intentState:v,reason:e instanceof Error?e:new Error(e)})):S.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},S=new Ux({callback:_,params:{canvas:n,canvasContext:t,dependencyTracker:w?new fb(n,v.operatorList.length,x):null,viewport:i,transform:a,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:v.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!b,pdfBug:this._pdfBug,pageColors:d,enableHWA:this._transport.enableHWA,operationsFilter:m});(v.renderTasks||=new Set).add(S);const C=S.task;return Promise.all([v.displayReadyCapability.promise,l]).then(e=>{let[t,n]=e;if(this.destroyed)_();else{if(this._stats?.time("Rendering"),!(n.renderingIntent&f))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");S.initializeGraphics({transparency:t,optionalContentConfig:n}),S.operatorListChanged()}}).catch(_),C}getOperatorList(){let{intent:e="display",annotationMode:t=Tf.ENABLE,printAnnotationStorage:n=null,isEditing:i=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=this._transport.getRenderingIntent(e,t,n,i,!0);let r,a=this._intentStates.get(s.cacheKey);return a||(a=Object.create(null),this._intentStates.set(s.cacheKey,a)),a.opListReadCapability||(r=Object.create(null),r.operatorListChanged=function(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(r))},a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||=new Set).add(r),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(s)),a.opListReadCapability.promise}streamTextContent(){let{includeMarkedContent:e=!1,disableNormalization:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===e,disableNormalization:!0===t},{highWaterMark:100,size:e=>e.items.length})}getTextContent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._transport._htmlForXfa)return this.getXfa().then(e=>Ty.textContent(e));const t=this.streamTextContent(e);return new Promise(function(e,n){const i=t.getReader(),s={items:[],styles:Object.create(null),lang:null};!function t(){i.read().then(function(n){let{value:i,done:r}=n;r?e(s):(s.lang??=i.lang,Object.assign(s.styles,i.styles),s.items.push(...i.items),t())},n)}()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),this.#Bs=!1,Promise.all(e)}cleanup(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.#Bs=!0;const t=this.#Us();return e&&t&&(this._stats&&=new jy),t}#Us(){if(!this.#Bs||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#Bs=!1,!0}_startRenderPage(e,t){const n=this._intentStates.get(t);n&&(this._stats?.timeEnd("Page Request"),n.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let n=0,i=e.length;n<i;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const n of t.renderTasks)n.operatorListChanged();e.lastChunk&&this.#Us()}_pumpOperatorList(e){let{renderingIntent:t,cacheKey:n,annotationStorageSerializable:i,modifiedIds:s}=e;const{map:r,transfer:a}=i,o=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:n,annotationStorage:r,modifiedIds:s},a).getReader(),l=this._intentStates.get(n);l.streamReader=o;const c=()=>{o.read().then(e=>{let{value:t,done:n}=e;n?l.streamReader=null:this._transport.destroyed||(this._renderPageChunk(t,l),c())},e=>{if(l.streamReader=null,!this._transport.destroyed){if(l.operatorList){l.operatorList.lastChunk=!0;for(const e of l.renderTasks)e.operatorListChanged();this.#Us()}if(l.displayReadyCapability)l.displayReadyCapability.reject(e);else{if(!l.opListReadCapability)throw e;l.opListReadCapability.reject(e)}}})};c()}_abortOperatorList(e){let{intentState:t,reason:n,force:i=!1}=e;if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!i){if(t.renderTasks.size>0)return;if(n instanceof My){let e=100;return n.extraDelay>0&&n.extraDelay<1e3&&(e+=n.extraDelay),void(t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:n,force:!0})},e))}}if(t.streamReader.cancel(new gy(n.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[e,n]of this._intentStates)if(n===t){this._intentStates.delete(e);break}this.cleanup()}}}get stats(){return this._stats}}class Ox{#as=(()=>Promise.withResolvers())();#zs=null;#qi=null;#Vs=null;static#Hs=0;static#$s=!1;static#qs=(()=>new WeakMap)();static#Gs=(()=>{ff&&(this.#$s=!0,nx.workerSrc||="./pdf.worker.mjs"),this._isSameOrigin=(e,t)=>{const n=URL.parse(e);if(!n?.origin||"null"===n.origin)return!1;const i=new URL(t,n);return n.origin===i.origin},this._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},this.fromPort=e=>{var t;if(t="`PDFWorker.fromPort` - please use `PDFWorker.create` instead.",console.log("Deprecated API usage: "+t),!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return this.create(e)}})();constructor(){let{name:e=null,port:t=null,verbosity:n=ty()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.name=e,this.destroyed=!1,this.verbosity=n,t){if(Ox.#qs.has(t))throw new Error("Cannot use more than one PDFWorker per port.");Ox.#qs.set(t,this),this.#Ws(t)}else this.#Ks()}get promise(){return this.#as.promise}#Qs(){this.#as.resolve(),this.#zs.send("configure",{verbosity:this.verbosity})}get port(){return this.#qi}get messageHandler(){return this.#zs}#Ws(e){this.#qi=e,this.#zs=new Gv("main","worker",e),this.#zs.on("ready",()=>{}),this.#Qs()}#Ks(){if(Ox.#$s||Ox.#Xs)return void this.#Ys();let{workerSrc:e}=Ox;try{Ox._isSameOrigin(window.location,e)||(e=Ox._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),n=new Gv("main","worker",t),i=()=>{s.abort(),n.destroy(),t.terminate(),this.destroyed?this.#as.reject(new Error("Worker was destroyed")):this.#Ys()},s=new AbortController;t.addEventListener("error",()=>{this.#Vs||i()},{signal:s.signal}),n.on("test",e=>{s.abort(),!this.destroyed&&e?(this.#zs=n,this.#qi=t,this.#Vs=t,this.#Qs()):i()}),n.on("ready",e=>{if(s.abort(),this.destroyed)i();else try{r()}catch{this.#Ys()}});const r=()=>{const e=new Uint8Array;n.send("test",e,[e.buffer])};return void r()}catch{ny("The worker has been disabled.")}this.#Ys()}#Ys(){Ox.#$s||(iy("Setting up fake worker."),Ox.#$s=!0),Ox._setupFakeWorkerGlobal.then(e=>{if(this.destroyed)return void this.#as.reject(new Error("Worker was destroyed"));const t=new Mv;this.#qi=t;const n="fake"+Ox.#Hs++,i=new Gv(n+"_worker",n,t);e.setup(i,t),this.#zs=new Gv(n,n+"_worker",t),this.#Qs()}).catch(e=>{this.#as.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){this.destroyed=!0,this.#Vs?.terminate(),this.#Vs=null,Ox.#qs.delete(this.#qi),this.#qi=null,this.#zs?.destroy(),this.#zs=null}static create(e){const t=this.#qs.get(e?.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new Ox(e)}static get workerSrc(){if(nx.workerSrc)return nx.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#Xs(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){return ly(this,"_setupFakeWorkerGlobal",(async()=>{if(this.#Xs)return this.#Xs;return(await import(this.workerSrc)).WorkerMessageHandler})())}}class Fx{#Js=(()=>new Map)();#Zs=(()=>new Map)();#er=(()=>new Map)();#tr=(()=>new Map)();#nr=null;constructor(e,t,n,i,s,r){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new Ix,this.fontLoader=new Sv({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=s.canvasFactory,this.filterFactory=s.filterFactory,this.cMapReaderFactory=s.cMapReaderFactory,this.standardFontDataFactory=s.standardFontDataFactory,this.wasmFactory=s.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=r,this.setupMessageHandler()}#ir(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.#Js.get(e);if(n)return n;const i=this.messageHandler.sendWithPromise(e,t);return this.#Js.set(e,i),i}get annotationStorage(){return ly(this,"annotationStorage",new wv)}getRenderingIntent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Tf.ENABLE,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=xf,a=xv;switch(e){case"any":r=bf;break;case"display":break;case"print":r=wf;break;default:iy(`getRenderingIntent - invalid intent: ${e}`)}const o=r&wf&&n instanceof _v?n:this.annotationStorage;switch(t){case Tf.DISABLE:r+=Cf;break;case Tf.ENABLE:break;case Tf.ENABLE_FORMS:r+=_f;break;case Tf.ENABLE_STORAGE:r+=Sf,a=o.serializable;break;default:iy(`getRenderingIntent - invalid annotationMode: ${t}`)}i&&(r+=Af),s&&(r+=Ef);const{ids:l,hash:c}=o.modifiedIds;return{renderingIntent:r,cacheKey:[r,a.hash,c].join("_"),annotationStorageSerializable:a,modifiedIds:l}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#nr?.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const n of this.#Zs.values())e.push(n._destroy());this.#Zs.clear(),this.#er.clear(),this.#tr.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#Js.clear(),this.filterFactory.destroy(),Dx.cleanup(),this._networkStream?.cancelAllRequests(new gy("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(e,t)=>{ry(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=e=>{this._lastProgress={loaded:e.loaded,total:e.total}},t.onPull=()=>{this._fullReader.read().then(function(e){let{value:n,done:i}=e;i?t.close():(ry(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(n),1,[n]))}).catch(e=>{t.error(e)})},t.onCancel=e=>{this._fullReader.cancel(e),t.ready.catch(e=>{if(!this.destroyed)throw e})}}),e.on("ReaderHeadersReady",async e=>{await this._fullReader.headersReady;const{isStreamingSupported:n,isRangeSupported:i,contentLength:s}=this._fullReader;return n&&i||(this._lastProgress&&t.onProgress?.(this._lastProgress),this._fullReader.onProgress=e=>{t.onProgress?.({loaded:e.loaded,total:e.total})}),{isStreamingSupported:n,isRangeSupported:i,contentLength:s}}),e.on("GetRangeReader",(e,t)=>{ry(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(e.begin,e.end);n?(t.onPull=()=>{n.read().then(function(e){let{value:n,done:i}=e;i?t.close():(ry(n instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(n),1,[n]))}).catch(e=>{t.error(e)})},t.onCancel=e=>{n.cancel(e),t.ready.catch(e=>{if(!this.destroyed)throw e})}):t.close()}),e.on("GetDoc",e=>{let{pdfInfo:n}=e;this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new Lx(n,this))}),e.on("DocException",e=>{t._capability.reject(qv(e))}),e.on("PasswordRequest",e=>{this.#nr=Promise.withResolvers();try{if(!t.onPassword)throw qv(e);const n=e=>{e instanceof Error?this.#nr.reject(e):this.#nr.resolve({password:e})};t.onPassword(n,e.code)}catch(n){this.#nr.reject(n)}return this.#nr.promise}),e.on("DataLoaded",e=>{t.onProgress?.({loaded:e.length,total:e.length}),this.downloadInfoCapability.resolve(e)}),e.on("StartRenderPage",e=>{if(this.destroyed)return;this.#Zs.get(e.pageIndex)._startRenderPage(e.transparency,e.cacheKey)}),e.on("commonobj",t=>{let[n,i,s]=t;if(this.destroyed)return null;if(this.commonObjs.has(n))return null;switch(i){case"Font":if("error"in s){const e=s.error;iy(`Error during font loading: ${e}`),this.commonObjs.resolve(n,e);break}const t=new Tv(s),r=this._params.pdfBug&&globalThis.FontInspector?.enabled?(e,t)=>globalThis.FontInspector.fontAdded(e,t):null,a=new Cv(t,r,s.extra,s.charProcOperatorList);this.fontLoader.bind(a).catch(()=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!a.fontExtraProperties&&a.data&&a.clearData(),this.commonObjs.resolve(n,a)});break;case"CopyLocalImage":const{imageRef:o}=s;ry(o,"The imageRef must be defined.");for(const e of this.#Zs.values())for(const[,t]of e.objs)if(t?.ref===o)return t.dataLen?(this.commonObjs.resolve(n,structuredClone(t)),t.dataLen):null;break;case"FontPath":this.commonObjs.resolve(n,new Nv(s));break;case"Image":this.commonObjs.resolve(n,s);break;case"Pattern":const l=new kv(s);this.commonObjs.resolve(n,l.getIR());break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),e.on("obj",e=>{let[t,n,i,s]=e;if(this.destroyed)return;const r=this.#Zs.get(n);if(!r.objs.has(t))if(0!==r._intentStates.size)switch(i){case"Image":case"Pattern":r.objs.resolve(t,s);break;default:throw new Error(`Got unknown object type ${i}`)}else s?.bitmap?.close()}),e.on("DocProgress",e=>{this.destroyed||t.onProgress?.({loaded:e.loaded,total:e.total})}),e.on("FetchBinaryData",async e=>{if(this.destroyed)throw new Error("Worker was destroyed.");const t=this[e.type];if(!t)throw new Error(`${e.type} not initialized, see the \`useWorkerFetch\` parameter.`);return t.fetch(e)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&iy("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this._fullReader?.filename??null},t).finally(()=>{this.annotationStorage.resetModified()})}extractPages(e){return this.messageHandler.sendWithPromise("ExtractPages",{pageInfos:e})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,n=this.#er.get(t);if(n)return n;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&this.#tr.set(n.refStr,e);const i=new jx(t,n,this,this._params.pdfBug);return this.#Zs.set(t,i),i});return this.#er.set(t,i),i}getPageIndex(e){return Dv(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return this.#ir("GetFieldObjects")}hasJSActions(){return this.#ir("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return"string"!==typeof e?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(e,t){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:e,pageIndexesToSkip:t})}getDocJSActions(){return this.#ir("GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return this.#ir("GetOptionalContentConfig").then(t=>new ax(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=this.#Js.get(e);if(t)return t;const n=this.messageHandler.sendWithPromise(e,null).then(e=>({info:e[0],metadata:e[1]?new ix(e[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null,hasStructTree:e[2]}));return this.#Js.set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#Zs.values()){if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`)}this.commonObjs.clear(),e||this.fontLoader.clear(),this.#Js.clear(),this.filterFactory.destroy(!0),Dx.cleanup()}}cachedPageNumber(e){if(!Dv(e))return null;const t=0===e.gen?`${e.num}R`:`${e.num}R${e.gen}`;return this.#tr.get(t)??null}}class Bx{#sr=null;onContinue=null;onError=null;constructor(e){this.#sr=e}get promise(){return this.#sr.capability.promise}cancel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.#sr.cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=this.#sr.operatorList;if(!e)return!1;const{annotationCanvasMap:t}=this.#sr;return e.form||e.canvas&&t?.size>0}}class Ux{#rr=null;static#ar=(()=>new WeakSet)();constructor(e){let{callback:t,params:n,objs:i,commonObjs:s,annotationCanvasMap:r,operatorList:a,pageIndex:o,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:d=!1,pdfBug:u=!1,pageColors:h=null,enableHWA:p=!1,operationsFilter:m=null}=e;this.callback=t,this.params=n,this.objs=i,this.commonObjs=s,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=u,this.pageColors=h,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===d&&"undefined"!==typeof window,this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Bx(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=n.canvas,this._canvasContext=n.canvas?null:n.canvasContext,this._enableHWA=p,this._dependencyTracker=n.dependencyTracker,this._operationsFilter=m}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics(e){let{transparency:t=!1,optionalContentConfig:n}=e;if(this.cancelled)return;if(this._canvas){if(Ux.#ar.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Ux.#ar.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:i,transform:s,background:r,dependencyTracker:a}=this.params,o=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new tx(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:n},this.annotationCanvasMap,this.pageColors,a),this.gfx.beginDrawing({transform:s,viewport:i,transparency:t,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#rr&&(window.cancelAnimationFrame(this.#rr),this.#rr=null),Ux.#ar.delete(this._canvas),e||=new My(`Rendering cancelled, page ${this._pageIndex+1}`,t),this.callback(e),this.task.onError?.(e)}operatorListChanged(){this.graphicsReady?(this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||=this._continueBound}_continue(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#rr=window.requestAnimationFrame(()=>{this.#rr=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Ux.#ar.delete(this._canvas),this.callback())))}}const zx="5.4.530";class Vx{#or=null;#lr=null;#cr;#dr=null;#ur=!1;#hr=!1;#r=null;#pr;#mr=null;#y=null;static#gr=null;static get _keyboardManager(){return ly(this,"_keyboardManager",new lv([[["Escape","mac+Escape"],Vx.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Vx.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Vx.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Vx.prototype._moveToPrevious],[["Home","mac+Home"],Vx.prototype._moveToBeginning],[["End","mac+End"],Vx.prototype._moveToEnd]]))}constructor(e){let{editor:t=null,uiManager:n=null}=e;t?(this.#hr=!1,this.#r=t):this.#hr=!0,this.#y=t?._uiManager||n,this.#pr=this.#y._eventBus,this.#cr=t?.color?.toUpperCase()||this.#y?.highlightColors.values().next().value||"#FFFF98",Vx.#gr||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const e=this.#or=document.createElement("button");e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",this.#r&&(e.ariaControls=`${this.#r.id}_colorpicker_dropdown`);const t=this.#y._signal;e.addEventListener("click",this.#fr.bind(this),{signal:t}),e.addEventListener("keydown",this.#yr.bind(this),{signal:t});const n=this.#lr=document.createElement("span");return n.className="swatch",n.ariaHidden="true",n.style.backgroundColor=this.#cr,e.append(n),e}renderMainDropdown(){const e=this.#dr=this.#vr();return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}#vr(){const e=document.createElement("div"),t=this.#y._signal;e.addEventListener("contextmenu",Fy,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#r&&(e.id=`${this.#r.id}_colorpicker_dropdown`);for(const[n,i]of this.#y.highlightColors){const s=document.createElement("button");s.tabIndex="0",s.role="option",s.setAttribute("data-color",i),s.title=n,s.setAttribute("data-l10n-id",Vx.#gr[n]);const r=document.createElement("span");s.append(r),r.className="swatch",r.style.backgroundColor=i,s.ariaSelected=i===this.#cr,s.addEventListener("click",this.#br.bind(this,i),{signal:t}),e.append(s)}return e.addEventListener("keydown",this.#yr.bind(this),{signal:t}),e}#br(e,t){t.stopPropagation(),this.#pr.dispatch("switchannotationeditorparams",{source:this,type:If.HIGHLIGHT_COLOR,value:e}),this.updateColor(e)}_colorSelectFromKeyboard(e){if(e.target===this.#or)return void this.#fr(e);const t=e.target.getAttribute("data-color");t&&this.#br(t,e)}_moveToNext(e){this.#xr?e.target!==this.#or?e.target.nextSibling?.focus():this.#dr.firstElementChild?.focus():this.#fr(e)}_moveToPrevious(e){e.target!==this.#dr?.firstElementChild&&e.target!==this.#or?(this.#xr||this.#fr(e),e.target.previousSibling?.focus()):this.#xr&&this._hideDropdownFromKeyboard()}_moveToBeginning(e){this.#xr?this.#dr.firstElementChild?.focus():this.#fr(e)}_moveToEnd(e){this.#xr?this.#dr.lastElementChild?.focus():this.#fr(e)}#yr(e){Vx._keyboardManager.exec(this,e)}#fr(e){if(this.#xr)return void this.hideDropdown();if(this.#ur=0===e.detail,this.#mr||(this.#mr=new AbortController,window.addEventListener("pointerdown",this.#h.bind(this),{signal:this.#y.combinedSignal(this.#mr)})),this.#or.ariaExpanded="true",this.#dr)return void this.#dr.classList.remove("hidden");const t=this.#dr=this.#vr();this.#or.append(t)}#h(e){this.#dr?.contains(e.target)||this.hideDropdown()}hideDropdown(){this.#dr?.classList.add("hidden"),this.#or.ariaExpanded="false",this.#mr?.abort(),this.#mr=null}get#xr(){return this.#dr&&!this.#dr.classList.contains("hidden")}_hideDropdownFromKeyboard(){this.#hr||(this.#xr?(this.hideDropdown(),this.#or.focus({preventScroll:!0,focusVisible:this.#ur})):this.#r?.unselect())}updateColor(e){if(this.#lr&&(this.#lr.style.backgroundColor=e),!this.#dr)return;const t=this.#y.highlightColors.values();for(const n of this.#dr.children)n.ariaSelected=t.next().value===e.toUpperCase()}destroy(){this.#or?.remove(),this.#or=null,this.#lr=null,this.#dr?.remove(),this.#dr=null}}class Hx{#wr=null;#r=null;#y=null;static#gr=null;constructor(e){this.#r=e,this.#y=e._uiManager,Hx.#gr||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#wr)return this.#wr;const{editorType:e,colorType:t,color:n}=this.#r,i=this.#wr=document.createElement("input");return i.type="color",i.value=n||"#000000",i.className="basicColorPicker",i.tabIndex=0,i.setAttribute("data-l10n-id",Hx.#gr[e]),i.addEventListener("input",()=>{this.#y.updateParams(t,i.value)},{signal:this.#y._signal}),i}update(e){this.#wr&&(this.#wr.value=e)}destroy(){this.#wr?.remove(),this.#wr=null}hideDropdown(){}}function $x(e){return Math.floor(255*Math.max(0,Math.min(1,e))).toString(16).padStart(2,"0")}function qx(e){return Math.max(0,Math.min(255,255*e))}class Gx{static CMYK_G(e){let[t,n,i,s]=e;return["G",1-Math.min(1,.3*t+.59*i+.11*n+s)]}static G_CMYK(e){let[t]=e;return["CMYK",0,0,0,1-t]}static G_RGB(e){let[t]=e;return["RGB",t,t,t]}static G_rgb(e){let[t]=e;return t=qx(t),[t,t,t]}static G_HTML(e){let[t]=e;const n=$x(t);return`#${n}${n}${n}`}static RGB_G(e){let[t,n,i]=e;return["G",.3*t+.59*n+.11*i]}static RGB_rgb(e){return e.map(qx)}static RGB_HTML(e){return`#${e.map($x).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB(e){let[t,n,i,s]=e;return["RGB",1-Math.min(1,t+s),1-Math.min(1,i+s),1-Math.min(1,n+s)]}static CMYK_rgb(e){let[t,n,i,s]=e;return[qx(1-Math.min(1,t+s)),qx(1-Math.min(1,i+s)),qx(1-Math.min(1,n+s))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK(e){let[t,n,i]=e;const s=1-t,r=1-n,a=1-i;return["CMYK",s,r,a,Math.min(s,r,a)]}}class Wx{create(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),n||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if("string"!==typeof e)throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){sy("Abstract method `_createSVG` called.")}}class Kx extends Wx{_createSVG(e){return document.createElementNS(Ny,e)}}const Qx=new WeakSet,Xx=60*(new Date).getTimezoneOffset()*1e3;class Yx{static create(e){switch(e.data.annotationType){case Uf.LINK:return new ew(e);case Uf.TEXT:return new tw(e);case Uf.WIDGET:switch(e.data.fieldType){case"Tx":return new iw(e);case"Btn":return e.data.radioButton?new aw(e):e.data.checkBox?new rw(e):new ow(e);case"Ch":return new lw(e);case"Sig":return new sw(e)}return new nw(e);case Uf.POPUP:return new cw(e);case Uf.FREETEXT:return new uw(e);case Uf.LINE:return new hw(e);case Uf.SQUARE:return new pw(e);case Uf.CIRCLE:return new mw(e);case Uf.POLYLINE:return new gw(e);case Uf.CARET:return new yw(e);case Uf.INK:return new vw(e);case Uf.POLYGON:return new fw(e);case Uf.HIGHLIGHT:return new bw(e);case Uf.UNDERLINE:return new xw(e);case Uf.SQUIGGLY:return new ww(e);case Uf.STRIKEOUT:return new _w(e);case Uf.STAMP:return new Sw(e);case Uf.FILEATTACHMENT:return new Cw(e);default:return new Jx(e)}}}class Jx{#_r=null;#Sr=!1;#Cr=null;constructor(e){let{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:i=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableComment=e.enableComment,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,this.hasOwnCommentButton=!1,t&&(this.contentElement=this.container=this._createContainer(n)),i&&this._createQuadrilaterals()}static _hasPopupData(e){let{contentsObj:t,richText:n}=e;return!(!t?.str&&!n?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Jx._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:e}=this,t=this.annotationStorage?.getEditor(e.id);return t?t.getData():e}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const e=this.annotationStorage?.getEditor(this.data.id);if(e)return e.commentButtonPositionInPage;const{quadPoints:t,inkLists:n,rect:i}=this.data;let s=-1/0,r=-1/0;if(t?.length>=8){for(let e=0;e<t.length;e+=8)t[e+1]>r?(r=t[e+1],s=t[e+2]):t[e+1]===r&&(s=Math.max(s,t[e+2]));return[s,r]}if(n?.length>=1){for(const e of n)for(let t=0,n=e.length;t<n;t+=2)e[t+1]>r?(r=e[t+1],s=e[t]):e[t+1]===r&&(s=Math.max(s,e[t]));if(s!==1/0)return[s,r]}return i?[i[2],i[3]]:null}_normalizePoint(e){const{page:{view:t},viewport:{rawDims:{pageWidth:n,pageHeight:i,pageX:s,pageY:r}}}=this.parent;return e[1]=t[3]-e[1]+t[1],e[0]=100*(e[0]-s)/n,e[1]=100*(e[1]-r)/i,e}get commentText(){const{data:e}=this;return this.annotationStorage.getRawValue(`${kf}${e.id}`)?.popup?.contents||e.contentsObj?.str||""}set commentText(e){const{data:t}=this,n={deleted:!e,contents:e||""};this.annotationStorage.updateEditor(t.id,{popup:n})||this.annotationStorage.setValue(`${kf}${t.id}`,{id:t.id,annotationType:t.annotationType,pageIndex:this.parent.page._pageIndex,popup:n,popupRef:t.popupRef,modificationDate:new Date}),e||this.removePopup()}removePopup(){(this.#Cr?.popup||this.popup)?.remove(),this.#Cr=this.popup=null}updateEdited(e){if(!this.container)return;e.rect&&(this.#_r||={rect:this.data.rect.slice(0)});const{rect:t,popup:n}=e;t&&this.#Ar(t);let i=this.#Cr?.popup||this.popup;!i&&n?.text&&(this._createPopup(n),i=this.#Cr.popup),i&&(i.updateEdited(e),n?.deleted&&(i.remove(),this.#Cr=null,this.popup=null))}resetEdited(){this.#_r&&(this.#Ar(this.#_r.rect),this.#Cr?.popup.resetEdited(),this.#_r=null)}#Ar(e){const{container:{style:t},data:{rect:n,rotation:i},parent:{viewport:{rawDims:{pageWidth:s,pageHeight:r,pageX:a,pageY:o}}}}=this;n?.splice(0,4,...e),t.left=100*(e[0]-a)/s+"%",t.top=100*(r-e[3]+o)/r+"%",0===i?(t.width=100*(e[2]-e[0])/s+"%",t.height=100*(e[3]-e[1])/r+"%"):this.setRotation(i)}_createContainer(e){const{data:t,parent:{page:n,viewport:i}}=this,s=document.createElement("section");s.setAttribute("data-annotation-id",t.id),this instanceof nw||this instanceof ew||(s.tabIndex=0);const{style:r}=s;if(r.zIndex=this.parent.zIndex,this.parent.zIndex+=2,t.alternativeText&&(s.title=t.alternativeText),t.noRotate&&s.classList.add("norotate"),!t.rect||this instanceof cw){const{rotation:e}=t;return t.hasOwnCanvas||0===e||this.setRotation(e,s),s}const{width:a,height:o}=this;if(!e&&t.borderStyle.width>0){r.borderWidth=`${t.borderStyle.width}px`;const e=t.borderStyle.horizontalCornerRadius,n=t.borderStyle.verticalCornerRadius;if(e>0||n>0){const t=`calc(${e}px * var(--total-scale-factor)) / calc(${n}px * var(--total-scale-factor))`;r.borderRadius=t}else if(this instanceof aw){const e=`calc(${a}px * var(--total-scale-factor)) / calc(${o}px * var(--total-scale-factor))`;r.borderRadius=e}switch(t.borderStyle.style){case zf:r.borderStyle="solid";break;case Vf:r.borderStyle="dashed";break;case Hf:iy("Unimplemented border style: beveled");break;case $f:iy("Unimplemented border style: inset");break;case qf:r.borderBottomStyle="solid"}const i=t.borderColor||null;i?(this.#Sr=!0,r.borderColor=xy.makeHexColor(0|i[0],0|i[1],0|i[2])):r.borderWidth=0}const l=xy.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:c,pageHeight:d,pageX:u,pageY:h}=i.rawDims;r.left=100*(l[0]-u)/c+"%",r.top=100*(l[1]-h)/d+"%";const{rotation:p}=t;return t.hasOwnCanvas||0===p?(r.width=100*a/c+"%",r.height=100*o/d+"%"):this.setRotation(p,s),s}setRotation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.container;if(!this.data.rect)return;const{pageWidth:n,pageHeight:i}=this.parent.viewport.rawDims;let{width:s,height:r}=this;e%180!==0&&([s,r]=[r,s]),t.style.width=100*s/n+"%",t.style.height=100*r/i+"%",t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(e,t,n)=>{const i=n.detail[e],s=i[0],r=i.slice(1);n.target.style[t]=Gx[`${s}_HTML`](r),this.annotationStorage.setValue(this.data.id,{[t]:Gx[`${s}_rgb`](r)})};return ly(this,"_commonActions",{display:e=>{const{display:t}=e.detail,n=t%2===1;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:n,noPrint:1===t||2===t})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:t}=e.detail;this.container.style.visibility=t?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:t,noView:t})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:e=>{const t=e.detail.rotation;this.setRotation(t),this.annotationStorage.setValue(this.data.id,{rotation:t})}})}_dispatchEventFromSandbox(e,t){const n=this._commonActions;for(const i of Object.keys(t.detail)){const s=e[i]||n[i];s?.(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const n=this._commonActions;for(const[i,s]of Object.entries(t)){const r=n[i];if(r){r({detail:{[i]:s},target:e}),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,n,i,s]=this.data.rect.map(e=>Math.fround(e));if(8===e.length){const[r,a,o,l]=e.subarray(2,6);if(i===r&&s===a&&t===o&&n===l)return}const{style:r}=this.container;let a;if(this.#Sr){const{borderColor:e,borderWidth:t}=r;r.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${e}" stroke-width="${t}">`],this.container.classList.add("hasBorder")}const o=i-t,l=s-n,{svgFactory:c}=this,d=c.createElement("svg");d.classList.add("quadrilateralsContainer"),d.setAttribute("width",0),d.setAttribute("height",0),d.role="none";const u=c.createElement("defs");d.append(u);const h=c.createElement("clipPath"),p=`clippath_${this.data.id}`;h.setAttribute("id",p),h.setAttribute("clipPathUnits","objectBoundingBox"),u.append(h);for(let m=2,g=e.length;m<g;m+=8){const n=e[m],i=e[m+1],r=e[m+2],d=e[m+3],u=c.createElement("rect"),p=(r-t)/o,g=(s-i)/l,f=(n-r)/o,y=(i-d)/l;u.setAttribute("x",p),u.setAttribute("y",g),u.setAttribute("width",f),u.setAttribute("height",y),h.append(u),a?.push(`<rect vector-effect="non-scaling-stroke" x="${p}" y="${g}" width="${f}" height="${y}"/>`)}this.#Sr&&(a.push("</g></svg>')"),r.backgroundImage=a.join("")),this.container.append(d),this.container.style.clipPath=`url(#${p})`}_createPopup(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const{data:t}=this;let n,i;e?(n={str:e.text},i=e.date):(n=t.contentsObj,i=t.modificationDate),this.#Cr=new cw({data:{color:t.color,titleObj:t.titleObj,modificationDate:i,contentsObj:n,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]})}get hasPopupElement(){return!!(this.#Cr||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#Cr}render(){sy("Abstract method `AnnotationElement.render` called")}_getElementsByName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=[];if(this._fieldObjects){const i=this._fieldObjects[e];if(i)for(const{page:e,id:s,exportValues:r}of i){if(-1===e)continue;if(s===t)continue;const i="string"===typeof r?r:null,a=document.querySelector(`[data-element-id="${s}"]`);!a||Qx.has(a)?n.push({id:s,exportValue:i,domElement:a}):iy(`_getElementsByName - element not allowed: ${s}`)}return n}for(const i of document.getElementsByName(e)){const{exportValue:e}=i,s=i.getAttribute("data-element-id");s!==t&&(Qx.has(i)&&n.push({id:s,exportValue:e,domElement:i}))}return n}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class Zx extends Jx{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.editor=e.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:e}=this;e.hasComment&&this._createPopup(e.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(e){this.editor.comment=e,e||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}class ew extends Jx{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:t}=this,n=document.createElement("a");n.setAttribute("data-element-id",e.id);let i=!1;return e.url?(t.addLinkAttributes(n,e.url,e.newWindow),i=!0):e.action?(this._bindNamedAction(n,e.action,e.overlaidText),i=!0):e.attachment?(this.#Er(n,e.attachment,e.overlaidText,e.attachmentDest),i=!0):e.setOCGState?(this.#Tr(n,e.setOCGState,e.overlaidText),i=!0):e.dest?(this._bindLink(n,e.dest,e.overlaidText),i=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,e),i=!0),e.resetForm?(this._bindResetFormAction(n,e.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(n,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&(this.contentElement=n,this.container.append(n)),this.container}#kr(){this.container.setAttribute("data-internal-link","")}_bindLink(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||""===t)&&this.#kr(),n&&(e.title=n)}_bindNamedAction(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),n&&(e.title=n),this.#kr()}#Er(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e.href=this.linkService.getAnchorUrl(""),t.description?e.title=t.description:n&&(e.title=n),e.onclick=()=>(this.downloadManager?.openOrDownloadData(t.content,t.filename,i),!1),this.#kr()}#Tr(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),n&&(e.title=n),this.#kr()}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");const n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(t.actions)){const s=n.get(i);s&&(e[s]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:i}}),!1))}t.overlaidText&&(e.title=t.overlaidText),e.onclick||(e.onclick=()=>!1),this.#kr()}_bindResetFormAction(e,t){const n=e.onclick;if(n||(e.href=this.linkService.getAnchorUrl("")),this.#kr(),!this._fieldObjects)return iy('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),void(n||(e.onclick=()=>!1));e.onclick=()=>{n?.();const{fields:e,refs:i,include:s}=t,r=[];if(0!==e.length||0!==i.length){const t=new Set(i);for(const n of e){const e=this._fieldObjects[n]||[];for(const{id:n}of e)t.add(n)}for(const e of Object.values(this._fieldObjects))for(const n of e)t.has(n.id)===s&&r.push(n)}else for(const t of Object.values(this._fieldObjects))r.push(...t);const a=this.annotationStorage,o=[];for(const t of r){const{id:e}=t;switch(o.push(e),t.type){case"text":{const n=t.defaultValue||"";a.setValue(e,{value:n});break}case"checkbox":case"radiobutton":{const n=t.defaultValue===t.exportValues;a.setValue(e,{value:n});break}case"combobox":case"listbox":{const n=t.defaultValue||"";a.setValue(e,{value:n});break}default:continue}const n=document.querySelector(`[data-element-id="${e}"]`);n&&(Qx.has(n)?n.dispatchEvent(new Event("resetform")):iy(`_bindResetFormAction - element not allowed: ${e}`))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:o,name:"ResetForm"}}),!1}}}class tw extends Jx{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(e),this.container}}class nw extends Jx{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&("CANVAS"===e.previousSibling?.nodeName&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return vy.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,i,s){n.includes("mouse")?e.addEventListener(n,e=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:s(e),shift:e.shiftKey,modifier:this._getKeyModifier(e)}})}):e.addEventListener(n,e=>{if("blur"===n){if(!t.focused||!e.relatedTarget)return;t.focused=!1}else if("focus"===n){if(t.focused)return;t.focused=!0}s&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:s(e)}})})}_setEventListeners(e,t,n,i){for(const[s,r]of n)("Action"===r||this.data.actions?.[r])&&("Focus"!==r&&"Blur"!==r||(t||={focused:!1}),this._setEventListener(e,t,s,r,i),"Focus"!==r||this.data.actions?.Blur?"Blur"!==r||this.data.actions?.Focus||this._setEventListener(e,t,"focus","Focus",null):this._setEventListener(e,t,"blur","Blur",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=null===t?"transparent":xy.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||9,s=e.style;let r;const a=e=>Math.round(10*e)/10;if(this.data.multiLine){const e=Math.abs(this.data.rect[3]-this.data.rect[1]-2),t=e/(Math.round(e/(vf*i))||1);r=Math.min(i,a(t/vf))}else{const e=Math.abs(this.data.rect[3]-this.data.rect[1]-2);r=Math.min(i,a(e/vf))}s.fontSize=`calc(${r}px * var(--total-scale-factor))`,s.color=xy.makeHexColor(n[0],n[1],n[2]),null!==this.data.textAlignment&&(s.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class iw extends nw{constructor(e){super(e,{isRenderable:e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue})}setPropertyOnSiblings(e,t,n,i){const s=this.annotationStorage;for(const r of this._getElementsByName(e.name,e.id))r.domElement&&(r.domElement[t]=n),s.setValue(r.id,{[i]:n})}render(){const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const i=e.getValue(t,{value:this.data.fieldValue});let s=i.value||"";const r=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;r&&s.length>r&&(s=s.slice(0,r));let a=i.formattedValue||this.data.textContent?.join("\n")||null;a&&this.data.comb&&(a=a.replaceAll(/\s+/g,""));const o={userValue:s,formattedValue:a,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=a??s,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type=this.data.password?"password":"text",n.setAttribute("value",a??s),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),Qx.add(n),this.contentElement=n,n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;const{datetimeFormat:l,datetimeType:c,timeStep:d}=this.data,u=!!c&&this.enableScripting;l&&(n.title=l),this._setRequired(n,this.data.required),r&&(n.maxLength=r),n.addEventListener("input",i=>{e.setValue(t,{value:i.target.value}),this.setPropertyOnSiblings(n,"value",i.target.value,"value"),o.formattedValue=null}),n.addEventListener("resetform",e=>{const t=this.data.defaultFieldValue??"";n.value=o.userValue=t,o.formattedValue=null});let h=e=>{const{formattedValue:t}=o;null!==t&&void 0!==t&&(e.target.value=t),e.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",e=>{if(o.focused)return;const{target:t}=e;if(u&&(t.type=c,d&&(t.step=d)),o.userValue){const e=o.userValue;if(u)if("time"===c){const n=new Date(e),i=[n.getHours(),n.getMinutes(),n.getSeconds()];t.value=i.map(e=>e.toString().padStart(2,"0")).join(":")}else t.value=new Date(e-Xx).toISOString().split("date"===c?"T":".",1)[0];else t.value=e}o.lastCommittedValue=t.value,o.commitKey=1,this.data.actions?.Focus||(o.focused=!0)}),n.addEventListener("updatefromsandbox",n=>{this.showElementAndHideCanvas(n.target);const i={value(n){o.userValue=n.detail.value??"",u||e.setValue(t,{value:o.userValue.toString()}),n.target.value=o.userValue},formattedValue(n){const{formattedValue:i}=n.detail;o.formattedValue=i,null!==i&&void 0!==i&&n.target!==document.activeElement&&(n.target.value=i);const s={formattedValue:i};u&&(s.value=i),e.setValue(t,s)},selRange(e){e.target.setSelectionRange(...e.detail.selRange)},charLimit:n=>{const{charLimit:i}=n.detail,{target:s}=n;if(0===i)return void s.removeAttribute("maxLength");s.setAttribute("maxLength",i);let r=o.userValue;!r||r.length<=i||(r=r.slice(0,i),s.value=o.userValue=r,e.setValue(t,{value:r}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:r,willCommit:!0,commitKey:1,selStart:s.selectionStart,selEnd:s.selectionEnd}}))}};this._dispatchEventFromSandbox(i,n)}),n.addEventListener("keydown",e=>{o.commitKey=1;let n=-1;if("Escape"===e.key?n=0:"Enter"!==e.key||this.data.multiLine?"Tab"===e.key&&(o.commitKey=3):n=2,-1===n)return;const{value:i}=e.target;o.lastCommittedValue!==i&&(o.lastCommittedValue=i,o.userValue=i,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:i,willCommit:!0,commitKey:n,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}))});const i=h;h=null,n.addEventListener("blur",e=>{if(!o.focused||!e.relatedTarget)return;this.data.actions?.Blur||(o.focused=!1);const{target:n}=e;let{value:s}=n;if(u){if(s&&"time"===c){const e=s.split(":").map(e=>parseInt(e,10));s=new Date(2e3,0,1,e[0],e[1],e[2]||0).valueOf(),n.step=""}else s.includes("T")||(s=`${s}T00:00`),s=new Date(s).valueOf();n.type="text"}o.userValue=s,o.lastCommittedValue!==s&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:s,willCommit:!0,commitKey:o.commitKey,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}),i(e)}),this.data.actions?.Keystroke&&n.addEventListener("beforeinput",e=>{o.lastCommittedValue=null;const{data:n,target:i}=e,{value:s,selectionStart:r,selectionEnd:a}=i;let l=r,c=a;switch(e.inputType){case"deleteWordBackward":{const e=s.substring(0,r).match(/\w*[^\w]*$/);e&&(l-=e[0].length);break}case"deleteWordForward":{const e=s.substring(r).match(/^[^\w]*\w*/);e&&(c+=e[0].length);break}case"deleteContentBackward":r===a&&(l-=1);break;case"deleteContentForward":r===a&&(c+=1)}e.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:s,change:n||"",willCommit:!1,selStart:l,selEnd:c}})}),this._setEventListeners(n,o,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],e=>e.target.value)}if(h&&n.addEventListener("blur",h),this.data.comb){const e=(this.data.rect[2]-this.data.rect[0])/r;n.classList.add("comb"),n.style.letterSpacing=`calc(${e}px * var(--total-scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class sw extends nw{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class rw extends nw{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,n=t.id;let i=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;"string"===typeof i&&(i="Off"!==i,e.setValue(n,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const s=document.createElement("input");return Qx.add(s),s.setAttribute("data-element-id",n),s.disabled=t.readOnly,this._setRequired(s,this.data.required),s.type="checkbox",s.name=t.fieldName,i&&s.setAttribute("checked",!0),s.setAttribute("exportValue",t.exportValue),s.tabIndex=0,s.addEventListener("change",i=>{const{name:s,checked:r}=i.target;for(const a of this._getElementsByName(s,n)){const n=r&&a.exportValue===t.exportValue;a.domElement&&(a.domElement.checked=n),e.setValue(a.id,{value:n})}e.setValue(n,{value:r})}),s.addEventListener("resetform",e=>{const n=t.defaultFieldValue||"Off";e.target.checked=n===t.exportValue}),this.enableScripting&&this.hasJSActions&&(s.addEventListener("updatefromsandbox",t=>{const i={value(t){t.target.checked="Off"!==t.detail.value,e.setValue(n,{value:t.target.checked})}};this._dispatchEventFromSandbox(i,t)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],e=>e.target.checked)),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class aw extends nw{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,n=t.id;let i=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if("string"===typeof i&&(i=i!==t.buttonValue,e.setValue(n,{value:i})),i)for(const r of this._getElementsByName(t.fieldName,n))e.setValue(r.id,{value:!1});const s=document.createElement("input");if(Qx.add(s),s.setAttribute("data-element-id",n),s.disabled=t.readOnly,this._setRequired(s,this.data.required),s.type="radio",s.name=t.fieldName,i&&s.setAttribute("checked",!0),s.tabIndex=0,s.addEventListener("change",t=>{const{name:i,checked:s}=t.target;for(const r of this._getElementsByName(i,n))e.setValue(r.id,{value:!1});e.setValue(n,{value:s})}),s.addEventListener("resetform",e=>{const n=t.defaultFieldValue;e.target.checked=null!==n&&void 0!==n&&n===t.buttonValue}),this.enableScripting&&this.hasJSActions){const i=t.buttonValue;s.addEventListener("updatefromsandbox",t=>{const s={value:t=>{const s=i===t.detail.value;for(const i of this._getElementsByName(t.target.name)){const t=s&&i.id===n;i.domElement&&(i.domElement.checked=t),e.setValue(i.id,{value:t})}}};this._dispatchEventFromSandbox(s,t)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],e=>e.target.checked)}return this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class ow extends ew{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",e=>{this._dispatchEventFromSandbox({},e)})),e}}class lw extends nw{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");Qx.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=0;let s=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",e=>{const t=this.data.defaultFieldValue;for(const n of i.options)n.selected=n.value===t});for(const c of this.data.options){const e=document.createElement("option");e.textContent=c.displayValue,e.value=c.exportValue,n.value.includes(c.exportValue)&&(e.setAttribute("selected",!0),s=!1),i.append(e)}let r=null;if(s){const e=document.createElement("option");e.value=" ",e.setAttribute("hidden",!0),e.setAttribute("selected",!0),i.prepend(e),r=()=>{e.remove(),i.removeEventListener("input",r),r=null},i.addEventListener("input",r)}const a=e=>{const t=e?"value":"textContent",{options:n,multiple:s}=i;return s?Array.prototype.filter.call(n,e=>e.selected).map(e=>e[t]):-1===n.selectedIndex?null:n[n.selectedIndex][t]};let o=a(!1);const l=e=>{const t=e.target.options;return Array.prototype.map.call(t,e=>({displayValue:e.textContent,exportValue:e.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",n=>{const s={value(n){r?.();const s=n.detail.value,l=new Set(Array.isArray(s)?s:[s]);for(const e of i.options)e.selected=l.has(e.value);e.setValue(t,{value:a(!0)}),o=a(!1)},multipleSelection(e){i.multiple=!0},remove(n){const s=i.options,r=n.detail.remove;if(s[r].selected=!1,i.remove(r),s.length>0){-1===Array.prototype.findIndex.call(s,e=>e.selected)&&(s[0].selected=!0)}e.setValue(t,{value:a(!0),items:l(n)}),o=a(!1)},clear(n){for(;0!==i.length;)i.remove(0);e.setValue(t,{value:null,items:[]}),o=a(!1)},insert(n){const{index:s,displayValue:r,exportValue:c}=n.detail.insert,d=i.children[s],u=document.createElement("option");u.textContent=r,u.value=c,d?d.before(u):i.append(u),e.setValue(t,{value:a(!0),items:l(n)}),o=a(!1)},items(n){const{items:s}=n.detail;for(;0!==i.length;)i.remove(0);for(const e of s){const{displayValue:t,exportValue:n}=e,s=document.createElement("option");s.textContent=t,s.value=n,i.append(s)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:a(!0),items:l(n)}),o=a(!1)},indices(n){const i=new Set(n.detail.indices);for(const e of n.target.options)e.selected=i.has(e.index);e.setValue(t,{value:a(!0)}),o=a(!1)},editable(e){e.target.disabled=!e.detail.editable}};this._dispatchEventFromSandbox(s,n)}),i.addEventListener("input",n=>{const i=a(!0),s=a(!1);e.setValue(t,{value:i}),n.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:o,change:s,changeEx:i,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],e=>e.target.value)):i.addEventListener("input",function(n){e.setValue(t,{value:a(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class cw extends Jx{constructor(e){const{data:t,elements:n,parent:i}=e,s=!!i._commentManager;if(super(e,{isRenderable:!s&&Jx._hasPopupData(t)}),this.elements=n,s&&Jx._hasPopupData(t)){const e=this.popup=this.#Nr();for(const t of n)t.popup=e}else this.popup=null}#Nr(){return new dw({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:e}=this;e.classList.add("popupAnnotation"),e.role="comment";const t=this.popup=this.#Nr(),n=[];for(const i of this.elements)i.popup=t,i.container.ariaHasPopup="dialog",n.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",n.map(e=>`${Cy}${e}`).join(",")),this.container}}class dw{#H=null;#Ir=this.#yr.bind(this);#Dr=this.#Pr.bind(this);#Mr=this.#Rr.bind(this);#Lr=this.#jr.bind(this);#Or=null;#Ae=null;#Fr=null;#Br=null;#Ur=null;#zr=null;#Vr=null;#Hr=!1;#$r=null;#qr=null;#P=null;#Gr=null;#Wr=null;#yt=null;#Kr=null;#pt=null;#Qr=null;#_r=null;#Xr=!1;#Yr=null;#Jr=null;constructor(e){let{container:t,color:n,elements:i,titleObj:s,modificationDate:r,contentsObj:a,richText:o,parent:l,rect:c,parentRect:d,open:u,commentManager:h=null}=e;this.#Ae=t,this.#Qr=s,this.#Fr=a,this.#pt=o,this.#zr=l,this.#Or=n,this.#Kr=c,this.#Vr=d,this.#Ur=i,this.#H=h,this.#Yr=i[0],this.#Br=Uy.toDateObject(r),this.trigger=i.flatMap(e=>e.getElementsToTriggerPopup()),h||(this.#Zr(),this.#Ae.hidden=!0,u&&this.#jr())}#Zr(){if(this.#qr)return;this.#qr=new AbortController;const{signal:e}=this.#qr;for(const t of this.trigger)t.addEventListener("click",this.#Lr,{signal:e}),t.addEventListener("pointerenter",this.#Mr,{signal:e}),t.addEventListener("pointerleave",this.#Dr,{signal:e}),t.classList.add("popupTriggerArea");for(const t of this.#Ur)t.container?.addEventListener("keydown",this.#Ir,{signal:e})}#ea(){const e=this.#Ur.find(e=>e.hasCommentButton);e&&(this.#Wr=e._normalizePoint(e.commentButtonPosition))}renderCommentButton(){if(this.#Gr)return void(this.#Gr.parentNode||this.#Yr.container.after(this.#Gr));if(this.#Wr||this.#ea(),!this.#Wr)return;const{signal:e}=this.#qr=new AbortController,t=this.#Yr.hasOwnCommentButton,n=()=>{this.#H.toggleCommentPopup(this,!0,void 0,!t)},i=()=>{this.#H.toggleCommentPopup(this,!1,!0,!t)},s=()=>{this.#H.toggleCommentPopup(this,!1,!1)};if(t){this.#Gr=this.#Yr.container;for(const t of this.trigger)t.ariaHasPopup="dialog",t.ariaControls="commentPopup",t.addEventListener("keydown",this.#Ir,{signal:e}),t.addEventListener("click",n,{signal:e}),t.addEventListener("pointerenter",i,{signal:e}),t.addEventListener("pointerleave",s,{signal:e}),t.classList.add("popupTriggerArea")}else{const t=this.#Gr=document.createElement("button");t.className="annotationCommentButton";const r=this.#Yr.container;t.style.zIndex=r.style.zIndex+1,t.tabIndex=0,t.ariaHasPopup="dialog",t.ariaControls="commentPopup",t.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#ta(),this.#na(),t.addEventListener("keydown",this.#Ir,{signal:e}),t.addEventListener("click",n,{signal:e}),t.addEventListener("pointerenter",i,{signal:e}),t.addEventListener("pointerleave",s,{signal:e}),r.after(t)}}#na(){if(this.#Yr.extraPopupElement&&!this.#Yr.editor)return;this.#Gr||this.renderCommentButton();const[e,t]=this.#Wr,{style:n}=this.#Gr;n.left=`calc(${e}%)`,n.top=`calc(${t}% - var(--comment-button-dim))`}#ta(){this.#Yr.extraPopupElement||(this.#Gr||this.renderCommentButton(),this.#Gr.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:e,opacity:t}=this.#Yr.commentData;return e?this.#zr._commentManager.makeCommentColor(e,t):null}focusCommentButton(){setTimeout(()=>{this.#Gr?.focus()},0)}getData(){const{richText:e,color:t,opacity:n,creationDate:i,modificationDate:s}=this.#Yr.commentData;return{contentsObj:{str:this.comment},richText:e,color:t,opacity:n,creationDate:i,modificationDate:s}}get elementBeforePopup(){return this.#Gr}get comment(){return this.#Jr||=this.#Yr.commentText,this.#Jr}set comment(e){e!==this.comment&&(this.#Yr.commentText=this.#Jr=e)}focus(){this.#Yr.container?.focus()}get parentBoundingClientRect(){return this.#Yr.layer.getBoundingClientRect()}setCommentButtonStates(e){let{selected:t,hasPopup:n}=e;this.#Gr&&(this.#Gr.classList.toggle("selected",t),this.#Gr.ariaExpanded=n)}setSelectedCommentButton(e){this.#Gr.classList.toggle("selected",e)}get commentPopupPosition(){if(this.#yt)return this.#yt;const{x:e,y:t,height:n}=this.#Gr.getBoundingClientRect(),{x:i,y:s,width:r,height:a}=this.#Yr.layer.getBoundingClientRect();return[(e-i)/r,(t+n-s)/a]}set commentPopupPosition(e){this.#yt=e}hasDefaultPopupPosition(){return null===this.#yt}get commentButtonPosition(){return this.#Wr}get commentButtonWidth(){return this.#Gr.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(e){const[t,n]=this.#yt||this.commentButtonPosition.map(e=>e/100),i=this.parentBoundingClientRect,{x:s,y:r,width:a,height:o}=i;this.#H.showDialog(null,this,s+t*a,r+n*o,{...e,parentDimensions:i})}render(){if(this.#$r)return;const e=this.#$r=document.createElement("div");if(e.className="popup",this.#Or){const t=e.style.outlineColor=xy.makeHexColor(...this.#Or);e.style.backgroundColor=`color-mix(in srgb, ${t} 30%, white)`}const t=document.createElement("span");if(t.className="header",this.#Qr?.str){const e=document.createElement("span");e.className="title",t.append(e),({dir:e.dir,str:e.textContent}=this.#Qr)}if(e.append(t),this.#Br){const e=document.createElement("time");e.className="popupDate",e.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),e.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#Br.valueOf()})),e.dateTime=this.#Br.toISOString(),t.append(e)}Zy({html:this.#ia||this.#Fr.str,dir:this.#Fr?.dir,className:"popupContent"},e),this.#Ae.append(e)}get#ia(){const e=this.#pt,t=this.#Fr;return!e?.str||t?.str&&t.str!==e.str?null:this.#pt.html||null}get#sa(){return this.#ia?.attributes?.style?.fontSize||0}get#ra(){return this.#ia?.attributes?.style?.color||null}#aa(e){const t=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},i={style:{color:this.#ra,fontSize:this.#sa?`calc(${this.#sa}px * var(--total-scale-factor))`:""}};for(const s of e.split("\n"))t.push({name:"span",value:s,attributes:i});return n}#yr(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||("Enter"===e.key||"Escape"===e.key&&this.#Hr)&&this.#jr()}updateEdited(e){let{rect:t,popup:n,deleted:i}=e;if(this.#H)return i?(this.remove(),this.#Jr=null):n&&(n.deleted?this.remove():(this.#ta(),this.#Jr=n.text)),void(t&&(this.#Wr=null,this.#ea(),this.#na()));i||n?.deleted?this.remove():(this.#Zr(),this.#_r||={contentsObj:this.#Fr,richText:this.#pt},t&&(this.#P=null),n&&n.text&&(this.#pt=this.#aa(n.text),this.#Br=Uy.toDateObject(n.date),this.#Fr=null),this.#$r?.remove(),this.#$r=null)}resetEdited(){this.#_r&&(({contentsObj:this.#Fr,richText:this.#pt}=this.#_r),this.#_r=null,this.#$r?.remove(),this.#$r=null,this.#P=null)}remove(){if(this.#qr?.abort(),this.#qr=null,this.#$r?.remove(),this.#$r=null,this.#Xr=!1,this.#Hr=!1,this.#Gr?.remove(),this.#Gr=null,this.trigger)for(const e of this.trigger)e.classList.remove("popupTriggerArea")}#oa(){if(null!==this.#P)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:i,pageY:s}}}=this.#zr;let r=!!this.#Vr,a=r?this.#Vr:this.#Kr;for(const h of this.#Ur)if(!a||null!==xy.intersect(h.data.rect,a)){a=h.data.rect,r=!0;break}const o=xy.normalizeRect([a[0],e[3]-a[1]+e[1],a[2],e[3]-a[3]+e[1]]),l=r?a[2]-a[0]+5:0,c=o[0]+l,d=o[1];this.#P=[100*(c-i)/t,100*(d-s)/n];const{style:u}=this.#Ae;u.left=`${this.#P[0]}%`,u.top=`${this.#P[1]}%`}#jr(){this.#H?this.#H.toggleCommentPopup(this,!1):(this.#Hr=!this.#Hr,this.#Hr?(this.#Rr(),this.#Ae.addEventListener("click",this.#Lr),this.#Ae.addEventListener("keydown",this.#Ir)):(this.#Pr(),this.#Ae.removeEventListener("click",this.#Lr),this.#Ae.removeEventListener("keydown",this.#Ir)))}#Rr(){this.#$r||this.render(),this.isVisible?this.#Hr&&this.#Ae.classList.add("focused"):(this.#oa(),this.#Ae.hidden=!1,this.#Ae.style.zIndex=parseInt(this.#Ae.style.zIndex)+1e3)}#Pr(){this.#Ae.classList.remove("focused"),!this.#Hr&&this.isVisible&&(this.#Ae.hidden=!0,this.#Ae.style.zIndex=parseInt(this.#Ae.style.zIndex)-1e3)}forceHide(){this.#Xr=this.isVisible,this.#Xr&&(this.#Ae.hidden=!0)}maybeShow(){this.#H||(this.#Zr(),this.#Xr&&(this.#$r||this.#Rr(),this.#Xr=!1,this.#Ae.hidden=!1))}get isVisible(){return!this.#H&&!1===this.#Ae.hidden}}class uw extends Jx{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=Nf.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=this.contentElement=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class hw extends Jx{#la=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:e,width:t,height:n}=this,i=this.svgFactory.create(t,n,!0),s=this.#la=this.svgFactory.createElement("svg:line");return s.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),s.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),s.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),s.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),s.setAttribute("stroke-width",e.borderStyle.width||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),i.append(s),this.container.append(i),!e.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#la}addHighlightArea(){this.container.classList.add("highlightArea")}}class pw extends Jx{#ca=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:e,width:t,height:n}=this,i=this.svgFactory.create(t,n,!0),s=e.borderStyle.width,r=this.#ca=this.svgFactory.createElement("svg:rect");return r.setAttribute("x",s/2),r.setAttribute("y",s/2),r.setAttribute("width",t-s),r.setAttribute("height",n-s),r.setAttribute("stroke-width",s||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),i.append(r),this.container.append(i),!e.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#ca}addHighlightArea(){this.container.classList.add("highlightArea")}}class mw extends Jx{#da=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:e,width:t,height:n}=this,i=this.svgFactory.create(t,n,!0),s=e.borderStyle.width,r=this.#da=this.svgFactory.createElement("svg:ellipse");return r.setAttribute("cx",t/2),r.setAttribute("cy",n/2),r.setAttribute("rx",t/2-s/2),r.setAttribute("ry",n/2-s/2),r.setAttribute("stroke-width",s||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),i.append(r),this.container.append(i),!e.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#da}addHighlightArea(){this.container.classList.add("highlightArea")}}class gw extends Jx{#ua=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:t,borderStyle:n,popupRef:i},width:s,height:r}=this;if(!t)return this.container;const a=this.svgFactory.create(s,r,!0);let o=[];for(let c=0,d=t.length;c<d;c+=2){const n=t[c]-e[0],i=e[3]-t[c+1];o.push(`${n},${i}`)}o=o.join(" ");const l=this.#ua=this.svgFactory.createElement(this.svgElementName);return l.setAttribute("points",o),l.setAttribute("stroke-width",n.width||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),a.append(l),this.container.append(a),!i&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#ua}addHighlightArea(){this.container.classList.add("highlightArea")}}class fw extends gw{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class yw extends Jx{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}class vw extends Jx{#ha=null;#pa=[];constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType="InkHighlight"===this.data.it?Nf.HIGHLIGHT:Nf.INK}#ma(e,t){switch(e){case 90:return{transform:`rotate(90) translate(${-t[0]},${t[1]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};case 180:return{transform:`rotate(180) translate(${-t[2]},${t[1]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]};case 270:return{transform:`rotate(270) translate(${-t[2]},${t[3]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};default:return{transform:`translate(${-t[0]},${t[3]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,rotation:t,inkLists:n,borderStyle:i,popupRef:s}}=this,{transform:r,width:a,height:o}=this.#ma(t,e),l=this.svgFactory.create(a,o,!0),c=this.#ha=this.svgFactory.createElement("svg:g");l.append(c),c.setAttribute("stroke-width",i.width||1),c.setAttribute("stroke-linecap","round"),c.setAttribute("stroke-linejoin","round"),c.setAttribute("stroke-miterlimit",10),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),c.setAttribute("transform",r);for(let d=0,u=n.length;d<u;d++){const e=this.svgFactory.createElement(this.svgElementName);this.#pa.push(e),e.setAttribute("points",n[d].join(",")),c.append(e)}return!s&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(l),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);const{thickness:t,points:n,rect:i}=e,s=this.#ha;if(t>=0&&s.setAttribute("stroke-width",t||1),n)for(let r=0,a=this.#pa.length;r<a;r++)this.#pa[r].setAttribute("points",n[r].join(","));if(i){const{transform:e,width:t,height:n}=this.#ma(this.data.rotation,i);s.parentElement.setAttribute("viewBox",`0 0 ${t} ${n}`),s.setAttribute("transform",e)}}getElementsToTriggerPopup(){return this.#pa}addHighlightArea(){this.container.classList.add("highlightArea")}}class bw extends Jx{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Nf.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const t=document.createElement("mark");t.classList.add("overlaidText"),t.textContent=e,this.container.append(t)}return this.container}}class xw extends Jx{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),e){const t=document.createElement("u");t.classList.add("overlaidText"),t.textContent=e,this.container.append(t)}return this.container}}class ww extends Jx{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),e){const t=document.createElement("u");t.classList.add("overlaidText"),t.textContent=e,this.container.append(t)}return this.container}}class _w extends Jx{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),e){const t=document.createElement("s");t.classList.add("overlaidText"),t.textContent=e,this.container.append(t)}return this.container}}class Sw extends Jx{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Nf.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class Cw extends Jx{#ga=null;constructor(e){super(e,{isRenderable:!0});const{file:t}=this.data;this.filename=t.filename,this.content=t.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...t})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:t}=this;let n;t.hasAppearance||0===t.fillAlpha?n=document.createElement("div"):(n=document.createElement("img"),n.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(t.name)?"paperclip":"pushpin"}.svg`,t.fillAlpha&&t.fillAlpha<1&&(n.style=`filter: opacity(${Math.round(100*t.fillAlpha)}%);`)),n.addEventListener("dblclick",this.#fa.bind(this)),this.#ga=n;const{isMac:i}=vy.platform;return e.addEventListener("keydown",e=>{"Enter"===e.key&&(i?e.metaKey:e.ctrlKey)&&this.#fa()}),!t.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):n.classList.add("popupTriggerArea"),e.append(n),e}getElementsToTriggerPopup(){return this.#ga}addHighlightArea(){this.container.classList.add("highlightArea")}#fa(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class Aw{#ya=null;#va=null;#U=null;#ba=(()=>new Map)();#xa=null;#wa=null;#Ur=[];#_a=!1;constructor(e){let{div:t,accessibilityManager:n,annotationCanvasMap:i,annotationEditorUIManager:s,page:r,viewport:a,structTreeLayer:o,commentManager:l,linkService:c,annotationStorage:d}=e;this.div=t,this.#ya=n,this.#va=i,this.#xa=o||null,this.#wa=c||null,this.#U=d||new wv,this.page=r,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=s,this._commentManager=l||null}hasEditableAnnotations(){return this.#ba.size>0}async render(e){const{annotations:t}=e,n=this.div;$y(n,this.viewport);const i=new Map,s=[],r={data:null,layer:n,linkService:this.#wa,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:!1!==e.renderForms,svgFactory:new Kx,annotationStorage:this.#U,enableComment:!0===e.enableComment,enableScripting:!0===e.enableScripting,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const a of t){if(a.noHTML)continue;const e=a.annotationType===Uf.POPUP;if(e){const e=i.get(a.id);if(!e)continue;if(!this._commentManager){s.push(a);continue}r.elements=e}else if(a.rect[2]===a.rect[0]||a.rect[3]===a.rect[1])continue;r.data=a;const t=Yx.create(r);if(!t.isRenderable)continue;if(!e&&(this.#Ur.push(t),a.popupRef)){const e=i.get(a.popupRef);e?e.push(t):i.set(a.popupRef,[t])}const n=t.render();a.hidden&&(n.style.visibility="hidden"),t._isEditable&&(this.#ba.set(t.data.id,t),this._annotationEditorUIManager?.renderAnnotationElement(t))}await this.#Sa();for(const a of s){const e=r.elements=i.get(a.id);r.data=a;const t=Yx.create(r);if(!t.isRenderable)continue;const n=t.render();t.contentElement.id=`${Cy}${a.id}`,a.hidden&&(n.style.visibility="hidden"),e.at(-1).container.after(n)}this.#Ca()}async#Sa(){if(0===this.#Ur.length)return;this.div.replaceChildren();const e=[];if(!this.#_a){this.#_a=!0;for(const{contentElement:t,data:{id:n}}of this.#Ur){const i=t.id=`${Cy}${n}`;e.push(this.#xa?.getAriaAttributes(i).then(e=>{if(e)for(const[n,i]of e)t.setAttribute(n,i)}))}}this.#Ur.sort((e,t)=>{let{data:{rect:[n,i,s,r]}}=e,{data:{rect:[a,o,l,c]}}=t;if(n===s&&i===r)return 1;if(a===l&&o===c)return-1;const d=(i+r)/2,u=(o+c)/2;if(d>=c&&u<=i)return-1;if(u>=r&&d<=o)return 1;return(n+s)/2-(a+l)/2});const t=document.createDocumentFragment();for(const n of this.#Ur)t.append(n.container),this._commentManager?(n.extraPopupElement?.popup||n.popup)?.renderCommentButton():n.extraPopupElement&&t.append(n.extraPopupElement.render());if(this.div.append(t),await Promise.all(e),this.#ya)for(const n of this.#Ur)this.#ya.addPointerInTextLayer(n.contentElement,!1)}async addLinkAnnotations(e){const t={data:null,layer:this.div,linkService:this.#wa,svgFactory:new Kx,parent:this};for(const n of e){n.borderStyle||=Aw._defaultBorderStyle,t.data=n;const e=Yx.create(t);e.isRenderable&&(e.render(),e.contentElement.id=`${Cy}${n.id}`,this.#Ur.push(e))}await this.#Sa()}update(e){let{viewport:t}=e;const n=this.div;this.viewport=t,$y(n,{rotation:t.rotation}),this.#Ca(),n.hidden=!1}#Ca(){if(!this.#va)return;const e=this.div;for(const[t,n]of this.#va){const i=e.querySelector(`[data-annotation-id="${t}"]`);if(!i)continue;n.className="annotationContent";const{firstChild:s}=i;s?"CANVAS"===s.nodeName?s.replaceWith(n):s.classList.contains("annotationContent")?s.after(n):s.before(n):i.append(n);const r=this.#ba.get(t);r&&(r._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(t,i.id,n),r._hasNoCanvas=!1):r.canvas=n)}this.#va.clear()}getEditableAnnotations(){return Array.from(this.#ba.values())}getEditableAnnotation(e){return this.#ba.get(e)}addFakeAnnotation(e){const{div:t}=this,{id:n,rotation:i}=e,s=new Zx({data:{id:n,rect:e.getPDFRect(),rotation:i},editor:e,layer:t,parent:this,enableComment:!!this._commentManager,linkService:this.#wa,annotationStorage:this.#U});return s.render(),s.contentElement.id=`${Cy}${n}`,s.createOrUpdatePopup(),this.#Ur.push(s),s}removeAnnotation(e){const t=this.#Ur.findIndex(t=>t.data.id===e);if(t<0)return;const[n]=this.#Ur.splice(t,1);this.#ya?.removePointerInTextLayer(n.contentElement)}updateFakeAnnotations(e){if(0!==e.length){for(const t of e)t.updateFakeAnnotationElement(this);this.#Sa()}}togglePointerEvents(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.div.classList.toggle("disabled",!e)}static get _defaultBorderStyle(){return ly(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:zf,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const Ew=/\r\n?|\n/g;class Tw extends mv{#Aa="";#Ea=`${this.id}-editor`;#Ta=null;#sa;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const e=Tw.prototype,t=e=>e.isEmpty(),n=dv.TRANSLATE_SMALL,i=dv.TRANSLATE_BIG;return ly(this,"_keyboardManager",new lv([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-n,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-i,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[n,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[i,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-n],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-i],checker:t}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,n],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,i],checker:t}]]))}static _type="freetext";static _editorType=(()=>Nf.FREETEXT)();constructor(e){super({...e,name:"freeTextEditor"}),this.color=e.color||Tw._defaultColor||mv._defaultLineColor,this.#sa=e.fontSize||Tw._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static initialize(e,t){mv.initialize(e,t);const n=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(n.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case If.FREETEXT_SIZE:Tw._defaultFontSize=t;break;case If.FREETEXT_COLOR:Tw._defaultColor=t}}updateParams(e,t){switch(e){case If.FREETEXT_SIZE:this.#ka(t);break;case If.FREETEXT_COLOR:this.#ta(t)}}static get defaultPropertiesToUpdate(){return[[If.FREETEXT_SIZE,Tw._defaultFontSize],[If.FREETEXT_COLOR,Tw._defaultColor||mv._defaultLineColor]]}get propertiesToUpdate(){return[[If.FREETEXT_SIZE,this.#sa],[If.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new Hx(this),[["colorPicker",this._colorPicker]]}get colorType(){return If.FREETEXT_COLOR}#ka(e){const t=e=>{this.editorDiv.style.fontSize=`calc(${e}px * var(--total-scale-factor))`,this.translate(0,-(e-this.#sa)*this.parentScale),this.#sa=e,this.#Na()},n=this.#sa;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:If.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#ta(e){const t=e=>{this.color=e,this.onUpdatedColor()},n=this.color;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:If.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){const e=this.parentScale;return[-Tw._internalPadding*e,-(Tw._internalPadding+this.#sa)*e]}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#Ta=new AbortController;const e=this._uiManager.combinedSignal(this.#Ta);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e}),!0}disableEditMode(){return!!super.disableEditMode()&&(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#Ea),this._isDraggable=!0,this.#Ta?.abort(),this.#Ta=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0)}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#Ia(){const e=[];this.editorDiv.normalize();let t=null;for(const n of this.editorDiv.childNodes)t?.nodeType===Node.TEXT_NODE&&"BR"===n.nodeName||(e.push(Tw.#Da(n)),t=n);return e.join("\n")}#Na(){const[e,t]=this.parentDimensions;let n;if(this.isAttachedToDOM)n=this.div.getBoundingClientRect();else{const{currentLayer:e,div:t}=this,i=t.style.display,s=t.classList.contains("hidden");t.classList.remove("hidden"),t.style.display="hidden",e.div.append(this.div),n=t.getBoundingClientRect(),t.remove(),t.style.display=i,t.classList.toggle("hidden",s)}this.rotation%180===this.parentRotation%180?(this.width=n.width/e,this.height=n.height/t):(this.width=n.height/e,this.height=n.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=this.#Aa,t=this.#Aa=this.#Ia().trimEnd();if(e===t)return;const n=e=>{this.#Aa=e,e?(this.#Pa(),this._uiManager.rebuild(this),this.#Na()):this.remove()};this.addCommands({cmd:()=>{n(t)},undo:()=>{n(e)},mustExec:!1}),this.#Na()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(e){e.target===this.div&&"Enter"===e.key&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){Tw._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let e,t;(this._isCopy||this.annotationElementId)&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#Ea),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:n}=this.editorDiv;if(n.fontSize=`calc(${this.#sa}px * var(--total-scale-factor))`,n.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[n,i]=this.parentDimensions;if(this.annotationElementId){const{position:s}=this._initialData;let[r,a]=this.getInitialTranslation();[r,a]=this.pageTranslationToScreen(r,a);const[o,l]=this.pageDimensions,[c,d]=this.pageTranslation;let u,h;switch(this.rotation){case 0:u=e+(s[0]-c)/o,h=t+this.height-(s[1]-d)/l;break;case 90:u=e+(s[0]-c)/o,h=t-(s[1]-d)/l,[r,a]=[a,-r];break;case 180:u=e-this.width+(s[0]-c)/o,h=t-(s[1]-d)/l,[r,a]=[-r,-a];break;case 270:u=e+(s[0]-c-this.height*l)/o,h=t+(s[1]-d-this.width*o)/l,[r,a]=[-a,r]}this.setAt(u*n,h*i,r,a)}else this._moveAfterPaste(e,t);this.#Pa(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#Da(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(Ew,"")}editorDivPaste(e){const t=e.clipboardData||window.clipboardData,{types:n}=t;if(1===n.length&&"text/plain"===n[0])return;e.preventDefault();const i=Tw.#Ma(t.getData("text")||"").replaceAll(Ew,"\n");if(!i)return;const s=window.getSelection();if(!s.rangeCount)return;this.editorDiv.normalize(),s.deleteFromDocument();const r=s.getRangeAt(0);if(!i.includes("\n"))return r.insertNode(document.createTextNode(i)),this.editorDiv.normalize(),void s.collapseToStart();const{startContainer:a,startOffset:o}=r,l=[],c=[];if(a.nodeType===Node.TEXT_NODE){const e=a.parentElement;if(c.push(a.nodeValue.slice(o).replaceAll(Ew,"")),e!==this.editorDiv){let t=l;for(const n of this.editorDiv.childNodes)n!==e?t.push(Tw.#Da(n)):t=c}l.push(a.nodeValue.slice(0,o).replaceAll(Ew,""))}else if(a===this.editorDiv){let e=l,t=0;for(const n of this.editorDiv.childNodes)t++===o&&(e=c),e.push(Tw.#Da(n))}this.#Aa=`${l.join("\n")}${i}${c.join("\n")}`,this.#Pa();const d=new Range;let u=Math.sumPrecise(l.map(e=>e.length));for(const{firstChild:h}of this.editorDiv.childNodes)if(h.nodeType===Node.TEXT_NODE){const e=h.nodeValue.length;if(u<=e){d.setStart(h,u),d.setEnd(h,u);break}u-=e}s.removeAllRanges(),s.addRange(d)}#Pa(){if(this.editorDiv.replaceChildren(),this.#Aa)for(const e of this.#Aa.split("\n")){const t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}#Ra(){return this.#Aa.replaceAll("\xa0"," ")}static#Ma(e){return e.replaceAll(" ","\xa0")}get contentDiv(){return this.editorDiv}getPDFRect(){const e=Tw._internalPadding*this.parentScale;return this.getRect(e,e)}static async deserialize(e,t,n){let i=null;if(e instanceof uw){const{data:{defaultAppearanceData:{fontSize:t,fontColor:n},rect:s,rotation:r,id:a,popupRef:o,richText:l,contentsObj:c,creationDate:d,modificationDate:u},textContent:h,textPosition:p,parent:{page:{pageNumber:m}}}=e;if(!h||0===h.length)return null;i=e={annotationType:Nf.FREETEXT,color:Array.from(n),fontSize:t,value:h.join("\n"),position:p,pageIndex:m-1,rect:s.slice(0),rotation:r,annotationElementId:a,id:a,deleted:!1,popupRef:o,comment:c?.str||null,richText:l,creationDate:d,modificationDate:u}}const s=await super.deserialize(e,t,n);return s.#sa=e.fontSize,s.color=xy.makeHexColor(...e.color),s.#Aa=Tw.#Ma(e.value),s._initialData=i,e.comment&&s.setCommentData(e),s}serialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const t=mv._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),n=Object.assign(super.serialize(e),{color:t,fontSize:this.#sa,value:this.#Ra()});return this.addComment(n),e?(n.isCopy=!0,n):this.annotationElementId&&!this.#La(n)?null:(n.id=this.annotationElementId,n)}#La(e){const{value:t,fontSize:n,color:i,pageIndex:s}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||e.value!==t||e.fontSize!==n||e.color.some((e,t)=>e!==i[t])||e.pageIndex!==s}renderAnnotationElement(e){const t=super.renderAnnotationElement(e);if(!t)return null;const{style:n}=t;n.fontSize=`calc(${this.#sa}px * var(--total-scale-factor))`,n.color=this.color,t.replaceChildren();for(const i of this.#Aa.split("\n")){const e=document.createElement("div");e.append(i?document.createTextNode(i):document.createElement("br")),t.append(e)}return e.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#Aa}}),t}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}}class kw{static PRECISION=1e-4;toSVGPath(){sy("Abstract method `toSVGPath` must be implemented.")}get box(){sy("Abstract getter `box` must be implemented.")}serialize(e,t){sy("Abstract method `serialize` must be implemented.")}static _rescale(e,t,n,i,s,r){r||=new Float32Array(e.length);for(let a=0,o=e.length;a<o;a+=2)r[a]=t+e[a]*i,r[a+1]=n+e[a+1]*s;return r}static _rescaleAndSwap(e,t,n,i,s,r){r||=new Float32Array(e.length);for(let a=0,o=e.length;a<o;a+=2)r[a]=t+e[a+1]*i,r[a+1]=n+e[a]*s;return r}static _translate(e,t,n,i){i||=new Float32Array(e.length);for(let s=0,r=e.length;s<r;s+=2)i[s]=t+e[s],i[s+1]=n+e[s+1];return i}static svgRound(e){return Math.round(1e4*e)}static _normalizePoint(e,t,n,i,s){switch(s){case 90:return[1-t/n,e/i];case 180:return[1-e/n,1-t/i];case 270:return[t/n,1-e/i];default:return[e/n,t/i]}}static _normalizePagePoint(e,t,n){switch(n){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,n,i,s,r){return[(e+5*n)/6,(t+5*i)/6,(5*n+s)/6,(5*i+r)/6,(n+s)/2,(i+r)/2]}}class Nw{#ja;#Oa=[];#Fa;#Ba;#Ua=[];#za=(()=>new Float32Array(18))();#Va;#Ha;#$a;#qa;#Ga;#Wa;#Ka=[];static#Qa=8;static#Xa=2;static#Ya=(()=>Nw.#Qa+Nw.#Xa)();constructor(e,t,n,i,s){let{x:r,y:a}=e,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.#ja=t,this.#Wa=i*n,this.#Ba=s,this.#za.set([NaN,NaN,NaN,NaN,r,a],6),this.#Fa=o,this.#qa=Nw.#Qa*n,this.#$a=Nw.#Ya*n,this.#Ga=n,this.#Ka.push(r,a)}isEmpty(){return isNaN(this.#za[8])}#Ja(){const e=this.#za.subarray(4,6),t=this.#za.subarray(16,18),[n,i,s,r]=this.#ja;return[(this.#Va+(e[0]-t[0])/2-n)/s,(this.#Ha+(e[1]-t[1])/2-i)/r,(this.#Va+(t[0]-e[0])/2-n)/s,(this.#Ha+(t[1]-e[1])/2-i)/r]}add(e){let{x:t,y:n}=e;this.#Va=t,this.#Ha=n;const[i,s,r,a]=this.#ja;let[o,l,c,d]=this.#za.subarray(8,12);const u=t-c,h=n-d,p=Math.hypot(u,h);if(p<this.#$a)return!1;const m=p-this.#qa,g=m/p,f=g*u,y=g*h;let v=o,b=l;o=c,l=d,c+=f,d+=y,this.#Ka?.push(t,n);const x=f/m,w=-y/m*this.#Wa,_=x*this.#Wa;if(this.#za.set(this.#za.subarray(2,8),0),this.#za.set([c+w,d+_],4),this.#za.set(this.#za.subarray(14,18),12),this.#za.set([c-w,d-_],16),isNaN(this.#za[6]))return 0===this.#Ua.length&&(this.#za.set([o+w,l+_],2),this.#Ua.push(NaN,NaN,NaN,NaN,(o+w-i)/r,(l+_-s)/a),this.#za.set([o-w,l-_],14),this.#Oa.push(NaN,NaN,NaN,NaN,(o-w-i)/r,(l-_-s)/a)),this.#za.set([v,b,o,l,c,d],6),!this.isEmpty();this.#za.set([v,b,o,l,c,d],6);return Math.abs(Math.atan2(b-l,v-o)-Math.atan2(y,f))<Math.PI/2?([o,l,c,d]=this.#za.subarray(2,6),this.#Ua.push(NaN,NaN,NaN,NaN,((o+c)/2-i)/r,((l+d)/2-s)/a),[o,l,v,b]=this.#za.subarray(14,18),this.#Oa.push(NaN,NaN,NaN,NaN,((v+o)/2-i)/r,((b+l)/2-s)/a),!0):([v,b,o,l,c,d]=this.#za.subarray(0,6),this.#Ua.push(((v+5*o)/6-i)/r,((b+5*l)/6-s)/a,((5*o+c)/6-i)/r,((5*l+d)/6-s)/a,((o+c)/2-i)/r,((l+d)/2-s)/a),[c,d,o,l,v,b]=this.#za.subarray(12,18),this.#Oa.push(((v+5*o)/6-i)/r,((b+5*l)/6-s)/a,((5*o+c)/6-i)/r,((5*l+d)/6-s)/a,((o+c)/2-i)/r,((l+d)/2-s)/a),!0)}toSVGPath(){if(this.isEmpty())return"";const e=this.#Ua,t=this.#Oa;if(isNaN(this.#za[6])&&!this.isEmpty())return this.#Za();const n=[];n.push(`M${e[4]} ${e[5]}`);for(let i=6;i<e.length;i+=6)isNaN(e[i])?n.push(`L${e[i+4]} ${e[i+5]}`):n.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);this.#eo(n);for(let i=t.length-6;i>=6;i-=6)isNaN(t[i])?n.push(`L${t[i+4]} ${t[i+5]}`):n.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);return this.#to(n),n.join(" ")}#Za(){const[e,t,n,i]=this.#ja,[s,r,a,o]=this.#Ja();return`M${(this.#za[2]-e)/n} ${(this.#za[3]-t)/i} L${(this.#za[4]-e)/n} ${(this.#za[5]-t)/i} L${s} ${r} L${a} ${o} L${(this.#za[16]-e)/n} ${(this.#za[17]-t)/i} L${(this.#za[14]-e)/n} ${(this.#za[15]-t)/i} Z`}#to(e){const t=this.#Oa;e.push(`L${t[4]} ${t[5]} Z`)}#eo(e){const[t,n,i,s]=this.#ja,r=this.#za.subarray(4,6),a=this.#za.subarray(16,18),[o,l,c,d]=this.#Ja();e.push(`L${(r[0]-t)/i} ${(r[1]-n)/s} L${o} ${l} L${c} ${d} L${(a[0]-t)/i} ${(a[1]-n)/s}`)}newFreeDrawOutline(e,t,n,i,s,r){return new Iw(e,t,n,i,s,r)}getOutlines(){const e=this.#Ua,t=this.#Oa,n=this.#za,[i,s,r,a]=this.#ja,o=new Float32Array((this.#Ka?.length??0)+2);for(let d=0,u=o.length-2;d<u;d+=2)o[d]=(this.#Ka[d]-i)/r,o[d+1]=(this.#Ka[d+1]-s)/a;if(o[o.length-2]=(this.#Va-i)/r,o[o.length-1]=(this.#Ha-s)/a,isNaN(n[6])&&!this.isEmpty())return this.#no(o);const l=new Float32Array(this.#Ua.length+24+this.#Oa.length);let c=e.length;for(let d=0;d<c;d+=2)isNaN(e[d])?l[d]=l[d+1]=NaN:(l[d]=e[d],l[d+1]=e[d+1]);c=this.#io(l,c);for(let d=t.length-6;d>=6;d-=6)for(let e=0;e<6;e+=2)isNaN(t[d+e])?(l[c]=l[c+1]=NaN,c+=2):(l[c]=t[d+e],l[c+1]=t[d+e+1],c+=2);return this.#so(l,c),this.newFreeDrawOutline(l,o,this.#ja,this.#Ga,this.#Fa,this.#Ba)}#no(e){const t=this.#za,[n,i,s,r]=this.#ja,[a,o,l,c]=this.#Ja(),d=new Float32Array(36);return d.set([NaN,NaN,NaN,NaN,(t[2]-n)/s,(t[3]-i)/r,NaN,NaN,NaN,NaN,(t[4]-n)/s,(t[5]-i)/r,NaN,NaN,NaN,NaN,a,o,NaN,NaN,NaN,NaN,l,c,NaN,NaN,NaN,NaN,(t[16]-n)/s,(t[17]-i)/r,NaN,NaN,NaN,NaN,(t[14]-n)/s,(t[15]-i)/r],0),this.newFreeDrawOutline(d,e,this.#ja,this.#Ga,this.#Fa,this.#Ba)}#so(e,t){const n=this.#Oa;return e.set([NaN,NaN,NaN,NaN,n[4],n[5]],t),t+6}#io(e,t){const n=this.#za.subarray(4,6),i=this.#za.subarray(16,18),[s,r,a,o]=this.#ja,[l,c,d,u]=this.#Ja();return e.set([NaN,NaN,NaN,NaN,(n[0]-s)/a,(n[1]-r)/o,NaN,NaN,NaN,NaN,l,c,NaN,NaN,NaN,NaN,d,u,NaN,NaN,NaN,NaN,(i[0]-s)/a,(i[1]-r)/o],t),t+24}}class Iw extends kw{#ja;#ro=(()=>new Float32Array(4))();#Fa;#Ba;#Ka;#Ga;#ao;constructor(e,t,n,i,s,r){super(),this.#ao=e,this.#Ka=t,this.#ja=n,this.#Ga=i,this.#Fa=s,this.#Ba=r,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#oo(r);const[a,o,l,c]=this.#ro;for(let d=0,u=e.length;d<u;d+=2)e[d]=(e[d]-a)/l,e[d+1]=(e[d+1]-o)/c;for(let d=0,u=t.length;d<u;d+=2)t[d]=(t[d]-a)/l,t[d+1]=(t[d+1]-o)/c}toSVGPath(){const e=[`M${this.#ao[4]} ${this.#ao[5]}`];for(let t=6,n=this.#ao.length;t<n;t+=6)isNaN(this.#ao[t])?e.push(`L${this.#ao[t+4]} ${this.#ao[t+5]}`):e.push(`C${this.#ao[t]} ${this.#ao[t+1]} ${this.#ao[t+2]} ${this.#ao[t+3]} ${this.#ao[t+4]} ${this.#ao[t+5]}`);return e.push("Z"),e.join(" ")}serialize(e,t){let[n,i,s,r]=e;const a=s-n,o=r-i;let l,c;switch(t){case 0:l=kw._rescale(this.#ao,n,r,a,-o),c=kw._rescale(this.#Ka,n,r,a,-o);break;case 90:l=kw._rescaleAndSwap(this.#ao,n,i,a,o),c=kw._rescaleAndSwap(this.#Ka,n,i,a,o);break;case 180:l=kw._rescale(this.#ao,s,i,-a,o),c=kw._rescale(this.#Ka,s,i,-a,o);break;case 270:l=kw._rescaleAndSwap(this.#ao,s,r,-a,-o),c=kw._rescaleAndSwap(this.#Ka,s,r,-a,-o)}return{outline:Array.from(l),points:[Array.from(c)]}}#oo(e){const t=this.#ao;let n=t[4],i=t[5];const s=[n,i,n,i];let r=n,a=i,o=n,l=i;const c=e?Math.max:Math.min,d=new Float32Array(4);for(let h=6,p=t.length;h<p;h+=6){const e=t[h+4],u=t[h+5];isNaN(t[h])?(xy.pointBoundingBox(e,u,s),a>u?(r=e,a=u):a===u&&(r=c(r,e)),l<u?(o=e,l=u):l===u&&(o=c(o,e))):(d[0]=d[1]=1/0,d[2]=d[3]=-1/0,xy.bezierBoundingBox(n,i,...t.slice(h,h+6),d),xy.rectBoundingBox(d[0],d[1],d[2],d[3],s),a>d[1]?(r=d[0],a=d[1]):a===d[1]&&(r=c(r,d[0])),l<d[3]?(o=d[2],l=d[3]):l===d[3]&&(o=c(o,d[2]))),n=e,i=u}const u=this.#ro;u[0]=s[0]-this.#Fa,u[1]=s[1]-this.#Fa,u[2]=s[2]-s[0]+2*this.#Fa,u[3]=s[3]-s[1]+2*this.#Fa,this.firstPoint=[r,a],this.lastPoint=[o,l]}get box(){return this.#ro}newOutliner(e,t,n,i,s){return new Nw(e,t,n,i,s,arguments.length>5&&void 0!==arguments[5]?arguments[5]:0)}getNewOutline(e,t){const[n,i,s,r]=this.#ro,[a,o,l,c]=this.#ja,d=s*l,u=r*c,h=n*l+a,p=i*c+o,m=this.newOutliner({x:this.#Ka[0]*d+h,y:this.#Ka[1]*u+p},this.#ja,this.#Ga,e,this.#Ba,t??this.#Fa);for(let g=2;g<this.#Ka.length;g+=2)m.add({x:this.#Ka[g]*d+h,y:this.#Ka[g+1]*u+p});return m.getOutlines()}}class Dw{#ja;#lo;#co;#do=[];#uo=[];constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const s=[1/0,1/0,-1/0,-1/0],r=10**-4;for(const{x:m,y:g,width:f,height:y}of e){const e=Math.floor((m-t)/r)*r,n=Math.ceil((m+f+t)/r)*r,i=Math.floor((g-t)/r)*r,a=Math.ceil((g+y+t)/r)*r,o=[e,i,a,!0],l=[n,i,a,!1];this.#do.push(o,l),xy.rectBoundingBox(e,i,n,a,s)}const a=s[2]-s[0]+2*n,o=s[3]-s[1]+2*n,l=s[0]-n,c=s[1]-n;let d=i?-1/0:1/0,u=1/0;const h=this.#do.at(i?-1:-2),p=[h[0],h[2]];for(const m of this.#do){const[e,t,n,s]=m;!s&&i?t<u?(u=t,d=e):t===u&&(d=Math.max(d,e)):s&&!i&&(t<u?(u=t,d=e):t===u&&(d=Math.min(d,e))),m[0]=(e-l)/a,m[1]=(t-c)/o,m[2]=(n-c)/o}this.#ja=new Float32Array([l,c,a,o]),this.#lo=[d,u],this.#co=p}getOutlines(){this.#do.sort((e,t)=>e[0]-t[0]||e[1]-t[1]||e[2]-t[2]);const e=[];for(const t of this.#do)t[3]?(e.push(...this.#ho(t)),this.#po(t)):(this.#mo(t),e.push(...this.#ho(t)));return this.#go(e)}#go(e){const t=[],n=new Set;for(const r of e){const[e,n,i]=r;t.push([e,n,r],[e,i,r])}t.sort((e,t)=>e[1]-t[1]||e[0]-t[0]);for(let r=0,a=t.length;r<a;r+=2){const e=t[r][2],i=t[r+1][2];e.push(i),i.push(e),n.add(e),n.add(i)}const i=[];let s;for(;n.size>0;){const e=n.values().next().value;let[t,r,a,o,l]=e;n.delete(e);let c=t,d=r;for(s=[t,a],i.push(s);;){let e;if(n.has(o))e=o;else{if(!n.has(l))break;e=l}n.delete(e),[t,r,a,o,l]=e,c!==t&&(s.push(c,d,t,d===r?r:a),c=t),d=d===r?a:r}s.push(c,d)}return new Pw(i,this.#ja,this.#lo,this.#co)}#fo(e){const t=this.#uo;let n=0,i=t.length-1;for(;n<=i;){const s=n+i>>1,r=t[s][0];if(r===e)return s;r<e?n=s+1:i=s-1}return i+1}#po(e){let[,t,n]=e;const i=this.#fo(t);this.#uo.splice(i,0,[t,n])}#mo(e){let[,t,n]=e;const i=this.#fo(t);for(let s=i;s<this.#uo.length;s++){const[e,i]=this.#uo[s];if(e!==t)break;if(e===t&&i===n)return void this.#uo.splice(s,1)}for(let s=i-1;s>=0;s--){const[e,i]=this.#uo[s];if(e!==t)break;if(e===t&&i===n)return void this.#uo.splice(s,1)}}#ho(e){const[t,n,i]=e,s=[[t,n,i]],r=this.#fo(i);for(let a=0;a<r;a++){const[e,n]=this.#uo[a];for(let i=0,r=s.length;i<r;i++){const[,a,o]=s[i];if(!(n<=a||o<=e))if(a>=e)if(o>n)s[i][1]=n;else{if(1===r)return[];s.splice(i,1),i--,r--}else s[i][2]=e,o>n&&s.push([t,n,o])}}return s}}class Pw extends kw{#ja;#yo;constructor(e,t,n,i){super(),this.#yo=e,this.#ja=t,this.firstPoint=n,this.lastPoint=i}toSVGPath(){const e=[];for(const t of this.#yo){let[n,i]=t;e.push(`M${n} ${i}`);for(let s=2;s<t.length;s+=2){const r=t[s],a=t[s+1];r===n?(e.push(`V${a}`),i=a):a===i&&(e.push(`H${r}`),n=r)}e.push("Z")}return e.join(" ")}serialize(e,t){let[n,i,s,r]=e;const a=[],o=s-n,l=r-i;for(const c of this.#yo){const e=new Array(c.length);for(let t=0;t<c.length;t+=2)e[t]=n+c[t]*o,e[t+1]=r-c[t+1]*l;a.push(e)}return a}get box(){return this.#ja}get classNamesForOutlining(){return["highlightOutline"]}}class Mw extends Nw{newFreeDrawOutline(e,t,n,i,s,r){return new Rw(e,t,n,i,s,r)}}class Rw extends Iw{newOutliner(e,t,n,i,s){return new Mw(e,t,n,i,s,arguments.length>5&&void 0!==arguments[5]?arguments[5]:0)}}class Lw extends mv{#vo=null;#bo=0;#xo;#wo=null;#s=null;#_o=null;#So=null;#Co=0;#Ao=null;#Eo=null;#A=null;#To=!1;#lo=null;#co=null;#ko=null;#mt="";#Wa;#No="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=(()=>Nf.HIGHLIGHT)();static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const e=Lw.prototype;return ly(this,"_keyboardManager",new lv([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}constructor(e){super({...e,name:"highlightEditor"}),this.color=e.color||Lw._defaultColor,this.#Wa=e.thickness||Lw._defaultThickness,this.opacity=e.opacity||Lw._defaultOpacity,this.#xo=e.boxes||null,this.#No=e.methodOfCreation||"",this.#mt=e.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",e.highlightId>-1?(this.#To=!0,this.#Io(e),this.#Do()):this.#xo&&(this.#vo=e.anchorNode,this.#bo=e.anchorOffset,this.#So=e.focusNode,this.#Co=e.focusOffset,this.#Po(),this.#Do(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#To?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#Wa,methodOfCreation:this.#No}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}#Po(){const e=new Dw(this.#xo,.001);this.#Eo=e.getOutlines(),[this.x,this.y,this.width,this.height]=this.#Eo.box;const t=new Dw(this.#xo,.0025,.001,"ltr"===this._uiManager.direction);this.#_o=t.getOutlines();const{firstPoint:n}=this.#Eo;this.#lo=[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height];const{lastPoint:i}=this.#_o;this.#co=[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]}#Io(e){let{highlightOutlines:t,highlightId:n,clipPathId:i}=e;this.#Eo=t;if(this.#_o=t.getNewOutline(this.#Wa/2+1.5,.0025),n>=0)this.#A=n,this.#wo=i,this.parent.drawLayer.finalizeDraw(n,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#ko=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#_o.box,path:{d:this.#_o.toSVGPath()}},!0);else if(this.parent){const e=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#A,{bbox:Lw.#Mo(this.#Eo.box,(e-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#ko,{bbox:Lw.#Mo(this.#_o.box,e),path:{d:this.#_o.toSVGPath()}})}const[s,r,a,o]=t.box;switch(this.rotation){case 0:this.x=s,this.y=r,this.width=a,this.height=o;break;case 90:{const[e,t]=this.parentDimensions;this.x=r,this.y=1-s,this.width=a*t/e,this.height=o*e/t;break}case 180:this.x=1-s,this.y=1-r,this.width=a,this.height=o;break;case 270:{const[e,t]=this.parentDimensions;this.x=1-r,this.y=s,this.width=a*t/e,this.height=o*e/t;break}}const{firstPoint:l}=t;this.#lo=[(l[0]-s)/a,(l[1]-r)/o];const{lastPoint:c}=this.#_o;this.#co=[(c[0]-s)/a,(c[1]-r)/o]}static initialize(e,t){mv.initialize(e,t),Lw._defaultColor||=t.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(e,t){switch(e){case If.HIGHLIGHT_COLOR:Lw._defaultColor=t;break;case If.HIGHLIGHT_THICKNESS:Lw._defaultThickness=t}}translateInPage(e,t){}get toolbarPosition(){return this.#co}get commentButtonPosition(){return this.#lo}updateParams(e,t){switch(e){case If.HIGHLIGHT_COLOR:this.#ta(t);break;case If.HIGHLIGHT_THICKNESS:this.#Ro(t)}}static get defaultPropertiesToUpdate(){return[[If.HIGHLIGHT_COLOR,Lw._defaultColor],[If.HIGHLIGHT_THICKNESS,Lw._defaultThickness]]}get propertiesToUpdate(){return[[If.HIGHLIGHT_COLOR,this.color||Lw._defaultColor],[If.HIGHLIGHT_THICKNESS,this.#Wa||Lw._defaultThickness],[If.HIGHLIGHT_FREE,this.#To]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#A,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#s?.updateColor(this.color),super.onUpdatedColor()}#ta(e){const t=(e,t)=>{this.color=e,this.opacity=t,this.onUpdatedColor()},n=this.color,i=this.opacity;this.addCommands({cmd:t.bind(this,e,Lw._defaultOpacity),undo:t.bind(this,n,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:If.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(e)},!0)}#Ro(e){const t=this.#Wa,n=e=>{this.#Wa=e,this.#Lo(e)};this.addCommands({cmd:n.bind(this,e),undo:n.bind(this,t),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:If.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)}get toolbarButtons(){if(this._uiManager.highlightColors){return[["colorPicker",this.#s=new Vx({editor:this})]]}return super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#jo())}getBaseTranslation(){return[0,0]}getRect(e,t){return super.getRect(e,t,this.#jo())}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){this.#Oo(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.#Do(),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?this.#Oo():e&&(this.#Do(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),this.show(this._isVisible),t&&this.select()}#Lo(e){this.#To&&(this.#Io({highlightOutlines:this.#Eo.getNewOutline(e/2)}),this.fixAndSetPosition(),this.setDims())}#Oo(){null!==this.#A&&this.parent&&(this.parent.drawLayer.remove(this.#A),this.#A=null,this.parent.drawLayer.remove(this.#ko),this.#ko=null)}#Do(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parent;null===this.#A&&(({id:this.#A,clipPathId:this.#wo}=e.drawLayer.draw({bbox:this.#Eo.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#To},path:{d:this.#Eo.toSVGPath()}},!1,!0)),this.#ko=e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#To},bbox:this.#_o.box,path:{d:this.#_o.toSVGPath()}},this.#To),this.#Ao&&(this.#Ao.style.clipPath=this.#wo))}static#Mo(e,t){let[n,i,s,r]=e;switch(t){case 90:return[1-i-r,n,r,s];case 180:return[1-n-s,1-i-r,s,r];case 270:return[i,1-n-s,r,s]}return[n,i,s,r]}rotate(e){const{drawLayer:t}=this.parent;let n;this.#To?(e=(e-this.rotation+360)%360,n=Lw.#Mo(this.#Eo.box,e)):n=Lw.#Mo([this.x,this.y,this.width,this.height],e),t.updateProperties(this.#A,{bbox:n,root:{"data-main-rotation":e}}),t.updateProperties(this.#ko,{bbox:Lw.#Mo(this.#_o.box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;const e=super.render();this.#mt&&(e.setAttribute("aria-label",this.#mt),e.setAttribute("role","mark")),this.#To?e.classList.add("free"):this.div.addEventListener("keydown",this.#Fo.bind(this),{signal:this._uiManager._signal});const t=this.#Ao=document.createElement("div");return e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal",t.style.clipPath=this.#wo,this.setDims(),iv(this,this.#Ao,["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#ko,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#ko,{rootClass:{hovered:!1}})}#Fo(e){Lw._keyboardManager.exec(this,e)}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:this.#Bo(!0);break;case 1:case 3:this.#Bo(!1)}}#Bo(e){if(!this.#vo)return;const t=window.getSelection();e?t.setPosition(this.#vo,this.#bo):t.setPosition(this.#So,this.#Co)}select(){super.select(),this.#ko&&this.parent?.drawLayer.updateProperties(this.#ko,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#ko&&(this.parent?.drawLayer.updateProperties(this.#ko,{rootClass:{selected:!1}}),this.#To||this.#Bo(!1))}get _mustFixPosition(){return!this.#To}show(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._isVisible;super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(this.#A,{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(this.#ko,{rootClass:{hidden:!e}}))}#jo(){return this.#To?this.rotation:0}#Uo(){if(this.#To)return null;const[e,t]=this.pageDimensions,[n,i]=this.pageTranslation,s=this.#xo,r=new Float32Array(8*s.length);let a=0;for(const{x:o,y:l,width:c,height:d}of s){const s=o*e+n,u=(1-l)*t+i;r[a]=r[a+4]=s,r[a+1]=r[a+3]=u,r[a+2]=r[a+6]=s+c*e,r[a+5]=r[a+7]=u-d*t,a+=8}return r}#zo(e){return this.#Eo.serialize(e,this.#jo())}static startHighlighting(e,t,n){let{target:i,x:s,y:r}=n;const{x:a,y:o,width:l,height:c}=i.getBoundingClientRect(),d=new AbortController,u=e.combinedSignal(d),h=t=>{d.abort(),this.#Vo(e,t)};window.addEventListener("blur",h,{signal:u}),window.addEventListener("pointerup",h,{signal:u}),window.addEventListener("pointerdown",By,{capture:!0,passive:!1,signal:u}),window.addEventListener("contextmenu",Fy,{signal:u}),i.addEventListener("pointermove",this.#Ho.bind(this,e),{signal:u}),this._freeHighlight=new Mw({x:s,y:r},[a,o,l,c],e.scale,this._defaultThickness/2,t,.001),({id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0))}static#Ho(e,t){this._freeHighlight.add(t)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#Vo(e,t){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(e,t,n){let i=null;if(e instanceof bw){const{data:{quadPoints:t,rect:n,rotation:s,id:r,color:a,opacity:o,popupRef:l,richText:c,contentsObj:d,creationDate:u,modificationDate:h},parent:{page:{pageNumber:p}}}=e;i=e={annotationType:Nf.HIGHLIGHT,color:Array.from(a),opacity:o,quadPoints:t,boxes:null,pageIndex:p-1,rect:n.slice(0),rotation:s,annotationElementId:r,id:r,deleted:!1,popupRef:l,richText:c,comment:d?.str||null,creationDate:u,modificationDate:h}}else if(e instanceof vw){const{data:{inkLists:t,rect:n,rotation:s,id:r,color:a,borderStyle:{rawWidth:o},popupRef:l,richText:c,contentsObj:d,creationDate:u,modificationDate:h},parent:{page:{pageNumber:p}}}=e;i=e={annotationType:Nf.HIGHLIGHT,color:Array.from(a),thickness:o,inkLists:t,boxes:null,pageIndex:p-1,rect:n.slice(0),rotation:s,annotationElementId:r,id:r,deleted:!1,popupRef:l,richText:c,comment:d?.str||null,creationDate:u,modificationDate:h}}const{color:s,quadPoints:r,inkLists:a,opacity:o}=e,l=await super.deserialize(e,t,n);l.color=xy.makeHexColor(...s),l.opacity=o||1,a&&(l.#Wa=e.thickness),l._initialData=i,e.comment&&l.setCommentData(e);const[c,d]=l.pageDimensions,[u,h]=l.pageTranslation;if(r){const e=l.#xo=[];for(let t=0;t<r.length;t+=8)e.push({x:(r[t]-u)/c,y:1-(r[t+1]-h)/d,width:(r[t+2]-r[t])/c,height:(r[t+1]-r[t+5])/d});l.#Po(),l.#Do(),l.rotate(l.rotation)}else if(a){l.#To=!0;const e=a[0],n={x:e[0]-u,y:d-(e[1]-h)},i=new Mw(n,[0,0,c,d],1,l.#Wa/2,!0,.001);for(let t=0,a=e.length;t<a;t+=2)n.x=e[t]-u,n.y=d-(e[t+1]-h),i.add(n);const{id:s,clipPathId:r}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:l.color,"fill-opacity":l._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:i.toSVGPath()}},!0,!0);l.#Io({highlightOutlines:i.getOutlines(),highlightId:s,clipPathId:r}),l.#Do(),l.rotate(l.parentRotation)}return l}serialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const t=mv._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),n=super.serialize(e);return Object.assign(n,{color:t,opacity:this.opacity,thickness:this.#Wa,quadPoints:this.#Uo(),outlines:this.#zo(n.rect)}),this.addComment(n),this.annotationElementId&&!this.#La(n)?null:(n.id=this.annotationElementId,n)}#La(e){const{color:t}=this._initialData;return this.hasEditedComment||e.color.some((e,n)=>e!==t[n])}renderAnnotationElement(e){return this.deleted?(e.hide(),null):(e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class jw{#$o=(()=>Object.create(null))();updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,n]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,n)}updateSVGProperty(e,t){this.#$o[e]=t}toSVGProperties(){const e=this.#$o;return this.#$o=Object.create(null),{root:e}}reset(){this.#$o=Object.create(null)}updateAll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;this.updateProperties(e)}clone(){sy("Not implemented")}}class Ow extends mv{#qo=null;#Go;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#Wo=null;static#Ko=null;static#Qo=null;static _INNER_MARGIN=3;constructor(e){super(e),this.#Go=e.mustBeCommitted||!1,this._addOutlines(e)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(e){e.drawOutlines&&(this.#Xo(e),this.#Do())}#Xo(e){let{drawOutlines:t,drawId:n,drawingOptions:i}=e;this.#qo=t,this._drawingOptions||=i,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),n>=0?(this._drawId=n,this.parent.drawLayer.finalizeDraw(n,t.defaultProperties)):this._drawId=this.#Yo(t,this.parent),this.#Jo(t.box)}#Yo(e,t){const{id:n}=t.drawLayer.draw(Ow._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return n}static _mergeSVGProperties(e,t){const n=new Set(Object.keys(e));for(const[i,s]of Object.entries(t))n.has(i)?Object.assign(e[i],s):e[i]=s;return e}static getDefaultDrawingOptions(e){sy("Not implemented")}static get typesMap(){sy("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,t){const n=this.typesMap.get(e);n&&this._defaultDrawingOptions.updateProperty(n,t),this._currentParent&&(Ow.#Wo.updateProperty(n,t),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,t){const n=this.constructor.typesMap.get(e);n&&this._updateProperty(e,n,t)}static get defaultPropertiesToUpdate(){const e=[],t=this._defaultDrawingOptions;for(const[n,i]of this.typesMap)e.push([n,t[i]]);return e}get propertiesToUpdate(){const e=[],{_drawingOptions:t}=this;for(const[n,i]of this.constructor.typesMap)e.push([n,t[i]]);return e}_updateProperty(e,t,n){const i=this._drawingOptions,s=i[t],r=n=>{i.updateProperty(t,n);const s=this.#qo.updateProperty(t,n);s&&this.#Jo(s),this.parent?.drawLayer.updateProperties(this._drawId,i.toSVGProperties()),e===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:r.bind(this,n),undo:r.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,Ow._mergeSVGProperties(this.#qo.getPathResizingSVGProperties(this.#Zo()),{bbox:this.#el()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,Ow._mergeSVGProperties(this.#qo.getPathResizedSVGProperties(this.#Zo()),{bbox:this.#el()}))}_onTranslating(e,t){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#el()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,Ow._mergeSVGProperties(this.#qo.getPathTranslatedSVGProperties(this.#Zo(),this.parentDimensions),{bbox:this.#el()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#Go&&(this.#Go=!1,this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){this.#Oo(),super.remove()}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.#Do(),this.#Jo(this.#qo.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),this.#Oo()):e&&(this._uiManager.addShouldRescale(this),this.#Do(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),t&&this.select()}#Oo(){null!==this._drawId&&this.parent&&(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#Do(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parent;null!==this._drawId&&this.parent===e||(null===this._drawId?(this._drawingOptions.updateAll(),this._drawId=this.#Yo(this.#qo,e)):this.parent.drawLayer.updateParent(this._drawId,e.drawLayer))}#tl(e){let[t,n,i,s]=e;const{parentDimensions:[r,a],rotation:o}=this;switch(o){case 90:return[n,1-t,i*(a/r),s*(r/a)];case 180:return[1-t,1-n,i,s];case 270:return[1-n,t,i*(a/r),s*(r/a)];default:return[t,n,i,s]}}#Zo(){const{x:e,y:t,width:n,height:i,parentDimensions:[s,r],rotation:a}=this;switch(a){case 90:return[1-t,e,n*(s/r),i*(r/s)];case 180:return[1-e,1-t,n,i];case 270:return[t,1-e,n*(s/r),i*(r/s)];default:return[e,t,n,i]}}#Jo(e){[this.x,this.y,this.width,this.height]=this.#tl(e),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#el(){const{x:e,y:t,width:n,height:i,rotation:s,parentRotation:r,parentDimensions:[a,o]}=this;switch((4*s+r)/90){case 1:return[1-t-i,e,i,n];case 2:return[1-e-n,1-t-i,n,i];case 3:return[t,1-e-n,i,n];case 4:return[e,t-n*(a/o),i*(o/a),n*(a/o)];case 5:return[1-t,e,n*(a/o),i*(o/a)];case 6:return[1-e-i*(o/a),1-t,i*(o/a),n*(a/o)];case 7:return[t-n*(a/o),1-e-i*(o/a),n*(a/o),i*(o/a)];case 8:return[e-n,t-i,n,i];case 9:return[1-t,e-n,i,n];case 10:return[1-e,1-t,n,i];case 11:return[t-i,1-e,i,n];case 12:return[e-i*(o/a),t,i*(o/a),n*(a/o)];case 13:return[1-t-n*(a/o),e-i*(o/a),n*(a/o),i*(o/a)];case 14:return[1-e,1-t-n*(a/o),i*(o/a),n*(a/o)];case 15:return[t,1-e,n*(a/o),i*(o/a)];default:return[e,t,n,i]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,Ow._mergeSVGProperties({bbox:this.#el()},this.#qo.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#Jo(this.#qo.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let e,t;this._isCopy&&(e=this.x,t=this.y);const n=super.render();n.classList.add("draw");const i=document.createElement("div");return n.append(i),i.setAttribute("aria-hidden","true"),i.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(e,t),n}static createDrawerInstance(e,t,n,i,s){sy("Not implemented")}static startDrawing(e,t,n,i){const{target:s,offsetX:r,offsetY:a,pointerId:o,pointerType:l}=i;if(sv.isInitializedAndDifferentPointerType(l))return;const{viewport:{rotation:c}}=e,{width:d,height:u}=s.getBoundingClientRect(),h=Ow.#Ko=new AbortController,p=e.combinedSignal(h);sv.setPointer(l,o),window.addEventListener("pointerup",e=>{sv.isSamePointerIdOrRemove(e.pointerId)&&this._endDraw(e)},{signal:p}),window.addEventListener("pointercancel",e=>{sv.isSamePointerIdOrRemove(e.pointerId)&&this._currentParent.endDrawingSession()},{signal:p}),window.addEventListener("pointerdown",e=>{sv.isSamePointerType(e.pointerType)&&(sv.initializeAndAddPointerId(e.pointerId),Ow.#Wo.isCancellable()&&(Ow.#Wo.removeLastElement(),Ow.#Wo.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:p}),window.addEventListener("contextmenu",Fy,{signal:p}),s.addEventListener("pointermove",this._drawMove.bind(this),{signal:p}),s.addEventListener("touchmove",e=>{sv.isSameTimeStamp(e.timeStamp)&&By(e)},{signal:p}),e.toggleDrawing(),t._editorUndoBar?.hide(),Ow.#Wo?e.drawLayer.updateProperties(this._currentDrawId,Ow.#Wo.startNew(r,a,d,u,c)):(t.updateUIForDefaultProperties(this),Ow.#Wo=this.createDrawerInstance(r,a,d,u,c),Ow.#Qo=this.getDefaultDrawingOptions(),this._currentParent=e,({id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(Ow.#Qo.toSVGProperties(),Ow.#Wo.defaultSVGProperties),!0,!1)))}static _drawMove(e){if(sv.isSameTimeStamp(e.timeStamp),!Ow.#Wo)return;const{offsetX:t,offsetY:n,pointerId:i}=e;sv.isSamePointerId(i)&&(sv.isUsingMultiplePointers()?this._endDraw(e):(this._currentParent.drawLayer.updateProperties(this._currentDrawId,Ow.#Wo.add(t,n)),sv.setTimeStamp(e.timeStamp),By(e)))}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,Ow.#Wo=null,Ow.#Qo=null,sv.clearTimeStamp()),Ow.#Ko&&(Ow.#Ko.abort(),Ow.#Ko=null,sv.clearPointerIds())}static _endDraw(e){const t=this._currentParent;if(t){if(t.toggleDrawing(!0),this._cleanup(!1),e?.target===t.div&&t.drawLayer.updateProperties(this._currentDrawId,Ow.#Wo.end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){const e=Ow.#Wo,n=this._currentDrawId,i=e.getLastElement();return void t.addCommands({cmd:()=>{t.drawLayer.updateProperties(n,e.setLastElement(i))},undo:()=>{t.drawLayer.updateProperties(n,e.removeLastElement())},mustExec:!1,type:If.DRAW_STEP})}this.endDrawing(!1)}}static endDrawing(e){const t=this._currentParent;if(!t)return null;if(t.toggleDrawing(!0),t.cleanUndoStack(If.DRAW_STEP),!Ow.#Wo.isEmpty()){const{pageDimensions:[n,i],scale:s}=t,r=t.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:Ow.#Wo.getOutlines(n*s,i*s,s,this._INNER_MARGIN),drawingOptions:Ow.#Qo,mustBeCommitted:!e});return this._cleanup(!0),r}return t.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,t,n,i,s,r){sy("Not implemented")}static async deserialize(e,t,n){const{rawDims:{pageWidth:i,pageHeight:s,pageX:r,pageY:a}}=t.viewport,o=this.deserializeDraw(r,a,i,s,this._INNER_MARGIN,e),l=await super.deserialize(e,t,n);return l.createDrawingOptions(e),l.#Xo({drawOutlines:o}),l.#Do(),l.onScaleChanging(),l.rotate(),l}serializeDraw(e){const[t,n]=this.pageTranslation,[i,s]=this.pageDimensions;return this.#qo.serialize([t,n,i,s],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class Fw{#za=(()=>new Float64Array(6))();#la;#nl;#gs;#Wa;#Ka;#il="";#sl=0;#yo=(()=>new Bw)();#rl;#al;constructor(e,t,n,i,s,r){this.#rl=n,this.#al=i,this.#gs=s,this.#Wa=r,[e,t]=this.#ol(e,t);const a=this.#la=[NaN,NaN,NaN,NaN,e,t];this.#Ka=[e,t],this.#nl=[{line:a,points:this.#Ka}],this.#za.set(a,0)}updateProperty(e,t){"stroke-width"===e&&(this.#Wa=t)}#ol(e,t){return kw._normalizePoint(e,t,this.#rl,this.#al,this.#gs)}isEmpty(){return!this.#nl||0===this.#nl.length}isCancellable(){return this.#Ka.length<=10}add(e,t){[e,t]=this.#ol(e,t);const[n,i,s,r]=this.#za.subarray(2,6),a=e-s,o=t-r;return Math.hypot(this.#rl*a,this.#al*o)<=2?null:(this.#Ka.push(e,t),isNaN(n)?(this.#za.set([s,r,e,t],2),this.#la.push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(this.#za[0])&&this.#la.splice(6,6),this.#za.set([n,i,s,r,e,t],0),this.#la.push(...kw.createBezierPoints(n,i,s,r,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const n=this.add(e,t);return n||(2===this.#Ka.length?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,n,i,s){this.#rl=n,this.#al=i,this.#gs=s,[e,t]=this.#ol(e,t);const r=this.#la=[NaN,NaN,NaN,NaN,e,t];this.#Ka=[e,t];const a=this.#nl.at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),this.#nl.push({line:r,points:this.#Ka}),this.#za.set(r,0),this.#sl=0,this.toSVGPath(),null}getLastElement(){return this.#nl.at(-1)}setLastElement(e){return this.#nl?(this.#nl.push(e),this.#la=e.line,this.#Ka=e.points,this.#sl=0,{path:{d:this.toSVGPath()}}):this.#yo.setLastElement(e)}removeLastElement(){if(!this.#nl)return this.#yo.removeLastElement();this.#nl.pop(),this.#il="";for(let e=0,t=this.#nl.length;e<t;e++){const{line:t,points:n}=this.#nl[e];this.#la=t,this.#Ka=n,this.#sl=0,this.toSVGPath()}return{path:{d:this.#il}}}toSVGPath(){const e=kw.svgRound(this.#la[4]),t=kw.svgRound(this.#la[5]);if(2===this.#Ka.length)return this.#il=`${this.#il} M ${e} ${t} Z`,this.#il;if(this.#Ka.length<=6){const n=this.#il.lastIndexOf("M");this.#il=`${this.#il.slice(0,n)} M ${e} ${t}`,this.#sl=6}if(4===this.#Ka.length){const e=kw.svgRound(this.#la[10]),t=kw.svgRound(this.#la[11]);return this.#il=`${this.#il} L ${e} ${t}`,this.#sl=12,this.#il}const n=[];0===this.#sl&&(n.push(`M ${e} ${t}`),this.#sl=6);for(let i=this.#sl,s=this.#la.length;i<s;i+=6){const[e,t,s,r,a,o]=this.#la.slice(i,i+6).map(kw.svgRound);n.push(`C${e} ${t} ${s} ${r} ${a} ${o}`)}return this.#il+=n.join(" "),this.#sl=this.#la.length,this.#il}getOutlines(e,t,n,i){const s=this.#nl.at(-1);return s.line=new Float32Array(s.line),s.points=new Float32Array(s.points),this.#yo.build(this.#nl,e,t,n,this.#gs,this.#Wa,i),this.#za=null,this.#la=null,this.#nl=null,this.#il=null,this.#yo}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class Bw extends kw{#ro;#ll=0;#Fa;#nl;#rl;#al;#cl;#gs;#Wa;build(e,t,n,i,s,r,a){this.#rl=t,this.#al=n,this.#cl=i,this.#gs=s,this.#Wa=r,this.#Fa=a??0,this.#nl=e,this.#dl()}get thickness(){return this.#Wa}setLastElement(e){return this.#nl.push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#nl.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const e=[];for(const{line:t}of this.#nl)if(e.push(`M${kw.svgRound(t[4])} ${kw.svgRound(t[5])}`),6!==t.length)if(12===t.length&&isNaN(t[6]))e.push(`L${kw.svgRound(t[10])} ${kw.svgRound(t[11])}`);else for(let n=6,i=t.length;n<i;n+=6){const[i,s,r,a,o,l]=t.subarray(n,n+6).map(kw.svgRound);e.push(`C${i} ${s} ${r} ${a} ${o} ${l}`)}else e.push("Z");return e.join("")}serialize(e,t){let[n,i,s,r]=e;const a=[],o=[],[l,c,d,u]=this.#ul();let h,p,m,g,f,y,v,b,x;switch(this.#gs){case 0:x=kw._rescale,h=n,p=i+r,m=s,g=-r,f=n+l*s,y=i+(1-c-u)*r,v=n+(l+d)*s,b=i+(1-c)*r;break;case 90:x=kw._rescaleAndSwap,h=n,p=i,m=s,g=r,f=n+c*s,y=i+l*r,v=n+(c+u)*s,b=i+(l+d)*r;break;case 180:x=kw._rescale,h=n+s,p=i,m=-s,g=r,f=n+(1-l-d)*s,y=i+c*r,v=n+(1-l)*s,b=i+(c+u)*r;break;case 270:x=kw._rescaleAndSwap,h=n+s,p=i+r,m=-s,g=-r,f=n+(1-c-u)*s,y=i+(1-l-d)*r,v=n+(1-c)*s,b=i+(1-l)*r}for(const{line:w,points:_}of this.#nl)a.push(x(w,h,p,m,g,t?new Array(w.length):null)),o.push(x(_,h,p,m,g,t?new Array(_.length):null));return{lines:a,points:o,rect:[f,y,v,b]}}static deserialize(e,t,n,i,s,r){let{paths:{lines:a,points:o},rotation:l,thickness:c}=r;const d=[];let u,h,p,m,g;switch(l){case 0:g=kw._rescale,u=-e/n,h=t/i+1,p=1/n,m=-1/i;break;case 90:g=kw._rescaleAndSwap,u=-t/i,h=-e/n,p=1/i,m=1/n;break;case 180:g=kw._rescale,u=e/n+1,h=-t/i,p=-1/n,m=1/i;break;case 270:g=kw._rescaleAndSwap,u=t/i+1,h=e/n+1,p=-1/i,m=-1/n}if(!a){a=[];for(const e of o){const t=e.length;if(2===t){a.push(new Float32Array([NaN,NaN,NaN,NaN,e[0],e[1]]));continue}if(4===t){a.push(new Float32Array([NaN,NaN,NaN,NaN,e[0],e[1],NaN,NaN,NaN,NaN,e[2],e[3]]));continue}const n=new Float32Array(3*(t-2));a.push(n);let[i,s,r,o]=e.subarray(0,4);n.set([NaN,NaN,NaN,NaN,i,s],0);for(let a=4;a<t;a+=2){const t=e[a],l=e[a+1];n.set(kw.createBezierPoints(i,s,r,o,t,l),3*(a-2)),[i,s,r,o]=[r,o,t,l]}}}for(let y=0,v=a.length;y<v;y++)d.push({line:g(a[y].map(e=>e??NaN),u,h,p,m),points:g(o[y].map(e=>e??NaN),u,h,p,m)});const f=new this.prototype.constructor;return f.build(d,n,i,1,l,c,s),f}#hl(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.#Wa;const t=this.#Fa+e/2*this.#cl;return this.#gs%180===0?[t/this.#rl,t/this.#al]:[t/this.#al,t/this.#rl]}#ul(){const[e,t,n,i]=this.#ro,[s,r]=this.#hl(0);return[e+s,t+r,n-2*s,i-2*r]}#dl(){const e=this.#ro=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:i}of this.#nl){if(i.length<=12){for(let t=4,n=i.length;t<n;t+=6)xy.pointBoundingBox(i[t],i[t+1],e);continue}let t=i[4],n=i[5];for(let s=6,r=i.length;s<r;s+=6){const[r,a,o,l,c,d]=i.subarray(s,s+6);xy.bezierBoundingBox(t,n,r,a,o,l,c,d,e),t=c,n=d}}const[t,n]=this.#hl();e[0]=Ay(e[0]-t,0,1),e[1]=Ay(e[1]-n,0,1),e[2]=Ay(e[2]+t,0,1),e[3]=Ay(e[3]+n,0,1),e[2]-=e[0],e[3]-=e[1]}get box(){return this.#ro}updateProperty(e,t){return"stroke-width"===e?this.#Ro(t):null}#Ro(e){const[t,n]=this.#hl();this.#Wa=e;const[i,s]=this.#hl(),[r,a]=[i-t,s-n],o=this.#ro;return o[0]-=r,o[1]-=a,o[2]+=2*r,o[3]+=2*a,o}updateParentDimensions(e,t){let[n,i]=e;const[s,r]=this.#hl();this.#rl=n,this.#al=i,this.#cl=t;const[a,o]=this.#hl(),l=a-s,c=o-r,d=this.#ro;return d[0]-=l,d[1]-=c,d[2]+=2*l,d[3]+=2*c,d}updateRotation(e){return this.#ll=e,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#ro.map(kw.svgRound).join(" ")}get defaultProperties(){const[e,t]=this.#ro;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${kw.svgRound(e)} ${kw.svgRound(t)}`}}}get rotationTransform(){const[,,e,t]=this.#ro;let n=0,i=0,s=0,r=0,a=0,o=0;switch(this.#ll){case 90:i=t/e,s=-e/t,a=e;break;case 180:n=-1,r=-1,a=e,o=t;break;case 270:i=-t/e,s=e/t,o=t;break;default:return""}return`matrix(${n} ${i} ${s} ${r} ${kw.svgRound(a)} ${kw.svgRound(o)})`}getPathResizingSVGProperties(e){let[t,n,i,s]=e;const[r,a]=this.#hl(),[o,l,c,d]=this.#ro;if(Math.abs(c-r)<=kw.PRECISION||Math.abs(d-a)<=kw.PRECISION){const e=t+i/2-(o+c/2),r=n+s/2-(l+d/2);return{path:{"transform-origin":`${kw.svgRound(t)} ${kw.svgRound(n)}`,transform:`${this.rotationTransform} translate(${e} ${r})`}}}const u=(i-2*r)/(c-2*r),h=(s-2*a)/(d-2*a),p=c/i,m=d/s;return{path:{"transform-origin":`${kw.svgRound(o)} ${kw.svgRound(l)}`,transform:`${this.rotationTransform} scale(${p} ${m}) translate(${kw.svgRound(r)} ${kw.svgRound(a)}) scale(${u} ${h}) translate(${kw.svgRound(-r)} ${kw.svgRound(-a)})`}}}getPathResizedSVGProperties(e){let[t,n,i,s]=e;const[r,a]=this.#hl(),o=this.#ro,[l,c,d,u]=o;if(o[0]=t,o[1]=n,o[2]=i,o[3]=s,Math.abs(d-r)<=kw.PRECISION||Math.abs(u-a)<=kw.PRECISION){const e=t+i/2-(l+d/2),r=n+s/2-(c+u/2);for(const{line:t,points:n}of this.#nl)kw._translate(t,e,r,t),kw._translate(n,e,r,n);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${kw.svgRound(t)} ${kw.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const h=(i-2*r)/(d-2*r),p=(s-2*a)/(u-2*a),m=-h*(l+r)+t+r,g=-p*(c+a)+n+a;if(1!==h||1!==p||0!==m||0!==g)for(const{line:f,points:y}of this.#nl)kw._rescale(f,m,g,h,p,f),kw._rescale(y,m,g,h,p,y);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${kw.svgRound(t)} ${kw.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties(e,t){let[n,i]=e;const[s,r]=t,a=this.#ro,o=n-a[0],l=i-a[1];if(this.#rl===s&&this.#al===r)for(const{line:c,points:d}of this.#nl)kw._translate(c,o,l,c),kw._translate(d,o,l,d);else{const e=this.#rl/s,t=this.#al/r;this.#rl=s,this.#al=r;for(const{line:n,points:i}of this.#nl)kw._rescale(n,o,l,e,t,n),kw._rescale(i,o,l,e,t,i);a[2]*=e,a[3]*=t}return a[0]=n,a[1]=i,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${kw.svgRound(n)} ${kw.svgRound(i)}`}}}get defaultSVGProperties(){const e=this.#ro;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${kw.svgRound(e[0])} ${kw.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}}class Uw extends jw{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:mv._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){"stroke-width"===e&&(t??=this["stroke-width"],t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new Uw(this._viewParameters);return e.updateAll(this),e}}class zw extends Ow{static _type="ink";static _editorType=(()=>Nf.INK)();static _defaultDrawingOptions=null;constructor(e){super({...e,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(e,t){mv.initialize(e,t),this._defaultDrawingOptions=new Uw(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!0}static get typesMap(){return ly(this,"typesMap",new Map([[If.INK_THICKNESS,"stroke-width"],[If.INK_COLOR,"stroke"],[If.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,t,n,i,s){return new Fw(e,t,n,i,s,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,t,n,i,s,r){return Bw.deserialize(e,t,n,i,s,r)}static async deserialize(e,t,n){let i=null;if(e instanceof vw){const{data:{inkLists:t,rect:n,rotation:s,id:r,color:a,opacity:o,borderStyle:{rawWidth:l},popupRef:c,richText:d,contentsObj:u,creationDate:h,modificationDate:p},parent:{page:{pageNumber:m}}}=e;i=e={annotationType:Nf.INK,color:Array.from(a),thickness:l,opacity:o,paths:{points:t},boxes:null,pageIndex:m-1,rect:n.slice(0),rotation:s,annotationElementId:r,id:r,deleted:!1,popupRef:c,richText:d,comment:u?.str||null,creationDate:h,modificationDate:p}}const s=await super.deserialize(e,t,n);return s._initialData=i,e.comment&&s.setCommentData(e),s}get toolbarButtons(){return this._colorPicker||=new Hx(this),[["colorPicker",this._colorPicker]]}get colorType(){return If.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:e,_drawingOptions:t,parent:n}=this;t.updateSVGProperty("stroke-width"),n.drawLayer.updateProperties(e,t.toSVGProperties())}static onScaleChangingWhenDrawing(){const e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions(e){let{color:t,thickness:n,opacity:i}=e;this._drawingOptions=zw.getDefaultDrawingOptions({stroke:xy.makeHexColor(...t),"stroke-width":n,"stroke-opacity":i})}serialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:t,points:n}=this.serializeDraw(e),{_drawingOptions:{stroke:i,"stroke-opacity":s,"stroke-width":r}}=this,a=Object.assign(super.serialize(e),{color:mv._colorManager.convert(i),opacity:s,thickness:r,paths:{lines:t,points:n}});return this.addComment(a),e?(a.isCopy=!0,a):this.annotationElementId&&!this.#La(a)?null:(a.id=this.annotationElementId,a)}#La(e){const{color:t,thickness:n,opacity:i,pageIndex:s}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||e.color.some((e,n)=>e!==t[n])||e.thickness!==n||e.opacity!==i||e.pageIndex!==s}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;const{points:t,rect:n}=this.serializeDraw(!1);return e.updateEdited({rect:n,thickness:this._drawingOptions["stroke-width"],points:t,popup:this.comment}),null}}class Vw extends Bw{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}class Hw{static#pl={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#ml(e,t,n,i){return i-=t,0===(n-=e)?i>0?0:4:1===n?i+6:2-i}static#gl=(()=>new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]))();static#fl(e,t,n,i,s,r,a){const o=this.#ml(n,i,s,r);for(let l=0;l<8;l++){const s=(-l+o-a+16)%8;if(0!==e[(n+this.#gl[2*s])*t+(i+this.#gl[2*s+1])])return s}return-1}static#yl(e,t,n,i,s,r,a){const o=this.#ml(n,i,s,r);for(let l=0;l<8;l++){const s=(l+o+a+16)%8;if(0!==e[(n+this.#gl[2*s])*t+(i+this.#gl[2*s+1])])return s}return-1}static#vl(e,t,n,i){const s=e.length,r=new Int32Array(s);for(let c=0;c<s;c++)r[c]=e[c]<=i?1:0;for(let c=1;c<n-1;c++)r[c*t]=r[c*t+t-1]=0;for(let c=0;c<t;c++)r[c]=r[t*n-1-c]=0;let a,o=1;const l=[];for(let c=1;c<n-1;c++){a=1;for(let e=1;e<t-1;e++){const n=c*t+e,i=r[n];if(0===i)continue;let s=c,d=e;if(1===i&&0===r[n-1])o+=1,d-=1;else{if(!(i>=1&&0===r[n+1])){1!==i&&(a=Math.abs(i));continue}o+=1,d+=1,i>1&&(a=i)}const u=[e,c],h=d===e+1,p={isHole:h,points:u,id:o,parent:0};let m;l.push(p);for(const e of l)if(e.id===a){m=e;break}m?m.isHole?p.parent=h?m.parent:a:p.parent=h?a:m.parent:p.parent=h?a:0;const g=this.#fl(r,t,c,e,s,d,0);if(-1===g){r[n]=-o,1!==r[n]&&(a=Math.abs(r[n]));continue}let f=this.#gl[2*g],y=this.#gl[2*g+1];const v=c+f,b=e+y;s=v,d=b;let x=c,w=e;for(;;){const i=this.#yl(r,t,x,w,s,d,1);f=this.#gl[2*i],y=this.#gl[2*i+1];const l=x+f,h=w+y;u.push(h,l);const p=x*t+w;if(0===r[p+1]?r[p]=-o:1===r[p]&&(r[p]=o),l===c&&h===e&&x===v&&w===b){1!==r[n]&&(a=Math.abs(r[n]));break}s=x,d=w,x=l,w=h}}}return l}static#bl(e,t,n,i){if(n-t<=4){for(let s=t;s<n-2;s+=2)i.push(e[s],e[s+1]);return}const s=e[t],r=e[t+1],a=e[n-4]-s,o=e[n-3]-r,l=Math.hypot(a,o),c=a/l,d=o/l,u=c*r-d*s,h=o/a,p=1/l,m=Math.atan(h),g=Math.cos(m),f=Math.sin(m),y=p*(Math.abs(g)+Math.abs(f)),v=p*(1-y+y**2),b=Math.max(Math.atan(Math.abs(f+g)*v),Math.atan(Math.abs(f-g)*v));let x=0,w=t;for(let _=t+2;_<n-2;_+=2){const t=Math.abs(u-c*e[_+1]+d*e[_]);t>x&&(w=_,x=t)}x>(l*b)**2?(this.#bl(e,t,w+2,i),this.#bl(e,w,n,i)):i.push(s,r)}static#xl(e){const t=[],n=e.length;return this.#bl(e,0,n,t),t.push(e[n-2],e[n-1]),t.length<=4?null:t}static#wl(e,t,n,i,s,r){const a=new Float32Array(r**2),o=-2*i**2,l=r>>1;for(let m=0;m<r;m++){const e=(m-l)**2;for(let t=0;t<r;t++)a[m*r+t]=Math.exp((e+(t-l)**2)/o)}const c=new Float32Array(256),d=-2*s**2;for(let m=0;m<256;m++)c[m]=Math.exp(m**2/d);const u=e.length,h=new Uint8Array(u),p=new Uint32Array(256);for(let m=0;m<n;m++)for(let i=0;i<t;i++){const s=m*t+i,o=e[s];let d=0,u=0;for(let h=0;h<r;h++){const s=m+h-l;if(!(s<0||s>=n))for(let n=0;n<r;n++){const p=i+n-l;if(p<0||p>=t)continue;const m=e[s*t+p],g=a[h*r+n]*c[Math.abs(m-o)];d+=m*g,u+=g}}p[h[s]=Math.round(d/u)]++}return[h,p]}static#_l(e){const t=new Uint32Array(256);for(const n of e)t[n]++;return t}static#Sl(e){const t=e.length,n=new Uint8ClampedArray(t>>2);let i=-1/0,s=1/0;for(let a=0,o=n.length;a<o;a++){const t=n[a]=e[a<<2];i=Math.max(i,t),s=Math.min(s,t)}const r=255/(i-s);for(let a=0,o=n.length;a<o;a++)n[a]=(n[a]-s)*r;return n}static#Cl(e){let t,n=-1/0,i=-1/0;const s=e.findIndex(e=>0!==e);let r=s,a=s;for(t=s;t<256;t++){const s=e[t];s>n&&(t-r>i&&(i=t-r,a=t-1),n=s,r=t)}for(t=a-1;t>=0&&!(e[t]>e[t+1]);t--);return t}static#Al(e){const t=e,{width:n,height:i}=e,{maxDim:s}=this.#pl;let r=n,a=i;if(n>s||i>s){let o=n,l=i,c=Math.log2(Math.max(n,i)/s);const d=Math.floor(c);c=c===d?d-1:d;for(let n=0;n<c;n++){r=Math.ceil(o/2),a=Math.ceil(l/2);const n=new OffscreenCanvas(r,a);n.getContext("2d").drawImage(e,0,0,o,l,0,0,r,a),o=r,l=a,e!==t&&e.close(),e=n.transferToImageBitmap()}const u=Math.min(s/r,s/a);r=Math.round(r*u),a=Math.round(a*u)}const o=new OffscreenCanvas(r,a).getContext("2d",{willReadFrequently:!0});o.fillStyle="white",o.fillRect(0,0,r,a),o.filter="grayscale(1)",o.drawImage(e,0,0,e.width,e.height,0,0,r,a);const l=o.getImageData(0,0,r,a).data;return[this.#Sl(l),r,a]}static extractContoursFromText(e,t,n,i,s,r){let{fontFamily:a,fontStyle:o,fontWeight:l}=t,c=new OffscreenCanvas(1,1),d=c.getContext("2d",{alpha:!1});const u=d.font=`${o} ${l} 200px ${a}`,{actualBoundingBoxLeft:h,actualBoundingBoxRight:p,actualBoundingBoxAscent:m,actualBoundingBoxDescent:g,fontBoundingBoxAscent:f,fontBoundingBoxDescent:y,width:v}=d.measureText(e),b=1.5,x=Math.ceil(Math.max(Math.abs(h)+Math.abs(p)||0,v)*b),w=Math.ceil(Math.max(Math.abs(m)+Math.abs(g)||200,Math.abs(f)+Math.abs(y)||200)*b);c=new OffscreenCanvas(x,w),d=c.getContext("2d",{alpha:!0,willReadFrequently:!0}),d.font=u,d.filter="grayscale(1)",d.fillStyle="white",d.fillRect(0,0,x,w),d.fillStyle="black",d.fillText(e,.5*x/2,1.5*w/2);const _=this.#Sl(d.getImageData(0,0,x,w).data),S=this.#_l(_),C=this.#Cl(S),A=this.#vl(_,x,w,C);return this.processDrawnLines({lines:{curves:A,width:x,height:w},pageWidth:n,pageHeight:i,rotation:s,innerMargin:r,mustSmooth:!0,areContours:!0})}static process(e,t,n,i,s){const[r,a,o]=this.#Al(e),[l,c]=this.#wl(r,a,o,Math.hypot(a,o)*this.#pl.sigmaSFactor,this.#pl.sigmaR,this.#pl.kernelSize),d=this.#Cl(c),u=this.#vl(l,a,o,d);return this.processDrawnLines({lines:{curves:u,width:a,height:o},pageWidth:t,pageHeight:n,rotation:i,innerMargin:s,mustSmooth:!0,areContours:!0})}static processDrawnLines(e){let{lines:t,pageWidth:n,pageHeight:i,rotation:s,innerMargin:r,mustSmooth:a,areContours:o}=e;s%180!==0&&([n,i]=[i,n]);const{curves:l,width:c,height:d}=t,u=t.thickness??0,h=[],p=Math.min(n/c,i/d),m=p/n,g=p/i,f=[];for(const{points:v}of l){const e=a?this.#xl(v):v;if(!e)continue;f.push(e);const t=e.length,n=new Float32Array(t),i=new Float32Array(3*(2===t?2:t-2));if(h.push({line:i,points:n}),2===t){n[0]=e[0]*m,n[1]=e[1]*g,i.set([NaN,NaN,NaN,NaN,n[0],n[1]],0);continue}let[s,r,o,l]=e;s*=m,r*=g,o*=m,l*=g,n.set([s,r,o,l],0),i.set([NaN,NaN,NaN,NaN,s,r],0);for(let a=4;a<t;a+=2){const t=n[a]=e[a]*m,c=n[a+1]=e[a+1]*g;i.set(kw.createBezierPoints(s,r,o,l,t,c),3*(a-2)),[s,r,o,l]=[o,l,t,c]}}if(0===h.length)return null;const y=o?new Vw:new Bw;return y.build(h,n,i,1,s,o?0:u,r),{outline:y,newCurves:f,areContours:o,thickness:u,width:c,height:d}}static async compressSignature(e){let t,{outlines:n,areContours:i,thickness:s,width:r,height:a}=e,o=1/0,l=-1/0,c=0;for(const v of n){c+=v.length;for(let e=2,t=v.length;e<t;e++){const t=v[e]-v[e-2];o=Math.min(o,t),l=Math.max(l,t)}}t=o>=-128&&l<=127?Int8Array:o>=-32768&&l<=32767?Int16Array:Int32Array;const d=n.length,u=8+3*d,h=new Uint32Array(u);let p=0;h[p++]=u*Uint32Array.BYTES_PER_ELEMENT+(c-2*d)*t.BYTES_PER_ELEMENT,h[p++]=0,h[p++]=r,h[p++]=a,h[p++]=i?0:1,h[p++]=Math.max(0,Math.floor(s??0)),h[p++]=d,h[p++]=t.BYTES_PER_ELEMENT;for(const v of n)h[p++]=v.length-2,h[p++]=v[0],h[p++]=v[1];const m=new CompressionStream("deflate-raw"),g=m.writable.getWriter();await g.ready,g.write(h);const f=t.prototype.constructor;for(const v of n){const e=new f(v.length-2);for(let t=2,n=v.length;t<n;t++)e[t-2]=v[t]-v[t-2];g.write(e)}g.close();const y=await new Response(m.readable).arrayBuffer();return Ey(new Uint8Array(y))}static async decompressSignature(e){try{const n=(t=e,Uint8Array.fromBase64?Uint8Array.fromBase64(t):yy(atob(t))),{readable:i,writable:s}=new DecompressionStream("deflate-raw"),r=s.getWriter();await r.ready,r.write(n).then(async()=>{await r.ready,await r.close()}).catch(()=>{});let a=null,o=0;for await(const e of i)a||=new Uint8Array(new Uint32Array(e.buffer,0,4)[0]),a.set(e,o),o+=e.length;const l=new Uint32Array(a.buffer,0,a.length>>2),c=l[1];if(0!==c)throw new Error(`Invalid version: ${c}`);const d=l[2],u=l[3],h=0===l[4],p=l[5],m=l[6],g=l[7],f=[],y=(8+3*m)*Uint32Array.BYTES_PER_ELEMENT;let v;switch(g){case Int8Array.BYTES_PER_ELEMENT:v=new Int8Array(a.buffer,y);break;case Int16Array.BYTES_PER_ELEMENT:v=new Int16Array(a.buffer,y);break;case Int32Array.BYTES_PER_ELEMENT:v=new Int32Array(a.buffer,y)}o=0;for(let e=0;e<m;e++){const t=l[3*e+8],n=new Float32Array(t+2);f.push(n);for(let i=0;i<2;i++)n[i]=l[3*e+8+i+1];for(let e=0;e<t;e++)n[e+2]=n[e]+v[o++]}return{areContours:h,thickness:p,outlines:f,width:d,height:u}}catch(n){return iy(`decompressSignature: ${n}`),null}var t}}class $w extends jw{constructor(){super(),super.updateProperties({fill:mv._defaultLineColor,"stroke-width":0})}clone(){const e=new $w;return e.updateAll(this),e}}class qw extends Uw{constructor(e){super(e),super.updateProperties({stroke:mv._defaultLineColor,"stroke-width":1})}clone(){const e=new qw(this._viewParameters);return e.updateAll(this),e}}class Gw extends Ow{#El=!1;#Tl=null;#kl=null;#Nl=null;static _type="signature";static _editorType=(()=>Nf.SIGNATURE)();static _defaultDrawingOptions=null;constructor(e){super({...e,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#kl=e.signatureData||null,this.#Tl=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(e,t){mv.initialize(e,t),this._defaultDrawingOptions=new $w,this._defaultDrawnSignatureOptions=new qw(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!1}static get typesMap(){return ly(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#Tl}}static computeTelemetryFinalData(e){const t=e.get("hasDescription");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){null!==this._drawId&&super.onScaleChanging()}render(){if(this.div)return this.div;let e,t;const{_isCopy:n}=this;if(n&&(this._isCopy=!1,e=this.x,t=this.y),super.render(),null===this._drawId)if(this.#kl){const{lines:e,mustSmooth:t,areContours:n,description:i,uuid:s,heightInPage:r}=this.#kl,{rawDims:{pageWidth:a,pageHeight:o},rotation:l}=this.parent.viewport,c=Hw.processDrawnLines({lines:e,pageWidth:a,pageHeight:o,rotation:l,innerMargin:Gw._INNER_MARGIN,mustSmooth:t,areContours:n});this.addSignature(c,r,i,s)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#Tl||""}));return n&&(this._isCopy=!0,this._moveAfterPaste(e,t)),this.div}setUuid(e){this.#Nl=e,this.addEditToolbar()}getUuid(){return this.#Nl}get description(){return this.#Tl}set description(e){this.#Tl=e,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:e})),super.addEditToolbar().then(t=>{t?.updateEditSignatureButton(e)}))}getSignaturePreview(){const{newCurves:e,areContours:t,thickness:n,width:i,height:s}=this.#kl,r=Math.max(i,s);return{areContours:t,outline:Hw.processDrawnLines({lines:{curves:e.map(e=>({points:e})),thickness:n,width:i,height:s},pageWidth:r,pageHeight:r,rotation:0,innerMargin:0,mustSmooth:!1,areContours:t}).outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(e,t,n,i){const{x:s,y:r}=this,{outline:a}=this.#kl=e;let o;this.#El=a instanceof Vw,this.description=n,this.#El?o=Gw.getDefaultDrawingOptions():(o=Gw._defaultDrawnSignatureOptions.clone(),o.updateProperties({"stroke-width":a.thickness})),this._addOutlines({drawOutlines:a,drawingOptions:o});const[,l]=this.pageDimensions;let c=t/l;c=c>=1?.5:c,this.width*=c/this.height,this.width>=1&&(c*=.9/this.width,this.width=.9),this.height=c,this.setDims(),this.x=s,this.y=r,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(i),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!i,hasDescription:!!n}}),this.div.hidden=!1}getFromImage(e){const{rawDims:{pageWidth:t,pageHeight:n},rotation:i}=this.parent.viewport;return Hw.process(e,t,n,i,Gw._INNER_MARGIN)}getFromText(e,t){const{rawDims:{pageWidth:n,pageHeight:i},rotation:s}=this.parent.viewport;return Hw.extractContoursFromText(e,t,n,i,s,Gw._INNER_MARGIN)}getDrawnSignature(e){const{rawDims:{pageWidth:t,pageHeight:n},rotation:i}=this.parent.viewport;return Hw.processDrawnLines({lines:e,pageWidth:t,pageHeight:n,rotation:i,innerMargin:Gw._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions(e){let{areContours:t,thickness:n}=e;t?this._drawingOptions=Gw.getDefaultDrawingOptions():(this._drawingOptions=Gw._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":n}))}serialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty())return null;const{lines:t,points:n}=this.serializeDraw(e),{_drawingOptions:{"stroke-width":i}}=this,s=Object.assign(super.serialize(e),{isSignature:!0,areContours:this.#El,color:[0,0,0],thickness:this.#El?0:i});return this.addComment(s),e?(s.paths={lines:t,points:n},s.uuid=this.#Nl,s.isCopy=!0):s.lines=t,this.#Tl&&(s.accessibilityData={type:"Figure",alt:this.#Tl}),s}static deserializeDraw(e,t,n,i,s,r){return r.areContours?Vw.deserialize(e,t,n,i,s,r):Bw.deserialize(e,t,n,i,s,r)}static async deserialize(e,t,n){const i=await super.deserialize(e,t,n);return i.#El=e.areContours,i.description=e.accessibilityData?.alt||"",i.#Nl=e.uuid,i}}class Ww extends mv{#Il=null;#Dl=null;#Pl=null;#Ml=null;#Rl=null;#Ll="";#jl=null;#Ol=!1;#Fl=null;#Bl=!1;#Ul=!1;static _type="stamp";static _editorType=(()=>Nf.STAMP)();constructor(e){super({...e,name:"stampEditor"}),this.#Ml=e.bitmapUrl,this.#Rl=e.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(e,t){mv.initialize(e,t)}static isHandlingMimeForPasting(e){return Gy.includes(e)}static paste(e,t){t.pasteEditor({mode:Nf.STAMP},{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(e){const t=e.get("hasAltText");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}#zl(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e?(this.#Il=e.bitmap,t||(this.#Dl=e.id,this.#Bl=e.isSvg),e.file&&(this.#Ll=e.file.name),this.#Vl()):this.remove()}#Hl(){if(this.#Pl=null,this._uiManager.enableWaiting(!1),this.#jl)if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#Il)this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});else{if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#Il){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.hasAltTextData())return null;const{mlManager:n}=this._uiManager;if(!n)throw new Error("No ML.");if(!await n.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:i,width:s,height:r}=e||this.copyCanvas(null,null,!0).imageData,a=await n.guess({name:"altText",request:{data:i,width:s,height:r,channels:i.length/(s*r)}});if(!a)throw new Error("No response from the AI service.");if(a.error)throw new Error("Error from the AI service.");if(a.cancel)return null;if(!a.output)throw new Error("No valid response from the AI service.");const o=a.output;return await this.setGuessedAltText(o),t&&!this.hasAltTextData()&&(this.altTextData={alt:o,decorative:!1}),o}#$l(){if(this.#Dl)return this._uiManager.enableWaiting(!0),void this._uiManager.imageManager.getFromId(this.#Dl).then(e=>this.#zl(e,!0)).finally(()=>this.#Hl());if(this.#Ml){const e=this.#Ml;return this.#Ml=null,this._uiManager.enableWaiting(!0),void(this.#Pl=this._uiManager.imageManager.getFromUrl(e).then(e=>this.#zl(e)).finally(()=>this.#Hl()))}if(this.#Rl){const e=this.#Rl;return this.#Rl=null,this._uiManager.enableWaiting(!0),void(this.#Pl=this._uiManager.imageManager.getFromFile(e).then(e=>this.#zl(e)).finally(()=>this.#Hl()))}const e=document.createElement("input");e.type="file",e.accept=Gy.join(",");const t=this._uiManager._signal;this.#Pl=new Promise(n=>{e.addEventListener("change",async()=>{if(e.files&&0!==e.files.length){this._uiManager.enableWaiting(!0);const t=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#zl(t)}else this.remove();n()},{signal:t}),e.addEventListener("cancel",()=>{this.remove(),n()},{signal:t})}).finally(()=>this.#Hl()),e.click()}remove(){this.#Dl&&(this.#Il=null,this._uiManager.imageManager.deleteId(this.#Dl),this.#jl?.remove(),this.#jl=null,this.#Fl&&(clearTimeout(this.#Fl),this.#Fl=null)),super.remove()}rebuild(){this.parent?(super.rebuild(),null!==this.div&&(this.#Dl&&null===this.#jl&&this.#$l(),this.isAttachedToDOM||this.parent.add(this))):this.#Dl&&this.#$l()}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(this.#Pl||this.#Il||this.#Ml||this.#Rl||this.#Dl||this.#Ol)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let e,t;return this._isCopy&&(e=this.x,t=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#Ol||(this.#Il?this.#Vl():this.#$l()),this._isCopy&&this._moveAfterPaste(e,t),this._uiManager.addShouldRescale(this),this.div}setCanvas(e,t){const{id:n,bitmap:i}=this._uiManager.imageManager.getFromCanvas(e,t);t.remove(),n&&this._uiManager.imageManager.isValidId(n)&&(this.#Dl=n,i&&(this.#Il=i),this.#Ol=!1,this.#Vl())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;null!==this.#Fl&&clearTimeout(this.#Fl);this.#Fl=setTimeout(()=>{this.#Fl=null,this.#ql()},200)}#Vl(){const{div:e}=this;let{width:t,height:n}=this.#Il;const[i,s]=this.pageDimensions,r=.75;if(this.width)t=this.width*i,n=this.height*s;else if(t>r*i||n>r*s){const e=Math.min(r*i/t,r*s/n);t*=e,n*=e}this._uiManager.enableWaiting(!1);const a=this.#jl=document.createElement("canvas");a.setAttribute("role","img"),this.addContainer(a),this.width=t/i,this.height=n/s,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&!this.annotationElementId||(e.hidden=!1),this.#ql(),this.#Ul||(this.parent.addUndoableEditor(this),this.#Ul=!0),this._reportTelemetry({action:"inserted_image"}),this.#Ll&&this.div.setAttribute("aria-description",this.#Ll),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e||(e=224);const{width:i,height:s}=this.#Il,r=new qy;let a=this.#Il,o=i,l=s,c=null;if(t){if(i>t||s>t){const e=Math.min(t/i,t/s);o=Math.floor(i*e),l=Math.floor(s*e)}c=document.createElement("canvas");const e=c.width=Math.ceil(o*r.sx),n=c.height=Math.ceil(l*r.sy);this.#Bl||(a=this.#Gl(e,n));const d=c.getContext("2d");d.filter=this._uiManager.hcmFilter;let u="white",h="#cfcfd8";"none"!==this._uiManager.hcmFilter?h="black":Wy.isDarkMode&&(u="#8f8f9d",h="#42414d");const p=15,m=p*r.sx,g=p*r.sy,f=new OffscreenCanvas(2*m,2*g),y=f.getContext("2d");y.fillStyle=u,y.fillRect(0,0,2*m,2*g),y.fillStyle=h,y.fillRect(0,0,m,g),y.fillRect(m,g,m,g),d.fillStyle=d.createPattern(f,"repeat"),d.fillRect(0,0,e,n),d.drawImage(a,0,0,a.width,a.height,0,0,e,n)}let d=null;if(n){let t,n;if(r.symmetric&&a.width<e&&a.height<e)t=a.width,n=a.height;else if(a=this.#Il,i>e||s>e){const r=Math.min(e/i,e/s);t=Math.floor(i*r),n=Math.floor(s*r),this.#Bl||(a=this.#Gl(t,n))}const o=new OffscreenCanvas(t,n).getContext("2d",{willReadFrequently:!0});o.drawImage(a,0,0,a.width,a.height,0,0,t,n),d={width:t,height:n,data:o.getImageData(0,0,t,n).data}}return{canvas:c,width:o,height:l,imageData:d}}#Gl(e,t){const{width:n,height:i}=this.#Il;let s=n,r=i,a=this.#Il;for(;s>2*e||r>2*t;){const n=s,i=r;s>2*e&&(s=s>=16384?Math.floor(s/2)-1:Math.ceil(s/2)),r>2*t&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2));const o=new OffscreenCanvas(s,r);o.getContext("2d").drawImage(a,0,0,n,i,0,0,s,r),a=o.transferToImageBitmap()}return a}#ql(){const[e,t]=this.parentDimensions,{width:n,height:i}=this,s=new qy,r=Math.ceil(n*e*s.sx),a=Math.ceil(i*t*s.sy),o=this.#jl;if(!o||o.width===r&&o.height===a)return;o.width=r,o.height=a;const l=this.#Bl?this.#Il:this.#Gl(r,a),c=o.getContext("2d");c.filter=this._uiManager.hcmFilter,c.drawImage(l,0,0,l.width,l.height,0,0,r,a)}#Wl(e){if(e){if(this.#Bl){const e=this._uiManager.imageManager.getSvgUrl(this.#Dl);if(e)return e}const e=document.createElement("canvas");({width:e.width,height:e.height}=this.#Il);return e.getContext("2d").drawImage(this.#Il,0,0),e.toDataURL()}if(this.#Bl){const[e,t]=this.pageDimensions,n=Math.round(this.width*e*Iy.PDF_TO_CSS_UNITS),i=Math.round(this.height*t*Iy.PDF_TO_CSS_UNITS),s=new OffscreenCanvas(n,i);return s.getContext("2d").drawImage(this.#Il,0,0,this.#Il.width,this.#Il.height,0,0,n,i),s.transferToImageBitmap()}return structuredClone(this.#Il)}static async deserialize(e,t,n){let i=null,s=!1;if(e instanceof Sw){const{data:{rect:r,rotation:a,id:o,structParent:l,popupRef:c,richText:d,contentsObj:u,creationDate:h,modificationDate:p},container:m,parent:{page:{pageNumber:g}},canvas:f}=e;let y,v;f?(delete e.canvas,({id:y,bitmap:v}=n.imageManager.getFromCanvas(m.id,f)),f.remove()):(s=!0,e._hasNoCanvas=!0);const b=(await t._structTree.getAriaAttributes(`${Cy}${o}`))?.get("aria-label")||"";i=e={annotationType:Nf.STAMP,bitmapId:y,bitmap:v,pageIndex:g-1,rect:r.slice(0),rotation:a,annotationElementId:o,id:o,deleted:!1,accessibilityData:{decorative:!1,altText:b},isSvg:!1,structParent:l,popupRef:c,richText:d,comment:u?.str||null,creationDate:h,modificationDate:p}}const r=await super.deserialize(e,t,n),{rect:a,bitmap:o,bitmapUrl:l,bitmapId:c,isSvg:d,accessibilityData:u}=e;s?(n.addMissingCanvas(e.id,r),r.#Ol=!0):c&&n.imageManager.isValidId(c)?(r.#Dl=c,o&&(r.#Il=o)):r.#Ml=l,r.#Bl=d;const[h,p]=r.pageDimensions;return r.width=(a[2]-a[0])/h,r.height=(a[3]-a[1])/p,u&&(r.altTextData=u),r._initialData=i,e.comment&&r.setCommentData(e),r.#Ul=!!i,r}serialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n=Object.assign(super.serialize(e),{bitmapId:this.#Dl,isSvg:this.#Bl});if(this.addComment(n),e)return n.bitmapUrl=this.#Wl(!0),n.accessibilityData=this.serializeAltText(!0),n.isCopy=!0,n;const{decorative:i,altText:s}=this.serializeAltText(!1);if(!i&&s&&(n.accessibilityData={type:"Figure",alt:s}),this.annotationElementId){const e=this.#La(n);return e.isSame?null:(e.isSameAltText?delete n.accessibilityData:n.accessibilityData.structParent=this._initialData.structParent??-1,n.id=this.annotationElementId,delete n.bitmapId,n)}if(null===t)return n;t.stamps||=new Map;const r=this.#Bl?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(t.stamps.has(this.#Dl)){if(this.#Bl){const e=t.stamps.get(this.#Dl);r>e.area&&(e.area=r,e.serialized.bitmap.close(),e.serialized.bitmap=this.#Wl(!1))}}else t.stamps.set(this.#Dl,{area:r,serialized:n}),n.bitmap=this.#Wl(!1);return n}#La(e){const{pageIndex:t,accessibilityData:{altText:n}}=this._initialData,i=e.pageIndex===t,s=(e.accessibilityData?.alt||"")===n;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&i&&s,isSameAltText:s}}renderAnnotationElement(e){return this.deleted?(e.hide(),null):(e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class Kw{#ya;#Kl=!1;#Ql=null;#Xl=null;#Yl=null;#Jl=(()=>new Map)();#Zl=!1;#ec=!1;#tc=!1;#nc=null;#ic=null;#sc=null;#rc=null;#ac=null;#oc=-1;#y;static _initialized=!1;static#Q=(()=>new Map([Tw,zw,Ww,Lw,Gw].map(e=>[e._editorType,e])))();constructor(e){let{uiManager:t,pageIndex:n,div:i,structTreeLayer:s,accessibilityManager:r,annotationLayer:a,drawLayer:o,textLayer:l,viewport:c,l10n:d}=e;const u=[...Kw.#Q.values()];if(!Kw._initialized){Kw._initialized=!0;for(const e of u)e.initialize(d,t)}t.registerEditorTypes(u),this.#y=t,this.pageIndex=n,this.div=i,this.#ya=r,this.#Ql=a,this.viewport=c,this.#sc=l,this.drawLayer=o,this._structTree=s,this.#y.addLayer(this)}get isEmpty(){return 0===this.#Jl.size}get isInvisible(){return this.isEmpty&&this.#y.getMode()===Nf.NONE}updateToolbar(e){this.#y.updateToolbar(e)}updateMode(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.#y.getMode();switch(this.#lc(),e){case Nf.NONE:return this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),void this.disableClick();case Nf.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Nf.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;if(t.toggle("nonEditing",!1),e===Nf.POPUP)t.toggle("commentEditing",!0);else{t.toggle("commentEditing",!1);for(const n of Kw.#Q.values())t.toggle(`${n._type}Editing`,e===n._editorType)}this.div.hidden=!1}hasTextLayer(e){return e===this.#sc?.div}setEditingState(e){this.#y.setEditingState(e)}addCommands(e){this.#y.addCommands(e)}cleanUndoStack(e){this.#y.cleanUndoStack(e)}toggleDrawing(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.div.classList.toggle("drawing",!e)}togglePointerEvents(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.#Ql?.togglePointerEvents(e)}get#cc(){return 0!==this.#Jl.size?this.#Jl.values():this.#y.getEditors(this.pageIndex)}async enable(){this.#tc=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#ac?.abort(),this.#ac=null;const e=new Set;for(const n of this.#cc)n.enableEditing(),n.show(!0),n.annotationElementId&&(this.#y.removeChangedExistingAnnotation(n),e.add(n.annotationElementId));const t=this.#Ql;if(t)for(const n of t.getEditableAnnotations()){if(n.hide(),this.#y.isDeletedAnnotationElement(n.data.id))continue;if(e.has(n.data.id))continue;const t=await this.deserialize(n);t&&(this.addOrRebuild(t),t.enableEditing())}this.#tc=!1,this.#y._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#ec=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#sc&&!this.#ac){this.#ac=new AbortController;const e=this.#y.combinedSignal(this.#ac);this.#sc.div.addEventListener("pointerdown",e=>{const{clientX:t,clientY:n,timeStamp:i}=e;if(i-this.#oc>500)return void(this.#oc=i);this.#oc=-1;const{classList:s}=this.div;s.toggle("getElements",!0);const r=document.elementsFromPoint(t,n);if(s.toggle("getElements",!1),!this.div.contains(r[0]))return;let a;const o=new RegExp(`^${kf}[0-9]+$`);for(const c of r)if(o.test(c.id)){a=c.id;break}if(!a)return;const l=this.#Jl.get(a);null===l?.annotationElementId&&(e.stopPropagation(),e.preventDefault(),l.dblclick(e))},{signal:e,capture:!0})}const e=this.#Ql,t=[];if(e){const n=new Map,i=new Map;for(const e of this.#cc)e.disableEditing(),e.annotationElementId?null===e.serialize()?(i.set(e.annotationElementId,e),this.getEditableAnnotation(e.annotationElementId)?.show(),e.remove()):n.set(e.annotationElementId,e):t.push(e);const s=e.getEditableAnnotations();for(const e of s){const{id:t}=e.data;if(this.#y.isDeletedAnnotationElement(t)){e.updateEdited({deleted:!0});continue}let s=i.get(t);s?(s.resetAnnotationElement(e),s.show(!1),e.show()):(s=n.get(t),s&&(this.#y.addChangedExistingAnnotation(s),s.renderAnnotationElement(e)&&s.show(!1)),e.show())}}this.#lc(),this.isEmpty&&(this.div.hidden=!0);const{classList:n}=this.div;for(const i of Kw.#Q.values())n.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),e?.updateFakeAnnotations(t),this.#ec=!1}getEditableAnnotation(e){return this.#Ql?.getEditableAnnotation(e)||null}setActiveEditor(e){this.#y.getActive()!==e&&this.#y.setActiveEditor(e)}enableTextSelection(){if(this.div.tabIndex=-1,this.#sc?.div&&!this.#rc){this.#rc=new AbortController;const e=this.#y.combinedSignal(this.#rc);this.#sc.div.addEventListener("pointerdown",this.#dc.bind(this),{signal:e}),this.#sc.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#sc?.div&&this.#rc&&(this.#rc.abort(),this.#rc=null,this.#sc.div.classList.remove("highlighting"))}#dc(e){this.#y.unselectAll();const{target:t}=e;if(t===this.#sc.div||("img"===t.getAttribute("role")||t.classList.contains("endOfContent"))&&this.#sc.div.contains(t)){const{isMac:t}=vy.platform;if(0!==e.button||e.ctrlKey&&t)return;this.#y.showAllEditors("highlight",!0,!0),this.#sc.div.classList.add("free"),this.toggleDrawing(),Lw.startHighlighting(this,"ltr"===this.#y.direction,{target:this.#sc.div,x:e.x,y:e.y}),this.#sc.div.addEventListener("pointerup",()=>{this.#sc.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#y._signal}),e.preventDefault()}}enableClick(){if(this.#Xl)return;this.#Xl=new AbortController;const e=this.#y.combinedSignal(this.#Xl);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){this.#Xl?.abort(),this.#Xl=null}attach(e){this.#Jl.set(e.id,e);const{annotationElementId:t}=e;t&&this.#y.isDeletedAnnotationElement(t)&&this.#y.removeDeletedAnnotationElement(e)}detach(e){this.#Jl.delete(e.id),this.#ya?.removePointerInTextLayer(e.contentDiv),!this.#ec&&e.annotationElementId&&this.#y.addDeletedAnnotationElement(e)}remove(e){this.detach(e),this.#y.removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){e.parent!==this&&(e.parent&&e.annotationElementId&&(this.#y.addDeletedAnnotationElement(e),mv.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(e.parent!==this||!e.isAttachedToDOM){if(this.changeParent(e),this.#y.addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!this.#tc),this.#y.addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!this.#Yl&&(e._focusEventsAllowed=!1,this.#Yl=setTimeout(()=>{this.#Yl=null,e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this.#y._signal}),t.focus())},0)),e._structTreeParentId=this.#ya?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||=this,e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){this.addCommands({cmd:()=>e._uiManager.rebuild(e),undo:()=>{e.remove()},mustExec:!1})}getEditorByUID(e){for(const t of this.#Jl.values())if(t.uid===e)return t;return null}getNextId(){return this.#y.getId()}get#uc(){return Kw.#Q.get(this.#y.getMode())}combinedSignal(e){return this.#y.combinedSignal(e)}#hc(e){const t=this.#uc;return t?new t.prototype.constructor(e):null}canCreateNewEmptyEditor(){return this.#uc?.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await this.#y.updateMode(e.mode);const{offsetX:n,offsetY:i}=this.#pc(),s=this.getNextId(),r=this.#hc({parent:this,id:s,x:n,y:i,uiManager:this.#y,isCentered:!0,...t});r&&this.add(r)}async deserialize(e){return await(Kw.#Q.get(e.annotationType??e.annotationEditorType)?.deserialize(e,this,this.#y))||null}createAndAddNewEditor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=this.getNextId(),s=this.#hc({parent:this,id:i,x:e.offsetX,y:e.offsetY,uiManager:this.#y,isCentered:t,...n});return s&&this.add(s),s}get boundingClientRect(){return this.div.getBoundingClientRect()}#pc(){const{x:e,y:t,width:n,height:i}=this.boundingClientRect,s=Math.max(0,e),r=Math.max(0,t),a=(s+Math.min(window.innerWidth,e+n))/2-e,o=(r+Math.min(window.innerHeight,t+i))/2-t,[l,c]=this.viewport.rotation%180===0?[a,o]:[o,a];return{offsetX:l,offsetY:c}}addNewEditor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.createAndAddNewEditor(this.#pc(),!0,e)}setSelected(e){this.#y.setSelected(e)}toggleSelected(e){this.#y.toggleSelected(e)}unselect(e){this.#y.unselect(e)}pointerup(e){const{isMac:t}=vy.platform;if(0!==e.button||e.ctrlKey&&t)return;if(e.target!==this.div)return;if(!this.#Zl)return;if(this.#Zl=!1,this.#uc?.isDrawer&&this.#uc.supportMultipleDrawings)return;if(!this.#Kl)return void(this.#Kl=!0);const n=this.#y.getMode();n!==Nf.STAMP&&n!==Nf.SIGNATURE?this.createAndAddNewEditor(e,!1):this.#y.unselectAll()}pointerdown(e){if(this.#y.getMode()===Nf.HIGHLIGHT&&this.enableTextSelection(),this.#Zl)return void(this.#Zl=!1);const{isMac:t}=vy.platform;if(0!==e.button||e.ctrlKey&&t)return;if(e.target!==this.div)return;if(this.#Zl=!0,this.#uc?.isDrawer)return void this.startDrawingSession(e);const n=this.#y.getActive();this.#Kl=!n||n.isEmpty()}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),this.#nc)return void this.#uc.startDrawing(this,this.#y,!1,e);this.#y.setCurrentDrawingSession(this),this.#nc=new AbortController;const t=this.#y.combinedSignal(this.#nc);this.div.addEventListener("blur",e=>{let{relatedTarget:t}=e;t&&!this.div.contains(t)&&(this.#ic=null,this.commitOrRemove())},{signal:t}),this.#uc.startDrawing(this,this.#y,!1,e)}pause(e){if(e){const{activeElement:e}=document;return void(this.div.contains(e)&&(this.#ic=e))}this.#ic&&setTimeout(()=>{this.#ic?.focus(),this.#ic=null},0)}endDrawingSession(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.#nc?(this.#y.setCurrentDrawingSession(null),this.#nc.abort(),this.#nc=null,this.#ic=null,this.#uc.endDrawing(e)):null}findNewParent(e,t,n){const i=this.#y.findParent(t,n);return null!==i&&i!==this&&(i.changeParent(e),!0)}commitOrRemove(){return!!this.#nc&&(this.endDrawingSession(),!0)}onScaleChanging(){this.#nc&&this.#uc.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#y.getActive()?.parent===this&&(this.#y.commitOrRemove(),this.#y.setActiveEditor(null)),this.#Yl&&(clearTimeout(this.#Yl),this.#Yl=null);for(const e of this.#Jl.values())this.#ya?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,this.#Jl.clear(),this.#y.removeLayer(this)}#lc(){for(const e of this.#Jl.values())e.isEmpty()&&e.remove()}render(e){let{viewport:t}=e;this.viewport=t,$y(this.div,t);for(const n of this.#y.getEditors(this.pageIndex))this.add(n),n.rebuild();this.updateMode()}update(e){let{viewport:t}=e;this.#y.commitOrRemove(),this.#lc();const n=this.viewport.rotation,i=t.rotation;if(this.viewport=t,$y(this.div,{rotation:i}),n!==i)for(const s of this.#Jl.values())s.rotate(i)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return this.#y.viewParameters.realScale}}class Qw{#zr=null;#mc=(()=>new Map)();#gc=(()=>new Map)();static#A=0;constructor(e){let{pageIndex:t}=e;this.pageIndex=t}setParent(e){if(this.#zr){if(this.#zr!==e){if(this.#mc.size>0)for(const t of this.#mc.values())t.remove(),e.append(t);this.#zr=e}}else this.#zr=e}static get _svgFactory(){return ly(this,"_svgFactory",new Kx)}static#fc(e,t){let[n,i,s,r]=t;const{style:a}=e;a.top=100*i+"%",a.left=100*n+"%",a.width=100*s+"%",a.height=100*r+"%"}#yc(){const e=Qw._svgFactory.create(1,1,!0);return this.#zr.append(e),e.setAttribute("aria-hidden",!0),e}#vc(e,t){const n=Qw._svgFactory.createElement("clipPath");e.append(n);const i=`clip_${t}`;n.setAttribute("id",i),n.setAttribute("clipPathUnits","objectBoundingBox");const s=Qw._svgFactory.createElement("use");return n.append(s),s.setAttribute("href",`#${t}`),s.classList.add("clip"),i}#bc(e,t){for(const[n,i]of Object.entries(t))null===i?e.removeAttribute(n):e.setAttribute(n,i)}draw(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=Qw.#A++,s=this.#yc(),r=Qw._svgFactory.createElement("defs");s.append(r);const a=Qw._svgFactory.createElement("path");r.append(a);const o=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke"),t&&this.#gc.set(i,a);const l=n?this.#vc(r,o):null,c=Qw._svgFactory.createElement("use");return s.append(c),c.setAttribute("href",`#${o}`),this.updateProperties(s,e),this.#mc.set(i,s),{id:i,clipPathId:`url(#${l})`}}drawOutline(e,t){const n=Qw.#A++,i=this.#yc(),s=Qw._svgFactory.createElement("defs");i.append(s);const r=Qw._svgFactory.createElement("path");s.append(r);const a=`path_p${this.pageIndex}_${n}`;let o;if(r.setAttribute("id",a),r.setAttribute("vector-effect","non-scaling-stroke"),t){const e=Qw._svgFactory.createElement("mask");s.append(e),o=`mask_p${this.pageIndex}_${n}`,e.setAttribute("id",o),e.setAttribute("maskUnits","objectBoundingBox");const t=Qw._svgFactory.createElement("rect");e.append(t),t.setAttribute("width","1"),t.setAttribute("height","1"),t.setAttribute("fill","white");const i=Qw._svgFactory.createElement("use");e.append(i),i.setAttribute("href",`#${a}`),i.setAttribute("stroke","none"),i.setAttribute("fill","black"),i.setAttribute("fill-rule","nonzero"),i.classList.add("mask")}const l=Qw._svgFactory.createElement("use");i.append(l),l.setAttribute("href",`#${a}`),o&&l.setAttribute("mask",`url(#${o})`);const c=l.cloneNode();return i.append(c),l.classList.add("mainOutline"),c.classList.add("secondaryOutline"),this.updateProperties(i,e),this.#mc.set(n,i),n}finalizeDraw(e,t){this.#gc.delete(e),this.updateProperties(e,t)}updateProperties(e,t){if(!t)return;const{root:n,bbox:i,rootClass:s,path:r}=t,a="number"===typeof e?this.#mc.get(e):e;if(a){if(n&&this.#bc(a,n),i&&Qw.#fc(a,i),s){const{classList:e}=a;for(const[t,n]of Object.entries(s))e.toggle(t,n)}if(r){const e=a.firstElementChild.firstElementChild;this.#bc(e,r)}}}updateParent(e,t){if(t===this)return;const n=this.#mc.get(e);n&&(t.#zr.append(n),this.#mc.delete(e),t.#mc.set(e,n))}remove(e){this.#gc.delete(e),null!==this.#zr&&(this.#mc.get(e).remove(),this.#mc.delete(e))}destroy(){this.#zr=null;for(const e of this.#mc.values())e.remove();this.#mc.clear(),this.#gc.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:Dw},globalThis.pdfjsLib={AbortException:gy,AnnotationEditorLayer:Kw,AnnotationEditorParamsType:If,AnnotationEditorType:Nf,AnnotationEditorUIManager:dv,AnnotationLayer:Aw,AnnotationMode:Tf,AnnotationType:Uf,applyOpacity:function(e,t,n,i){const s=255*(1-(i=Math.min(Math.max(i??1,0),1)));return[e=Math.round(e*i+s),t=Math.round(t*i+s),n=Math.round(n*i+s)]},build:"50cc4adac",ColorPicker:Vx,createValidAbsoluteUrl:ay,CSSConstants:class{static get commentForegroundColor(){const e=document.createElement("span");e.classList.add("comment","sidebar");const{style:t}=e;t.width=t.height="0",t.display="none",t.color="var(--comment-fg-color)",document.body.append(e);const{color:n}=window.getComputedStyle(e);return e.remove(),ly(this,"commentForegroundColor",zy(n))}},DOMSVGFactory:Kx,DrawLayer:Qw,FeatureTest:vy,fetchData:Dy,findContrastColor:function(e,t){const n=e[0]+256*e[1]+65536*e[2]+16777216*t[0]+4294967296*t[1]+1099511627776*t[2];let i=Jy.get(n);if(i)return i;const s=new Float32Array(9),r=s.subarray(0,3),a=s.subarray(3,6);Ky(e,a);const o=s.subarray(6,9);Ky(t,o);const l=o[2]<.5,c=l?12:4.5;if(a[2]=l?Math.sqrt(a[2]):1-Math.sqrt(1-a[2]),Yy(a,o,r)<c){let e,t;l?(e=a[2],t=1):(e=0,t=a[2]);const n=.005;for(;t-e>n;){const n=a[2]=(e+t)/2;l===Yy(a,o,r)<c?e=n:t=n}a[2]=l?t:e}return Qy(a,r),i=xy.makeHexColor(Math.round(255*r[0]),Math.round(255*r[1]),Math.round(255*r[2])),Jy.set(n,i),i},getDocument:Px,getFilenameFromUrl:function(e){return[e]=e.split(/[#?]/,1),e.substring(e.lastIndexOf("/")+1)},getPdfFilenameFromUrl:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"document.pdf";if("string"!==typeof e)return t;if(Ry(e))return iy('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const n=(e=>{try{return new URL(e)}catch{try{return new URL(decodeURIComponent(e))}catch{try{return new URL(e,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(e),"https://foo.bar")}catch{return null}}}}})(e);if(!n)return t;const i=e=>{try{let t=decodeURIComponent(e);return t.includes("/")?(t=t.split("/").at(-1),t.test(/^\.pdf$/i)?t:e):t}catch{return e}},s=/\.pdf$/i,r=n.pathname.split("/").at(-1);if(s.test(r))return i(r);if(n.searchParams.size>0){const e=Array.from(n.searchParams.values()).reverse();for(const n of e)if(s.test(n))return i(n);const t=Array.from(n.searchParams.keys()).reverse();for(const n of t)if(s.test(n))return i(n)}if(n.hash){const e=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(n.hash);if(e)return i(e[0])}return t},getRGB:zy,getUuid:Sy,getXfaPageViewport:function(e,t){let{scale:n=1,rotation:i=0}=t;const{width:s,height:r}=e.attributes.style,a=[0,0,parseInt(s),parseInt(r)];return new Py({viewBox:a,userUnit:1,scale:n,rotation:i})},GlobalWorkerOptions:nx,ImageKind:Bf,InvalidPDFException:hy,isDataScheme:Ry,isPdfFile:Ly,isValidExplicitDest:Pv,MathClamp:Ay,noContextMenu:Fy,normalizeUnicode:function(e){return wy||(wy=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,_y=new Map([["\ufb05","\u017ft"]])),e.replaceAll(wy,(e,t,n)=>t?t.normalize("NFKC"):_y.get(n))},OPS:Wf,OutputScale:qy,PasswordResponses:{NEED_PASSWORD:1,INCORRECT_PASSWORD:2},PDFDataRangeTransport:Rx,PDFDateString:Uy,PDFWorker:Ox,PermissionFlag:{PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},PixelsPerInch:Iy,RenderingCancelledException:My,renderRichText:Zy,ResponseException:py,setLayerDimensions:$y,shadow:ly,SignatureExtractor:Hw,stopEvent:By,SupportedImageMimeTypes:Gy,TextLayer:Dx,TouchManager:pv,updateUrlHash:oy,Util:xy,VerbosityLevel:Gf,version:zx,XfaLayer:ky},nx.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${zx}/pdf.worker.min.js`;const Xw=async e=>{const t=e.type||e.name.split(".").pop().toLowerCase();if("application/pdf"===t||e.name.endsWith(".pdf"))return await(async e=>{try{const t=await e.arrayBuffer(),n=await Px({data:t}).promise;let i="";for(let e=1;e<=n.numPages;e++){const t=await n.getPage(e);i+=(await t.getTextContent()).items.map(e=>e.str).join(" ")+"\n\n"}return i.trim()}catch(t){return console.error("Error extracting PDF text:",t),null}})(e);if(t.includes("text")||e.name.endsWith(".txt"))return await e.text();try{return await e.text()}catch{return console.warn(`Could not extract text from ${e.name}`),null}},Yw=(e,t)=>{var n;const[s,r]=(0,i.useState)(Jg),[a,o]=(0,i.useState)(null),[l,c]=(0,i.useState)(!1),[d,u]=(0,i.useState)(null),[h,p]=(0,i.useState)(!1),[m,g]=(0,i.useState)(""),f=(0,i.useRef)(null),y=(0,i.useCallback)((e,t)=>{r(n=>({...n,[e]:t}))},[]),v=(0,i.useCallback)((e,t)=>{r(n=>({...n,quizConfig:{...n.quizConfig,[e]:t}}))},[]),b=(0,i.useCallback)((e,t)=>{r(n=>({...n,assignedEmployees:t?[...n.assignedEmployees,e]:n.assignedEmployees.filter(t=>t!==e)}))},[]),x=(0,i.useCallback)(async e=>{const t=Array.from(e.target.files),n=await Promise.all(t.map(async e=>{const t=await Xw(e);return{name:e.name,size:e.size,type:e.type,file:e,extractedText:t}}));r(e=>({...e,documents:[...e.documents,...n]}));const i=n.filter(e=>e.extractedText).map(e=>`=== ${e.name} ===\n${e.extractedText}`).join("\n\n");i&&(g(e=>e?`${e}\n\n${i}`:i),console.log("\ud83d\udcc4 Extracted text from documents:",i.substring(0,500)+"..."))},[]),w=(0,i.useCallback)(e=>{r(t=>{t.documents[e];const n=t.documents.filter((t,n)=>n!==e),i=n.filter(e=>e.extractedText).map(e=>`=== ${e.name} ===\n${e.extractedText}`).join("\n\n");return g(i),{...t,documents:n}})},[]),_=(0,i.useCallback)(async(e,t)=>{p(!0);try{const e=s.documents||[];if(0===e.length)return void u({relevantDocuments:[],suggestedContent:["No documents uploaded yet. Upload training materials to generate content."],performanceGaps:[],recommendedTrainings:[]});const n=e.map(e=>({name:e.name,relevance:1,hasContent:!!e.extractedText,contentPreview:e.extractedText?e.extractedText.substring(0,200)+"...":"Content not extracted"})),i=e.filter(e=>e.extractedText).map(e=>e.extractedText).join(" "),r=[];i.toLowerCase().includes("safety")&&r.push("Safety procedures and requirements identified in documents"),i.toLowerCase().includes("maintenance")&&r.push("Maintenance procedures found in uploaded materials"),(i.toLowerCase().includes("equipment")||i.toLowerCase().includes("machine"))&&r.push("Equipment operation guidelines available"),(i.toLowerCase().includes("procedure")||i.toLowerCase().includes("protocol"))&&r.push("Standard operating procedures documented"),0===r.length&&r.push(`Document content ready for training generation (${i.length} characters extracted)`);const a={relevantDocuments:n,suggestedContent:r,performanceGaps:[],recommendedTrainings:[{title:t||s.title||"Custom Training",reason:`Based on ${e.length} uploaded document(s)`,priority:"high",estimatedDuration:"1-2 hours",ragSources:e.map(e=>e.name)}],totalContentLength:i.length};u(a),console.log("\ud83d\udcca Document analysis complete:",a)}catch(n){console.error("Document analysis failed:",n),u({relevantDocuments:[],suggestedContent:["Error analyzing documents: "+n.message],performanceGaps:[],recommendedTrainings:[]})}finally{p(!1)}},[s.documents,s.title]),S=(0,i.useCallback)(t=>{var n,i,r;const a=(null===(n=Qg.find(e=>e.code===s.language))||void 0===n?void 0:n.name)||"English",o=(null===e||void 0===e||null===(i=e.company)||void 0===i?void 0:i.name)||(null===e||void 0===e?void 0:e.companyName)||"Company",l=(null===(r=s.quizConfig)||void 0===r?void 0:r.questionCount)||10,c=s.documents.filter(e=>e.extractedText).map(e=>e.extractedText).join("\n\n"),d=m||c,u=d.length>2e4?d.substring(0,2e4)+"\n\n[Document continues...]":d;return console.log("\ud83d\udcc4 Document content length:",d.length,"characters"),(!u||u.length<100)&&console.warn("\u26a0\ufe0f No document content available for training generation"),`You are a professional corporate training developer for ${o}. Create a comprehensive, enterprise-grade training module based EXCLUSIVELY on the documentation provided below.\n\nTRAINING REQUIREMENTS:\n- Title: ${s.title||"Training Module"}\n- Department: ${s.department||"General"}\n- Language: ${a}\n- Quiz Questions Required: ${l}\n\nSOURCE DOCUMENTATION:\n====================\n${u||"No documentation provided. Create a general training outline."}\n====================\n\nCRITICAL INSTRUCTIONS:\n1. Extract ALL relevant procedures, protocols, safety requirements, and best practices from the documentation above\n2. Create detailed, specific training content - NOT generic placeholder text\n3. Include actual steps, measurements, temperatures, times, or specifications mentioned in the documents\n4. Create ${l} quiz questions that test SPECIFIC knowledge from the documents\n5. Each quiz question must reference actual content from the documentation\n6. Include safety warnings and compliance requirements mentioned in the docs\n\nReturn ONLY valid JSON (no markdown code blocks, no extra text):\n{\n  "training": {\n    "introduction": "Comprehensive introduction to ${s.title} covering the key topics from the documentation",\n    "sections": [\n      {\n        "title": "Section title from document",\n        "content": "Detailed procedural content with specific steps, measurements, and requirements from the documentation. Include numbered steps if applicable.",\n        "keyPoints": ["Specific technical point 1", "Specific technical point 2", "Specific technical point 3", "Specific technical point 4"]\n      },\n      {\n        "title": "Another key section",\n        "content": "More detailed content from documents",\n        "keyPoints": ["Point 1", "Point 2", "Point 3"]\n      },\n      {\n        "title": "Safety and Compliance",\n        "content": "Safety requirements and compliance information from documentation",\n        "keyPoints": ["Safety point 1", "Safety point 2", "Safety point 3"]\n      }\n    ],\n    "safetyNotes": ["Specific safety requirement from docs", "Another safety requirement", "PPE or protection requirements"],\n    "bestPractices": ["Best practice 1 from docs", "Best practice 2", "Best practice 3"],\n    "commonMistakes": ["Common error to avoid", "Another mistake", "Third mistake to prevent"]\n  },\n  "quiz": [\n    {\n      "question": "Specific question about content from the documentation?",\n      "options": ["A) Correct answer from docs", "B) Plausible but wrong", "C) Another wrong option", "D) Fourth option"],\n      "correct": 0,\n      "explanation": "This is correct because [reference to document content]",\n      "type": "Procedures"\n    }\n  ]\n}\n\nGenerate EXACTLY ${l} quiz questions covering different aspects of the documentation.`},[s,e,m]),C=(0,i.useCallback)(async(e,t)=>{let[n,i]=e;if(console.log(`\ud83e\udd16 Calling ${n} API with prompt length: ${t.length} characters`),"openai"===n&&i.apiKey){const e=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.apiKey}`},body:JSON.stringify({model:i.model||"gpt-4o-mini",messages:[{role:"system",content:"You are a professional corporate training developer. Create comprehensive, detailed training content based on provided documentation. Always return valid JSON only, no markdown."},{role:"user",content:t}],max_tokens:4e3,temperature:.3})});if(!e.ok){var s;const t=await e.json().catch(()=>({}));throw new Error(`OpenAI API error: ${e.status} - ${(null===(s=t.error)||void 0===s?void 0:s.message)||"Unknown error"}`)}const n=await e.json();return console.log("\u2705 OpenAI response received, parsing..."),mf(n.choices[0].message.content)}if("anthropic"===n&&i.apiKey){const e=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":i.apiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:i.model||"claude-3-sonnet-20240229",system:"You are a professional corporate training developer. Create comprehensive, detailed training content based on provided documentation. Always return valid JSON only, no markdown.",messages:[{role:"user",content:t}],max_tokens:4e3})});if(!e.ok){var r;const t=await e.json().catch(()=>({}));throw new Error(`Anthropic API error: ${e.status} - ${(null===(r=t.error)||void 0===r?void 0:r.message)||"Unknown error"}`)}const n=await e.json();return console.log("\u2705 Anthropic response received, parsing..."),mf(n.content[0].text)}throw new Error(`Model ${n} not configured with API key`)},[]),A=(0,i.useCallback)(async e=>{console.log("\ud83e\udd99 Using free LLaMA API as fallback (limited capabilities)...");const t=e.length>8e3?e.substring(0,8e3)+"\n\n[Content truncated. Generate training based on the content above.]":e,n=await fetch("https://chatterfix-llama-api-650169261019.us-central1.run.app/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"llama3.2:1b",messages:[{role:"user",content:t}],max_tokens:3e3,temperature:.5})});if(!n.ok)throw new Error(`Free LLaMA API error: ${n.status}`);const i=await n.json();return console.log("\u2705 LLaMA response received, parsing..."),mf(i.choices[0].message.content)},[]),E=(0,i.useCallback)(async(t,n)=>{const i=["https://linesmart-api-650169261019.us-central1.run.app","https://linesmart-api-650169261019.us-central1.run.app"].filter(Boolean),r=[...new Set(i)];console.log("\ud83d\udd27 Environment API URL:","https://linesmart-api-650169261019.us-central1.run.app"),console.log("\ud83d\udd27 Will try URLs:",r);let a=null;for(const d of r)try{var o,l;const i=`${d}/api/ai/generate-training`;console.log("\ud83d\udd0c Trying backend API at:",i),console.log("\ud83d\udcc4 Document content length:",(null===n||void 0===n?void 0:n.length)||0,"characters"),console.log("\ud83d\udcdd Prompt length:",(null===t||void 0===t?void 0:t.length)||0,"characters");const r=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:t,context:{documentContent:n,company:(null===e||void 0===e||null===(o=e.company)||void 0===o?void 0:o.name)||(null===e||void 0===e?void 0:e.companyName),department:s.department},options:{questionCount:(null===(l=s.quizConfig)||void 0===l?void 0:l.questionCount)||10,maxTokens:4e3}})});if(!r.ok){const e=await r.json().catch(()=>({}));throw new Error(`API error: ${r.status} - ${e.message||"Unknown error"}`)}const a=await r.json();if(console.log("\u2705 Backend API response received:",a.success?"Success":"Failed"),a.success&&a.data)return a.data;throw new Error("Invalid response structure from backend")}catch(c){console.log(`\u274c API call to ${d} failed:`,c.message),a=c}throw a||new Error("All backend API attempts failed")},[e,s.department,null===(n=s.quizConfig)||void 0===n?void 0:n.questionCount]),T=(0,i.useCallback)(async t=>{var n;const i=s.documents.filter(e=>e.extractedText).map(e=>e.extractedText).join("\n\n"),r=m||i;try{return await E(t,r)}catch(o){console.log("Backend API failed:",o.message)}const a=Object.entries((null===e||void 0===e||null===(n=e.aiModels)||void 0===n?void 0:n.configs)||{}).filter(e=>{let[t,n]=e;return(null===n||void 0===n?void 0:n.apiKey)&&"llama"!==t});if(a.length>0)try{return await C(a[0],t)}catch(l){console.log("User API failed:",l.message)}return console.log("\u26a0\ufe0f Falling back to free LLaMA API (limited capabilities)"),await A(t)},[e,s.documents,m,E,C,A]),k=(0,i.useCallback)(t=>{var n;const i="es"===s.language,r=(null===e||void 0===e||null===(n=e.company)||void 0===n?void 0:n.name)||(null===e||void 0===e?void 0:e.companyName)||"Company",a=s.documents||[];if(a.some(e=>e.extractedText)){const e=a.filter(e=>e.extractedText).map(e=>e.extractedText).join("\n").substring(0,2e3).split("\n").filter(e=>e.trim().length>20);return{training:{introduction:`Welcome to the ${s.title} training module. This training is based on your uploaded documentation and covers key procedures and requirements.`,sections:[{title:"Overview from Documentation",content:`This training is generated from your uploaded documents: ${a.map(e=>e.name).join(", ")}. The content below summarizes key information from these materials.`,keyPoints:e.slice(0,5).map(e=>e.substring(0,100))},{title:"Key Procedures",content:e.slice(5,10).join(" ")||"Review the uploaded documentation for detailed procedures.",keyPoints:["Follow all documented procedures","Refer to source materials for specific requirements","Contact supervisor for clarification when needed"]}],safetyNotes:["Always follow safety procedures outlined in documentation","Report any safety concerns immediately"],bestPractices:["Review documentation before starting tasks","Keep training materials accessible for reference"],commonMistakes:["Skipping documented steps","Not referring to updated procedures"]},quiz:[{question:"What should you always do before starting a new task?",options:["A) Review the documented procedures","B) Skip to the practical work","C) Ask a coworker what to do","D) Use your best judgment"],correct:0,explanation:"Always review documented procedures before starting any task to ensure compliance and safety.",type:"General Knowledge"}],ragAnalysis:d,note:"Training generated from uploaded documents. For better results, ensure an AI API key is configured."}}return{training:{introduction:i?`Bienvenido al m\xf3dulo de capacitaci\xf3n ${s.title} para ${r}.`:`Welcome to the ${s.title} training module for ${r}. Please upload training documents to generate customized content.`,sections:[{title:i?"Contenido Pendiente":"Content Pending",content:i?"Por favor suba documentos de capacitaci\xf3n para generar contenido personalizado.":"Please upload training documents (PDF, TXT) to generate comprehensive training content based on your materials.",keyPoints:i?["Suba manuales de la empresa","Incluya procedimientos de seguridad","Agregue gu\xedas de operaci\xf3n"]:["Upload company manuals","Include safety procedures","Add operation guides"]}],safetyNotes:[i?"Siempre siga los protocolos de seguridad":"Always follow safety protocols"],bestPractices:[i?"Revise la documentaci\xf3n regularmente":"Review documentation regularly"],commonMistakes:[i?"No revisar procedimientos actualizados":"Not reviewing updated procedures"]},quiz:[],ragAnalysis:d}},[s,e,d]),N=(0,i.useCallback)(async(e,t)=>{var n;c(!0),console.log("\ud83d\ude80 Starting training generation..."),console.log("\ud83d\udccb Training data:",{title:s.title,department:s.department,type:s.trainingType,documentsCount:(null===(n=s.documents)||void 0===n?void 0:n.length)||0});try{const n=S(e);console.log("\ud83d\udcdd Generated prompt length:",n.length);let s=null,r=null;try{console.log("\ud83d\udd0c Calling API..."),s=await T(n),console.log("\u2705 API response received:",s?"Success":"Empty")}catch(i){r=i,console.error("\u274c API generation failed:",i.message)}if(s&&s.training)console.log("\u2705 Using API-generated training"),o(s),t("review");else if(r){const e=`Training generation failed: ${r.message}\n\nPlease check:\n1. Your internet connection\n2. The API service status\n\nTry again or contact support.`;console.error(e),alert(e)}else{console.log("\u26a0\ufe0f No API response, using placeholder training");const n=k(e);o(n),t("review")}}catch(i){console.error("\u274c Training generation error:",i),alert(`Error generating training: ${i.message}\n\nPlease try again.`)}finally{c(!1)}},[S,T,k,s]),I=(0,i.useCallback)(()=>{r(Jg),o(null),u(null),g("")},[]),D=(0,i.useCallback)(()=>Object.entries(e.aiModels.configs).filter(e=>{let[t,n]=e;return n.apiKey&&"llama"!==t}),[e.aiModels.configs]);return{trainingData:s,setTrainingData:r,updateTrainingData:y,updateQuizConfig:v,toggleAssignedEmployee:b,generatedTraining:a,setGeneratedTraining:o,isGenerating:l,ragAnalysis:d,isAnalyzing:h,documentContent:m,fileInputRef:f,handleFileUpload:x,removeDocument:w,analyzeTrainingWithRAG:_,generateTraining:N,resetTrainingData:I,getEnabledModels:D}},Jw=()=>{const[e,t]=(0,i.useState)(ef),[n,s]=(0,i.useState)(Zg),[r,a]=(0,i.useState)(null),[o,l]=(0,i.useState)(!1),[c,d]=(0,i.useState)("all"),u=(0,i.useCallback)((e,t)=>{s(n=>({...n,[e]:t}))},[]),h=(0,i.useCallback)(()=>{s(Zg)},[]),p=(0,i.useCallback)(i=>{if(n.name&&n.department&&n.position){const r={id:e.length+1,...n,role:"employee",supervisor:null===i||void 0===i?void 0:i.name,completedTrainings:0,totalTrainings:0,lastTraining:null,performance:null,certifications:[],trainingHistory:[],recommendedTrainings:[{title:"Company Orientation",reason:"New employee onboarding",priority:"high"},{title:"Safety Fundamentals",reason:"Required for all new hires",priority:"high"},{title:`${n.department} Basics`,reason:"Department-specific training",priority:"high"}]};t(e=>[...e,r]),s(Zg),l(!1)}},[n,e]),m=(0,i.useCallback)((e,n,i,s)=>{t(t=>t.map(t=>t.id===e?{...t,completedTrainings:t.completedTrainings+1,lastTraining:(new Date).toISOString().split("T")[0],trainingHistory:[{id:t.trainingHistory.length+1,title:n.title,date:(new Date).toISOString().split("T")[0],score:i.percentage,status:"completed",language:n.language,ragSources:s?s.relevantDocuments.map(e=>e.name):[]},...t.trainingHistory]}:t))},[]),g=(0,i.useCallback)(()=>"all"===c?e:e.filter(e=>e.department===c),[e,c]),f=(0,i.useCallback)(()=>e.find(e=>"supervisor"===e.role)||e[2],[e]),y=(0,i.useCallback)(t=>e.filter(e=>{var n;return e.supervisor===(null===t||void 0===t?void 0:t.name)||(null===t||void 0===t||null===(n=t.supervisesEmployees)||void 0===n?void 0:n.includes(e.id))}),[e]),v=(0,i.useCallback)(t=>e.filter(e=>e.department===t),[e]),b=(0,i.useCallback)(t=>e.find(e=>e.id===t),[e]);return{employees:e,setEmployees:t,newEmployee:n,setNewEmployee:s,updateNewEmployee:u,selectedEmployee:r,setSelectedEmployee:a,showAddEmployee:o,setShowAddEmployee:l,filterDepartment:c,setFilterDepartment:d,addNewEmployee:p,resetNewEmployee:h,updateEmployeeTraining:m,getFilteredEmployees:g,getCurrentUser:f,getSupervisedEmployees:y,getEmployeesByDepartment:v,getEmployeeById:b}},Zw=()=>{const[e,t]=(0,i.useState)(0),[n,s]=(0,i.useState)({}),[r,a]=(0,i.useState)(null),o=(0,i.useCallback)((e,t)=>{s(n=>({...n,[e]:t}))},[]),l=(0,i.useCallback)(e=>{t(0),s({}),a(null),e("quiz")},[]),c=(0,i.useCallback)((e,t,i)=>{const s=e.quiz.map((e,t)=>({question:e.question,userAnswer:n[t],correctAnswer:e.correct,isCorrect:n[t]===e.correct,explanation:e.explanation})),r=s.filter(e=>e.isCorrect).length,o=Math.round(r/s.length*100);a({results:s,score:r,total:s.length,percentage:o,passed:o>=(t||80)}),i("results")},[n]),d=(0,i.useCallback)(()=>{t(e=>Math.max(0,e-1))},[]),u=(0,i.useCallback)(e=>{t(t=>Math.min(e-1,t+1))},[]),h=(0,i.useCallback)(e=>{t(0),s({}),a(null),e("quiz")},[]),p=(0,i.useCallback)(()=>{t(0),s({}),a(null)},[]),m=(0,i.useCallback)(e=>Object.keys(n).length===e,[n]),g=(0,i.useCallback)(t=>(e+1)/t*100,[e]);return{currentQuestionIndex:e,setCurrentQuestionIndex:t,userAnswers:n,setUserAnswers:s,quizResults:r,setQuizResults:a,handleAnswerSelect:o,startQuiz:l,submitQuiz:c,goToPreviousQuestion:d,goToNextQuestion:u,retakeQuiz:h,resetQuiz:p,isAllQuestionsAnswered:m,getCurrentProgress:g}},e_=Ig("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]),t_=Ig("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),n_=Ig("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),i_=e=>{var t,n,i;let{setupConfig:s,currentUser:r,userProfile:a,userTier:o,demoUser:l,completedSetup:c,onSetupClick:d,onLogout:u,showLogout:h=!1}=e;const p=(null===a||void 0===a?void 0:a.employeeId)||(null===r||void 0===r?void 0:r.employeeId),m=(null===s||void 0===s||null===(t=s.company)||void 0===t?void 0:t.name)||(null===s||void 0===s?void 0:s.companyName)||"Company";return(0,Ag.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,Ag.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,Ag.jsxs)("div",{className:"flex justify-between items-center py-4",children:[(0,Ag.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Ag.jsx)(e_,{className:"h-8 w-8 text-blue-600"}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Ag.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Line Smart"}),"demo"===o&&(0,Ag.jsx)("span",{className:"bg-gradient-to-r from-purple-600 to-pink-600 text-white px-3 py-1 rounded-full text-xs font-semibold",children:"DEMO ACCESS"})]}),(0,Ag.jsx)("p",{className:"text-sm text-gray-500",children:"AI-Powered Training Platform"})]})]}),(0,Ag.jsxs)("div",{className:"flex items-center space-x-4",children:[(c||l)&&(0,Ag.jsxs)("div",{className:"text-right",children:[(0,Ag.jsx)("div",{className:"text-sm text-gray-700 font-medium",children:l?l.companyName:m}),(0,Ag.jsxs)("div",{className:"text-sm text-gray-500",children:[l?l.email:`${(null===r||void 0===r?void 0:r.name)||"User"}`,p&&(0,Ag.jsxs)("span",{className:"ml-2 font-mono text-blue-600",children:["(",p,")"]}),(0,Ag.jsxs)("span",{className:"ml-1 text-gray-400",children:["\u2022 ",(null===r||void 0===r?void 0:r.role)||"admin"]})]}),(0,Ag.jsx)("div",{className:"text-xs text-gray-400",children:l?"Demo Mode - Full Features Available":`${(null===s||void 0===s||null===(n=s.aiModels)||void 0===n?void 0:n.primary)||(null===s||void 0===s?void 0:s.primaryModel)||"gpt-4o-mini"} \u2022 ${pf((null===s||void 0===s||null===(i=s.company)||void 0===i?void 0:i.defaultLanguage)||(null===s||void 0===s?void 0:s.defaultLanguage)||"en")}`})]}),(0,Ag.jsxs)("button",{onClick:d,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 flex items-center space-x-2",children:[(0,Ag.jsx)(t_,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:"Setup"})]}),h&&u&&(0,Ag.jsxs)("button",{onClick:u,className:"px-4 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 flex items-center space-x-2 transition-colors",children:[(0,Ag.jsx)(n_,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:"Logout"})]})]})]})})})},s_=Ig("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),r_=Ig("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),a_=Ig("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]),o_=Ig("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),l_=e=>{let{stats:t}=e;const n=[{title:"Total Employees",value:t.totalEmployees,icon:s_,color:"blue"},{title:"Avg. Completion",value:`${t.avgCompletion}%`,icon:r_,color:"green"},{title:"Active Trainings",value:t.activeTrainings,icon:a_,color:"orange"},{title:"Avg. Performance",value:`${t.avgPerformance}%`,icon:o_,color:"purple"}],i={blue:"text-blue-600",green:"text-green-600",orange:"text-orange-600",purple:"text-purple-600"};return(0,Ag.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:n.map((e,t)=>{const n=e.icon;return(0,Ag.jsx)("div",{className:"bg-white p-6 rounded-xl shadow-sm border",children:(0,Ag.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("p",{className:"text-sm text-gray-600",children:e.title}),(0,Ag.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.value})]}),(0,Ag.jsx)(n,{className:`h-8 w-8 ${i[e.color]}`})]})},t)})})},c_=Ig("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]),d_=e=>{let{employee:t,onEdit:n,onAssignTraining:i}=e;const s=t.totalTrainings>0?t.completedTrainings/t.totalTrainings*100:0;return(0,Ag.jsxs)("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[(0,Ag.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("h3",{className:"font-semibold text-gray-900",children:t.name}),(0,Ag.jsx)("p",{className:"text-sm text-gray-600",children:t.position}),(0,Ag.jsx)("p",{className:"text-xs text-gray-500",children:t.department}),(0,Ag.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,Ag.jsx)("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:pf(t.preferredLanguage)}),"supervisor"===t.role&&(0,Ag.jsx)("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:"Supervisor"})]})]}),(0,Ag.jsx)("button",{onClick:()=>n(t),className:"text-blue-600 hover:text-blue-800",children:(0,Ag.jsx)(c_,{className:"h-4 w-4"})})]}),(0,Ag.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,Ag.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,Ag.jsx)("span",{children:"Training Progress"}),(0,Ag.jsxs)("span",{children:[t.completedTrainings,"/",t.totalTrainings]})]}),(0,Ag.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,Ag.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${s}%`}})}),t.performance&&(0,Ag.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,Ag.jsx)("span",{children:"Performance"}),(0,Ag.jsxs)("span",{className:"font-medium "+(t.performance>=90?"text-green-600":t.performance>=80?"text-yellow-600":"text-red-600"),children:[t.performance,"%"]})]})]}),(0,Ag.jsxs)("div",{className:"space-y-2",children:[(0,Ag.jsx)("h4",{className:"text-sm font-medium text-gray-700",children:"Recommended Trainings:"}),t.recommendedTrainings.slice(0,2).map((e,t)=>(0,Ag.jsxs)("div",{className:"text-xs bg-gray-50 p-2 rounded",children:[(0,Ag.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Ag.jsx)("span",{className:"font-medium",children:e.title}),(0,Ag.jsx)("span",{className:"px-2 py-1 rounded text-xs "+("high"===e.priority?"bg-red-100 text-red-800":"medium"===e.priority?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:e.priority})]}),(0,Ag.jsx)("p",{className:"text-gray-600 mt-1",children:e.reason})]},t))]}),(0,Ag.jsx)("div",{className:"mt-4 pt-4 border-t",children:(0,Ag.jsx)("button",{onClick:()=>i(t),className:"w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm",children:"Assign Training"})})]})},u_=Ig("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),h_=Ig("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),p_=Ig("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),m_=Ig("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),g_=Ig("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),f_=e=>{let{currentView:t,setCurrentView:n,setShowTrainingData:i,generatedTraining:s,canManageUsers:r=!1}=e;const a=[{id:"dashboard",label:"Employee Dashboard",icon:s_,disabled:!1},{id:"create",label:"Create Training",icon:u_,disabled:!1},{id:"training-data",label:"Training Data",icon:h_,disabled:!1,onClick:()=>i(!0)},{id:"quiz",label:"Take Quiz",icon:p_,disabled:!s},{id:"review",label:"Review Training",icon:m_,disabled:!s},...r?[{id:"users",label:"User Management",icon:g_,disabled:!1}]:[]];return(0,Ag.jsx)("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg mb-8 w-fit",children:a.map(e=>{const i=e.icon,s=t===e.id,r=e.disabled;return(0,Ag.jsxs)("button",{onClick:()=>e.onClick?e.onClick():n(e.id),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${s?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"} ${r?"opacity-50 cursor-not-allowed":""}`,disabled:r,children:[(0,Ag.jsx)(i,{className:"h-4 w-4 inline mr-2"}),e.label]},e.id)})})},y_=Ig("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),v_=e=>{let{error:t,onClose:n}=e;return t?(0,Ag.jsx)("div",{className:"fixed top-4 right-4 z-50 max-w-md animate-slide-in",children:(0,Ag.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg shadow-lg p-4",children:(0,Ag.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Ag.jsx)(Dg,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),(0,Ag.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Ag.jsx)("h3",{className:"text-sm font-semibold text-red-900 mb-1",children:"Error"}),(0,Ag.jsx)("p",{className:"text-sm text-red-800 break-words",children:t})]}),n&&(0,Ag.jsx)("button",{onClick:n,className:"text-red-400 hover:text-red-600 flex-shrink-0","aria-label":"Close notification",children:(0,Ag.jsx)(y_,{className:"h-4 w-4"})})]})})}):null},b_=e=>{let{isOpen:t,onClose:n,newEmployee:i,onUpdateNewEmployee:s,onAddEmployee:r}=e;return t?(0,Ag.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,Ag.jsxs)("div",{className:"bg-white rounded-xl shadow-lg max-w-md w-full mx-4",children:[(0,Ag.jsx)("div",{className:"p-6 border-b",children:(0,Ag.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Ag.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Add New Employee"}),(0,Ag.jsx)("button",{onClick:n,className:"text-gray-500 hover:text-gray-700",children:"\u2715"})]})}),(0,Ag.jsxs)("div",{className:"p-6 space-y-4",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),(0,Ag.jsx)("input",{type:"text",value:i.name,onChange:e=>s("name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter employee name"})]}),(0,Ag.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department"}),(0,Ag.jsxs)("select",{value:i.department,onChange:e=>s("department",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,Ag.jsx)("option",{value:"",children:"Select"}),Gg.map(e=>(0,Ag.jsx)("option",{value:e,children:e},e))]})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Position"}),(0,Ag.jsx)("input",{type:"text",value:i.position,onChange:e=>s("position",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Job title"})]})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),(0,Ag.jsx)("input",{type:"email",value:i.email,onChange:e=>s("email",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"employee@company.com"})]}),(0,Ag.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hire Date"}),(0,Ag.jsx)("input",{type:"date",value:i.hireDate,onChange:e=>s("hireDate",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Preferred Language"}),(0,Ag.jsx)("select",{value:i.preferredLanguage,onChange:e=>s("preferredLanguage",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:Qg.map(e=>(0,Ag.jsxs)("option",{value:e.code,children:[e.flag," ",e.name]},e.code))})]})]}),(0,Ag.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,Ag.jsx)("button",{onClick:n,className:"flex-1 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),(0,Ag.jsx)("button",{onClick:r,disabled:!i.name||!i.department||!i.position,className:"flex-1 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300",children:"Add Employee"})]})]})]})}):null},x_=e=>{let{employee:t,onClose:n}=e;return t?(0,Ag.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,Ag.jsxs)("div",{className:"bg-white rounded-xl shadow-lg max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[(0,Ag.jsx)("div",{className:"p-6 border-b",children:(0,Ag.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:t.name}),(0,Ag.jsxs)("p",{className:"text-gray-600",children:[t.position," \u2022 ",t.department]}),(0,Ag.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[(0,Ag.jsx)("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:pf(t.preferredLanguage)}),"supervisor"===t.role&&(0,Ag.jsx)("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:"Supervisor"})]})]}),(0,Ag.jsx)("button",{onClick:n,className:"text-gray-500 hover:text-gray-700",children:"\u2715"})]})}),(0,Ag.jsxs)("div",{className:"p-6 space-y-6",children:[(0,Ag.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,Ag.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,Ag.jsx)("h3",{className:"font-medium text-blue-900 mb-2",children:"Training Progress"}),(0,Ag.jsxs)("p",{className:"text-2xl font-bold text-blue-600",children:[t.completedTrainings,"/",t.totalTrainings]}),(0,Ag.jsx)("p",{className:"text-sm text-blue-700",children:"Completed Trainings"})]}),(0,Ag.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,Ag.jsx)("h3",{className:"font-medium text-green-900 mb-2",children:"Performance Score"}),(0,Ag.jsxs)("p",{className:"text-2xl font-bold text-green-600",children:[t.performance||"N/A","%"]}),(0,Ag.jsx)("p",{className:"text-sm text-green-700",children:"Current Performance"})]}),(0,Ag.jsxs)("div",{className:"bg-purple-50 p-4 rounded-lg",children:[(0,Ag.jsx)("h3",{className:"font-medium text-purple-900 mb-2",children:"Last Training"}),(0,Ag.jsx)("p",{className:"text-lg font-bold text-purple-600",children:t.lastTraining||"No training yet"}),(0,Ag.jsx)("p",{className:"text-sm text-purple-700",children:"Most Recent"})]})]}),t.certifications&&t.certifications.length>0&&(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"Certifications"}),(0,Ag.jsx)("div",{className:"flex flex-wrap gap-2",children:t.certifications.map((e,t)=>(0,Ag.jsx)("span",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm",children:e},t))})]}),t.trainingHistory&&t.trainingHistory.length>0&&(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"Training History"}),(0,Ag.jsx)("div",{className:"space-y-3",children:t.trainingHistory.map((e,t)=>(0,Ag.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("p",{className:"font-medium text-gray-900",children:e.title}),(0,Ag.jsxs)("p",{className:"text-sm text-gray-600",children:[e.date," \u2022 ",pf(e.language)]})]}),(0,Ag.jsxs)("div",{className:"text-right",children:[(0,Ag.jsxs)("span",{className:"font-medium "+(e.score>=90?"text-green-600":e.score>=80?"text-yellow-600":"text-red-600"),children:[e.score,"%"]}),(0,Ag.jsx)("p",{className:"text-xs text-gray-500",children:e.status})]})]},t))})]}),t.recommendedTrainings&&t.recommendedTrainings.length>0&&(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"Recommended Trainings"}),(0,Ag.jsx)("div",{className:"space-y-3",children:t.recommendedTrainings.map((e,t)=>(0,Ag.jsx)("div",{className:"p-3 bg-yellow-50 rounded-lg border-l-4 border-yellow-400",children:(0,Ag.jsxs)("div",{className:"flex justify-between items-start",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("p",{className:"font-medium text-yellow-900",children:e.title}),(0,Ag.jsx)("p",{className:"text-sm text-yellow-800 mt-1",children:e.reason})]}),(0,Ag.jsx)("span",{className:"px-2 py-1 rounded text-xs "+("high"===e.priority?"bg-red-100 text-red-800":"medium"===e.priority?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:e.priority})]})},t))})]})]}),(0,Ag.jsx)("div",{className:"p-6 border-t",children:(0,Ag.jsx)("button",{onClick:n,className:"w-full py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Close"})})]})}):null},w_=e=>{let{stats:t,employees:n,filterDepartment:i,setFilterDepartment:s,setShowAddEmployee:r,setSelectedEmployee:a,setCurrentView:o}=e;return(0,Ag.jsxs)("div",{className:"space-y-8",children:[(0,Ag.jsx)(l_,{stats:t}),(0,Ag.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[(0,Ag.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,Ag.jsx)("h2",{className:"text-xl font-semibold",children:"Supervised Employee Management"}),(0,Ag.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Ag.jsxs)("button",{onClick:()=>r(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center space-x-2",children:[(0,Ag.jsx)(g_,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:"Add Employee"})]}),(0,Ag.jsxs)("select",{value:i,onChange:e=>s(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,Ag.jsx)("option",{value:"all",children:"All Departments"}),Gg.map(e=>(0,Ag.jsx)("option",{value:e,children:e},e))]})]})]}),(0,Ag.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(e=>(0,Ag.jsx)(d_,{employee:e,onEdit:e=>a(e),onAssignTraining:e=>{a(e),o("create")}},e.id))})]})]})},__=e=>{var t,n;let{generatedTraining:i,currentQuestionIndex:s,userAnswers:r,trainingData:a,onAnswerSelect:o,onPrevious:l,onNext:c,onSubmit:d,progressPercentage:u,canSubmit:h}=e;const p=i.quiz[s],m=s===i.quiz.length-1;return(0,Ag.jsx)("div",{className:"max-w-3xl mx-auto",children:(0,Ag.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-8",children:[(0,Ag.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,Ag.jsxs)("h2",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[(0,Ag.jsx)(jg,{className:"h-6 w-6 mr-2 text-green-600"}),"Knowledge Assessment Quiz"]}),(0,Ag.jsxs)("div",{className:"text-right",children:[(0,Ag.jsxs)("span",{className:"text-sm text-gray-500",children:["Question ",s+1," of ",i.quiz.length]}),(0,Ag.jsxs)("div",{className:"text-xs text-blue-600 mt-1",children:["Passing Score: ",(null===(t=a.quizConfig)||void 0===t?void 0:t.passingScore)||80,"%"]})]})]}),(0,Ag.jsxs)("div",{className:"mb-8",children:[(0,Ag.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-6",children:(0,Ag.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${u}%`}})}),(0,Ag.jsxs)("div",{className:"question-container",children:[(0,Ag.jsxs)("div",{className:"mb-4",children:[(0,Ag.jsx)("span",{className:"inline-block px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:p.type||"Company Policy"}),p.ragSource&&(0,Ag.jsxs)("span",{className:"inline-block ml-2 px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs",children:["Source: ",p.ragSource]})]}),(0,Ag.jsx)("h3",{className:"text-lg font-medium mb-6",children:p.question}),(0,Ag.jsx)("div",{className:"space-y-3",children:p.options.map((e,t)=>(0,Ag.jsxs)("label",{className:"block p-4 border rounded-lg cursor-pointer transition-colors "+(r[s]===t?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"),children:[(0,Ag.jsx)("input",{type:"radio",name:`question-${s}`,value:t,checked:r[s]===t,onChange:()=>o(s,t),className:"sr-only"}),(0,Ag.jsx)("span",{className:"text-gray-700",children:e})]},t))})]})]}),(0,Ag.jsxs)("div",{className:"flex justify-between",children:[(0,Ag.jsx)("button",{onClick:l,disabled:0===s,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),m?(0,Ag.jsxs)("button",{onClick:d,disabled:!h,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center space-x-2",children:[(0,Ag.jsx)(p_,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:"Submit Quiz"})]}):(0,Ag.jsx)("button",{onClick:c,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Next"})]}),(0,Ag.jsxs)("div",{className:"mt-8 bg-yellow-50 p-4 rounded-lg",children:[(0,Ag.jsx)("h4",{className:"font-medium text-yellow-900 mb-2",children:"Quiz Information"}),(0,Ag.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-yellow-800",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("span",{className:"font-medium",children:"Questions:"})," ",i.quiz.length]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("span",{className:"font-medium",children:"Passing Score:"})," ",(null===(n=a.quizConfig)||void 0===n?void 0:n.passingScore)||80,"%"]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("span",{className:"font-medium",children:"Retakes:"})," Unlimited"]})]})]})]})})},S_=Ig("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),C_=e=>{var t;let{quizResults:n,generatedTraining:i,trainingData:s,onReviewTraining:r,onRetakeQuiz:a,onComplete:o}=e;return(0,Ag.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,Ag.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-8",children:[(0,Ag.jsxs)("div",{className:"text-center mb-8",children:[(0,Ag.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full mb-4 "+(n.passed?"bg-green-100 text-green-600":"bg-red-100 text-red-600"),children:n.passed?(0,Ag.jsx)(p_,{className:"h-8 w-8"}):(0,Ag.jsx)(Dg,{className:"h-8 w-8"})}),(0,Ag.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:n.passed?"Training Completed Successfully!":"Training Needs Review"}),(0,Ag.jsxs)("p",{className:"text-gray-600 mb-4",children:["You scored ",n.score," out of ",n.total," (",n.percentage,"%)"]}),(0,Ag.jsx)("div",{className:"inline-block px-4 py-2 rounded-full text-sm font-medium "+(n.passed?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:n.passed?"PASSED":`FAILED - Minimum ${(null===(t=s.quizConfig)||void 0===t?void 0:t.passingScore)||80}% required`}),n.passed&&(0,Ag.jsxs)("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:[(0,Ag.jsx)("h3",{className:"font-medium text-blue-900 mb-2",children:"\ud83c\udf89 Certification Earned"}),(0,Ag.jsx)("p",{className:"text-sm text-blue-800",children:"Certificate will be automatically added to employee training record"})]})]}),(0,Ag.jsxs)("div",{className:"space-y-6",children:[(0,Ag.jsx)("h3",{className:"text-lg font-semibold",children:"Detailed Results"}),n.results.map((e,t)=>(0,Ag.jsxs)("div",{className:"p-6 rounded-lg border-l-4 "+(e.isCorrect?"border-green-500 bg-green-50":"border-red-500 bg-red-50"),children:[(0,Ag.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,Ag.jsxs)("h4",{className:"font-medium text-gray-900",children:["Question ",t+1]}),(0,Ag.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Ag.jsx)("span",{className:"text-sm font-medium "+(e.isCorrect?"text-green-600":"text-red-600"),children:e.isCorrect?"Correct":"Incorrect"}),i.quiz[t].ragSource&&(0,Ag.jsxs)("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 rounded text-xs",children:["Source: ",i.quiz[t].ragSource]})]})]}),(0,Ag.jsx)("p",{className:"text-gray-700 mb-3",children:e.question}),!e.isCorrect&&(0,Ag.jsxs)("div",{className:"mb-3 space-y-1",children:[(0,Ag.jsxs)("p",{className:"text-sm text-red-700",children:[(0,Ag.jsx)("strong",{children:"Your answer:"})," ",i.quiz[t].options[e.userAnswer]]}),(0,Ag.jsxs)("p",{className:"text-sm text-green-700",children:[(0,Ag.jsx)("strong",{children:"Correct answer:"})," ",i.quiz[t].options[e.correctAnswer]]})]}),(0,Ag.jsx)("div",{className:"bg-white p-3 rounded border",children:(0,Ag.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,Ag.jsx)("strong",{children:"Explanation:"})," ",e.explanation]})})]},t))]}),(0,Ag.jsxs)("div",{className:"flex justify-center space-x-4 mt-8",children:[(0,Ag.jsxs)("button",{onClick:r,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 flex items-center space-x-2",children:[(0,Ag.jsx)(m_,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:"Review Training"})]}),!n.passed&&(0,Ag.jsxs)("button",{onClick:a,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center space-x-2",children:[(0,Ag.jsx)(S_,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:"Retake Quiz"})]}),(0,Ag.jsxs)("button",{onClick:o,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center space-x-2",children:[(0,Ag.jsx)(jg,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:n.passed?"Complete Training":"Save Progress"})]})]})]})})},A_=Ig("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),E_=e=>{let{generatedTraining:t,trainingData:n,onStartQuiz:i}=e;return(0,Ag.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,Ag.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-8",children:[(0,Ag.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:n.title}),(0,Ag.jsxs)("p",{className:"text-gray-600",children:[n.department," \u2022 ",n.trainingType]}),(0,Ag.jsxs)("p",{className:"text-sm text-blue-600 mt-1",children:["Language: ",pf(n.language)," \u2022 Scope: ",n.trainingScope]})]}),(0,Ag.jsxs)("div",{className:"flex space-x-3",children:[(0,Ag.jsxs)("button",{onClick:i,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center space-x-2",children:[(0,Ag.jsx)(S_,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:"Start Quiz"})]}),(0,Ag.jsxs)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center space-x-2",children:[(0,Ag.jsx)(A_,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:"Export"})]})]})]}),(0,Ag.jsxs)("div",{className:"mb-8",children:[(0,Ag.jsx)("h3",{className:"text-xl font-semibold mb-3",children:"Introduction"}),(0,Ag.jsx)("p",{className:"text-gray-700 leading-relaxed",children:t.training.introduction})]}),(0,Ag.jsx)("div",{className:"space-y-8",children:t.training.sections.map((e,t)=>(0,Ag.jsxs)("div",{className:"border-l-4 border-blue-500 pl-6",children:[(0,Ag.jsx)("h3",{className:"text-xl font-semibold mb-3",children:e.title}),(0,Ag.jsx)("p",{className:"text-gray-700 mb-4 leading-relaxed",children:e.content}),(0,Ag.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,Ag.jsx)("h4",{className:"font-medium text-blue-900 mb-2",children:"Key Points:"}),(0,Ag.jsx)("ul",{className:"list-disc list-inside space-y-1 text-blue-800",children:e.keyPoints.map((e,t)=>(0,Ag.jsx)("li",{children:e},t))})]})]},t))}),(0,Ag.jsxs)("div",{className:"mt-8 bg-red-50 p-6 rounded-lg",children:[(0,Ag.jsxs)("h3",{className:"text-xl font-semibold text-red-900 mb-4 flex items-center",children:[(0,Ag.jsx)(Dg,{className:"h-5 w-5 mr-2"}),"Individual Safety Responsibilities"]}),(0,Ag.jsx)("ul",{className:"list-disc list-inside space-y-2 text-red-800",children:t.training.safetyNotes.map((e,t)=>(0,Ag.jsx)("li",{children:e},t))})]}),(0,Ag.jsxs)("div",{className:"mt-6 bg-green-50 p-6 rounded-lg",children:[(0,Ag.jsx)("h3",{className:"text-xl font-semibold text-green-900 mb-4",children:"Personal Best Practices"}),(0,Ag.jsx)("ul",{className:"list-disc list-inside space-y-2 text-green-800",children:t.training.bestPractices.map((e,t)=>(0,Ag.jsx)("li",{children:e},t))})]}),(0,Ag.jsxs)("div",{className:"mt-6 bg-yellow-50 p-6 rounded-lg",children:[(0,Ag.jsx)("h3",{className:"text-xl font-semibold text-yellow-900 mb-4",children:"Common Individual Mistakes to Avoid"}),(0,Ag.jsx)("ul",{className:"list-disc list-inside space-y-2 text-yellow-800",children:t.training.commonMistakes.map((e,t)=>(0,Ag.jsx)("li",{children:e},t))})]})]})})},T_=Ig("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),k_=Ig("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),N_=Ig("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),I_=Ig("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),D_=Ig("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),P_=e=>{let{onUpload:t,storageConfig:n,onStorageChange:s}=e;const[r,a]=(0,i.useState)(!1),[o,l]=(0,i.useState)([]),[c,d]=(0,i.useState)(!1),[u,h]=(0,i.useState)((null===n||void 0===n?void 0:n.type)||"secure-db"),p={"application/pdf":{icon:k_,label:"PDF",color:"text-red-600"},"text/plain":{icon:k_,label:"TXT",color:"text-gray-600"},"image/jpeg":{icon:I_,label:"JPG",color:"text-blue-600"},"image/png":{icon:I_,label:"PNG",color:"text-blue-600"},"image/gif":{icon:I_,label:"GIF",color:"text-green-600"},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{icon:k_,label:"DOCX",color:"text-blue-700"},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{icon:k_,label:"XLSX",color:"text-green-700"},"text/csv":{icon:k_,label:"CSV",color:"text-orange-600"},"application/vnd.ms-powerpoint":{icon:k_,label:"PPT",color:"text-orange-700"},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{icon:k_,label:"PPTX",color:"text-orange-700"}},m=[{id:"secure-db",name:"Secure Database",description:"Our encrypted, SOC2-compliant database",icon:Hg,features:["End-to-end encryption","SOC2 Type II certified","GDPR compliant","Automatic backups"],pricing:"Included",color:"bg-green-50 border-green-200 text-green-800"},{id:"google-cloud",name:"Google Cloud Storage",description:"Your own Google Cloud Storage bucket",icon:D_,features:["Your own GCS bucket","Full control","Custom retention","Regional storage"],pricing:"Google Cloud pricing",color:"bg-blue-50 border-blue-200 text-blue-800"},{id:"aws-s3",name:"Amazon S3",description:"Your own AWS S3 bucket",icon:D_,features:["Your own S3 bucket","Full control","Lifecycle policies","Global regions"],pricing:"AWS pricing",color:"bg-orange-50 border-orange-200 text-orange-800"},{id:"azure-blob",name:"Azure Blob Storage",description:"Your own Azure Storage account",icon:D_,features:["Your own storage account","Full control","Hot/Cool tiers","Global distribution"],pricing:"Azure pricing",color:"bg-purple-50 border-purple-200 text-purple-800"}],g=(0,i.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?a(!0):"dragleave"===e.type&&a(!1)},[]),f=(0,i.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),a(!1),e.dataTransfer.files&&e.dataTransfer.files[0]&&y(Array.from(e.dataTransfer.files))},[]),y=async e=>{d(!0);const n=[];for(const t of e)if(Object.keys(p).includes(t.type)){const e={id:Date.now()+Math.random(),name:t.name,size:t.size,type:t.type,status:"uploading",progress:0,file:t};n.push(e)}l(e=>[...e,...n]);for(const s of n)try{for(let t=0;t<=100;t+=20)await new Promise(e=>setTimeout(e,200)),l(e=>e.map(e=>e.id===s.id?{...e,progress:t}:e));const e=await v(s,u);l(t=>t.map(t=>t.id===s.id?{...t,status:"completed",...e}:t)),t&&t(e)}catch(i){l(e=>e.map(e=>e.id===s.id?{...e,status:"error",error:i.message}:e))}d(!1)},v=async(e,t)=>({storageId:`${t}_${Date.now()}`,url:URL.createObjectURL(e.file),extractedText:await b(e.file),metadata:{uploadedAt:(new Date).toISOString(),storageType:t,originalName:e.name,fileSize:e.size,mimeType:e.type}}),b=async e=>{if("text/plain"===e.type)return await e.text();if("text/csv"===e.type){return`CSV Data:\n${await e.text()}`}return e.type.startsWith("image/")?`[Image: ${e.name}] - OCR extraction would happen here`:"application/pdf"===e.type?`[PDF: ${e.name}] - PDF text extraction would happen here`:`[Document: ${e.name}] - Document parsing would happen here`},x=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},w=e=>{const t=p[e];if(t){const e=t.icon;return(0,Ag.jsx)(e,{className:`h-4 w-4 ${t.color}`})}return(0,Ag.jsx)(k_,{className:"h-4 w-4 text-gray-600"})};return(0,Ag.jsxs)("div",{className:"space-y-6",children:[(0,Ag.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[(0,Ag.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\ud83d\udcc1 Choose Storage Location"}),(0,Ag.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:m.map(e=>{const t=e.icon;return(0,Ag.jsx)("div",{onClick:()=>{return t=e.id,h(t),void(s&&s(t));var t},className:`p-4 rounded-lg border-2 cursor-pointer transition-all hover:shadow-md ${u===e.id?e.color:"bg-gray-50 border-gray-200 text-gray-600"}`,children:(0,Ag.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Ag.jsx)(t,{className:"h-5 w-5 mt-0.5"}),(0,Ag.jsxs)("div",{className:"flex-1",children:[(0,Ag.jsx)("h4",{className:"font-medium",children:e.name}),(0,Ag.jsx)("p",{className:"text-sm opacity-75 mb-2",children:e.description}),(0,Ag.jsx)("div",{className:"space-y-1",children:e.features.slice(0,2).map((e,t)=>(0,Ag.jsxs)("div",{className:"text-xs flex items-center space-x-1",children:[(0,Ag.jsx)(jg,{className:"h-3 w-3"}),(0,Ag.jsx)("span",{children:e})]},t))}),(0,Ag.jsxs)("div",{className:"text-xs font-medium mt-2",children:["\ud83d\udcb0 ",e.pricing]})]})]})},e.id)})})]}),(0,Ag.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[(0,Ag.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\ud83d\udce4 Upload Training Materials"}),(0,Ag.jsxs)("div",{className:"relative border-2 border-dashed rounded-lg p-8 text-center transition-colors "+(r?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-gray-400"),onDragEnter:g,onDragLeave:g,onDragOver:g,onDrop:f,children:[(0,Ag.jsx)(T_,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,Ag.jsxs)("div",{className:"space-y-2",children:[(0,Ag.jsx)("div",{className:"text-lg font-medium text-gray-900",children:"Drag and drop files here, or click to browse"}),(0,Ag.jsx)("div",{className:"text-sm text-gray-600",children:"Supports: PDF, TXT, DOCX, XLSX, CSV, PPT, PPTX, JPG, PNG, GIF"}),(0,Ag.jsx)("div",{className:"text-xs text-gray-500",children:"Maximum file size: 50MB per file"})]}),(0,Ag.jsx)("input",{type:"file",multiple:!0,accept:Object.keys(p).join(","),onChange:e=>{e.target.files&&y(Array.from(e.target.files))},className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"})]}),(0,Ag.jsx)("div",{className:"mt-4 flex flex-wrap gap-2",children:Object.entries(p).map(e=>{let[t,n]=e;const i=n.icon;return(0,Ag.jsxs)("div",{className:"flex items-center space-x-1 bg-gray-100 rounded px-2 py-1",children:[(0,Ag.jsx)(i,{className:`h-3 w-3 ${n.color}`}),(0,Ag.jsx)("span",{className:"text-xs text-gray-600",children:n.label})]},t)})})]}),o.length>0&&(0,Ag.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[(0,Ag.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\ud83d\udccb Uploaded Files"}),(0,Ag.jsx)("div",{className:"space-y-3",children:o.map(e=>(0,Ag.jsxs)("div",{className:"flex items-center space-x-4 p-3 bg-gray-50 rounded-lg",children:[(0,Ag.jsx)("div",{className:"flex-shrink-0",children:w(e.type)}),(0,Ag.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Ag.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Ag.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.name}),(0,Ag.jsxs)("div",{className:"flex items-center space-x-2",children:["uploading"===e.status&&(0,Ag.jsx)(zg,{className:"h-4 w-4 text-blue-500 animate-spin"}),"completed"===e.status&&(0,Ag.jsx)(jg,{className:"h-4 w-4 text-green-500"}),"error"===e.status&&(0,Ag.jsx)(Dg,{className:"h-4 w-4 text-red-500"}),(0,Ag.jsx)("button",{onClick:()=>{return t=e.id,void l(e=>e.filter(e=>e.id!==t));var t},className:"p-1 hover:bg-gray-200 rounded",children:(0,Ag.jsx)(y_,{className:"h-3 w-3 text-gray-400"})})]})]}),(0,Ag.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,Ag.jsx)("p",{className:"text-xs text-gray-500",children:x(e.size)}),"uploading"===e.status&&(0,Ag.jsx)("div",{className:"w-24 bg-gray-200 rounded-full h-1.5",children:(0,Ag.jsx)("div",{className:"bg-blue-600 h-1.5 rounded-full transition-all",style:{width:`${e.progress}%`}})}),"error"===e.status&&(0,Ag.jsx)("p",{className:"text-xs text-red-500",children:e.error})]})]})]},e.id))})]})]})},M_=Ig("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),R_=e=>{let{documents:t,onDocumentSelect:n,onDocumentDelete:s,searchQuery:r,onSearchChange:a}=e;const[o,l]=(0,i.useState)(t||[]),[c,d]=(0,i.useState)("all"),[u,h]=(0,i.useState)("newest"),[p,m]=(0,i.useState)("grid"),g=[{id:"all",label:"All Files",count:(null===t||void 0===t?void 0:t.length)||0},{id:"pdf",label:"PDFs",count:(null===t||void 0===t?void 0:t.filter(e=>"pdf"===e.type).length)||0},{id:"image",label:"Images",count:(null===t||void 0===t?void 0:t.filter(e=>"image"===e.type).length)||0},{id:"text",label:"Text Files",count:(null===t||void 0===t?void 0:t.filter(e=>"text"===e.type).length)||0},{id:"spreadsheet",label:"Spreadsheets",count:(null===t||void 0===t?void 0:t.filter(e=>"spreadsheet"===e.type).length)||0}];(0,i.useEffect)(()=>{let e=t||[];r&&(e=e.filter(e=>{var t,n;return e.name.toLowerCase().includes(r.toLowerCase())||(null===(t=e.content)||void 0===t?void 0:t.toLowerCase().includes(r.toLowerCase()))||(null===(n=e.tags)||void 0===n?void 0:n.some(e=>e.toLowerCase().includes(r.toLowerCase())))})),"all"!==c&&(e=e.filter(e=>e.type===c)),e.sort((e,t)=>{switch(u){case"newest":return new Date(t.uploadedAt)-new Date(e.uploadedAt);case"oldest":return new Date(e.uploadedAt)-new Date(t.uploadedAt);case"name":return e.name.localeCompare(t.name);case"size":return t.size-e.size;default:return 0}}),l(e)},[t,r,c,u]);const f=e=>{switch(e){case"pdf":return(0,Ag.jsx)(k_,{className:"h-8 w-8 text-red-600"});case"image":return(0,Ag.jsx)(I_,{className:"h-8 w-8 text-blue-600"});case"text":default:return(0,Ag.jsx)(k_,{className:"h-8 w-8 text-gray-600"});case"spreadsheet":return(0,Ag.jsx)(k_,{className:"h-8 w-8 text-green-600"})}},y=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},v=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return(0,Ag.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[(0,Ag.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,Ag.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"\ud83d\udcda Document Library"}),(0,Ag.jsx)("div",{className:"flex items-center space-x-2",children:(0,Ag.jsx)("button",{onClick:()=>m("grid"===p?"list":"grid"),className:"px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium",children:"grid"===p?"List View":"Grid View"})})]}),(0,Ag.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,Ag.jsxs)("div",{className:"relative",children:[(0,Ag.jsx)(N_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Ag.jsx)("input",{type:"text",placeholder:"Search documents, content, or tags...",value:r||"",onChange:e=>null===a||void 0===a?void 0:a(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,Ag.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,Ag.jsx)("div",{className:"flex flex-wrap gap-2",children:g.map(e=>(0,Ag.jsxs)("button",{onClick:()=>d(e.id),className:"px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+(c===e.id?"bg-blue-100 text-blue-700 border border-blue-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:[e.label," (",e.count,")"]},e.id))}),(0,Ag.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,Ag.jsx)("option",{value:"newest",children:"Newest First"}),(0,Ag.jsx)("option",{value:"oldest",children:"Oldest First"}),(0,Ag.jsx)("option",{value:"name",children:"Name A-Z"}),(0,Ag.jsx)("option",{value:"size",children:"Largest First"})]})]})]}),o.length>0?(0,Ag.jsx)("div",{className:"grid gap-4 "+("grid"===p?"grid-cols-1 md:grid-cols-2 lg:grid-cols-3":"grid-cols-1"),children:o.map(e=>(0,Ag.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors border border-gray-200 "+("list"===p?"flex items-center space-x-4":""),children:[(0,Ag.jsx)("div",{className:"flex-shrink-0 "+("list"===p?"":"mb-3"),children:f(e.type)}),(0,Ag.jsxs)("div",{className:"flex-1 "+("list"===p?"":"space-y-2"),children:[(0,Ag.jsxs)("div",{className:""+("list"===p?"flex items-center justify-between":""),children:[(0,Ag.jsx)("h4",{className:"font-medium text-gray-900 truncate",title:e.name,children:e.name}),"list"===p&&(0,Ag.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(0,Ag.jsx)("span",{className:"text-sm text-gray-500",children:y(e.size)}),(0,Ag.jsx)("span",{className:"text-sm text-gray-500",children:v(e.uploadedAt)})]})]}),"grid"===p&&(0,Ag.jsxs)(Ag.Fragment,{children:[(0,Ag.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[(0,Ag.jsx)("span",{children:y(e.size)}),(0,Ag.jsx)("span",{children:v(e.uploadedAt)})]}),e.tags&&e.tags.length>0&&(0,Ag.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.tags.slice(0,3).map((e,t)=>(0,Ag.jsx)("span",{className:"inline-block px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full",children:e},t)),e.tags.length>3&&(0,Ag.jsxs)("span",{className:"text-xs text-gray-500",children:["+",e.tags.length-3," more"]})]})]}),"list"===p&&e.tags&&e.tags.length>0&&(0,Ag.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:e.tags.slice(0,5).map((e,t)=>(0,Ag.jsx)("span",{className:"inline-block px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full",children:e},t))})]}),(0,Ag.jsx)("div",{className:"flex "+("list"===p?"items-center space-x-2":"justify-between mt-3"),children:(0,Ag.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Ag.jsx)("button",{onClick:()=>null===n||void 0===n?void 0:n(e),className:"p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors",title:"View document",children:(0,Ag.jsx)(m_,{className:"h-4 w-4"})}),(0,Ag.jsx)("button",{onClick:()=>window.open(e.url,"_blank"),className:"p-2 text-green-600 hover:bg-green-100 rounded-lg transition-colors",title:"Download",children:(0,Ag.jsx)(A_,{className:"h-4 w-4"})}),(0,Ag.jsx)("button",{onClick:()=>null===s||void 0===s?void 0:s(e.id),className:"p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors",title:"Delete",children:(0,Ag.jsx)(M_,{className:"h-4 w-4"})})]})})]},e.id))}):(0,Ag.jsxs)("div",{className:"text-center py-12",children:[(0,Ag.jsx)(k_,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,Ag.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No documents found"}),(0,Ag.jsx)("p",{className:"text-gray-600",children:r||"all"!==c?"Try adjusting your search or filters":"Upload some documents to get started"})]})]})},L_=Ig("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2",key:"187lwq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]),j_=e=>{let{currentConfig:t,onConfigUpdate:n,onTestConnection:s}=e;const[r,a]=(0,i.useState)((null===t||void 0===t?void 0:t.provider)||"secure-db"),[o,l]=(0,i.useState)((null===t||void 0===t?void 0:t.config)||{}),[c,d]=(0,i.useState)(!1),[u,h]=(0,i.useState)({}),p={"secure-db":{name:"Secure Database (Recommended)",description:"Our SOC2-compliant, encrypted database with automatic backups",icon:Hg,color:"bg-green-50 border-green-200 text-green-800",features:["End-to-end encryption","SOC2 Type II certified","GDPR compliant","Automatic daily backups","Real-time virus scanning","99.9% uptime SLA"],pricing:"Included in your subscription",setup:"No setup required - ready to use",fields:[]},"google-cloud":{name:"Google Cloud Storage",description:"Use your own Google Cloud Storage bucket for full control",icon:D_,color:"bg-blue-50 border-blue-200 text-blue-800",features:["Your own GCS bucket","Full data control","Custom retention policies","Regional/multi-regional storage","Lifecycle management","Direct Google Cloud billing"],pricing:"Google Cloud Storage pricing",setup:"Requires GCS bucket and service account",fields:[{id:"projectId",label:"Project ID",type:"text",required:!0,placeholder:"my-gcp-project"},{id:"bucketName",label:"Bucket Name",type:"text",required:!0,placeholder:"my-training-documents"},{id:"serviceAccountKey",label:"Service Account Key (JSON)",type:"textarea",required:!0,placeholder:"Paste your service account JSON key here..."},{id:"region",label:"Region",type:"select",required:!0,options:[{value:"us-central1",label:"US Central (Iowa)"},{value:"us-east1",label:"US East (South Carolina)"},{value:"us-west1",label:"US West (Oregon)"},{value:"europe-west1",label:"Europe West (Belgium)"},{value:"asia-east1",label:"Asia East (Taiwan)"}]}]},"aws-s3":{name:"Amazon S3",description:"Use your own AWS S3 bucket with full AWS integration",icon:D_,color:"bg-orange-50 border-orange-200 text-orange-800",features:["Your own S3 bucket","Full data control","Intelligent tiering","Cross-region replication","Advanced security features","Direct AWS billing"],pricing:"AWS S3 pricing",setup:"Requires S3 bucket and IAM credentials",fields:[{id:"accessKeyId",label:"Access Key ID",type:"text",required:!0,placeholder:"AKIA..."},{id:"secretAccessKey",label:"Secret Access Key",type:"password",required:!0,placeholder:"Your secret access key"},{id:"bucketName",label:"Bucket Name",type:"text",required:!0,placeholder:"my-training-bucket"},{id:"region",label:"Region",type:"select",required:!0,options:[{value:"us-east-1",label:"US East (N. Virginia)"},{value:"us-west-2",label:"US West (Oregon)"},{value:"eu-west-1",label:"Europe (Ireland)"},{value:"ap-southeast-1",label:"Asia Pacific (Singapore)"},{value:"ap-northeast-1",label:"Asia Pacific (Tokyo)"}]}]},"azure-blob":{name:"Azure Blob Storage",description:"Use your own Azure Storage account with enterprise features",icon:D_,color:"bg-purple-50 border-purple-200 text-purple-800",features:["Your own storage account","Full data control","Hot/Cool/Archive tiers","Global distribution","Advanced threat protection","Direct Azure billing"],pricing:"Azure Blob Storage pricing",setup:"Requires storage account and connection string",fields:[{id:"accountName",label:"Storage Account Name",type:"text",required:!0,placeholder:"mystorageaccount"},{id:"accountKey",label:"Account Key",type:"password",required:!0,placeholder:"Your storage account key"},{id:"containerName",label:"Container Name",type:"text",required:!0,placeholder:"training-documents"},{id:"endpoint",label:"Endpoint (Optional)",type:"text",required:!1,placeholder:"https://mystorageaccount.blob.core.windows.net/"}]}},m=(e,t)=>{l(n=>({...n,[e]:t}))},g=async()=>{d(!0),h({});try{const e=await(null===s||void 0===s?void 0:s(r,o));h({success:e.success,message:e.message,details:e.details})}catch(e){h({success:!1,message:e.message||"Connection test failed",details:e.details})}finally{d(!1)}};return(0,Ag.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[(0,Ag.jsxs)("div",{className:"flex items-center space-x-2 mb-6",children:[(0,Ag.jsx)(t_,{className:"h-5 w-5 text-gray-600"}),(0,Ag.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"\u2699\ufe0f Storage Configuration"})]}),(0,Ag.jsxs)("div",{className:"space-y-4 mb-8",children:[(0,Ag.jsx)("h4",{className:"font-medium text-gray-900",children:"Choose Your Storage Provider"}),(0,Ag.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries(p).map(e=>{let[t,n]=e;const i=n.icon;return(0,Ag.jsx)("div",{onClick:()=>a(t),className:`p-4 rounded-lg border-2 cursor-pointer transition-all hover:shadow-md ${r===t?n.color:"bg-gray-50 border-gray-200 text-gray-600"}`,children:(0,Ag.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Ag.jsx)(i,{className:"h-6 w-6 mt-0.5"}),(0,Ag.jsxs)("div",{className:"flex-1",children:[(0,Ag.jsx)("h5",{className:"font-medium mb-1",children:n.name}),(0,Ag.jsx)("p",{className:"text-sm opacity-75 mb-3",children:n.description}),(0,Ag.jsxs)("div",{className:"space-y-1 mb-3",children:[n.features.slice(0,3).map((e,t)=>(0,Ag.jsxs)("div",{className:"text-xs flex items-center space-x-1",children:[(0,Ag.jsx)(jg,{className:"h-3 w-3"}),(0,Ag.jsx)("span",{children:e})]},t)),n.features.length>3&&(0,Ag.jsxs)("div",{className:"text-xs opacity-75",children:["+",n.features.length-3," more features"]})]}),(0,Ag.jsxs)("div",{className:"text-xs",children:[(0,Ag.jsxs)("div",{className:"font-medium",children:["\ud83d\udcb0 ",n.pricing]}),(0,Ag.jsxs)("div",{className:"opacity-75 mt-1",children:["\ud83d\udd27 ",n.setup]})]})]})]})},t)})})]}),(0,Ag.jsxs)("div",{className:"space-y-6",children:[(0,Ag.jsxs)("h4",{className:"font-medium text-gray-900",children:["Configure ",p[r].name]}),(()=>{const e=p[r];return e.fields&&0!==e.fields.length?(0,Ag.jsxs)("div",{className:"space-y-4",children:[e.fields.map(e=>{var t;return(0,Ag.jsxs)("div",{children:[(0,Ag.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.label,e.required&&(0,Ag.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),"select"===e.type?(0,Ag.jsxs)("select",{value:o[e.id]||"",onChange:t=>m(e.id,t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:e.required,children:[(0,Ag.jsxs)("option",{value:"",children:["Select ",e.label]}),null===(t=e.options)||void 0===t?void 0:t.map(e=>(0,Ag.jsx)("option",{value:e.value,children:e.label},e.value))]}):"textarea"===e.type?(0,Ag.jsx)("textarea",{value:o[e.id]||"",onChange:t=>m(e.id,t.target.value),placeholder:e.placeholder,rows:6,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:e.required}):(0,Ag.jsx)("input",{type:e.type,value:o[e.id]||"",onChange:t=>m(e.id,t.target.value),placeholder:e.placeholder,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:e.required})]},e.id)}),(0,Ag.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Ag.jsx)("button",{onClick:g,disabled:c,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:c?(0,Ag.jsxs)(Ag.Fragment,{children:[(0,Ag.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),(0,Ag.jsx)("span",{children:"Testing..."})]}):(0,Ag.jsxs)(Ag.Fragment,{children:[(0,Ag.jsx)(L_,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:"Test Connection"})]})}),void 0!==u.success&&(0,Ag.jsxs)("div",{className:"flex items-center space-x-2 "+(u.success?"text-green-600":"text-red-600"),children:[u.success?(0,Ag.jsx)(jg,{className:"h-5 w-5"}):(0,Ag.jsx)(Dg,{className:"h-5 w-5"}),(0,Ag.jsx)("span",{className:"text-sm font-medium",children:u.message})]})]})]}):(0,Ag.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,Ag.jsxs)("div",{className:"flex items-center space-x-2 text-green-800",children:[(0,Ag.jsx)(jg,{className:"h-5 w-5"}),(0,Ag.jsx)("span",{className:"font-medium",children:"Ready to use!"})]}),(0,Ag.jsx)("p",{className:"text-green-700 text-sm mt-1",children:"No configuration required. Your documents will be stored securely in our encrypted database."})]})})(),(0,Ag.jsx)("div",{className:"flex justify-end",children:(0,Ag.jsx)("button",{onClick:()=>{null===n||void 0===n||n({provider:r,config:o})},className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium",children:"Save Configuration"})})]})]})},O_=Ig("Layers",[["polygon",{points:"12 2 2 7 12 12 22 7 12 2",key:"1b0ttc"}],["polyline",{points:"2 17 12 22 22 17",key:"imjtdl"}],["polyline",{points:"2 12 12 17 22 12",key:"5dexcv"}]]),F_=Ig("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),B_=e=>{var t,n;let{documents:s,onProcessingComplete:r,isProcessing:a,onStartProcessing:o}=e;const[l,c]=(0,i.useState)({chunkSize:1e3,chunkOverlap:200,embeddingModel:"text-embedding-ada-002",vectorStore:"chromadb",enableOCR:!0,enableSummarization:!0,extractKeywords:!0,languageDetection:!0}),[d,u]=(0,i.useState)({totalDocuments:0,processedDocuments:0,totalChunks:0,extractedKeywords:0,processingTime:0}),h=[{id:"text-embedding-ada-002",name:"OpenAI Ada v2",description:"High quality, 1536 dimensions"},{id:"text-embedding-3-small",name:"OpenAI v3 Small",description:"Latest model, efficient"},{id:"text-embedding-3-large",name:"OpenAI v3 Large",description:"Highest quality, 3072 dimensions"},{id:"sentence-transformers",name:"Sentence Transformers",description:"Open source, local processing"}],p=[{id:"chromadb",name:"ChromaDB",description:"Fast, open-source vector database"},{id:"pinecone",name:"Pinecone",description:"Managed vector database service"},{id:"weaviate",name:"Weaviate",description:"Open-source vector search engine"},{id:"qdrant",name:"Qdrant",description:"High-performance vector database"}],m=(e,t)=>{c(n=>({...n,[e]:t}))},g=()=>{if(!a)return null;const e=d.totalDocuments>0?d.processedDocuments/d.totalDocuments*100:0;return(0,Ag.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,Ag.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,Ag.jsx)(e_,{className:"h-5 w-5 text-blue-600 animate-pulse"}),(0,Ag.jsx)("span",{className:"font-medium text-blue-900",children:"Processing Documents..."})]}),(0,Ag.jsxs)("div",{className:"space-y-3",children:[(0,Ag.jsxs)("div",{className:"flex justify-between text-sm text-blue-800",children:[(0,Ag.jsxs)("span",{children:["Documents: ",d.processedDocuments,"/",d.totalDocuments]}),(0,Ag.jsxs)("span",{children:[Math.round(e),"%"]})]}),(0,Ag.jsx)("div",{className:"w-full bg-blue-200 rounded-full h-2",children:(0,Ag.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${e}%`}})}),(0,Ag.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm text-blue-700",children:[(0,Ag.jsxs)("div",{children:["\ud83d\udcc4 Chunks Created: ",d.totalChunks]}),(0,Ag.jsxs)("div",{children:["\ud83c\udff7\ufe0f Keywords: ",d.extractedKeywords]})]}),d.processingTime>0&&(0,Ag.jsxs)("div",{className:"text-sm text-blue-600",children:["\u23f1\ufe0f Processing Time: ",Math.round(d.processingTime/1e3),"s"]})]})]})};return(0,Ag.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[(0,Ag.jsxs)("div",{className:"flex items-center space-x-2 mb-6",children:[(0,Ag.jsx)(e_,{className:"h-5 w-5 text-gray-600"}),(0,Ag.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Document Processing Settings"})]}),(0,Ag.jsx)(g,{}),!a&&(0,Ag.jsxs)("div",{className:"space-y-6",children:[(0,Ag.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,Ag.jsxs)("h4",{className:"font-medium text-gray-900 mb-4 flex items-center space-x-2",children:[(0,Ag.jsx)(O_,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:"Text Chunking"})]}),(0,Ag.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Chunk Size (characters)"}),(0,Ag.jsx)("input",{type:"number",value:l.chunkSize,onChange:e=>m("chunkSize",parseInt(e.target.value)),min:"100",max:"4000",step:"100",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,Ag.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Recommended: 1000-2000 for training content"})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Chunk Overlap (characters)"}),(0,Ag.jsx)("input",{type:"number",value:l.chunkOverlap,onChange:e=>m("chunkOverlap",parseInt(e.target.value)),min:"0",max:"500",step:"50",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,Ag.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Maintains context between chunks"})]})]})]}),(0,Ag.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,Ag.jsxs)("h4",{className:"font-medium text-gray-900 mb-4 flex items-center space-x-2",children:[(0,Ag.jsx)(F_,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:"Embedding Model"})]}),(0,Ag.jsx)("div",{className:"space-y-3",children:h.map(e=>(0,Ag.jsxs)("label",{className:"flex items-start space-x-3 cursor-pointer",children:[(0,Ag.jsx)("input",{type:"radio",name:"embeddingModel",value:e.id,checked:l.embeddingModel===e.id,onChange:e=>m("embeddingModel",e.target.value),className:"mt-1"}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("div",{className:"font-medium text-gray-900",children:e.name}),(0,Ag.jsx)("div",{className:"text-sm text-gray-600",children:e.description})]})]},e.id))})]}),(0,Ag.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,Ag.jsxs)("h4",{className:"font-medium text-gray-900 mb-4 flex items-center space-x-2",children:[(0,Ag.jsx)(N_,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:"Vector Store"})]}),(0,Ag.jsx)("div",{className:"space-y-3",children:p.map(e=>(0,Ag.jsxs)("label",{className:"flex items-start space-x-3 cursor-pointer",children:[(0,Ag.jsx)("input",{type:"radio",name:"vectorStore",value:e.id,checked:l.vectorStore===e.id,onChange:e=>m("vectorStore",e.target.value),className:"mt-1"}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("div",{className:"font-medium text-gray-900",children:e.name}),(0,Ag.jsx)("div",{className:"text-sm text-gray-600",children:e.description})]})]},e.id))})]}),(0,Ag.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,Ag.jsxs)("h4",{className:"font-medium text-gray-900 mb-4 flex items-center space-x-2",children:[(0,Ag.jsx)(t_,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:"Processing Options"})]}),(0,Ag.jsx)("div",{className:"space-y-3",children:[{key:"enableOCR",label:"Enable OCR for Images",description:"Extract text from images and scanned documents"},{key:"enableSummarization",label:"Generate Summaries",description:"Create AI-powered summaries for each document"},{key:"extractKeywords",label:"Extract Keywords",description:"Automatically identify and tag key terms"},{key:"languageDetection",label:"Language Detection",description:"Detect and tag document languages"}].map(e=>(0,Ag.jsxs)("label",{className:"flex items-start space-x-3 cursor-pointer",children:[(0,Ag.jsx)("input",{type:"checkbox",checked:l[e.key],onChange:t=>m(e.key,t.target.checked),className:"mt-1"}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("div",{className:"font-medium text-gray-900",children:e.label}),(0,Ag.jsx)("div",{className:"text-sm text-gray-600",children:e.description})]})]},e.key))})]}),(0,Ag.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,Ag.jsx)("h4",{className:"font-medium text-blue-900 mb-2",children:"\ud83d\udcca Processing Summary"}),(0,Ag.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("div",{className:"text-blue-600",children:"Documents"}),(0,Ag.jsx)("div",{className:"font-medium text-blue-900",children:(null===s||void 0===s?void 0:s.length)||0})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("div",{className:"text-blue-600",children:"Est. Chunks"}),(0,Ag.jsx)("div",{className:"font-medium text-blue-900",children:s?Math.ceil(s.reduce((e,t)=>e+(t.size||0),0)/l.chunkSize):0})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("div",{className:"text-blue-600",children:"Embedding Model"}),(0,Ag.jsx)("div",{className:"font-medium text-blue-900",children:(null===(t=h.find(e=>e.id===l.embeddingModel))||void 0===t?void 0:t.name)||"None"})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("div",{className:"text-blue-600",children:"Vector Store"}),(0,Ag.jsx)("div",{className:"font-medium text-blue-900",children:(null===(n=p.find(e=>e.id===l.vectorStore))||void 0===n?void 0:n.name)||"None"})]})]})]}),(0,Ag.jsx)("div",{className:"flex justify-center",children:(0,Ag.jsxs)("button",{onClick:async()=>{o&&await o(l)},disabled:!s||0===s.length,className:"px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed font-medium flex items-center space-x-2",children:[(0,Ag.jsx)(e_,{className:"h-5 w-5"}),(0,Ag.jsx)("span",{children:"Process Documents"})]})})]})]})},U_=e=>{let{onClose:t,currentUser:n}=e;const[s,r]=(0,i.useState)("upload"),[a,o]=(0,i.useState)([{id:1,name:"Safety_Procedures_2024.pdf",type:"pdf",size:2547830,uploadedAt:"2024-08-01T10:30:00Z",tags:["safety","procedures","training"],content:"Safety procedures for workplace operations...",url:"#",metadata:{storageType:"secure-db",extractedKeywords:["safety","procedures","PPE","emergency"],language:"en",summary:"Comprehensive safety procedures for all workplace operations"}},{id:2,name:"Employee_Handbook_Spanish.docx",type:"text",size:1847294,uploadedAt:"2024-07-28T14:15:00Z",tags:["handbook","policies","spanish"],content:"Manual del empleado en espa\xf1ol...",url:"#",metadata:{storageType:"google-cloud",extractedKeywords:["pol\xedticas","empleado","beneficios"],language:"es",summary:"Manual completo del empleado en espa\xf1ol"}},{id:3,name:"Training_Metrics_Q2.xlsx",type:"spreadsheet",size:598273,uploadedAt:"2024-07-25T09:45:00Z",tags:["metrics","training","q2"],content:"Training completion rates and scores...",url:"#",metadata:{storageType:"secure-db",extractedKeywords:["metrics","completion","scores"],language:"en",summary:"Q2 training metrics and performance data"}}]),[l,c]=(0,i.useState)(""),[d,u]=(0,i.useState)({provider:"secure-db",config:{}}),[h,p]=(0,i.useState)(!1),[m,g]=(0,i.useState)({}),f=[{id:"upload",name:"Upload Documents",icon:T_},{id:"library",name:"Document Library",icon:k_},{id:"processing",name:"Process Documents",icon:e_},{id:"storage",name:"Storage Settings",icon:t_}],y=e=>e.includes("pdf")?"pdf":e.includes("image")?"image":e.includes("spreadsheet")||e.includes("csv")?"spreadsheet":"text";return(0,Ag.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,Ag.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-6xl h-[90vh] flex flex-col",children:[(0,Ag.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,Ag.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Ag.jsx)(h_,{className:"h-6 w-6 text-blue-600"}),(0,Ag.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Training Data Management"})]}),(0,Ag.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,Ag.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ag.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,Ag.jsx)("div",{className:"flex border-b border-gray-200 px-6",children:f.map(e=>{const t=e.icon;return(0,Ag.jsxs)("button",{onClick:()=>r(e.id),className:"flex items-center space-x-2 px-4 py-3 border-b-2 font-medium text-sm transition-colors "+(s===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,Ag.jsx)(t,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:e.name})]},e.id)})}),(0,Ag.jsxs)("div",{className:"flex-1 overflow-auto p-6",children:["upload"===s&&(0,Ag.jsx)(P_,{onUpload:e=>{const t={...e,id:a.length+1,uploadedAt:(new Date).toISOString(),tags:[],type:y(e.metadata.mimeType)};o(e=>[t,...e])},storageConfig:d,onStorageChange:e=>u(t=>({...t,provider:e}))}),"library"===s&&(0,Ag.jsxs)("div",{className:"space-y-6",children:[(0,Ag.jsxs)("div",{className:"relative",children:[(0,Ag.jsx)(N_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Ag.jsx)("input",{type:"text",placeholder:"Search documents, content, or tags...",value:l,onChange:e=>c(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,Ag.jsx)(R_,{documents:a,onDocumentSelect:e=>{console.log("Selected document:",e)},onDocumentDelete:e=>{o(t=>t.filter(t=>t.id!==e))},searchQuery:l,onSearchChange:c})]}),"processing"===s&&(0,Ag.jsx)(B_,{documents:a,isProcessing:h,onStartProcessing:async e=>{p(!0);const t=a.length;for(let n=0;n<t;n++)await new Promise(e=>setTimeout(e,1e3)),g({totalDocuments:t,processedDocuments:n+1,totalChunks:15*(n+1),extractedKeywords:8*(n+1),processingTime:1e3*(n+1)});setTimeout(()=>{p(!1),g({})},2e3)},processingStats:m}),"storage"===s&&(0,Ag.jsx)(j_,{currentConfig:d,onConfigUpdate:e=>{u(e)},onTestConnection:async(e,t)=>new Promise(n=>{setTimeout(()=>{"secure-db"===e||t.bucketName||t.accountName?n({success:!0,message:"Connection successful"}):n({success:!1,message:"Invalid configuration"})},2e3)})})]}),(0,Ag.jsx)("div",{className:"border-t border-gray-200 p-6",children:(0,Ag.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Ag.jsxs)("div",{className:"text-sm text-gray-600",children:[a.length," documents \u2022 Storage: ",d.provider]}),(0,Ag.jsxs)("div",{className:"flex items-center space-x-3",children:[h&&(0,Ag.jsxs)("div",{className:"flex items-center space-x-2 text-blue-600",children:[(0,Ag.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-blue-600 border-t-transparent rounded-full"}),(0,Ag.jsx)("span",{className:"text-sm",children:"Processing documents..."})]}),(0,Ag.jsx)("button",{onClick:t,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Close"})]})]})})]})})},z_=Ig("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),V_=Ig("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),H_=Ig("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),$_=e=>{let{onClose:t}=e;const{userProfile:n}=Tg(),{company:s}=df(),[r,a]=(0,i.useState)("members"),[o,l]=(0,i.useState)([]),[c,d]=(0,i.useState)([]),[u,h]=(0,i.useState)(!0),[p,m]=(0,i.useState)(""),[g,f]=(0,i.useState)("all"),[y,v]=(0,i.useState)("all"),[b,x]=(0,i.useState)(!1),[w,_]=(0,i.useState)({name:"",email:"",role:"employee",department:"",position:""}),[S,C]=(0,i.useState)(!1),[A,E]=(0,i.useState)(null),[T,k]=(0,i.useState)(null),[N,I]=(0,i.useState)(null),D=null===n||void 0===n?void 0:n.companyId;(0,i.useEffect)(()=>{D&&P()},[D]);const P=async()=>{h(!0);try{const[e,t]=await Promise.all([of.getCompanyMembers(D),of.getCompanyInvitations(D)]);l(e),d(t)}catch(e){console.error("Error loading user data:",e)}h(!1)},M=e=>{navigator.clipboard.writeText(e),alert("Copied to clipboard!")},R=o.filter(e=>{var t,n,i;const s=(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(p.toLowerCase()))||(null===(n=e.email)||void 0===n?void 0:n.toLowerCase().includes(p.toLowerCase()))||(null===(i=e.employeeId)||void 0===i?void 0:i.toLowerCase().includes(p.toLowerCase())),r="all"===g||e.role===g,a="all"===y||e.department===y;return s&&r&&a}),L=w.department&&sf[w.department]||[],j=(null===s||void 0===s?void 0:s.departments)||Gg;return(0,Ag.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,Ag.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-5xl h-[90vh] flex flex-col",children:[(0,Ag.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,Ag.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Ag.jsx)(s_,{className:"h-6 w-6 text-blue-600"}),(0,Ag.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"User Management"})]}),(0,Ag.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:(0,Ag.jsx)(y_,{className:"h-6 w-6"})})]}),(0,Ag.jsxs)("div",{className:"flex border-b border-gray-200 px-6",children:[(0,Ag.jsxs)("button",{onClick:()=>a("members"),className:"px-4 py-3 border-b-2 font-medium text-sm "+("members"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[(0,Ag.jsx)(s_,{className:"h-4 w-4 inline mr-2"}),"Members (",o.length,")"]}),(0,Ag.jsxs)("button",{onClick:()=>a("invitations"),className:"px-4 py-3 border-b-2 font-medium text-sm "+("invitations"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[(0,Ag.jsx)(Pg,{className:"h-4 w-4 inline mr-2"}),"Invitations (",c.filter(e=>"pending"===e.status).length," pending)"]})]}),(0,Ag.jsxs)("div",{className:"flex-1 overflow-auto p-6",children:[(0,Ag.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,Ag.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Ag.jsxs)("div",{className:"relative",children:[(0,Ag.jsx)(N_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Ag.jsx)("input",{type:"text",placeholder:"Search by name, email, or ID...",value:p,onChange:e=>m(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 w-64"})]}),(0,Ag.jsxs)("select",{value:g,onChange:e=>f(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,Ag.jsx)("option",{value:"all",children:"All Roles"}),Object.entries(nf).map(e=>{let[t,n]=e;return(0,Ag.jsx)("option",{value:t,children:n.name},t)})]}),(0,Ag.jsxs)("select",{value:y,onChange:e=>v(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,Ag.jsx)("option",{value:"all",children:"All Departments"}),j.map(e=>(0,Ag.jsx)("option",{value:e,children:e},e))]})]}),(0,Ag.jsxs)("button",{onClick:()=>x(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center space-x-2",children:[(0,Ag.jsx)(g_,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:"Invite User"})]})]}),u?(0,Ag.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Ag.jsx)("div",{className:"animate-spin h-8 w-8 border-4 border-blue-600 border-t-transparent rounded-full"})}):(0,Ag.jsxs)(Ag.Fragment,{children:["members"===r&&(0,Ag.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,Ag.jsxs)("table",{className:"w-full",children:[(0,Ag.jsx)("thead",{className:"bg-gray-50",children:(0,Ag.jsxs)("tr",{children:[(0,Ag.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Employee"}),(0,Ag.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"ID"}),(0,Ag.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Role"}),(0,Ag.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Department"}),(0,Ag.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),(0,Ag.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),(0,Ag.jsx)("tbody",{className:"divide-y divide-gray-200",children:R.map(e=>{var t;return(0,Ag.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Ag.jsx)("td",{className:"px-4 py-4",children:(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("div",{className:"font-medium text-gray-900",children:e.name}),(0,Ag.jsx)("div",{className:"text-sm text-gray-500",children:e.email})]})}),(0,Ag.jsx)("td",{className:"px-4 py-4",children:(0,Ag.jsx)("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:e.employeeId||e.id})}),(0,Ag.jsx)("td",{className:"px-4 py-4",children:(0,Ag.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full "+("admin"===e.role?"bg-purple-100 text-purple-700":"manager"===e.role?"bg-blue-100 text-blue-700":"supervisor"===e.role?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"),children:(null===(t=nf[e.role])||void 0===t?void 0:t.name)||e.role})}),(0,Ag.jsxs)("td",{className:"px-4 py-4 text-sm text-gray-600",children:[e.department||"-",e.position&&(0,Ag.jsx)("div",{className:"text-xs text-gray-400",children:e.position})]}),(0,Ag.jsx)("td",{className:"px-4 py-4",children:(0,Ag.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full "+("active"===e.status?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:e.status||"Active"})}),(0,Ag.jsx)("td",{className:"px-4 py-4",children:(0,Ag.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Ag.jsx)("button",{onClick:()=>I(e),className:"p-1 text-blue-600 hover:bg-blue-100 rounded",title:"Edit",children:(0,Ag.jsx)(z_,{className:"h-4 w-4"})}),"active"===e.status&&"admin"!==e.role&&(0,Ag.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to deactivate this user?"))try{await of.deactivateUser(D,e),P()}catch(t){alert("Error deactivating user: "+t.message)}})(e.id),className:"p-1 text-red-600 hover:bg-red-100 rounded",title:"Deactivate",children:(0,Ag.jsx)(y_,{className:"h-4 w-4"})})]})})]},e.id)})})]}),0===R.length&&(0,Ag.jsx)("div",{className:"text-center py-12 text-gray-500",children:"No members found matching your filters"})]}),"invitations"===r&&(0,Ag.jsx)("div",{className:"space-y-4",children:0===c.length?(0,Ag.jsx)("div",{className:"text-center py-12 text-gray-500",children:'No invitations yet. Click "Invite User" to get started.'}):c.map(e=>{var t,n;return(0,Ag.jsx)("div",{className:"p-4 rounded-lg border "+("pending"===e.status?"border-yellow-200 bg-yellow-50":"accepted"===e.status?"border-green-200 bg-green-50":"border-gray-200 bg-gray-50"),children:(0,Ag.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Ag.jsx)("span",{className:"font-medium text-gray-900",children:e.name}),(0,Ag.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full "+("pending"===e.status?"bg-yellow-100 text-yellow-700":"accepted"===e.status?"bg-green-100 text-green-700":"expired"===e.status?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"),children:(null===(t=af[e.status])||void 0===t?void 0:t.label)||e.status})]}),(0,Ag.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:[e.email," | ",null===(n=nf[e.role])||void 0===n?void 0:n.name," | ",e.department]}),(0,Ag.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:["Employee ID: ",e.employeeId," | Expires: ",new Date(e.expiresAt).toLocaleDateString()]})]}),"pending"===e.status&&(0,Ag.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Ag.jsx)("button",{onClick:()=>M(e.inviteCode),className:"p-2 text-gray-600 hover:bg-gray-200 rounded",title:"Copy invite code",children:(0,Ag.jsx)(V_,{className:"h-4 w-4"})}),(0,Ag.jsx)("button",{onClick:()=>(async e=>{try{const t=await of.resendInvitation(D,e);alert(`Invitation resent! New code: ${t.inviteCode}`);const n=await of.getCompanyInvitations(D);d(n)}catch(t){alert("Error resending invitation: "+t.message)}})(e.id),className:"p-2 text-blue-600 hover:bg-blue-100 rounded",title:"Resend invitation",children:(0,Ag.jsx)(H_,{className:"h-4 w-4"})}),(0,Ag.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to cancel this invitation?"))try{await of.cancelInvitation(D,e);const t=await of.getCompanyInvitations(D);d(t)}catch(t){alert("Error cancelling invitation: "+t.message)}})(e.id),className:"p-2 text-red-600 hover:bg-red-100 rounded",title:"Cancel invitation",children:(0,Ag.jsx)(M_,{className:"h-4 w-4"})})]})]})},e.id)})})]})]}),b&&(0,Ag.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-60 flex items-center justify-center p-4",children:(0,Ag.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md",children:[(0,Ag.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,Ag.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Invite New User"})}),(0,Ag.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),C(!0),k(null),E(null);try{const e=await of.createInvitation(D,n.id,w);E({message:`Invitation sent to ${w.email}`,inviteLink:e.inviteLink,inviteCode:e.inviteCode}),_({name:"",email:"",role:"employee",department:"",position:""});const t=await of.getCompanyInvitations(D);d(t)}catch(t){k(t.message)}C(!1)},className:"p-6 space-y-4",children:[T&&(0,Ag.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:T}),A&&(0,Ag.jsxs)("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg text-green-700 text-sm",children:[(0,Ag.jsx)("p",{className:"font-medium",children:A.message}),(0,Ag.jsxs)("div",{className:"mt-2 flex items-center space-x-2",children:[(0,Ag.jsx)("span",{className:"font-mono text-sm bg-green-100 px-2 py-1 rounded",children:A.inviteCode}),(0,Ag.jsx)("button",{type:"button",onClick:()=>M(A.inviteLink),className:"text-green-700 hover:text-green-900",children:(0,Ag.jsx)(V_,{className:"h-4 w-4"})})]})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name *"}),(0,Ag.jsx)("input",{type:"text",required:!0,value:w.name,onChange:e=>_({...w,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"John Smith"})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address *"}),(0,Ag.jsx)("input",{type:"email",required:!0,value:w.email,onChange:e=>_({...w,email:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"john@company.com"})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role *"}),(0,Ag.jsx)("select",{required:!0,value:w.role,onChange:e=>_({...w,role:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:Object.entries(nf).map(e=>{let[t,n]=e;return(0,Ag.jsxs)("option",{value:t,children:[n.name," - ",n.description]},t)})})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department *"}),(0,Ag.jsxs)("select",{required:!0,value:w.department,onChange:e=>_({...w,department:e.target.value,position:""}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,Ag.jsx)("option",{value:"",children:"Select Department"}),j.map(e=>(0,Ag.jsx)("option",{value:e,children:e},e))]})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Position"}),(0,Ag.jsxs)("select",{value:w.position,onChange:e=>_({...w,position:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",disabled:!w.department,children:[(0,Ag.jsx)("option",{value:"",children:"Select Position"}),L.map(e=>(0,Ag.jsx)("option",{value:e,children:e},e))]})]}),(0,Ag.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,Ag.jsx)("button",{type:"button",onClick:()=>{x(!1),E(null),k(null)},className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Cancel"}),(0,Ag.jsx)("button",{type:"submit",disabled:S,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400",children:S?"Sending...":"Send Invitation"})]})]})]})}),N&&(0,Ag.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-60 flex items-center justify-center p-4",children:(0,Ag.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md p-6",children:[(0,Ag.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Edit Member"}),(0,Ag.jsxs)("div",{className:"space-y-4",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),(0,Ag.jsx)("input",{type:"text",value:N.name,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50"})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Employee ID"}),(0,Ag.jsx)("input",{type:"text",value:N.employeeId||N.id,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 font-mono"})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),(0,Ag.jsx)("select",{value:N.role,onChange:e=>I({...N,role:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:Object.entries(nf).map(e=>{let[t,n]=e;return(0,Ag.jsx)("option",{value:t,children:n.name},t)})})]}),(0,Ag.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,Ag.jsx)("button",{onClick:()=>I(null),className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Cancel"}),(0,Ag.jsx)("button",{onClick:()=>(async(e,t)=>{try{await of.updateUserRole(D,e,t),P(),I(null)}catch(n){alert("Error updating role: "+n.message)}})(N.id,N.role),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Save Changes"})]})]})]})})]})})},q_=Ig("Bot",[["rect",{width:"18",height:"10",x:"3",y:"11",rx:"2",key:"1ofdy3"}],["circle",{cx:"12",cy:"5",r:"2",key:"f1ur92"}],["path",{d:"M12 7v4",key:"xawao1"}],["line",{x1:"8",x2:"8",y1:"16",y2:"16",key:"h6x27f"}],["line",{x1:"16",x2:"16",y1:"16",y2:"16",key:"5lty7f"}]]),G_=e=>{var t,n,i,s;let{setupStep:r,setupConfig:a,handleSetupNext:o,handleSetupPrev:l,updateCompanyConfig:c,updateAIModelConfig:d,updateAIModelAPIConfig:u,updateDataSourceConfig:h,updateDataSourceTypeConfig:p,updateRAGSettings:m,updateOnboardingConfig:g,generateCompanyConfig:f,testConnection:y,toggleDepartment:v,toggleSafetyRequirement:b,toggleSupportedLanguage:x,toggleOnboardingTraining:w,currentStepIndex:_,totalSteps:S,progressPercentage:C,setCurrentView:A,onComplete:E}=e;const T=[{id:"googleDrive",name:"Google Drive",icon:(0,Ag.jsx)(D_,{className:"h-5 w-5"}),description:"Connect to Google Drive folders"},{id:"s3",name:"Amazon S3",icon:(0,Ag.jsx)(h_,{className:"h-5 w-5"}),description:"AWS S3 bucket integration"},{id:"azure",name:"Azure Blob",icon:(0,Ag.jsx)(D_,{className:"h-5 w-5"}),description:"Microsoft Azure Blob Storage"},{id:"sharepoint",name:"SharePoint",icon:(0,Ag.jsx)(Vg,{className:"h-5 w-5"}),description:"Microsoft SharePoint"},{id:"local",name:"Local Files",icon:(0,Ag.jsx)(k_,{className:"h-5 w-5"}),description:"Upload files directly"}];return(0,Ag.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,Ag.jsxs)("div",{className:"mb-8",children:[(0,Ag.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Ag.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Platform Setup"}),(0,Ag.jsxs)("span",{className:"text-sm text-gray-500",children:["Step ",_," of ",S]})]}),(0,Ag.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,Ag.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${C}%`}})})]}),"welcome"===r&&(0,Ag.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-8 text-center",children:[(0,Ag.jsxs)("div",{className:"mb-6",children:[(0,Ag.jsx)(q_,{className:"h-16 w-16 text-blue-600 mx-auto mb-4"}),(0,Ag.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Welcome to LineSmart"}),(0,Ag.jsx)("p",{className:"text-gray-600 max-w-2xl mx-auto",children:"AI-powered training platform for your team. Get started in under 2 minutes!"})]}),(0,Ag.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,Ag.jsxs)("div",{className:"bg-green-50 p-6 rounded-lg",children:[(0,Ag.jsx)(F_,{className:"h-8 w-8 text-green-600 mb-3 mx-auto"}),(0,Ag.jsx)("h4",{className:"font-semibold text-green-900 mb-2",children:"Free AI Included"}),(0,Ag.jsx)("p",{className:"text-sm text-green-800",children:"50 trainings/month free"})]}),(0,Ag.jsxs)("div",{className:"bg-blue-50 p-6 rounded-lg",children:[(0,Ag.jsx)(s_,{className:"h-8 w-8 text-blue-600 mb-3 mx-auto"}),(0,Ag.jsx)("h4",{className:"font-semibold text-blue-900 mb-2",children:"Team Management"}),(0,Ag.jsx)("p",{className:"text-sm text-blue-800",children:"Track employee progress"})]}),(0,Ag.jsxs)("div",{className:"bg-purple-50 p-6 rounded-lg",children:[(0,Ag.jsx)(e_,{className:"h-8 w-8 text-purple-600 mb-3 mx-auto"}),(0,Ag.jsx)("h4",{className:"font-semibold text-purple-900 mb-2",children:"Smart Training"}),(0,Ag.jsx)("p",{className:"text-sm text-purple-800",children:"AI-generated content & quizzes"})]})]}),(0,Ag.jsxs)("div",{className:"space-y-4",children:[(0,Ag.jsxs)("button",{onClick:o,className:"w-full max-w-md px-8 py-4 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center justify-center space-x-2 mx-auto text-lg font-semibold",children:[(0,Ag.jsx)(F_,{className:"h-5 w-5"}),(0,Ag.jsx)("span",{children:"Quick Start (2 min)"})]}),(0,Ag.jsx)("p",{className:"text-sm text-gray-500",children:"Just enter your company name and you're ready to create training!"})]})]}),"company"===r&&(0,Ag.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-8",children:[(0,Ag.jsxs)("h3",{className:"text-xl font-semibold mb-6 flex items-center",children:[(0,Ag.jsx)(Vg,{className:"h-5 w-5 mr-2 text-blue-600"}),"Company Configuration"]}),(0,Ag.jsxs)("div",{className:"space-y-6",children:[(0,Ag.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company Name"}),(0,Ag.jsx)("input",{type:"text",value:a.company.name,onChange:e=>c("name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter your company name"})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Industry"}),(0,Ag.jsxs)("select",{value:a.company.industry,onChange:e=>{c("industry",e.target.value),a.company.name&&e.target.value&&f(a.company.name,e.target.value)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,Ag.jsx)("option",{value:"",children:"Select Industry"}),$g.map(e=>(0,Ag.jsx)("option",{value:e,children:e},e))]})]})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company Size"}),(0,Ag.jsxs)("select",{value:a.company.size,onChange:e=>c("size",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,Ag.jsx)("option",{value:"",children:"Select Company Size"}),qg.map(e=>(0,Ag.jsx)("option",{value:e,children:e},e))]})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Default Company Language"}),(0,Ag.jsx)("select",{value:a.company.defaultLanguage,onChange:e=>c("defaultLanguage",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:Qg.map(e=>(0,Ag.jsxs)("option",{value:e.code,children:[e.flag," ",e.name]},e.code))})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Departments"}),(0,Ag.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Gg.map(e=>(0,Ag.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,Ag.jsx)("input",{type:"checkbox",checked:a.company.departments.includes(e),onChange:t=>v(e,t.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,Ag.jsx)("span",{className:"text-sm text-gray-700",children:e})]},e))})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Safety & Compliance"}),(0,Ag.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Wg.map(e=>(0,Ag.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,Ag.jsx)("input",{type:"checkbox",checked:a.company.safetyRequirements.includes(e),onChange:t=>b(e,t.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,Ag.jsx)("span",{className:"text-sm text-gray-700",children:e})]},e))})]})]}),(0,Ag.jsxs)("div",{className:"flex justify-between mt-8",children:[(0,Ag.jsx)("button",{onClick:l,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Previous"}),(0,Ag.jsx)("button",{onClick:o,disabled:!a.company.name||!a.company.industry,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300",children:"Next"})]})]}),"ai-models"===r&&(0,Ag.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-8",children:[(0,Ag.jsxs)("h3",{className:"text-xl font-semibold mb-6 flex items-center",children:[(0,Ag.jsx)(e_,{className:"h-5 w-5 mr-2 text-blue-600"}),"AI Model Configuration"]}),(0,Ag.jsxs)("div",{className:"space-y-8",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-4",children:"Select Primary AI Model"}),(0,Ag.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Xg.map(e=>(0,Ag.jsxs)("div",{onClick:()=>d("primary",e.id),className:"p-4 border rounded-lg cursor-pointer transition-colors relative "+(a.aiModels.primary===e.id?e.isFree?"border-green-500 bg-green-50":"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"),children:[e.badge&&(0,Ag.jsx)("span",{className:"absolute top-2 right-2 px-2 py-1 bg-green-500 text-white text-xs font-bold rounded-full",children:e.badge}),(0,Ag.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:e.name}),(0,Ag.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]},e.id))})]}),a.aiModels.primary&&"free"!==a.aiModels.primary&&(0,Ag.jsxs)("div",{className:"border-t pt-6",children:[(0,Ag.jsxs)("h4",{className:"text-lg font-medium mb-4",children:["Configure ",null===(t=Xg.find(e=>e.id===a.aiModels.primary))||void 0===t?void 0:t.name]}),"llama"===a.aiModels.primary?(0,Ag.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:[(0,Ag.jsxs)("p",{className:"text-sm text-yellow-800",children:[(0,Ag.jsx)("strong",{children:"Local Llama Setup:"})," Install Ollama from"," ",(0,Ag.jsx)("a",{href:"https://ollama.ai",target:"_blank",rel:"noopener noreferrer",className:"underline",children:"ollama.ai"}),", then run ",(0,Ag.jsx)("code",{className:"bg-yellow-100 px-1 rounded",children:"ollama pull llama2"})," in your terminal."]}),(0,Ag.jsxs)("div",{className:"mt-3",children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ollama Endpoint"}),(0,Ag.jsx)("input",{type:"text",value:(null===(n=a.aiModels.configs.llama)||void 0===n?void 0:n.endpoint)||"http://localhost:11434",onChange:e=>u("llama","endpoint",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"http://localhost:11434"})]})]}):(0,Ag.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"API Key"}),(0,Ag.jsx)("input",{type:"password",value:(null===(i=a.aiModels.configs[a.aiModels.primary])||void 0===i?void 0:i.apiKey)||"",onChange:e=>u(a.aiModels.primary,"apiKey",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter API key"})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Model Version"}),(0,Ag.jsx)("input",{type:"text",value:(null===(s=a.aiModels.configs[a.aiModels.primary])||void 0===s?void 0:s.model)||"",onChange:e=>u(a.aiModels.primary,"model",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., gpt-4, claude-3-sonnet"})]})]}),(0,Ag.jsxs)("button",{onClick:()=>y(a.aiModels.primary,a.aiModels.configs[a.aiModels.primary]),className:"mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center space-x-2",children:[(0,Ag.jsx)(F_,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:"Test Connection"})]})]}),"free"===a.aiModels.primary&&(0,Ag.jsx)("div",{className:"border-t pt-6",children:(0,Ag.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,Ag.jsx)("h4",{className:"text-lg font-medium text-green-800 mb-2",children:"LineSmart Free Tier Selected"}),(0,Ag.jsx)("p",{className:"text-sm text-green-700 mb-3",children:"You're using LineSmart's hosted AI service. No API key required!"}),(0,Ag.jsxs)("ul",{className:"text-sm text-green-700 space-y-1",children:[(0,Ag.jsx)("li",{children:"- 50 AI generations per month"}),(0,Ag.jsx)("li",{children:"- Powered by GPT-4o-mini"}),(0,Ag.jsx)("li",{children:"- Full training content generation"}),(0,Ag.jsx)("li",{children:"- Quiz generation included"})]}),(0,Ag.jsx)("p",{className:"text-xs text-green-600 mt-3",children:"Need more? Add your own OpenAI API key for unlimited use."})]})})]}),(0,Ag.jsxs)("div",{className:"flex justify-between mt-8",children:[(0,Ag.jsx)("button",{onClick:l,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Previous"}),(0,Ag.jsx)("button",{onClick:o,disabled:!a.aiModels.primary,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300",children:"Next"})]})]}),"data-source"===r&&(0,Ag.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-8",children:[(0,Ag.jsxs)("h3",{className:"text-xl font-semibold mb-6 flex items-center",children:[(0,Ag.jsx)(h_,{className:"h-5 w-5 mr-2 text-blue-600"}),"Data Source & Training Data Configuration"]}),(0,Ag.jsxs)("div",{className:"space-y-8",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-4",children:"Select Data Source"}),(0,Ag.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:T.map(e=>(0,Ag.jsxs)("div",{onClick:()=>h("type",e.id),className:"p-4 border rounded-lg cursor-pointer transition-colors "+(a.dataSource.type===e.id?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"),children:[(0,Ag.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[e.icon,(0,Ag.jsx)("h4",{className:"font-medium text-gray-900",children:e.name})]}),(0,Ag.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]},e.id))})]}),(0,Ag.jsxs)("div",{className:"border-t pt-6",children:[(0,Ag.jsx)("h4",{className:"text-lg font-medium mb-4",children:"Training Data Settings"}),(0,Ag.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Chunk Size"}),(0,Ag.jsx)("input",{type:"number",value:a.dataSource.ragSettings.chunkSize,onChange:e=>m("chunkSize",parseInt(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Overlap"}),(0,Ag.jsx)("input",{type:"number",value:a.dataSource.ragSettings.overlap,onChange:e=>m("overlap",parseInt(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vector Store"}),(0,Ag.jsxs)("select",{value:a.dataSource.ragSettings.vectorStore,onChange:e=>m("vectorStore",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,Ag.jsx)("option",{value:"chromadb",children:"ChromaDB"}),(0,Ag.jsx)("option",{value:"pinecone",children:"Pinecone"}),(0,Ag.jsx)("option",{value:"weaviate",children:"Weaviate"}),(0,Ag.jsx)("option",{value:"qdrant",children:"Qdrant"})]})]})]})]})]}),(0,Ag.jsxs)("div",{className:"flex justify-between mt-8",children:[(0,Ag.jsx)("button",{onClick:l,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Previous"}),(0,Ag.jsx)("button",{onClick:o,disabled:!a.dataSource.type,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300",children:"Next"})]})]}),"onboarding"===r&&(0,Ag.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-8",children:[(0,Ag.jsxs)("h3",{className:"text-xl font-semibold mb-6 flex items-center",children:[(0,Ag.jsx)(g_,{className:"h-5 w-5 mr-2 text-blue-600"}),"Onboarding Configuration"]}),(0,Ag.jsxs)("div",{className:"space-y-6",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Default Onboarding Trainings"}),(0,Ag.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Kg.map(e=>(0,Ag.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,Ag.jsx)("input",{type:"checkbox",checked:a.onboarding.defaultTrainings.includes(e),onChange:t=>w(e,t.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,Ag.jsx)("span",{className:"text-sm text-gray-700",children:e})]},e))})]}),(0,Ag.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Probation Period (Days)"}),(0,Ag.jsx)("input",{type:"number",value:a.onboarding.probationPeriod,onChange:e=>g("probationPeriod",parseInt(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,Ag.jsx)("div",{children:(0,Ag.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,Ag.jsx)("input",{type:"checkbox",checked:a.onboarding.mentorAssignment,onChange:e=>g("mentorAssignment",e.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,Ag.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Automatic Mentor Assignment"})]})})]})]}),(0,Ag.jsxs)("div",{className:"flex justify-between mt-8",children:[(0,Ag.jsx)("button",{onClick:l,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Previous"}),(0,Ag.jsx)("button",{onClick:o,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Complete Setup"})]})]}),"complete"===r&&(0,Ag.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-8 text-center",children:[(0,Ag.jsxs)("div",{className:"mb-6",children:[(0,Ag.jsx)(jg,{className:"h-16 w-16 text-green-600 mx-auto mb-4"}),(0,Ag.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Setup Complete!"}),(0,Ag.jsx)("p",{className:"text-gray-600 max-w-2xl mx-auto",children:"Your Line Smart platform is now configured and ready to use."})]}),(0,Ag.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,Ag.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,Ag.jsxs)("h4",{className:"font-semibold text-blue-900 mb-2",children:["Company: ",a.company.name]}),(0,Ag.jsxs)("p",{className:"text-sm text-blue-800",children:[a.company.industry," \u2022 ",a.company.size]})]}),(0,Ag.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,Ag.jsxs)("h4",{className:"font-semibold text-green-900 mb-2",children:["AI Model: ",a.aiModels.primary]}),(0,Ag.jsxs)("p",{className:"text-sm text-green-800",children:["Training Data: ",a.dataSource.type]})]}),(0,Ag.jsxs)("div",{className:"bg-purple-50 p-4 rounded-lg",children:[(0,Ag.jsxs)("h4",{className:"font-semibold text-purple-900 mb-2",children:["Languages: ",a.company.supportedLanguages.length+1]}),(0,Ag.jsx)("p",{className:"text-sm text-purple-800",children:"Multi-language support enabled"})]})]}),(0,Ag.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,Ag.jsxs)("button",{onClick:async()=>{try{E&&await E({companyName:a.company.name,industry:a.company.industry,companySize:a.company.size,departments:a.company.departments,safetyRequirements:a.company.safetyRequirements,defaultLanguage:a.company.defaultLanguage,supportedLanguages:a.company.supportedLanguages,primaryModel:a.aiModels.primary,secondaryModel:a.aiModels.secondary,modelConfigs:a.aiModels.configs,dataSourceType:a.dataSource.type,ragSettings:a.dataSource.trainingDataSettings,defaultTrainings:a.onboarding.defaultTrainings,probationPeriod:a.onboarding.probationPeriod})}catch(e){console.error("Error completing setup:",e),alert(`Failed to complete setup: ${e.message}`)}},className:"px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center space-x-2",children:[(0,Ag.jsx)(s_,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:"Go to Dashboard"})]}),(0,Ag.jsxs)("button",{onClick:async()=>{try{E&&await E({companyName:a.company.name,industry:a.company.industry,companySize:a.company.size,departments:a.company.departments,safetyRequirements:a.company.safetyRequirements,defaultLanguage:a.company.defaultLanguage,supportedLanguages:a.company.supportedLanguages,primaryModel:a.aiModels.primary,secondaryModel:a.aiModels.secondary,modelConfigs:a.aiModels.configs,dataSourceType:a.dataSource.type,ragSettings:a.dataSource.trainingDataSettings,defaultTrainings:a.onboarding.defaultTrainings,probationPeriod:a.onboarding.probationPeriod}),A("create")}catch(e){console.error("Error completing setup:",e),alert(`Failed to complete setup: ${e.message}`)}},className:"px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center space-x-2",children:[(0,Ag.jsx)(jg,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:"Create Training"})]})]})]})]})},W_=Ig("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z",key:"nb9nel"}]]),K_=Ig("FileSearch",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7.5L14.5 2H6a2 2 0 0 0-2 2v3",key:"am10z3"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M5 17a3 3 0 1 0 0-6 3 3 0 0 0 0 6z",key:"ychnub"}],["path",{d:"m9 18-1.5-1.5",key:"1j6qii"}]]),Q_=e=>{var t,n,i;let{setupConfig:s,currentUser:r,currentUserDepartment:a,supervisedEmployees:o,employees:l,selectedEmployee:c,trainingData:d,updateTrainingData:u,updateQuizConfig:h,toggleAssignedEmployee:p,ragAnalysis:m,isAnalyzing:g,isGenerating:f,fileInputRef:y,onFileUpload:v,onRemoveDocument:b,onAnalyzeRAG:x,onGenerateTraining:w,getEnabledModels:_}=e;const S=_();return(0,Ag.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,Ag.jsx)("div",{className:"lg:col-span-2",children:(0,Ag.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[(0,Ag.jsxs)("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[(0,Ag.jsx)(k_,{className:"h-5 w-5 mr-2 text-blue-600"}),"Supervisor Training Development",(0,Ag.jsxs)("span",{className:"ml-3 text-sm text-gray-500",children:["(",null===r||void 0===r?void 0:r.name," - ",null===r||void 0===r?void 0:r.department,")"]})]}),(0,Ag.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:[(0,Ag.jsx)("h3",{className:"font-medium text-blue-900 mb-3",children:"Training Scope"}),(0,Ag.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[{value:"individual",icon:s_,label:"Individual Employee",desc:"Assign to specific employees"},{value:"department",icon:Vg,label:"Department Wide",desc:`All ${a} employees`},{value:"company",icon:W_,label:"Company Wide",desc:"All employees (requires approval)"}].map(e=>(0,Ag.jsxs)("label",{className:"flex items-center p-3 border rounded-lg cursor-pointer transition-colors "+(d.trainingScope===e.value?"border-blue-500 bg-blue-100":"border-gray-300"),children:[(0,Ag.jsx)("input",{type:"radio",name:"trainingScope",value:e.value,checked:d.trainingScope===e.value,onChange:e=>u("trainingScope",e.target.value),className:"sr-only"}),(0,Ag.jsxs)("div",{className:"text-center w-full",children:[(0,Ag.jsx)(e.icon,{className:"h-5 w-5 mx-auto mb-1 text-blue-600"}),(0,Ag.jsx)("span",{className:"text-sm font-medium",children:e.label}),(0,Ag.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:e.desc})]})]},e.value))})]}),(0,Ag.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:[(0,Ag.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,Ag.jsxs)("h3",{className:"font-medium text-blue-900 flex items-center",children:[(0,Ag.jsx)(K_,{className:"h-4 w-4 mr-2"}),"Document Analysis"]}),(0,Ag.jsx)("button",{onClick:x,disabled:g||!d.trainingType,className:"px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 disabled:bg-gray-300 flex items-center space-x-1",children:g?(0,Ag.jsxs)(Ag.Fragment,{children:[(0,Ag.jsx)("div",{className:"animate-spin h-3 w-3 border border-white border-t-transparent rounded-full"}),(0,Ag.jsx)("span",{children:"Analyzing..."})]}):(0,Ag.jsxs)(Ag.Fragment,{children:[(0,Ag.jsx)(N_,{className:"h-3 w-3"}),(0,Ag.jsx)("span",{children:"Analyze"})]})})]}),m?(0,Ag.jsxs)("div",{className:"space-y-3",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("h4",{className:"text-sm font-medium text-blue-800 mb-1",children:"Relevant Documents Found:"}),(0,Ag.jsx)("div",{className:"flex flex-wrap gap-2",children:m.relevantDocuments.map((e,t)=>(0,Ag.jsxs)("span",{className:"px-2 py-1 bg-white text-blue-700 rounded text-xs",children:[e.name," (",Math.round(100*e.relevance),"%)"]},t))})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("h4",{className:"text-sm font-medium text-blue-800 mb-1",children:"Key Insights:"}),(0,Ag.jsx)("ul",{className:"text-sm text-blue-700 space-y-1",children:m.suggestedContent.slice(0,2).map((e,t)=>(0,Ag.jsxs)("li",{className:"flex items-start",children:[(0,Ag.jsx)("span",{className:"mr-2",children:"\u2022"}),(0,Ag.jsx)("span",{children:e})]},t))})]})]}):(0,Ag.jsx)("p",{className:"text-sm text-blue-700",children:'Click "Analyze" to scan your company documents for relevant training content.'})]}),(0,Ag.jsxs)("div",{className:"space-y-6",children:[(0,Ag.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Training Title"}),(0,Ag.jsx)("input",{type:"text",value:d.title,onChange:e=>u("title",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Equipment Safety Training"})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Training Language"}),(0,Ag.jsx)("select",{value:d.language,onChange:e=>u("language",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:Qg.map(e=>(0,Ag.jsxs)("option",{value:e.code,children:[e.flag," ",e.name]},e.code))})]})]}),(0,Ag.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),(0,Ag.jsxs)("select",{value:d.department,onChange:e=>u("department",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,Ag.jsx)("option",{value:"",children:"Select Department"}),"department"===d.trainingScope?(0,Ag.jsx)("option",{value:a,children:a}):Gg.map(e=>(0,Ag.jsx)("option",{value:e,children:e},e))]})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Training Type"}),(0,Ag.jsxs)("select",{value:d.trainingType,onChange:e=>u("trainingType",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,Ag.jsx)("option",{value:"",children:"Select Training Type"}),Kg.map(e=>(0,Ag.jsx)("option",{value:e,children:e},e))]})]})]}),(0,Ag.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Due Date"}),(0,Ag.jsx)("input",{type:"date",value:d.dueDate,onChange:e=>u("dueDate",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"AI Model"}),(0,Ag.jsxs)("select",{value:d.aiModel,onChange:e=>u("aiModel",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,Ag.jsxs)("option",{value:"primary",children:["Primary (",s.aiModels.primary,")"]}),(0,Ag.jsx)("option",{value:"secondary",children:"Secondary Model"})]})]})]}),"individual"===d.trainingScope&&(0,Ag.jsxs)("div",{children:[(0,Ag.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Assign to Employees",(0,Ag.jsx)("span",{className:"text-xs text-blue-600 ml-2",children:"(Showing your supervised employees)"})]}),(0,Ag.jsx)("div",{className:"max-h-40 overflow-y-auto border border-gray-300 rounded-lg p-3",children:o.length>0?o.map(e=>(0,Ag.jsxs)("label",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0",children:[(0,Ag.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Ag.jsx)("input",{type:"checkbox",checked:d.assignedEmployees.includes(e.id),onChange:t=>p(e.id,t.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,Ag.jsxs)("div",{className:"flex-1",children:[(0,Ag.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Ag.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:["(",e.department," - ",e.position,")"]})]})]}),(0,Ag.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Ag.jsx)("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:pf(e.preferredLanguage)}),e.preferredLanguage!==d.language&&(0,Ag.jsx)("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded",children:"\u26a0\ufe0f Language mismatch"})]})]},e.id)):(0,Ag.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No supervised employees found."})}),c&&(0,Ag.jsxs)("p",{className:"text-sm text-blue-600 mt-2",children:["Pre-selected: ",c.name," (",pf(c.preferredLanguage),")"]})]}),"department"===d.trainingScope&&(0,Ag.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,Ag.jsx)("h4",{className:"font-medium text-green-900 mb-2",children:"Department-Wide Training"}),(0,Ag.jsxs)("p",{className:"text-sm text-green-800",children:["This training will be assigned to all employees in the ",a," department."]})]}),"company"===d.trainingScope&&(0,Ag.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:[(0,Ag.jsx)("h4",{className:"font-medium text-yellow-900 mb-2",children:"\u26a0\ufe0f Company-Wide Training"}),(0,Ag.jsx)("p",{className:"text-sm text-yellow-800",children:"This training will require management approval."})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Training Description"}),(0,Ag.jsx)("textarea",{value:d.description,onChange:e=>u("description",e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Provide specific details..."})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Learning Objectives"}),(0,Ag.jsx)("textarea",{value:d.objectives,onChange:e=>u("objectives",e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"What should employees be able to do after completing this training?"})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supporting Documents"}),(0,Ag.jsxs)("div",{onClick:()=>{var e;return null===(e=y.current)||void 0===e?void 0:e.click()},className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors cursor-pointer",children:[(0,Ag.jsx)(T_,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),(0,Ag.jsx)("p",{className:"text-sm text-gray-600",children:"Upload documents, procedures, and materials"})]}),(0,Ag.jsx)("input",{ref:y,type:"file",multiple:!0,accept:".pdf,.doc,.docx,.txt",onChange:v,className:"hidden"}),d.documents.length>0&&(0,Ag.jsx)("div",{className:"mt-4 space-y-2",children:d.documents.map((e,t)=>(0,Ag.jsxs)("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded-lg",children:[(0,Ag.jsxs)("div",{className:"flex items-center",children:[(0,Ag.jsx)(k_,{className:"h-4 w-4 text-blue-600 mr-2"}),(0,Ag.jsx)("span",{className:"text-sm text-gray-700",children:e.name})]}),(0,Ag.jsx)("button",{onClick:()=>b(t),className:"text-red-500 hover:text-red-700 text-sm",children:"Remove"})]},t))})]}),(0,Ag.jsxs)("div",{className:"border-t pt-6",children:[(0,Ag.jsxs)("h3",{className:"text-lg font-medium mb-4 flex items-center",children:[(0,Ag.jsx)(jg,{className:"h-5 w-5 mr-2 text-green-600"}),"Automated Quiz Generation"]}),(0,Ag.jsx)("div",{className:"bg-green-50 p-4 rounded-lg mb-4",children:(0,Ag.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-green-800 mb-1",children:"Quiz Questions"}),(0,Ag.jsxs)("select",{value:(null===(t=d.quizConfig)||void 0===t?void 0:t.questionCount)||5,onChange:e=>h("questionCount",parseInt(e.target.value)),className:"w-full px-3 py-1 border border-green-300 rounded text-sm focus:ring-2 focus:ring-green-500",children:[(0,Ag.jsx)("option",{value:3,children:"3 Questions"}),(0,Ag.jsx)("option",{value:5,children:"5 Questions"}),(0,Ag.jsx)("option",{value:7,children:"7 Questions"}),(0,Ag.jsx)("option",{value:10,children:"10 Questions"})]})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-green-800 mb-1",children:"Passing Score"}),(0,Ag.jsxs)("select",{value:(null===(n=d.quizConfig)||void 0===n?void 0:n.passingScore)||80,onChange:e=>h("passingScore",parseInt(e.target.value)),className:"w-full px-3 py-1 border border-green-300 rounded text-sm focus:ring-2 focus:ring-green-500",children:[(0,Ag.jsx)("option",{value:70,children:"70%"}),(0,Ag.jsx)("option",{value:80,children:"80%"}),(0,Ag.jsx)("option",{value:90,children:"90%"}),(0,Ag.jsx)("option",{value:100,children:"100%"})]})]}),(0,Ag.jsxs)("div",{children:[(0,Ag.jsx)("label",{className:"block text-sm font-medium text-green-800 mb-1",children:"Question Style"}),(0,Ag.jsxs)("select",{value:(null===(i=d.quizConfig)||void 0===i?void 0:i.style)||"mixed",onChange:e=>h("style",e.target.value),className:"w-full px-3 py-1 border border-green-300 rounded text-sm focus:ring-2 focus:ring-green-500",children:[(0,Ag.jsx)("option",{value:"mixed",children:"Mixed"}),(0,Ag.jsx)("option",{value:"multiple-choice",children:"Multiple Choice Only"}),(0,Ag.jsx)("option",{value:"scenario",children:"Scenario-Based"}),(0,Ag.jsx)("option",{value:"company-specific",children:"Company Policy Focus"})]})]})]})})]}),(0,Ag.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:(0,Ag.jsx)("div",{className:"flex items-center space-x-2 text-sm",children:S.length>0?(0,Ag.jsxs)(Ag.Fragment,{children:[(0,Ag.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,Ag.jsxs)("span",{className:"text-blue-800",children:["Will use your ",S[0][0].toUpperCase()," API \u2022 Fallback: Free LLaMA"]})]}):(0,Ag.jsxs)(Ag.Fragment,{children:[(0,Ag.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),(0,Ag.jsx)("span",{className:"text-blue-800",children:"\ud83e\udd99 Using free LLaMA API (no API key required)"})]})})}),(0,Ag.jsx)("button",{onClick:w,disabled:!d.title||!d.department||!d.trainingType||f,className:"w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:f?(0,Ag.jsxs)(Ag.Fragment,{children:[(0,Ag.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),(0,Ag.jsx)("span",{children:"Generating Training + Quiz..."})]}):(0,Ag.jsxs)(Ag.Fragment,{children:[(0,Ag.jsx)(e_,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:"Generate Training + Automated Quiz"})]})})]})]})}),(0,Ag.jsxs)("div",{className:"space-y-6",children:[(0,Ag.jsxs)("div",{className:"bg-green-50 rounded-xl p-6",children:[(0,Ag.jsx)("h3",{className:"text-lg font-semibold text-green-900 mb-3",children:"\ud83c\udfaf Supervisor Training Development"}),(0,Ag.jsx)("div",{className:"space-y-3 text-sm text-green-800",children:["Individual & department-wide training","Multi-language support (10+ languages)","Employee language preference matching"].map((e,t)=>(0,Ag.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Ag.jsx)(jg,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:e})]},t))})]}),(0,Ag.jsxs)("div",{className:"bg-purple-50 rounded-xl p-6",children:[(0,Ag.jsx)("h3",{className:"text-lg font-semibold text-purple-900 mb-3",children:"\ud83c\udf0d Multi-Language Training"}),(0,Ag.jsx)("div",{className:"space-y-3 text-sm text-purple-800",children:(0,Ag.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Ag.jsx)("span",{className:"font-medium",children:"Current Language:"}),(0,Ag.jsx)("span",{className:"px-2 py-1 bg-white rounded",children:pf(d.language)})]})})]}),(0,Ag.jsxs)("div",{className:"bg-blue-50 rounded-xl p-6",children:[(0,Ag.jsx)("h3",{className:"text-lg font-semibold text-blue-900 mb-3",children:"\ud83e\udd16 AI Features Active"}),(0,Ag.jsx)("div",{className:"space-y-3 text-sm text-blue-800",children:["Company document analysis","Performance-based recommendations","Multi-language policy integration"].map((e,t)=>(0,Ag.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Ag.jsx)(jg,{className:"h-4 w-4"}),(0,Ag.jsx)("span",{children:e})]},t))})]}),m&&(0,Ag.jsxs)("div",{className:"bg-yellow-50 rounded-xl p-6",children:[(0,Ag.jsx)("h3",{className:"text-lg font-semibold text-yellow-900 mb-3",children:"AI Recommendations"}),(0,Ag.jsx)("div",{className:"space-y-3",children:m.recommendedTrainings.map((e,t)=>(0,Ag.jsxs)("div",{className:"bg-white p-3 rounded border-l-4 border-yellow-400",children:[(0,Ag.jsx)("h4",{className:"font-medium text-yellow-900",children:e.title}),(0,Ag.jsx)("p",{className:"text-sm text-yellow-800 mt-1",children:e.reason}),(0,Ag.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,Ag.jsxs)("span",{className:"px-2 py-1 rounded text-xs "+("high"===e.priority?"bg-red-100 text-red-800":"medium"===e.priority?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:[e.priority," priority"]}),(0,Ag.jsx)("span",{className:"text-xs text-gray-600",children:e.estimatedDuration})]})]},t))})]})]})]})},X_=()=>{const{currentUser:e,userProfile:t,logout:n,refreshUserProfile:s}=Tg(),{company:r,employees:a,saveCompany:o,addEmployee:l,updateEmployee:c,saveTraining:d,saveQuizResult:u,loading:h,rolePermissions:p,error:m}=df(),[g,f]=(0,i.useState)(null),[y,v]=(0,i.useState)(!1),[b,x]=(0,i.useState)(!1),[w,_]=(0,i.useState)(null),S=gf(),C=Jw(),A=Yw(S.setupConfig,C.employees),E=Zw();(0,i.useEffect)(()=>{a&&a.length>0&&C.setEmployees(a)},[a]),(0,i.useEffect)(()=>{h||b||(x(!0),r&&r.name?(S.setCompletedSetup(!0),f("dashboard"),console.log("\ud83d\udcca Company loaded:",r.name,"- going to dashboard")):(f("setup"),console.log("\ud83d\udd27 No company found - showing setup")))},[h,r,b]),(0,i.useEffect)(()=>{r&&(S.setSetupConfig(e=>{var t,n,i;return{...e,companyName:r.name||e.companyName,company:{name:r.name,...r},industry:r.industry||e.industry,companySize:r.size||e.companySize,departments:r.departments||e.departments,safetyRequirements:r.safetyRequirements||e.safetyRequirements,defaultLanguage:r.defaultLanguage||e.defaultLanguage,supportedLanguages:r.supportedLanguages||e.supportedLanguages,primaryModel:(null===(t=r.aiModels)||void 0===t?void 0:t.primary)||e.primaryModel,secondaryModel:(null===(n=r.aiModels)||void 0===n?void 0:n.secondary)||e.secondaryModel,dataSourceType:(null===(i=r.dataSource)||void 0===i?void 0:i.type)||e.dataSourceType,aiModels:r.aiModels||e.aiModels}}),S.setCompletedSetup(!0))},[r]),(0,i.useEffect)(()=>{m&&_(m)},[m]);const T=t?{id:t.id,name:t.displayName||(null===e||void 0===e?void 0:e.displayName)||"User",email:null===e||void 0===e?void 0:e.email,role:t.role||"admin",department:t.department||"Management"}:C.getCurrentUser(),k=null===T||void 0===T?void 0:T.department,N=C.getSupervisedEmployees(T),I=(D=C.employees,"all"===(P=C.filterDepartment)?D:D.filter(e=>e.department===P));var D,P;const M=(e=>{const t=e.length,n=e.reduce((e,t)=>e+(t.totalTrainings>0?t.completedTrainings/t.totalTrainings*100:0),0)/t,i=e.reduce((e,t)=>e+(t.totalTrainings-t.completedTrainings),0),s=e.filter(e=>e.performance).reduce((e,t)=>e+t.performance,0)/e.filter(e=>e.performance).length;return{totalEmployees:t,avgCompletion:Math.round(n),activeTrainings:i,avgPerformance:Math.round(s||0)}})(C.employees);return h||null===g?(0,Ag.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,Ag.jsxs)("div",{className:"text-center",children:[(0,Ag.jsx)("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto"}),(0,Ag.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading your workspace..."})]})}):(0,Ag.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,Ag.jsx)(v_,{error:w||m,onClose:()=>_(null)}),(0,Ag.jsx)(i_,{setupConfig:S.setupConfig,currentUser:T,userProfile:t,userTier:(null===t||void 0===t?void 0:t.tier)||"pro",demoUser:null,completedSetup:S.completedSetup,onSetupClick:()=>f("setup"),onLogout:async()=>{try{await n()}catch(e){console.error("Logout error:",e)}},showLogout:!0}),(0,Ag.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:["setup"===g&&(0,Ag.jsx)(G_,{...S,setCurrentView:f,onComplete:async e=>{try{_(null),await o({name:e.companyName,industry:e.industry,size:e.companySize,departments:e.departments,safetyRequirements:e.safetyRequirements,defaultLanguage:e.defaultLanguage,supportedLanguages:e.supportedLanguages,aiModels:{primary:e.primaryModel,secondary:e.secondaryModel,modelConfigs:e.modelConfigs},dataSource:{type:e.dataSourceType,ragSettings:e.ragSettings},onboarding:{defaultTrainings:e.defaultTrainings,probationPeriod:e.probationPeriod}}),await s(),S.setCompletedSetup(!0),f("dashboard")}catch(t){console.error("Error saving company:",t),_(t.message||"Failed to save company information")}}}),"setup"!==g&&S.completedSetup&&(0,Ag.jsx)(f_,{currentView:g,setCurrentView:f,setShowTrainingData:v,generatedTraining:A.generatedTraining,canManageUsers:(null===p||void 0===p?void 0:p.canManageUsers)||(null===p||void 0===p?void 0:p.canInviteUsers)}),"dashboard"===g&&S.completedSetup&&(0,Ag.jsx)(w_,{stats:M,employees:I,filterDepartment:C.filterDepartment,setFilterDepartment:C.setFilterDepartment,setShowAddEmployee:C.setShowAddEmployee,setSelectedEmployee:C.setSelectedEmployee,setCurrentView:f}),"create"===g&&S.completedSetup&&(0,Ag.jsx)(Q_,{setupConfig:S.setupConfig,currentUser:T,currentUserDepartment:k,supervisedEmployees:N,employees:C.employees,selectedEmployee:C.selectedEmployee,trainingData:A.trainingData,updateTrainingData:A.updateTrainingData,updateQuizConfig:A.updateQuizConfig,toggleAssignedEmployee:A.toggleAssignedEmployee,ragAnalysis:A.ragAnalysis,isAnalyzing:A.isAnalyzing,isGenerating:A.isGenerating,fileInputRef:A.fileInputRef,onFileUpload:A.handleFileUpload,onRemoveDocument:A.removeDocument,onAnalyzeRAG:()=>A.analyzeTrainingWithRAG(C.selectedEmployee,A.trainingData.trainingType),onGenerateTraining:async()=>{if(await A.generateTraining(k,f),A.generatedTraining)try{_(null),await d({title:A.trainingData.title,department:A.trainingData.department,trainingType:A.trainingData.trainingType,language:A.trainingData.language,description:A.trainingData.description,objectives:A.trainingData.objectives,trainingScope:A.trainingData.trainingScope,content:A.generatedTraining.content,quiz:A.generatedTraining.quiz,assignedEmployees:A.trainingData.assignedEmployees,dueDate:A.trainingData.dueDate})}catch(e){console.error("Error saving training:",e),_(e.message||"Failed to save training")}},getEnabledModels:A.getEnabledModels}),"review"===g&&A.generatedTraining&&(0,Ag.jsx)(E_,{generatedTraining:A.generatedTraining,trainingData:A.trainingData,onStartQuiz:()=>{E.startQuiz(f)}}),"quiz"===g&&A.generatedTraining&&(0,Ag.jsx)(__,{generatedTraining:A.generatedTraining,currentQuestionIndex:E.currentQuestionIndex,userAnswers:E.userAnswers,trainingData:A.trainingData,onAnswerSelect:E.handleAnswerSelect,onPrevious:E.goToPreviousQuestion,onNext:()=>E.goToNextQuestion(A.generatedTraining.quiz.length),onSubmit:()=>{var e;E.submitQuiz(A.generatedTraining,null===(e=A.trainingData.quizConfig)||void 0===e?void 0:e.passingScore,f)},progressPercentage:E.getCurrentProgress(A.generatedTraining.quiz.length),canSubmit:E.isAllQuestionsAnswered(A.generatedTraining.quiz.length)}),"results"===g&&E.quizResults&&(0,Ag.jsx)(C_,{quizResults:E.quizResults,generatedTraining:A.generatedTraining,trainingData:A.trainingData,onReviewTraining:()=>f("review"),onRetakeQuiz:()=>{E.retakeQuiz(f)},onComplete:async()=>{if(C.selectedEmployee&&E.quizResults)try{var e;_(null),await u({employeeId:C.selectedEmployee.id,trainingId:null===(e=A.generatedTraining)||void 0===e?void 0:e.id,trainingTitle:A.trainingData.title,score:E.quizResults.score,percentage:E.quizResults.percentage,passed:E.quizResults.passed,answers:E.userAnswers}),E.quizResults.passed&&C.updateEmployeeTraining(C.selectedEmployee.id,A.trainingData,E.quizResults,A.ragAnalysis)}catch(t){console.error("Error saving quiz result:",t),_(t.message||"Failed to save quiz result")}f("dashboard")}}),"users"===g&&S.completedSetup&&((null===p||void 0===p?void 0:p.canManageUsers)||(null===p||void 0===p?void 0:p.canInviteUsers))&&(0,Ag.jsx)($_,{})]}),y&&(0,Ag.jsx)(U_,{onClose:()=>v(!1)}),(0,Ag.jsx)(b_,{isOpen:C.showAddEmployee,onClose:()=>C.setShowAddEmployee(!1),newEmployee:C.newEmployee,onUpdateNewEmployee:C.updateNewEmployee,onAddEmployee:async()=>{try{_(null);const e=C.newEmployee;await l({name:e.name,email:e.email,department:e.department,position:e.position,role:e.role||"employee",supervisor:null===T||void 0===T?void 0:T.id,hireDate:(new Date).toISOString(),preferredLanguage:S.setupConfig.defaultLanguage}),C.setShowAddEmployee(!1),C.resetNewEmployee()}catch(e){console.error("Error adding employee:",e),_(e.message||"Failed to add employee")}}}),C.selectedEmployee&&"dashboard"===g&&(0,Ag.jsx)(x_,{employee:C.selectedEmployee,onClose:()=>C.setSelectedEmployee(null)})]})};class Y_ extends i.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t),this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?(0,Ag.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center px-4",children:(0,Ag.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:[(0,Ag.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,Ag.jsx)(Dg,{className:"h-8 w-8 text-red-600 flex-shrink-0"}),(0,Ag.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Something went wrong"})]}),(0,Ag.jsx)("p",{className:"text-gray-600 mb-4",children:"We're sorry, but something unexpected happened. Please try refreshing the page."}),this.state.error&&(0,Ag.jsx)("div",{className:"bg-red-50 border border-red-200 rounded p-3 mb-4",children:(0,Ag.jsx)("p",{className:"text-sm text-red-800 font-mono",children:this.state.error.toString()})}),(0,Ag.jsx)("button",{onClick:()=>window.location.reload(),className:"w-full py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Refresh Page"})]})}):this.props.children}}const J_=Y_,Z_=()=>{const{currentUser:e,loading:t,resetPassword:n}=Tg(),[s,r]=(0,i.useState)("login"),[a,o]=(0,i.useState)(!1),[l,c]=(0,i.useState)(""),[d,u]=(0,i.useState)(""),[h,p]=(0,i.useState)(!1);(0,i.useEffect)(()=>{const e=()=>{p("/join"===window.location.pathname)};return e(),window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)},[]);const m=async()=>{if(l)try{await n(l),u("Password reset email sent! Check your inbox.")}catch(e){u("Error sending reset email. Please try again.")}else u("Please enter your email")};return h?(0,Ag.jsx)(lf,{}):t?(0,Ag.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,Ag.jsxs)("div",{className:"text-center",children:[(0,Ag.jsx)("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto"}),(0,Ag.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading LineSmart..."})]})}):e?(0,Ag.jsx)(J_,{children:(0,Ag.jsx)(Ug,{children:(0,Ag.jsx)(X_,{})})}):a?(0,Ag.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-900 via-blue-800 to-indigo-900 flex items-center justify-center p-4",children:(0,Ag.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-8",children:[(0,Ag.jsxs)("div",{className:"text-center mb-8",children:[(0,Ag.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-4",children:[(0,Ag.jsx)("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:(0,Ag.jsx)("span",{className:"text-white font-bold text-xl",children:"LS"})}),(0,Ag.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:"LineSmart"})]}),(0,Ag.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Reset Password"}),(0,Ag.jsx)("p",{className:"text-gray-500 mt-1",children:"Enter your email to receive a reset link"})]}),d&&(0,Ag.jsx)("div",{className:"mb-6 p-4 rounded-lg "+(d.includes("sent")?"bg-green-50 border border-green-200 text-green-700":"bg-red-50 border border-red-200 text-red-700"),children:(0,Ag.jsx)("p",{className:"text-sm",children:d})}),(0,Ag.jsxs)("div",{className:"space-y-4",children:[(0,Ag.jsx)("input",{type:"email",value:l,onChange:e=>c(e.target.value),placeholder:"Enter your email",className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"}),(0,Ag.jsx)("button",{onClick:m,className:"w-full py-2.5 px-4 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-all",children:"Send Reset Link"}),(0,Ag.jsx)("button",{onClick:()=>{o(!1),u("")},className:"w-full py-2.5 px-4 bg-gray-100 text-gray-700 font-medium rounded-lg hover:bg-gray-200 transition-all",children:"Back to Login"})]})]})}):"signup"===s?(0,Ag.jsx)(Bg,{onSwitchToLogin:()=>r("login")}):(0,Ag.jsx)(Lg,{onSwitchToSignup:()=>r("signup"),onForgotPassword:()=>o(!0)})};s.createRoot(document.getElementById("root")).render((0,Ag.jsx)(i.StrictMode,{children:(0,Ag.jsx)(kg,{children:(0,Ag.jsx)(hf,{children:(0,Ag.jsx)(Z_,{})})})}))})();
//# sourceMappingURL=main.309db91c.js.map